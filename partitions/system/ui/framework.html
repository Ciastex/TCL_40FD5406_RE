<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style>
body
{
    margin: 0;
    /*background: rgba(0,0,0,0.9);*/
    background-size: 1920px 1080px;
}
  
#main
{
    position: absolute;
    left: 0px;
    top: 0px;
    width: 1920px;
    height: 1080px;
	z-index:0;
}

#globleShow
{
    position: absolute;
	left: 0px;
    top: 0px;
    width: 1920px;
    height: 1080px;
	z-index:1000;
}
#otherPage
{
	 position: absolute;
    left: 0px;
    top: 0px;
    width: 1920px;
    height: 1080px;
	z-index:2;
}
#operatePage
{
	position: absolute;
    left: 0px;
    top: 0px;
    width: 1920px;
    height: 1080px;
	z-index:1;
}
#frontPanel
{
	position:absolute;
	bottom:30px;
	left:50px;
	width:600px;
	height:70px;
	line-height:70px;
	border:solid 4px #1b1b1b;
	font-size:32px;
	color:#fff;
	background: #000000;
	text-align:center;
	pointer-events:none;
	z-index:1000;
	display:none;
}
#backgroundDownloadContainer{
	bottom:10px;
	right:10px;
	pointer-events:none;
	z-index:1000;
}
#downloadProgressValue{
	top:0px;
	left:0px;
	line-height:160px;
	text-align:center;
	font-size:25px;
	font-weight:bold;
	color:#fff;
}
#bgDownloadTitle{
    top:0px;
    left:0px;
    line-height:160px;
    text-align:center;
    font-size:25px;
    font-weight:bold;
    color:#fff;
}
.backgroundDownload{
	position:absolute;
	width:160px;
	height:160px;
}
#factoryHotkeyForm
{
	position: absolute;
    left: 50px;
    bottom: 50px;
    width: 450px;
    height: 280px;
	background:#000;
	opacity:0.7;
	border-radius:10px;
	pointer-events:none;
	z-index:1000;
	display:none;
}
.atrrH
{
	position: absolute;
	left:5px;
	font-size:20px;
	font-weight:bold;
	color:#F00;
}
.atrrL
{
	position: absolute;
	left:5px;
	font-size:20px;
	font-weight:bold;
	color:#fff;
}
.atrrR
{
	position: absolute;
	right:20px;
	font-size:20px;
	font-weight:bold;
	color:#fff;
}
#mute
{
    position: absolute;
    right: 50px;
    bottom: 200px;
    width: 90px;
    height: 90px;
	pointer-events:none;
	z-index:1000;
	display:none;
}
#glassRemind
{
	position:absolute;
	width:700px;
	height:200px;
	left:610px;
	font-size:30px;
	line-height:60px;
	text-align:center;
	padding-top:40px;
	top:390px;
	border:4px solid #1b1b1b;
	background:#000000;
	opacity:0.92;
	color:#ffffff;
	pointer-events:none;
	z-index:-10;
	display:none;
}
#volumeOffRemind
{
	position:absolute;
	width:700px;
	height:200px;
	left:610px;
	font-size:30px;
	line-height:60px;
	text-align:center;
	padding-top:40px;
	top:390px;
	border:4px solid #1b1b1b;
	background:#000000;
	opacity:0.92;
	color:#ffffff;
	pointer-events:none;
	z-index:1000;
	display:none;
}

#tvFaultDiagnosisRemind
{
	position:absolute;
	width:600px;
	height:120px;
	left:1050px;
	font-size:30px;
	line-height:60px;
	text-align:center;
	bottom:5px;
	border:4px solid #1b1b1b;
	background:#000000;
	opacity:0.92;
	color:#ffffff;
	pointer-events:none;
	z-index:1000;
	display:none;
}
#nScreenPhoneConnectToTvRemind
{
	position: absolute;
    left: 660px;
    top: 440px;
    width: 600px;
    height: 200px;
	line-height:200px;
    background: rgba(0,0,0,1);
    border:solid 4px #1b1b1b;
    color:#fff;
    font-size:28px;
    font-weight:bold;
    text-align: center;
	pointer-events:none;
	z-index:1000;
	display:none;
}
#nScreenPhoneConnectToTvRemind span
{
	position:absolute;
	left: 0px;	
	top:70px;
	height:40px;
	width:600px;
	line-height:40px;
	text-align:center;
	
}
#virtualRemote
{
    position: absolute;
	left: 0px;
    top: 0px;
    width: 1920px;
    height: 1080px;
    display:none;
	z-index:-1000;
}
</style>
<script type="text/javascript" src="event.js"></script>
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="keyboard.js"></script>
<script type="text/javascript" src="dataAccess.js"></script>
<script type="text/javascript" src="initZone.js"></script>
<script>
/**********系统相关变量 start*********************/
var  SourceSupportFlag = 0;
var g_setting 				= tcl.setting;
var g_channel 				= tcl.channel;
var g_factory 				= tcl.factory;
var g_media 				= tcl.media;
var g_pvr 					= tcl.pvr;
var g_tvfaultdiagnosis      = tcl.faultdiagnosis;
var g_isStartRemount = 0; //0:no;1:yes
var pvr                     = g_pvr;
var g_ulits                 = tcl.utils;
var currentPanel            = g_setting.is3DPanel;
var bluetooth 			    = tcl.bluetooth;//add yums  2015-3-28
var g_ginga			 		= tcl.ginga;
var g_nitRefreshControl     = 0; //0 mead need to show; 1 no need to show
var g_isUsedHotKeyToIntoPage= 0;					//是否通过快捷键进入页面，如fav,list,guide等,0 否， 1 是
var g_isUsedNotifyIntoPage 	= 0;					//是否通过消息进入页面，如CI_NAME_READY消息等,0 否， 1 是
var g_superPassword 		= "0423";
var g_remindWord 			= "";					//notAvailable,noTeleText
///////////////////////////////////////////////////////////快捷键使用的变量 end
var g_lastTime 				= -1;					//关机时间倒计时,power off timer
var g_previousHtmlPage 		= "";					//页面的前一个页面名称，比如在channel_play.html页面中按guide页面时进入guide，g_previousHtmlPage = “channel_play.html”,返回时从新返回channel_play.html页面。
var g_nextHtmlPage 			= "";
var g_volume_timer 			= 0;
var g_volume_visible 		= 0;					//判断当前的声音调是否可用
var mute_status 			= 0;
var force_mute_status	    = 0;
var g_temp                  = "";
var preTempPage		="";
var isFirstInitNotifyThread = 1;					//1 第一次初始化（创建）消息接收线程
var isChangeToScartAfterInit= 0;
var isChangeSourceJustNow 	= 0;					//是否刚刚切换完成信源1 是，0 否;用来判断分辨率是否应该显示的问题
var iseStickerPlaying = 0;                          //eSticker 正在播放(视频或标签)
var eStickerPlayingList = "";                       //eSticker 视频播放列表(USB或内置)
var eStickerPlayingVideoFlag = 0;                   //eSticker 视频播放标志(USB或内置) 1: 视频播放  0:tv singal或非视频播放
var eStickerPlayingVideoDemoFlag = 0;               //eSticker 内置视频播放标志 1: 内置视频播放  0:usb视频播放
var start_stop_flag = 0;
var menu_visible_status 	= 0;					//表示菜单显示与否，这里的菜单不仅仅指index主菜单,只要退出了channelPlay都算是进入了菜单，0 没有显示，1 显示
var g_satellites_name		= ["Astra HD+","Sky DE","ORS","Astra 19.2E","Astra 23.5E","Astra 28.2E","Hotbird 13.0E","Atlbird 5.0W","Turksat 42.0E","Eutel W3A 7.0E","Hispasat 30.0W","Eutelsat 36.0E","Astra 4A 4.8E","Sat1","Sat2","Sat3","Sat4","Thor (1W)","Sirius (5E)","Hotbird","Astra","nc+ / nc ++ MIX","n na karte"];
var g_operators_name		= ["Astra HD+","Sky Deutschland","ORS","AustriaSat","Others","CannalDigitaal HD","CannalDigitaal SD","TV VLAANDEREN HD","TV VLAANDEREN SD","TELESAT_Belgium","TELESAT_Luxembourg","Seznam kanalu pro Cesko","Seznam kanalu pro Slovensko","Canal Digital","nc+ / nc ++ MIX","n na karte"];
//缩写的都不翻译
/*
ENG（英语）	SPA,GLG,BAQ,EUS,CAT（西班牙）	FRE（法语）	GER（德语）	ITA（意大利语）	CZE（捷克斯洛伐克语）
SCR（克罗地亚语）	DAN（丹麦语）	HUN（匈牙利语）	DUT（荷兰语）	NOR（挪威语）	POL（波兰语）
POR（葡萄牙语）	RUM（罗马尼亚语）	SLO（斯洛伐克语）	SLV（斯洛文尼亚语）	SCC（塞尔维亚语）	FIN（芬兰语）
SWE（瑞典语）	TUR（土耳其）	GRE（希腊语）	BUL（保加利亚语）	RUS（俄语）	LAT（拉脱维亚语）	LIT（立陶宛语）
EST（爱沙尼亚语）	UKR（乌克兰语）
English,Spanish,French,German,Italian,
Czech,Croatian,Danish,Hungarian,Dutch,
Norwegian,Polish,Portuguese,Romanian,Slovak,
Slovenian,Serbian,Finnish,Swedish,Turkish,
Greek,Bulgarian,Russian,Latvian,Lithuanian,
Estonian,Ukrainian
*/
var mlmLangIndex 			= [6,7,9,5,12,
								0,10,2,13,14,
								15,16,17,19,25,
								20,21,22,23,35,
								8,24,18,33,279,
								36,468,63,107,287];				//按照上面的语言排序得到的多语言index
var mlmCountryIndex 		= [25,22,8,9,12,
								5,4,6,11,14,
								15,16,17,18,31,
								21,20,7,23,32,
								10,3,19,30,58,
								28,59,117,126,129];					//多语言mlmLangIndex对应的country index
var mlmName 				= ["English","Spanish","French","German","Italian",
								"Czech","Croatian","Danish","Hungarian","Dutch",
								"Norwegian","Polish","Portuguese","Romanian","Slovak",
								"Slovenian","Serbian","Finnish","Swedish","Turkish",
								"Greek","Bulgarian","Russian","Latvian","Lithuanian",
								"Estonian","Ukrainian","Albanian","Bosnian","Macedonian"];
var sysMenuLang				= ["English","Español","Français","Deutsch","Italiano",
								"Čeština","Hrvatski","Dansk","Magyar","Nederlands",
								"Norsk","Polski","Português","Română","Slovenčina",
								"Slovenščina","Srpski","Suomi","Svenska","Türkçe",
								"Ελληνικά","Български","Русский","Latviešu","Lietuvių",
								"Eesti","Українська","Shqip","Bosanski","Македонски"];
var mlmLangIndexLA         =  [6,17,7];       //LA区域语言排序
var sysMenuLangLA	       = ["English","Português","Español"];

var mlmLangIndexNA         =  [6,7];       //NA区域语言排序
var sysMenuLangNA	       = ["English","Español"];

var mlmLangIndexCO        =  [6,17,7];       
var sysMenuLangCO	       = ["English","Português","Español"];

var mlmCountryIndexLA     =[40,46,52,41,
                            44,43,92,49,152,
                            48,45,39,35,38,42];

var mlmCountryIndexCA     =[140,139,142,47,157,
							44,138,150,156,
							92,145,49,147,153,
							152,137,56,54,48,
							149,148,144,141,143,
							136,146,55];
var mlmLangIndexCA     =[7,7,7,7,7,
						7,7,7,7,
						7,7,7,7,7,
						7,7,7,7,7,
						7,7,7,7,7,
						7,7,6];
                            
var mlmCountryIndexCO     =[84];

var mlmCountryIndexAP     = [
	105,67,80,100,0,159,79,86,107,3,
    170,154,132,84,81,68,111,94,91,188,
    99,98,162,82,73,61,77,34,108,96,
    63,71,74,66,78,95,116,134,37,209,
    121,90,85,106,115,97,87,135,26,216,
    109,101,72,104,149,35,76,19,75,228,
    20,133,158,114,88,110,124,70,36,69,
    32,83,123,59,64,58,102,112,155];
var mlmLangIndexAP     = [
	31,9,17,18,6,86,31,6,9,6,
    9,6,9,7,9,31,6,6,9,9,
    18,6,9,6,223,6,6,232,6,31,
    18,6,31,18,31,6,31,6,6,9,
    9,18,319,31,6,6,6,9,6,9,
    6,31,6,31,7,6,31,18,31,9,
    6,26,6,6,6,31,18,6,442,9,
    35,6,6,18,471,474,31,6,6];

var mlmCountryIndexIRN     = [
    105,67,80,100,0,159,79,86,107,3,
    170,154,132,84,81,68,111,94,91,188,
    99,98,162,82,73,60,61,34,108,96,
    63,71,74,66,78,95,116,134,37,209,
    121,90,85,106,115,97,87,135,26,216,
    109,89,101,72,104,149,35,76,19,75,
    228,20,133,158,114,88,110,103,124,70,
    36,69,32,83,123,59,64,58,102,112,
    155];
var mlmLangIndexIRN     = [
    31,9,17,18,6,86,31,6,9,6,
    9,6,9,7,9,31,6,6,9,9,
    18,6,9,6,223,362,6,232,6,31,
    18,6,31,18,31,6,31,6,6,9,
    9,18,319,31,6,6,6,9,6,9,
    6,39,31,6,31,7,6,31,18,31,
    9,6,26,6,6,6,31,31,18,6,
    442,9,35,6,6,18,471,474,31,6,
    6];

var sourceOptions			= ["TV","AV","CMP","HDMI1","HDMI2","HDMI3","HDMI4","VGA","Media"];
var soundSystem 			= ["BG", "A2 B/G", "L", "L'", "I", "D/K","A2 D/K","A2 D/K1","A2 D/K2","M"];
var factoryOpenPromt		= [["D","P","W","S"],
								["NG","OK"],
								["NG","MAC","D_ID","U_ID","NID"]];
var netWlessAuto			= ["PIN","PBC"];
var sdHd					= ["SD","HD"];
var pOrI            		= ["p","i"];
var pvrOther     			= ["CH"];
/*audioSttlTtxLang:
 Albanian,Basque,Bosnian,Bulgarian,Catalan,Croatian,Czech,Danish,Dutch,English,Estonian,Finnish,
French,Gaelic,Irish,Galician,German,Greek,Hungarian,Italian,Icelandic,Latvian,
Lithuanian,Macedonian,Maori,Norwegian,Polish,Portuguese,Romanian,Russian,Sami,Serbian,Slovak,Slovenian,
Spanish,Swedish,Turkish,Welsh,Ukrainian,Original Audio*/
var audioSttlTtxLang		= [63,97,107,24,117,44,10,0,2,14,
                               6,36,22,9,28,185,5,8,40,13,
                               214,12,32,232,38,33,279,287,43,45,
                               15,16,17,19,18,383,21,25,20,7,
                               23,35,468,30,46];

/*备份
var souSoundType	= ["Invalid","Mono","Forced Mono","G Stereo","K Stereo",
						"Mono Sap","Stereo Sap","Dual A","Dual B","Dual AB",
						"Nicam Mono","Nicam Stereo","Nicam Dual A","Nicam Dual B","Nicam Dual AB",
						"Hidev Mono","Left Left","Right Right","Left Right"];// 无翻译
*/
/**********系统相关变量 相关变量 end*********************/

/**********channel 相关变量 start*********************/
var g_isShowInfoBar 		= 0;					// 0 no, 1 yes,初始化为1，因为初次进入channel_play.html要更新channel info 数据
var g_MMHStatus 			= 0;					//0 MMH not open ,1 MMH open 除了没有信号外刚进入channel_play.html要隐藏info bar和 信号提示框
var channelType				= 1;
////////////////////booking 时使用
var bookingMode 			= 0;						//0 no booking ,1  record, 2 reminder
/**********channel 相关变量 end*********************/



/*********************************setting  start*********************************/
var g_language 				= 0;
var g_country;
/*********ci*************/
var g_ciIsInUpdateForm 		= 0;					//1 在ci 数据更新的弹出对话框上，0 其他
var g_ciUpdateType 			= -1;					//-1 默认值，0 响应消息CI_OP_UPDATE_CHANNEL，1 响应消息CI_OP_UPDATE_NIT
var g_ciCurrentCardName;							//当前ci card的名称
var g_ciUpdateStatus		= 0;					//ci 升级状态，0：没有在升级中；1：在升级中。在升级过程中不能做相关的ci操作
/*********network*************/
var  cleanBrowserCacheFlag = 0;		//for hotel mode. just clean 1 time
/*********************************setting end*****************************/


/***********media 多媒体使用的变量 start ****************/
var g_page 					= new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1);
var g_pfposition			= new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
										-1,-1,-1,-1,-1,-1,-1,-1,-1,-1);
var g_searchFlag 			= 0;						//files searching flag:[0] unfinish [1] finish
var g_pushType			= 0;	// 1:music 2:picture 3:video 4:kodi 5:youtube					
var uiColourStyle = "#00aadd";
var uiColourStyleFlag = 1;
var runningTimer        = 0;
var SYSTEM_RUNNING_TIME = 540*60*1000;//系统运行时间
var cmd_vrc_auto_search_type = 0;//VRC 自动搜台type
var suspend_ts;
var configPackVersion = g_factory.getConfigPackVersion();//获取子版本号
var isShowOnce = 0;
// 主页按ok键时的集焦对象
var pressOkObject = null;
function initSetRegion()
{
	if("blue" == getUIStyle())
	{
		uiColourStyle = "#00aadd";
		uiColourStyleFlag = 1;
	}
	else
	{
		uiColourStyle = "#f00";
		uiColourStyleFlag = 0;
	}
}
function getUIStyle()
{
    if("null" == g_setting.getProperty("ro.sita.model.Apps.ui_branch","null"))
    {
        if(top.isLAFlag || top.isAUFlag || top.isNAFlag
                || ("TCL" == g_setting.getProperty("ro.sita.model.MODEL_MANUFACTURER_NAME_CFG.MANUFACTURER_NAME", "THOMSON")))
        {
            return "blue";
        }
        else
        {
            return "red";
        }
    }
    else
    {
        if("red" == g_setting.getProperty("ro.sita.model.Apps.ui_style","blue"))
        {
            return "red";
        }
        else
        {
            return "blue";
        }
    }
}
function enterKodi(type)
{
	var fileInfo="";
	g_media.setEnterDeviceType(2); 
	fileInfo = g_media.getCurrentPlayingMediaInfo();
	console.log("w------------enterKodi--------------------"+fileInfo.path);
	var pos=fileInfo.path.indexOf('plugin://');
	var endpos=fileInfo.path.indexOf('#');
	console.log("-----pos"+pos);
	console.log("c--------------enterKodi------------------"+fileInfo.path.substring(pos));
	g_media.setEnterDeviceType(0); 
	if (appOpenFlag)
	{ 
	    var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
	    if (appname == "tbrowser.kodi")
	    {
	        top.g_ulits.sendDataToApplication("tbrowser.kodi","http://127.0.0.1:1234/index.html?"+new Date().getTime()+"#uri="+fileInfo.path.substring(pos,endpos), 0x8300);
	    }
		return;
	}
				
	if(top.g_channel.checkhbbtvStatus()==3)
	{
        globleHBBTVClose();
	}
	if (top.preTempPage=="media" || top.g_temp=="media")
	{
	    top.g_lastEnterType = -1;
	    top.g_isMediaCenter = top.NDM_Others;
	    top.g_media.mediaStop(0);
	    top.g_media.deviceExitUninit();
	}
				
	checkPVR();
	appOpenFlag = 1;
	top.RemoteConntrolType = "HbbTV";
	g_setting.setProperty("app.ui.currentApp","tbrowser.kodi");
	closePage($("operatePage"));
	closePage($("otherPage"));
	$("main").onload = function(){
	    top.$("main").style.display="none";
	    top.$("operatePage").style.display="none";
	    top.$("otherPage").style.display="none";
	    $("main").onload =  function(){};
	    setTimeout(function(){
	        tcl.channel.requestInputSource(10);
	        tcl.channel.requestMute(0);
	        g_setting.sendMsgToDBC(1);
	        top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
	        top.g_ulits.openApplication("tbrowser.kodi","http://127.0.0.1:1234/index.html#uri="+fileInfo.path.substring(pos,endpos));
	    },10);
	}
	$("main").src="channelPlay.html";
	top.requestFocus(top.main, 1);
	setFrameFocusPage("main");
	menu_visible_status = 0;
	if (top.preTempPage!="homePage" && top.g_temp!="homePage")
	{
	    if (top.g_channel.inputSource != 10)
	    {
	        top.lastInputSource = top.g_channel.inputSource;
	    }
	}	
}
if(1)
{
	var NDM_Others = 0;
	var NDM_Device_List = 1;
	var NDM_Media_List = 2;
	var NDM_VIDEO_Play = 3;
	var NDM_Music_Play = 4;
	var NDM_Pic_Play = 5;
	var NDM_PVR_List = 6;
	var NDM_PVR_Play = 7;
	var NDM_DMR_Video = 8;
	var NDM_DMR_Music = 9;
	var NDM_DMR_Pic = 10;
}

function enterMediaPlay()
{
	g_dlnaMode = "dmr";
	g_previousHtmlPage = "channelPlay.html";
	if(top.g_channel.checkhbbtvStatus()==3)
        globleHBBTVClose();
		
	if(recordStatusFlag == 1)
	{
		g_pvr.recordStop();
		$("globleShow").contentWindow.hiddenRecord();
		pvrCurrentTime=0;
		recordStatusFlag =0;
	    pvrTotalTime=2*60*60;
	}
	else if(timeShiftStatusFlag == 1)
	{
		g_pvr.timeshiftStop();
		g_pvr.returnToLive();//返回实时播放页面
		g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
		timeShiftStatusFlag = 0;
		$("globleShow").contentWindow.hiddenTimeShift();
	}
	stopTimeout();
    if (top.g_temp == "homePage" || top.preTempPage=="homePage")
    {
        tcl.channel.requestMute(0);
    }
	top.g_temp="quickMenu";
    top.$("otherPage").src="";
    top.$("operatePage").src="";
    top.requestFocus(top.main, 1);
    setFrameFocusPage("main");
	top.$("otherPage").style.display = "block";
	top.$("operatePage").style.display = "block";
	top.$("main").style.display = "block";
}
var g_isMediaCenter = NDM_Others;
var g_newDeviceCount = 0;

var g_MediaVideoPlayCount = 0;
var g_MediaPicPlayCount = 0;

var g_mediaList;										//多媒体列表，多媒体使用，用完以后要释放内存,每次最多存放21个元素
var g_movieList 			= "";
var g_musicList 			= "";
var g_pictureList 			= "";
var g_deviceList 			= "";
var g_diskPosition 			= 0;
var g_mediaPosition 		= 0;						//初始化时焦点媒体在总的媒体列表中的序号位置
var g_currentMedia 			= "";						//这个是从index传进来的参数,例如：myMoive,myMusic,myPicture,myFile
var g_path;
var g_fileInfo;
var g_availableStatus 		= 0;						//0 媒体可以播放，其他为 媒体不可以播放

var g_deviceInfo 			= "";//g_media device
var g_focusTab				= "";//"Menu" "FirstColumn" "MusicCtl" "Option" "OptionList"
var g_mediaFolderPath		= "";//for saving current view folder path
var g_filePathDepth			= 0;
var g_currentMediaType		= "";//current view list type:[0]all file [1]pic [2]video [3]music
var g_listIndex = new Array(4);//for saving last list: list start index & focus index

var g_BGMmdiaFolderPath    =""//记录上一次背景音乐媒体播放的所在的路径  //add yums
var g_BGMmediaListIndex    = -1;//用于记录上一次播放的
var g_BGMmediaListStart    = -1;
var g_BGMmediaPath         = "";
var g_BGMmediaPathIndex    = "";/0-2/
var g_fileListDepth        = -1;
var g_menu5In1Visiable =0;
/***********多媒体使用的变量 end ****************/

/********************** LA FREQUENCY *************************/
var atv_antenna_freq = [{num: 2, freq: 55250}, {num: 3, freq: 61250}, {num: 4, freq: 67250},
				   		{num: 5, freq: 77250}, {num: 6, freq: 83250}, {num: 7, freq: 175250},
				   		{num: 8, freq: 181250}, {num: 9, freq: 187250}, {num: 10, freq: 193250}, 
						{num: 11, freq: 199250}, {num: 12, freq: 205250}, {num: 13, freq: 211250}, 
						{num: 14, freq: 471250}, {num: 15, freq: 477250}, {num: 16, freq: 483250}, 
						{num: 17, freq: 489250}, {num: 18, freq: 495250}, {num: 19, freq: 501250}, 
						{num: 20, freq: 507250}, {num: 21, freq: 513250}, {num: 22, freq: 519250}, 
						{num: 23, freq: 525250}, {num: 24, freq: 531250}, {num: 25, freq: 537250}, 
						{num: 26, freq: 543250}, {num: 27, freq: 549250}, {num: 28, freq: 555250}, 
						{num: 29, freq: 561250}, {num: 30, freq: 567250}, {num: 31, freq: 573250}, 
						{num: 32, freq: 579250}, {num: 33, freq: 585250}, {num: 34, freq: 591250}, 
						{num: 35, freq: 597250}, {num: 36, freq: 603250}, {num: 37, freq: 609250}, 
						{num: 38, freq: 615250}, {num: 39, freq: 621250}, {num: 40, freq: 627250},
						{num: 41, freq: 633250}, {num: 42, freq: 639250}, {num: 43, freq: 645250}, 
						{num: 44, freq: 651250}, {num: 45, freq: 657250}, {num: 46, freq: 663250}, 
						{num: 47, freq: 669250}, {num: 48, freq: 675250}, {num: 49, freq: 681250}, 
						{num: 50, freq: 687250}, {num: 51, freq: 693250}, {num: 52, freq: 699250}, 
						{num: 53, freq: 705250}, {num: 54, freq: 711250}, {num: 55, freq: 717250}, 
						{num: 56, freq: 723250}, {num: 57, freq: 729250}, {num: 58, freq: 735250}, 
						{num: 59, freq: 741250}, {num: 60, freq: 747250}, {num: 61, freq: 753250},
						{num: 62, freq: 759250}, {num: 63, freq: 765250}, {num: 64, freq: 771250}, 
						{num: 65, freq: 777250}, {num: 66, freq: 783250}, {num: 67, freq: 789250},
						{num: 68, freq: 795250}, {num: 69, freq: 801250}];

var dtv_antenna_freq = [{num: 7, freq: 177143}, {num: 8, freq: 183143}, {num: 9, freq: 189143}, 
						{num: 10, freq: 195143}, {num: 11, freq: 201143}, {num: 12, freq: 207143}, 
						{num: 13, freq: 213143}, {num: 14, freq: 473143}, {num: 15, freq: 479143}, 
						{num: 16, freq: 485143}, {num: 17, freq: 491143}, {num: 18, freq: 497143}, 
						{num: 19, freq: 503143}, {num: 20, freq: 509143}, {num: 21, freq: 515143}, 
						{num: 22, freq: 521143}, {num: 23, freq: 527143}, {num: 24, freq: 533143}, 
						{num: 25, freq: 539143}, {num: 26, freq: 545143}, {num: 27, freq: 551143}, 
						{num: 28, freq: 557143}, {num: 29, freq: 563143}, {num: 30, freq: 569143}, 
						{num: 31, freq: 575143}, {num: 32, freq: 581143}, {num: 33, freq: 587143}, 
						{num: 34, freq: 593143}, {num: 35, freq: 599143}, {num: 36, freq: 605143},
                        {num: 37, freq: 611143}, {num: 38, freq: 617143}, {num: 39, freq: 623143},
                        {num: 40, freq: 629143}, {num: 41, freq: 635143}, {num: 42, freq: 641143},
						{num: 43, freq: 647143}, {num: 44, freq: 653143}, {num: 45, freq: 659143}, 
						{num: 46, freq: 665143}, {num: 47, freq: 671143}, {num: 48, freq: 677143}, 
						{num: 49, freq: 683143}, {num: 50, freq: 689143}, {num: 51, freq: 695143}, 
						{num: 52, freq: 701143}, {num: 53, freq: 707143}, {num: 54, freq: 713143}, 
						{num: 55, freq: 719143}, {num: 56, freq: 725143}, {num: 57, freq: 731143}, 
						{num: 58, freq: 737143}, {num: 59, freq: 743143}, {num: 60, freq: 749143}, 
						{num: 61, freq: 755143}, {num: 62, freq: 761143}, {num: 63, freq: 767143}, 
						{num: 64, freq: 773143}, {num: 65, freq: 779143}, {num: 66, freq: 785143}, 
						{num: 67, freq: 791143}, {num: 68, freq: 797143}, {num: 69, freq: 803143}];

var atv_cable_freq	 = [{num: 1, freq: 73250}, {num: 2, freq: 55250}, {num: 3, freq: 61250}, 
						{num: 4, freq: 67250}, {num: 5, freq: 77250}, {num: 6, freq: 83250}, 
						{num: 7, freq: 175250}, {num: 8, freq: 181250}, {num: 9, freq: 187250}, 
						{num: 10, freq: 193250}, {num: 11, freq: 199250}, {num: 12, freq: 205250}, 
						{num: 13, freq: 211250}, {num: 14, freq: 121250}, {num: 15, freq: 127250}, 
						{num: 16, freq: 133250}, {num: 17, freq: 139250}, {num: 18, freq: 145250}, 
						{num: 19, freq: 151250}, {num: 20, freq: 157250}, {num: 21, freq: 163250}, 
						{num: 22, freq: 169250}, {num: 23, freq: 217250}, {num: 24, freq: 223250}, 
						{num: 25, freq: 229250}, {num: 26, freq: 235250}, {num: 27, freq: 241250},
						{num: 28, freq: 247250}, {num: 29, freq: 253250}, {num: 30, freq: 259250}, 
						{num: 31, freq: 265250}, {num: 32, freq: 271250}, {num: 33, freq: 277250}, 
						{num: 34, freq: 283250}, {num: 35, freq: 289250}, {num: 36, freq: 295250}, 
						{num: 37, freq: 301250}, {num: 38, freq: 307250}, {num: 39, freq: 313250}, 
						{num: 40, freq: 319250}, {num: 41, freq: 325250}, {num: 42, freq: 331250}, 
						{num: 43, freq: 337250}, {num: 44, freq: 343250}, {num: 45, freq: 349250}, 
						{num: 46, freq: 355250}, {num: 47, freq: 361250}, {num: 48, freq: 367250},
						{num: 49, freq: 373250}, {num: 50, freq: 379250}, {num: 51, freq: 385250}, 
						{num: 52, freq: 391250}, {num: 53, freq: 397250}, {num: 54, freq: 403250}, 
						{num: 55, freq: 409250}, {num: 56, freq: 415250}, {num: 57, freq: 421250},
						{num: 58, freq: 427250}, {num: 59, freq: 433250}, {num: 60, freq: 439250},
						{num: 61, freq: 445250}, {num: 62, freq: 451250}, {num: 63, freq: 457250}, 
						{num: 64, freq: 463250}, {num: 65, freq: 469250}, {num: 66, freq: 475250}, 
						{num: 67, freq: 481250}, {num: 68, freq: 487250}, {num: 69, freq: 493250},
						{num: 70, freq: 499250}, {num: 71, freq: 505250}, {num: 72, freq: 511250}, 
						{num: 73, freq: 517250}, {num: 74, freq: 523250}, {num: 75, freq: 529250}, 
						{num: 76, freq: 535250}, {num: 77, freq: 541250}, {num: 78, freq: 547250}, 
						{num: 79, freq: 553250}, {num: 80, freq: 559250}, {num: 81, freq: 565250}, 
						{num: 82, freq: 571250}, {num: 83, freq: 577250}, {num: 84, freq: 583250}, 
						{num: 85, freq: 589250}, {num: 86, freq: 595250}, {num: 87, freq: 601250},
						{num: 88, freq: 607250}, {num: 89, freq: 613250}, {num: 90, freq: 619250}, 
						{num: 91, freq: 625250}, {num: 92, freq: 631250}, {num: 93, freq: 637250}, 
						{num: 94, freq: 643250}, {num: 95, freq: 91250}, {num: 96, freq: 97250}, 
						{num: 97, freq: 103250}, {num: 98, freq: 109250}, {num: 99, freq: 115250}, 
						{num: 100, freq: 649250}, {num: 101, freq: 655250}, {num: 102, freq: 661250}, 
						{num: 103, freq: 667250}, {num: 104, freq: 673250}, {num: 105, freq: 679250}, 
						{num: 106, freq: 685250}, {num: 107, freq: 691250}, {num: 108, freq: 697250}, 
						{num: 109, freq: 703250}, {num: 110, freq: 709250}, {num: 111, freq: 715250}, 
						{num: 112, freq: 721250}, {num: 113, freq: 727250}, {num: 114, freq: 733250}, 
						{num: 115, freq: 739250}, {num: 116, freq: 745250}, {num: 117, freq: 751250}, 
						{num: 118, freq: 757250}, {num: 119, freq: 763250}, {num: 120, freq: 769250}, 
						{num: 121, freq: 775250}, {num: 122, freq: 781250}, {num: 123, freq: 787250},
						{num: 124, freq: 793250}, {num: 125, freq: 799250}, {num: 126, freq: 805250}, 
						{num: 127, freq: 811250}, {num: 128, freq: 817250}, {num: 129, freq: 823250}, 
						{num: 130, freq: 829250}, {num: 131, freq: 835250}, {num: 132, freq: 841250}, 
						{num: 133, freq: 847250}, {num: 134, freq: 853250}, {num: 135, freq: 859250}];

/********************** NA DTV FREQUENCY *************************/
var dtv_antenna_freq_NA = [{num: 2, freq: 57000},{num: 3, freq: 63000},{num: 4, freq: 69000},{num: 5, freq: 79000},
						   {num: 6, freq: 85000},{num: 7, freq: 177000},{num: 8, freq: 183000},{num: 9, freq: 189000},
						   {num: 10, freq: 195000},{num: 11, freq: 201000},{num: 12, freq: 207000},{num: 13, freq: 213000},
						   {num: 14, freq: 473000},{num: 15, freq: 479000},{num: 16, freq: 485000},{num: 17, freq: 491000},
						   {num: 18, freq: 497000},{num: 19, freq: 503000},{num: 20, freq: 509000},{num: 21, freq: 515000},
						   {num: 22, freq: 521000},{num: 23, freq: 527000},{num: 24, freq: 533000},{num: 25, freq: 539000},
						   {num: 26, freq: 545000},{num: 27, freq: 551000},{num: 28, freq: 557000},{num: 29, freq: 563000},
						   {num: 30, freq: 569000},{num: 31, freq: 575000},{num: 32, freq: 581000},{num: 33, freq: 587000},
						   {num: 34, freq: 593000},{num: 35, freq: 599000},{num: 36, freq: 605000},{num: 37, freq: 611000},
						   {num: 38, freq: 617000},{num: 39, freq: 623000},{num: 40, freq: 629000},{num: 41, freq: 635000},
						   {num: 42, freq: 641000},{num: 43, freq: 647000},{num: 44, freq: 653000},{num: 45, freq: 659000},
						   {num: 46, freq: 665000},{num: 47, freq: 671000},{num: 48, freq: 677000},{num: 49, freq: 683000},
						   {num: 50, freq: 689000},{num: 51, freq: 695000},{num: 52, freq: 701000},{num: 53, freq: 707000},
						   {num: 54, freq: 713000},{num: 55, freq: 719000},{num: 56, freq: 725000},{num: 57, freq: 731000},
						   {num: 58, freq: 737000},{num: 59, freq: 743000},{num: 60, freq: 749000},{num: 61, freq: 755000},
						   {num: 62, freq: 761000},{num: 63, freq: 767000},{num: 64, freq: 773000},{num: 65, freq: 779000},
						   {num: 66, freq: 785000},{num: 67, freq: 791000},{num: 68, freq: 797000},{num: 69, freq: 803000},
							];
var dtv_cable_freq_NA	 = [{num: 1, freq: 75000},{num: 2, freq: 57000},{num: 3, freq: 63000},{num: 4, freq: 69000},
							{num: 5, freq: 79000},{num: 6, freq: 85000},{num: 7, freq: 177000},{num: 8, freq: 183000},
							{num: 9, freq: 189000},{num: 10, freq: 195000},{num: 11, freq: 201000},{num: 12, freq: 207000},
							{num: 13, freq: 213000},{num: 14, freq: 123000},{num: 15, freq: 129000},{num: 16, freq: 135000},
							{num: 17, freq: 141000},{num: 18, freq: 147000},{num: 19, freq: 153000},{num: 20, freq: 159000},
							{num: 21, freq: 165000},{num: 22, freq: 171000},{num: 23, freq: 219000},{num: 24, freq: 225000},
							{num: 25, freq: 231000},{num: 26, freq: 237000},{num: 27, freq: 243000},{num: 28, freq: 249000},
							{num: 29, freq: 255000},{num: 30, freq: 261000},{num: 31, freq: 267000},{num: 32, freq: 273000},
							{num: 33, freq: 279000},{num: 34, freq: 285000},{num: 35, freq: 291000},{num: 36, freq: 297000},
							{num: 37, freq: 303000},{num: 38, freq: 309000},{num: 39, freq: 315000},{num: 40, freq: 321000},
							{num: 41, freq: 327000},{num: 42, freq: 333000},{num: 43, freq: 339000},{num: 44, freq: 345000},
							{num: 45, freq: 351000},{num: 46, freq: 357000},{num: 47, freq: 363000},{num: 48, freq: 369000},
							{num: 49, freq: 375000},{num: 50, freq: 381000},{num: 51, freq: 387000},{num: 52, freq: 393000},
							{num: 53, freq: 399000},{num: 54, freq: 405000},{num: 55, freq: 411000},{num: 56, freq: 417000},
							{num: 57, freq: 423000},{num: 58, freq: 429000},{num: 59, freq: 435000},{num: 60, freq: 441000},
							{num: 61, freq: 447000},{num: 62, freq: 453000},{num: 63, freq: 459000},{num: 64, freq: 465000},
							{num: 65, freq: 471000},{num: 66, freq: 477000},{num: 67, freq: 483000},{num: 68, freq: 489000},
							{num: 69, freq: 495000},{num: 70, freq: 501000},{num: 71, freq: 507000},{num: 72, freq: 513000},
							{num: 73, freq: 519000},{num: 74, freq: 525000},{num: 75, freq: 531000},{num: 76, freq: 537000},
							{num: 77, freq: 543000},{num: 78, freq: 549000},{num: 79, freq: 555000},{num: 80, freq: 561000},
							{num: 81, freq: 567000},{num: 82, freq: 573000},{num: 83, freq: 579000},{num: 84, freq: 585000},
							{num: 85, freq: 591000},{num: 86, freq: 597000},{num: 87, freq: 603000},{num: 88, freq: 609000},
							{num: 89, freq: 615000},{num: 90, freq: 621000},{num: 91, freq: 627000},{num: 92, freq: 633000},
							{num: 93, freq: 639000},{num: 94, freq: 645000},{num: 95, freq: 93000},{num: 96, freq: 99000},
							{num: 97, freq: 105000},{num: 98, freq: 111000},{num: 99, freq: 117000},{num: 100, freq: 651000},
							{num: 101, freq: 657000},{num: 102, freq: 663000},{num: 103, freq: 669000},{num: 104, freq: 675000},
							{num: 105, freq: 681000},{num: 106, freq: 687000},{num: 107, freq: 693000},{num: 108, freq: 699000},
							{num: 109, freq: 705000},{num: 110, freq: 711000},{num: 111, freq: 717000},{num: 112, freq: 723000},
							{num: 113, freq: 729000},{num: 114, freq: 735000},{num: 115, freq: 741000},{num: 116, freq: 747000},
							{num: 117, freq: 753000},{num: 118, freq: 759000},{num: 119, freq: 765000},{num: 120, freq: 771000},
							{num: 121, freq: 777000},{num: 122, freq: 783000},{num: 123, freq: 789000},{num: 124, freq: 795000},
							{num: 125, freq: 801000},{num: 126, freq: 807000},{num: 127, freq: 813000},{num: 128, freq: 819000},
							{num: 129, freq: 825000},{num: 130, freq: 831000},{num: 131, freq: 837000},{num: 132, freq: 843000},
							{num: 133, freq: 849000},{num: 134, freq: 855000},{num: 135, freq: 861000}];
/********************** Columbia DTV FREQUENCY *************************/
var dtv_antenna_freq_Columbia = [{num: 14, freq: 473000},{num: 15, freq: 479000},{num: 16, freq: 485000},{num: 17, freq: 491000},
							{num: 18, freq: 497000},{num: 19, freq: 503000},{num: 20, freq: 509000},{num: 21, freq: 515000},
							{num: 22, freq: 521000},{num: 23, freq: 527000},{num: 24, freq: 533000},{num: 25, freq: 539000},
							{num: 26, freq: 545000},{num: 27, freq: 551000},{num: 28, freq: 557000},{num: 29, freq: 563000},
							{num: 30, freq: 569000},{num: 31, freq: 575000},{num: 32, freq: 581000},{num: 33, freq: 587000},
							{num: 34, freq: 593000},{num: 35, freq: 599000},{num: 36, freq: 605000},{num: 37, freq: 611000},
							{num: 38, freq: 617000},{num: 39, freq: 623000},{num: 40, freq: 629000},{num: 41, freq: 635000},
							{num: 42, freq: 641000},{num: 43, freq: 647000},{num: 44, freq: 653000},{num: 45, freq: 659000},
							{num: 46, freq: 665000},{num: 47, freq: 671000},{num: 48, freq: 677000},{num: 49, freq: 683000},
							{num: 50, freq: 689000},{num: 51, freq: 695000},{num: 52, freq: 701000},{num: 53, freq: 707000},
							{num: 54, freq: 713000},{num: 55, freq: 719000},{num: 56, freq: 725000},{num: 57, freq: 731000},
							{num: 58, freq: 737000},{num: 59, freq: 743000},{num: 60, freq: 749000},{num: 61, freq: 755000},
							{num: 62, freq: 761000},{num: 63, freq: 767000},{num: 64, freq: 773000},{num: 65, freq: 779000},
							{num: 66, freq: 785000},{num: 67, freq: 791000},{num: 68, freq: 797000},{num: 69, freq: 803000}];
/**********************Columbia  ATV FREQUENCY *************************/
/* antenna ATV频点表与 atv_antenna_freq 相同*/
/* cable   ATV频点表*/
var atv_cable_freq_Columbia	 = [{num: 1, freq:73250},{num: 2, freq: 55250}, {num: 3, freq: 61250},
						{num: 4, freq: 67250}, {num: 5, freq: 77250}, {num: 6, freq: 83250},
						{num: 7, freq: 175250}, {num: 8, freq: 181250}, {num: 9, freq: 187250}, 
						{num: 10, freq: 193250}, {num: 11, freq: 199250}, {num: 12, freq: 205250}, 
						{num: 13, freq: 211250}, {num: 14, freq: 121250}, {num: 15, freq: 127250}, 
						{num: 16, freq: 133250}, {num: 17, freq: 139250}, {num: 18, freq: 145250}, 
						{num: 19, freq: 151250}, {num: 20, freq: 157250}, {num: 21, freq: 163250}, 
						{num: 22, freq: 169250}, {num: 23, freq: 217250}, {num: 24, freq: 223250}, 
						{num: 25, freq: 229250}, {num: 26, freq: 235250}, {num: 27, freq: 241250},
						{num: 28, freq: 247250}, {num: 29, freq: 253250}, {num: 30, freq: 259250}, 
						{num: 31, freq: 265250}, {num: 32, freq: 271250}, {num: 33, freq: 277250}, 
						{num: 34, freq: 283250}, {num: 35, freq: 289250}, {num: 36, freq: 295250}, 
						{num: 37, freq: 301250}, {num: 38, freq: 307250}, {num: 39, freq: 313250}, 
						{num: 40, freq: 319250}, {num: 41, freq: 325250}, {num: 42, freq: 331250}, 
						{num: 43, freq: 337250}, {num: 44, freq: 343250}, {num: 45, freq: 349250}, 
						{num: 46, freq: 355250}, {num: 47, freq: 361250}, {num: 48, freq: 367250},
						{num: 49, freq: 373250}, {num: 50, freq: 379250}, {num: 51, freq: 385250}, 
						{num: 52, freq: 391250}, {num: 53, freq: 397250}, {num: 54, freq: 403250}, 
						{num: 55, freq: 409250}, {num: 56, freq: 415250}, {num: 57, freq: 421250},
						{num: 58, freq: 427250}, {num: 59, freq: 433250}, {num: 60, freq: 439250},
						{num: 61, freq: 445250}, {num: 62, freq: 451250}, {num: 63, freq: 457250}, 
						{num: 64, freq: 463250}, {num: 65, freq: 469250}, {num: 66, freq: 475250}, 
						{num: 67, freq: 481250}, {num: 68, freq: 487250}, {num: 69, freq: 493250},
						{num: 70, freq: 499250}, {num: 71, freq: 505250}, {num: 72, freq: 511250}, 
						{num: 73, freq: 517250}, {num: 74, freq: 523250}, {num: 75, freq: 529250}, 
						{num: 76, freq: 535250}, {num: 77, freq: 541250}, {num: 78, freq: 547250}, 
						{num: 79, freq: 553250}, {num: 80, freq: 559250}, {num: 81, freq: 565250}, 
						{num: 82, freq: 571250}, {num: 83, freq: 577250}, {num: 84, freq: 583250}, 
						{num: 85, freq: 589250}, {num: 86, freq: 595250}, {num: 87, freq: 601250},
						{num: 88, freq: 607250}, {num: 89, freq: 613250}, {num: 90, freq: 619250}, 
						{num: 91, freq: 625250}, {num: 92, freq: 631250}, {num: 93, freq: 637250}, 
						{num: 94, freq: 643250}, {num: 95, freq: 91250}, {num: 96, freq: 97250}, 
						{num: 97, freq: 103250}, {num: 98, freq: 109250}, {num: 99, freq: 115250}, 
						{num: 100, freq: 649250}, {num: 101, freq: 655250}, {num: 102, freq: 661250}, 
						{num: 103, freq: 667250}, {num: 104, freq: 673250}, {num: 105, freq: 679250}, 
						{num: 106, freq: 685250}, {num: 107, freq: 691250}, {num: 108, freq: 697250}, 
						{num: 109, freq: 703250}, {num: 110, freq: 709250}, {num: 111, freq: 715250}, 
						{num: 112, freq: 721250}, {num: 113, freq: 727250}, {num: 114, freq: 733250}, 
						{num: 115, freq: 739250}, {num: 116, freq: 745250}, {num: 117, freq: 751250}, 
						{num: 118, freq: 757250}, {num: 119, freq: 763250}, {num: 120, freq: 769250}, 
						{num: 121, freq: 775250}, {num: 122, freq: 781250}, {num: 123, freq: 787250},
						{num: 124, freq: 793250}, {num: 125, freq: 799250}, {num: 126, freq: 805250},
						{num: 127, freq: 811250}, {num: 128, freq: 817250}, {num: 129, freq: 823250},
						{num: 130, freq: 829250}, {num: 131, freq: 835250}, {num: 132, freq: 841250},
						{num: 133, freq: 847250}, {num: 134, freq: 853250}, {num: 135, freq: 859250}];
/*******vienan dtv  antenna*******/
var dtv_antenna_freq_vienant = [{num: 6, freq: 178000}, {num: 7, freq: 186000},
						{num: 8, freq: 194000}, {num: 9, freq: 202000}, {num: 10, freq: 210000},
						{num: 11, freq: 218000}, {num: 12, freq: 226000}, {num: 21, freq: 474000},
						{num: 22, freq: 482000}, {num: 23, freq: 490000}, {num: 24, freq: 498000},
						{num: 25, freq: 506000}, {num: 26, freq: 514000}, {num: 27, freq: 522000},
						{num: 28, freq: 530000}, {num: 29, freq: 538000}, {num: 30, freq: 546000},
						{num: 31, freq: 554000}, {num: 32, freq: 562000}, {num: 33, freq: 570000},
						{num: 34, freq: 578000}, {num: 35, freq: 586000}, {num: 36, freq: 594000},
						{num: 37, freq: 602000}, {num: 38, freq: 610000}, {num: 39, freq: 618000},
						{num: 40, freq: 626000}, {num: 41, freq: 634000}, {num: 42, freq: 642000},
						{num: 43, freq: 650000}, {num: 44, freq: 658000}, {num: 45, freq: 666000},
						{num: 46, freq: 674000}, {num: 47, freq: 682000}, {num: 48, freq: 690000},
						{num: 49, freq: 698000}, {num: 50, freq: 706000}, {num: 51, freq: 714000},
						{num: 52, freq: 722000}, {num: 53, freq: 730000}, {num: 54, freq: 738000},
						{num: 55, freq: 746000}, {num: 56, freq: 754000}, {num: 57, freq: 762000},
						{num: 58, freq: 770000}, {num: 59, freq: 778000}, {num: 60, freq: 786000}];

/*******iran dtv cable*******/
var dtv_freq_iran = [{num: 6, freq: 177500}, {num: 7, freq: 184500},
	{num: 8, freq: 191500}, {num: 9, freq: 198500}, {num: "9A", freq: 205500},
	{num: 10, freq: 212500}, {num: 11, freq: 219500},{num: 12, freq: 226500},
	{num: 21, freq: 474000}, {num: 22, freq: 482000}, {num: 23, freq: 490000},
	{num: 24, freq: 498000}, {num: 25, freq: 506000}, {num: 26, freq: 514000},
	{num: 27, freq: 522000}, {num: 28, freq: 530000}, {num: 29, freq: 538000},
	{num: 30, freq: 546000}, {num: 31, freq: 554000}, {num: 32, freq: 562000},
	{num: 33, freq: 570000}, {num: 34, freq: 578000}, {num: 35, freq: 586000},
	{num: 36, freq: 594000}, {num: 37, freq: 602000}, {num: 38, freq: 610000},
	{num: 39, freq: 618000}, {num: 40, freq: 626000}, {num: 41, freq: 634000},
	{num: 42, freq: 642000}, {num: 43, freq: 650000}, {num: 44, freq: 658000},
	{num: 45, freq: 666000}, {num: 46, freq: 674000}, {num: 47, freq: 682000},
	{num: 48, freq: 690000}, {num: 49, freq: 698000}, {num: 50, freq: 706000},
	{num: 51, freq: 714000}, {num: 52, freq: 722000}, {num: 53, freq: 730000},
	{num: 54, freq: 738000}, {num: 55, freq: 746000}, {num: 56, freq: 754000},
	{num: 57, freq: 762000}, {num: 58, freq: 770000}, {num: 59, freq: 778000},
	{num: 60, freq: 786000}, {num: 61, freq: 794000}, {num: 62, freq: 802000},
	{num: 63, freq: 810000}, {num: 64, freq: 818000}, {num: 65, freq: 826000},
	{num: 66, freq: 834000}, {num: 67, freq: 842000}, {num: 68, freq: 850000},
						{num: 69, freq: 858000}];
/****************dlna 使用的变量 start***/
var g_focusPosition			= [[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],
								[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],
								[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],
								[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],
								[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1]];
							/*layerIndex进入文件夹从下标为1的地方开始*/
var g_dlnaPage				= [0,-1,-1,-1,-1,-1,-1,-1,-1,-1,
								-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
								-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
								-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
								-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];
var surfaceFlag				= 0;
var selectType				= 0;						//0 movie ,1 music ,2 photo ,3 dir
var g_dlnaPath;											//进入dlna文件浏览时使用
var g_dlnaName;
var g_dlnaMode;											//"dmr","dmp";chenhua add
/****************dlna 使用的变量 end***/


/*******************factory start *********************************/
var g_factory_designModeHotkey = 0;						//工厂菜单中DesignModeHotkey属性，0 off,1 on
var g_factory_hotkey 		= 0;						//工厂菜单factory menu 下factory hotkey 属性，0 off,1 on
var g_factory_mode 			= 0;						//工厂模式：0 设计师模式，1 工厂模式
var g_factory_keypad_state	= 0;

var g_openMheg5State 		= 0;
var g_motionClarity		= "Off";
/*********************factory end ******************************/

/*********************pvr and timeshit ******************************/
var pvrTotalTime            = 2*60*60;
var pvrCurrentTime          = 0;
var recordStatusFlag        = 0;
var timeShiftStatusFlag		= 0;						//0 no time shift run.1 time shift  runing
var pvrBookingDuration      = 0;
var pvrBookingScheduleId    = 0;
var g_scanStatus =0;
var pvrPlayStatusFlag      	= 0;
/*********************pvr and timeshit******************************/

/***************Upgrade related variables start***************/
/* g_whichUpdateDialogWillBeUsed
 * 0:Whether to download
 * 1:Whether to update after finishing downloading
 * 2:Update again
 * 3:Abnormal dialog. For example, network error.*/
var g_whichUpdateDialogWillBeUsed = 0;
var g_isDownloading = -1;  //-1:initial value 0:is not downloading 1: is downloading
var g_isForceUpgrade = false;
var bisUpgrade =0; //yiling0609
var g_downloadProgress = 0;
/****************Upgrade related variables end****************/


var shopRemindFlag 			= 1;						//1 shop remind is show,0 shop remind is not show
var isFirstInChanenlPlay 	= 1;						//1 yes, 0 no

var parentalLock			= 0;
var channelLock				= 0;
var inputLock 				= 0;
var playNumFromHref;


var startT;
var endT;

var initSSID                ="";
var initSecurityMode        = 0; 
var nextIndex               = 0;
var preIndex                = 0;
var glassConnectFlag        = 0;
var netCheckStatus          = 1; //表示检测到网络的状态
var netCheckFlag            = 0;//1表示正在检测网络 0 表示没有在检测网络
var hbbtvStatus             = 0;
var weakUpStatus			= 0;//电视机唤醒状态
var powerOffStatus          = 0;//搜台过程中按power键 1 yes 0 no
var pressKeyDownTimer       = 0;
var standByTime             = 0;
var bluetoothStart          = 0;
var lastInputSource         = 0;
var powerOffAsNosignal      = 0;
var initWireManual          = {
	ip                      :"",
	subMask                 :"",
	gateway                 :"",
	priDNS                  :"",
	secDNS                  :"",
}
var g_booking_interrelated = {
	bookingChannel			: "",
	isHaveProgramMoreInfo	: "",
	bookingEvent			: "",
}


//声音设置缓存变量
var g_sound_settings = {
	isFirstTimeIntoSound		: 1,
	autoVolumeCtrl				: "",
	sPDIFType					: "",
	sPDIFDelay					: "",
	audioScene					: ""
}

//开机初始化中搜台结果缓存
var g_init_installations = 
{
	TAtv						: -1,
	TDtv						: -1,
	CAtv						: -1,
	CDtv						: -1,
	SDtv						: -1,
}/*-1 表示么有搜过，0 表示搜过但是没有搜到台，> 0 表示搜到台了*/

//五合一按键使用场景枚举
if(1)
{
	var CONTEXT_HOME_PAGE 			= 0;	//智能主界面,launcher
	var CONTEXT_ATV_DTV_FULL_SCREEN = 1;	//atv/dtv全屏播放模式,TV mode
	var CONTEXT_OTHER_FULL_SCREEN	= 2;	//其他信源全屏模式,other source
	var CONTEXT_MENU_SELECT			= 3;	//菜单选择模式,TV Options
	var CONTEXT_MUSIC_MOVIE_PLAYER	= 4;	//音视频播放器
	var CONTEXT_PICTURE_PLAYER		= 5;	//图片播放器
	var CONTEXT_OTHER_SMART_PAGE	= 6;	//其他智能应用界面,other apps
	var CONTEXT_PANEL_OPERATION		= 7;	//panel key events
}
var preload = [];

var setProjTimeoutId = 0;
var changeProjIdPwd = "";
var panelTestPicture = 0;
//for mhl 
var mhl_inserted_status = 0;
var mhl_signal_input_status = 0;
var appOpenFlag =0;
var powerLogoFlag =1;    //工厂酒店菜单power logo开时开机显示welcome页面
var isFromOptionIntoUsb	= 1; //从channelPlay进MediaCenter： "channelPlay"  ，   从launcher进："launcher"   ，    从弹出框进：1
var SCHEDULE_EPG = 1;
var SCHEDULE_NETFLIX = 2;
var SCHEDULE_LOCAL_EPG = 3;
var SCHEDULE_SETTING = 4;
var SCHEDULE_HOMEPAGE = 5;
var SCHEDULE_SOURCE = 6;
var SCHEDULE_CEC = 7;
var SCHEDULE_STR = 8;
var SCHEDULE_SWITCHSRC= 9;
var SCHEDULE_DIAL = 10;
var SCHEDULE_TV = 11;
var SCHEDULE_YOUTUBE = 12;
var SCHEDULE_MEDIA = 13;
var SCHEDULE_INTERNET = 14;
var SCHEDULE_SEARCH = 15;
var SCHEDULE_KODI = 16;
var SCHEDULE_GLOBOPLAY = 17;
var SCHEDULE_APPS = 18;
var SCHEDULE_CAREVISION = 19;
var scheduleApp = 0;
var START_NETFLIX_BY_HOTKEY = 0xF041;//0xf001;
var FAV_LIST_TYPE = 5;
var runCount = 0;
var ledStatusDefault = "off";
var inputList =[
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
];
var inputSourceCount = 0;
var currentInputIndex = 0;
var dirJumpFlag = 0;
var initNoFocusForMain = 0;
var jumpKey;
var bt_soundOutPutValue = 0;//蓝牙音箱使用变量
var bt_soundOutputShowFlag = false;
var bt_connectDevicePosition = -1;//当前连接的蓝牙设备在列表中的位置
var OUT_PUT_NAME_FOR_DB = "app.bluetooth.soundoutput";//存入数据库中的字段名
var BT_SWITCH_STATE_FOR_DB = "app.bluetooth.switch";//存入数据库中蓝牙开关状态
var OSDPage = "main";
var uploadPeriod = 3600 * 1000;
var uploadTimer;
var bootActionTimer;
var isSambaFlag = top.g_setting.getProperty("ro.sita.cfg.app.samba","null");
var sambaServerFlag = 1;
//for scbc
var isSCBCFlag = top.g_setting.getProperty("ro.sita.cfg.app.forSCBC","false");	//是否是SCBC的ID
var isFloatLauncher = 0;
if(tcl.setting.getProperty("ro.sita.model.Apps.launcher_branch", "null").toString().indexOf("newsan")>-1)
{
	isFloatLauncher = 1;
}
else if(tcl.setting.getProperty("ro.sita.model.Apps.launcher_branch", "null").toString().indexOf("float")>-1)
{
	isFloatLauncher = 2;
}
var smartKey_color = top.g_setting.getProperty("ro.sita.cfg.app.smartKey_color","null");

//launcher 的 url
var mainUrl;
var prefixUrl;

//请求launcherid、templateid
var xmlHttpReq;
var launcher_id;


var periodUploaded = 0;

//缓存进度
var cached = false;
var updateready = false;
var noupdate = false;
var error = false;
var checking = false;
var downloading = false;
var progress = false;
var uploadXHR;


var isGingaOn = false;
var gingaOn = 0;
var GingaStates;
if(typeof(GingaStates) == "undefined"){
	var GingaStates ={
		NULL:0,
		False:0,
		True:1,
		Status:{				//Current TV status that affect ginga, in case of "Normal", ginga work normally, other case ginga is stop because of specific reason
			Normal				: 0,	 //TV status is OK. 
			PauseFirDifTS	  	: (1<<0),//different ts bit
			PauseForNoAv	  	: (1<<1),//include none DTV source, cabel tunermode and lock
			PauseForOtherApp	: (1<<2),//to other applicattion stop ginga
			PauseForNoSignal	: (1<<3),//for no signal		
			PauseForChannelScan	: (1<<4),//for channelScan
			PauseForPvr			: (1<<5),//for Pvr or timeshift stop ginga
			PauseForOtherPage	: (1<<6) //to other page stop ginga
		},
		Events:{
			GINGA_EVT_BEFORE_CHANNEL_CHANGE			: 0,//切频道之前 //PauseFirDifTS
			GINGA_EVT_AFTER_CHANNEL_CHANGE			: 1,//切频道之后，用GINGA_EVT_COMMON_VIDEO
			GINGA_EVT_NO_SIGNAL						: 2,//信号丢失 //PauseForNoSignal
			GINGA_EVT_RESUME_SIGNAL					: 3,//重新有信号 //PauseForNoSignal
			GINGA_EVT_COMMON_VIDEO					: 4,//正常TV播放 //PauseFirDifTS //PauseForNoAv
			GINGA_EVT_LOCKED_PROG					: 5,//频道内用限制锁 //PauseForNoAv
            GINGA_EVT_LOCKED_CH						: 6,//频道用户设置所 //PauseForNoAv
            GINGA_EVT_LOCKED_INP					: 7,//信源锁 //PauseForNoAv
			GINGA_EVT_UNLOCKED						: 8,//解锁 //PauseForNoAv
			GINGA_EVT_START_SCAN 					: 9,//开始搜台 //PauseForNoAv
			GINGA_EVT_STOP_SCAN						: 10,//结束搜台 //do nothing
			GINGA_EVT_BEFORE_AV_CHANGE				: 11,//AV COMPONENT
			GINGA_EVT_AFTER_AV_CHANGE				: 12,//AV COMPONENT
			GINGA_EVT_TUNER_MODE_CHANGE				: 13,//切换tuner mode
			GINGA_EVT_PAUSE_FOR_CONTROL_LOST		: 14,//UI需要停止Ginga //PauseForOtherPage
			GINGA_EVT_RESUME_FROM_CONTROL_LOST		: 15,//退出UI，Ginga重新运行 //PauseForOtherPage
			GINGA_EVT_PAUSE_FOR_OTHER_APP			: 16,//第三方应用 //PauseForOtherApp
			GINGA_EVT_RESUME_FROM_OTHER_APP			: 17,//第三方引用 //PauseForOtherApp
			GINGA_EVT_CHANNEL_LIST_CHANGED			: 18,//节目变更  
			GINGA_EVT_SOURCE_CHANGED				: 19,//PauseForNoAv
			GINGA_EVT_APP_STATUS_CHANGE      		: 20, //MW发消息ginga APP状态变更 no mask setting
			GINGA_EVT_DIABLE_GINGA					: 21,//菜单里面关闭ginga 功能
			GINGA_EVT_ENABLE_GINGA					: 22,//菜单里面打开ginga 功能
			GINGA_EVT_IN_PVR_STATUS					: 23,//处于PVR或者timeshit录制状态
			GINGA_EVT_NOT_PVR_STATUS				: 24,//非PVR或者timeshit状态
			GINGA_EVT_AUD_CONFIG_CHANGE				: 25,//GINGA callback, audio 需调整
			GINGA_EVT_VIDEO_RESIZE					: 26,//GINGA callback, video 被重置
			GINGA_EVT_COUNTRY_CHANGE				: 27,//国家变更时设置要变化
			GINGA_EVT_POWER_OFF						: 28, //关机处理
			GINGA_EVT_RESUME_MAIN_TV				: 29,
			GINGA_EVT_MENU_LANGUAGE_CHANGE			: 30,
            GINGA_EVT_STR_POWER_ON                  : 31  //str开机时
		},
		NetworkEvents:{                                  //MTK MW defined events to ginga library.
			GINGA_NW_EVT_TS_SELECTED 					: 1,            
   		 	GINGA_NW_EVT_TS_UNSELECTED 					: 2,            
    		GINGA_NW_EVT_TS_SELECTION_ERROR 			: 3,            
    		GINGA_NW_EVT_TS_LIST_CHANGED                : 4,            
    		GINGA_NW_EVT_SERVICE_SELECTED               : 5,            
   		 	GINGA_NW_EVT_SERVICE_UNSELECTED             : 6,           
    		GINGA_NW_EVT_SERVICE_COMPONENT_SELECTED     : 7,
    		GINGA_NW_EVT_SERVICE_COMPONENT_UNSELECTED   : 8,
    		GINGA_NW_EVT_SCANNING_STATUS                : 9
		},
		GingaCountry:{					//Notify ginga which country ginga is applied on.
			GINGA_CNRY_BRZ : 0,			//Brazil
    		GINGA_CNRY_AGR : 1			//Argentina;
		},
		GingaAPPStatus:{			//Ginga APP status
			GINGA_APP_UNINIT : 1,
			GINGA_APP_READY : 2,
			GINGA_APP_STARTED : 3,
			GINGA_APP_DESTROYED : 4
		},
		GingaAudioConfigType:{
			GINGA_AUD_CFG_TYPE_VOLUME 			: 0,
			GINGA_AUD_CFG_TYPE_BALANCE 			: 1,
			GINGA_AUD_CFG_TYPE_BASS				: 2,
			GINGA_AUD_CFG_TYPE_TREBLE			: 3,
			GINGA_AUD_CFG_TYPE_SHOW_MUTE_OSD	: 4,
			GINGA_AUD_CFG_TYPE_SHOW_UNMUTE_OSD	: 5,
			GINGA_AUD_CFG_TYPE_SHOW_VOLUME_OSD	: 6,
			GINGA_AUD_CFG_TYPE_RESTORE			: 7,
			GINGA_AUD_CFG_TYPE_MUTE				: 8
		}
	}
}
//if(GingaObj == "undefined")
var GingaObj =
{
	isInit : GingaStates.False, // ginga is init?
	isEnable : GingaStates.False, // ginga application is enabled?
	isSameTS : GingaStates.True,  // when change channel, is the two channel have the same frequency?
	tsSelect : GingaStates.False,  //ginga received ts select event last time?
	svcSelect : GingaStates.True,  //ginga received service select event last time?
	GingaStatus : GingaStates.Status.Normal, //Tv status that affect ginga. Refer to GingaStates.Status
	curAPPStatus : GingaStates.GingaAPPStatus.GINGA_APP_UNINIT, // current ginga app status
	noSignalTimer : GingaStates.NULL, // timer to decide it's really no signal, because sometime signal unstable, and will resume soon.
	audioConfig:{
		configType : GingaStates.GingaAudioConfigType.GINGA_AUD_CFG_TYPE_BALANCE,
		value : 0
	},
	isGingaVolume:GingaStates.False, //记录当前是否是ginga要求的音量
	isGingaBalance:GingaStates.False ////记录当前是否是ginga要求的balance
}
var frontPanelOnTimeoutIndex = null; //fron panel on setTimeout index
var forcePowerOffTimeOutIndex = 0;  //强制关机timeout索引

//虚拟遥控器
var virtualRemoteState = 0;//0  ：   表示  没有显示虚拟遥控器                           1 ： 表示  显示虚拟遥控器
var virtualRemote_timer;//计时器，5秒内没有操作即使虚拟遥控器消失
var RemoteConntrolType = "default";

var textDirection = g_setting.getProperty("app.ui.textDirection","ltr");

var g_CurrentchannelListType = 0;

//lqt
function virtualRemoteControl()
{
	console.log("-----virtualRemoteState----"+virtualRemoteState);
	//如果是偶数的话，就显示
	if(virtualRemoteState == 0)
	{
		document.getElementById("virtualRemote").contentWindow.showVirtualRemote(RemoteConntrolType);
	}
	//如果是奇数的话，就隐藏
	else
	{
		//隐藏虚拟遥控器
		document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
	}
}












function $(id)
{
    return document.getElementById(id);
}
var currentKeySet = 0;
var preKeySet     = 0;
function keySetForUI(level)
{
	preKeySet = currentKeySet;
	switch(level)
	{
		case 0:
		top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x400|0x800,2,0);
		currentKeySet=0;
		break;
		case 1:
		top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x400|0x800,0,2);
		currentKeySet=1;
		break;
		default:
		top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x400|0x800,0,2);
		currentKeySet=1;
		break;
	}
	return preKeySet;
}
function initGlobalVariable()
{
	
	 g_isUsedHotKeyToIntoPage = 0;//是否通过快捷键进入页面，如fav,list,guide等,0 否， 1 是
	 g_isUsedNotifyIntoPage = 0;//是否通过消息进入页面，如CI_NAME_READY消息等,0 否， 1 是
	 g_remindWord = "";//notAvailable,noTeleText
	///////////////////////////////////////////////////////////快捷键使用的变量 end
	 g_lastTime = -1;//关机时间倒计时,power off timer
	 g_previousHtmlPage = "";//页面的前一个页面名称，比如在channel_play.html页面中按guide页面时进入guide，g_previousHtmlPage = “channel_play.html”,返回时从新返回channel_play.html页面。
	 g_nextHtmlPage = "";
	 g_volume_timer = 0;
	 g_volume_visible = 0;//判断当前的声音调是否可用
	 mute_status = 0;
	 isFirstInitNotifyThread = 1;//1 第一次初始化（创建）消息接收线程
	 g_ciIsInUpdateForm = 0;//1 在ci 数据更新的弹出对话框上，0 其他
	 isChangeToScartAfterInit = 0;
	 isChangeSourceJustNow = 0;//是否刚刚切换完成信源1 是，0 否;用来判断分辨率是否应该显示的问题
	/**********系统相关变量 相关变量 end*********************/
	
	/**********channel 相关变量 start*********************/
	 g_isShowInfoBar = 0;// 0 no, 1 yes,初始化为1，因为初次进入channel_play.html要更新channel info 数据
	 g_MMHStatus = 0;//0 MMH not open ,1 MMH open 除了没有信号外刚进入channel_play.html要隐藏info bar和 信号提示框
	 channelType=1;
	////////////////////booking 时使用
	 bookingMode = 0;//0 no booking ,1  record, 2 reminder
	/**********channel 相关变量 end*********************/


/*******************factory start *********************************/
	   g_factory_designModeHotkey = 0;//工厂菜单中DesignModeHotkey属性，0 off,1 on
	   g_factory_hotkey = 0;//工厂菜单factory menu 下factory hotkey 属性，0 off,1 on
	   g_factory_mode = 0;//工厂模式：0 设计师模式，1 工厂模式
	   g_openMheg5State = 0;
	   g_factory_IR_status = 0;
	   g_factory_IR_msg = 0;
	   g_factory_delay_after_shop = 100;
	   
/*********************factory end ******************************/


	
	 shopRemindFlag = 1;//1 shop remind is show,0 shop remind is not show
	 isFirstInChanenlPlay = 1;//1 yes, 0 no
	
	 parentalLock=0;
	 channelLock=0;
	 inputLock = 0;
	 hbbtvStatus  = 0;
	 playNumFromHref="";
	 
	 g_sound_settings.isFirstTimeIntoSound = 1;
	 g_init_installations = 
	{
		TAtv						: -1,
		TDtv						: -1,
		CAtv						: -1,
		CDtv						: -1,
		SDtv						: -1,
	}
	menu_visible_status = 0;
	clearTimeout(pressKeyDownTimer);
	pressKeyDownTimer=0;
	standByTime=0;
}

var isEASFlag = 0;
var initGingaByNetflixFlag = 0;  //ginga需要和netflix互斥，记录netflix开机状态
/*
keyDownProcess:响应共有的快捷键处理，如果只是在特定页面处理的快捷键，请特殊处理，最好不要放在该函数中
*/
function keyDownProcess(evt)
{
    clearMyTimeout();
	console.log("*******sun>>>>************framework**********************"+evt.which);
	var keycode = evt.which;//alert(" keycode = " + keycode)
    switch(keycode)
    {
		case VK_POWER://power
			console.log("hevens ******** VK_POWER !!!");
			preSTRPowerOff();
			toPowerOff();
			return;
		case VK_PANEL_LONG_OK:
		case VK_PANEL_OK:
		case VK_PANEL_UP:
		case VK_PANEL_DOWN:
		case VK_PANEL_LEFT:
		case VK_PANEL_RIGHT:
		case VK_PANEL3_DOWN://按面板左侧键，-,（三键面板）
		case VK_PANEL3_UP://按面板右侧键，+,（三键面板）
		case VK_PANEL3_OK://按面板菜单键,（三键面板）
		case VK_PANEL3_LONG_OK://长按面板菜单键（三键面板）
			//PVR、TimeShift不响应面板按键
			if(top.recordStatusFlag || top.timeShiftStatusFlag) break;
			top.$('globleShow').contentWindow.keyProc(evt);
			break;
		case VK_3D://3d
			if(g_channel.checkhbbtvStatus()>=1||top.preTempPage=="media"||top.preTempPage=="homePage"||top.appOpenFlag)
			{
				return;
			}
			var source = g_channel.inputSource;
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";
			if(top.currentPanel>0&&(g_channel.inputUnlockState(source)==0&&g_channel.currentSignalStatus==1)&&((source!=1 && source!=0) || (source==1&&g_channel.channelProgramStatus()==1&&top.parentalLock != 1 && top.channelLock != 1 && g_channel.currentScreenSaverMode==8) ||(source==0&&g_channel.channelProgramStatus()==1&& top.channelLock != 1)))
			{
				closePage($("operatePage"));
				closePage($("otherPage"));
				top.g_previousHtmlPage = "channelPlay.html";
				$("main").src = "3dMode.html";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			else
			{
				closePage($("operatePage"));
				closePage($("otherPage"));
				g_remindWord = "notFunction";
				$("main").src = "intermediate.html";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			return;
			/*
		case VK_TV://tv
		 if(g_channel.inputSource > 1)
		 {
			top.g_previousHtmlPage = "channelPlay.html";
			g_remindWord = "TvHotKey";
			$("main").src = "intermediate.html";
			top.requestFocus(top.main, 1);
			$("operatePage").src = "";
		 }
		 return;
		 */
		case VK_ECO://eco
			if(top.preTempPage=="media"||top.preTempPage=="homePage"||top.appOpenFlag)
				return;
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";
			toECOSetting();
			return;
		case VK_SOURCE://source
			//lqt
			if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			if(recordStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?inputsource&nochange";
				return;
			}
			else if(timeShiftStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenTimeShift();
				top.$('main').src = "pvr/timeshift.html?inputsource&nochange";
				return;
			}
			toSource();
			break;
        case VK_SOURCE_CMP1:
            if(top.virtualRemoteState == 1)
            {
                //隐藏虚拟遥控器
                top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
            }
            toSourceEx(keycode, 4);
            break;
        case VK_SOURCE_VGA:
            if(top.virtualRemoteState == 1)
            {
                //隐藏虚拟遥控器
                top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
            }
            toSourceEx(keycode, 5);
            break;
        case VK_SOURCE_AV1:
            if(top.virtualRemoteState == 1)
            {
                //隐藏虚拟遥控器
                top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
            }
            toSourceEx(keycode, 2);
            break;
        case VK_SOURCE_HDMI1:
            if(top.virtualRemoteState == 1)
            {
                //隐藏虚拟遥控器
                top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
            }
            toSourceEx(keycode, 6);
            break;
        case VK_SOURCE_HDMI2:
            if(top.virtualRemoteState == 1)
            {
                //隐藏虚拟遥控器
                top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
            }
            toSourceEx(keycode, 7);
            break;
        case VK_SOURCE_HDMI3:
            if(top.virtualRemoteState == 1)
            {
                //隐藏虚拟遥控器
                top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
            }
            toSourceEx(keycode, 8);
            break;
        case VK_SOURCE_HDMI4:
            if(top.virtualRemoteState == 1)
            {
                //隐藏虚拟遥控器
                top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
            }
            toSourceEx(keycode, 12);
            break;
		case VK_VOLUME_DOWN://volume down,多媒体不能共用
			//lqt
			if(top.virtualRemoteState == 1&&RemoteConntrolType == "CH")
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			$('globleShow').contentWindow.initVolume();
			if(top.$('globleShow').contentWindow.volumeCount  > 0 )
			{
				closePage($("operatePage"));
                if (!isOptInShow)
				    closePage($("otherPage"));
				if(top.g_temp == "option")
				{
					$("main").src="channelPlay.html";
				}
				g_volume_visible = 1;
	                     /*
				if(timeShiftStatusFlag==1 || recordStatusFlag == 1)
				{
					//doNothing
				}
				else
				{
	                top.g_isShowInfoBar = 0;
					$("main").src="channelPlay.html";//多媒体不能共用，需要去掉这一句话
				}
	            */
				$("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
				setGlobleRemindEnable(1);
				top.requestFocus(top.globleShow, 0);
				setFrameFocusPage("globleShow");
				//showMute(0);//不能解除mute
				//top.startVolumeTimer();
			}
			return;
		case VK_VOLUME_UP://volume up
			//lqt
			if(top.virtualRemoteState == 1&&RemoteConntrolType == "CH")
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			$('globleShow').contentWindow.initVolume();
			if(top.$('globleShow').contentWindow.volumeCount  > 0 )
			{
				g_volume_visible = 1;
				closePage($("operatePage"));
                if (!isOptInShow)
				    closePage($("otherPage"));
				if(top.g_temp == "option")
				{
					$("main").src="channelPlay.html";
				}
	                    /*
				if(timeShiftStatusFlag==1 || recordStatusFlag == 1)
				{
					//doNothing
				}
				else
				{
	                top.g_isShowInfoBar = 0;
					$("main").src="channelPlay.html"//多媒体不能共用，需要去掉这一句话
				}
	            */
				$("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
				setGlobleRemindEnable(1);
				top.requestFocus(top.globleShow, 0);
				setFrameFocusPage("globleShow");
		       }
			//showMute(0);
			//top.startVolumeTimer();
			return;
		case VK_CHANNEL_UP://channel +
			if(top.appOpenFlag||top.preTempPage=="media")
				return;
			if(g_channel.checkhbbtvStatus()==3)
			{
				 closePage($("operatePage"));
				 closePage($("otherPage"));
				 $("main").src = "hbbtvCancelRemind.html?"+VK_CHANNEL_UP;
				 $("main").style.display = "block";
				
				 top.requestFocus(top.main, 1);
				 setFrameFocusPage("main");
				 return;
			}
			if(top.sourceChangeCheck(0) == true)
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "password.html?sourceLock:framework:upkey";
				top.$("otherPage").style.display = "block";
				top.requestFocus(top.otherPage, 0);
				top.setFrameFocusPage("otherPage");
				return;
			}
			toChannelUp()
			return;
		case VK_CHANNEL_DOWN://channel -
			if(top.appOpenFlag||top.preTempPage=="media")
				return;		
			if(g_channel.checkhbbtvStatus()==3)
			{
				 closePage($("operatePage"));
				 closePage($("otherPage"));
				 $("main").src = "hbbtvCancelRemind.html?"+VK_CHANNEL_DOWN;
				 $("main").style.display = "block";
				
				 top.requestFocus(top.main, 1);
				 setFrameFocusPage("main");
				 return;
			}
			if(top.sourceChangeCheck(1) == true)
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "password.html?sourceLock:framework:downkey";
				top.$("otherPage").style.display = "block";
				top.requestFocus(top.otherPage, 0);
				top.setFrameFocusPage("otherPage");
				return;
			}
		    toChannelDown();
			return;
		case VK_MUTE://key mute
			top.endT = new Date();
			//g_setting.sendCecKeyValue(VK_MUTE);
			showMute(1);
			sendMuteKey2Cec();
			if(top.g_temp =="menu"||top.g_temp =="option")
				restartTimeout();
			return;
		case VK_INFO://info
			if(top.preTempPage=="homePage"||top.appOpenFlag)
			{
				return;
			}
		
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");					
				top.$('main').contentWindow.keyProc(evt);
				return;
			}
			top.g_previousHtmlPage = "channelPlay.html";
			g_isShowInfoBar = 1;
			closePage($("operatePage").src);
			closePage($("otherPage"));
			top.jumpPage();
		
			return;
		case VK_OPTION://option
			//lqt
			if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			//timeshift下不响应切换比例模式功能
			if(timeShiftStatusFlag == 1 || /*hbbtvCancelKeyOperation(VK_OPTION)==true||*/top.preTempPage=="homePage"||top.g_temp=="homePage"||top.appOpenFlag)
			{
				if(top.appOpenFlag){//APP下option按键响应
					closePage($("operatePage"));
					$('otherPage').src = "option.html";
					top.$("otherPage").style.display="block";
					top.requestFocus(top.otherPage, 0);
					setFrameFocusPage("otherPage");
				}
				return;
			}
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");	
				top.$('main').contentWindow.keyProc(evt);
				return;
			}
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";

			top.g_previousHtmlPage = "channelPlay.html";
			closePage($("operatePage"));
			closePage($("otherPage"));
			//$('otherPage').src = "option.html";
			if ("null" != smartKey_color)
			{
				$('main').src = "smartKey/smart.html";
			}
			else {
				$('main').src = "option.html";
			}
			//$('main').src = "initSetup/initEnvironmentSet.html";
			//$("main").src = "";
			//top.otherPage.focus();
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			
			return;
		
		case VK_ZOOM_DOWN://zoom-
		case VK_ZOOM_UP://zoom+
            if (g_channel.checkhbbtvStatus() == 3) return;
            openZoomMenu();
			return;
		case VK_TV://tv
			if(top.preTempPage=="homePage"&&top.appOpenFlag==0)
			{
                top.preTempPage = "";
                $('main').contentWindow.document.onkeydown(evt);
				return;
			}
			if (top.appOpenFlag)
			{	
				var appname = top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
				top.g_ulits.closeApplication(appname);
				top.scheduleApp = top.SCHEDULE_SWITCHSRC;
				if(top.lastInputSource!=top.E_INPUT_DTV&&top.lastInputSource!=top.E_INPUT_ATV)
					top.lastInputSource=top.E_INPUT_DTV;
				return;
			}
			else if(top.g_setting.getTopApp() == "vod.netflix")
			{
				top.g_ulits.closeApplication("vod.netflix");
				top.scheduleApp = top.SCHEDULE_SWITCHSRC;
				if(top.lastInputSource!=top.E_INPUT_DTV&&top.lastInputSource!=top.E_INPUT_ATV)
					top.lastInputSource=top.E_INPUT_DTV;
				return;
			}
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");	
				top.$('main').contentWindow.keyProc(evt);
				return;
			}
		
			 if(g_factory.sourceLock == 1 && g_factory.hotelEnable == 1)
			 {
				$('otherPage').src = "password.html?sourceLock1";
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
				break;
			 }
            if(g_channel.inputSource > 1)
            {
                top.$("globleShow").contentWindow.hiddenGlassRemind();
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";
            }    
		         
			if(g_channel.checkhbbtvStatus()==0)
			{
				if(g_channel.inputSource > 1)
                {
                    closePage($("operatePage"));
                    closePage($("otherPage"));
                    top.g_previousHtmlPage = "channelPlay.html";
                    g_remindWord = "TvHotKey";
                    $("main").src = "intermediate.html";
                    top.requestFocus(top.main, 1);
					
                }
			}
			else if(g_channel.checkhbbtvStatus()==1 || g_channel.checkhbbtvStatus()==2)
			{
				
				if(g_channel.inputSource > 1)
                {
                    globleHBBTVClose();
                    closePage($("operatePage"));
                    closePage($("otherPage"));
                    top.g_previousHtmlPage = "channelPlay.html";
                    g_remindWord = "TvHotKey";
                    $("main").src = "intermediate.html";
                    top.requestFocus(top.main, 1);
                }
			}
			else
			{
                closePage($("operatePage"));
                closePage($("otherPage"));
                $("main").src = "hbbtvCancelRemind.html?"+VK_TV;
                $("main").style.display = "block";

                top.requestFocus(top.main, 1);
                setFrameFocusPage("main");
			}
		     
			return;
    	case VK_NETFLIX:
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");	
				top.$('main').contentWindow.keyProc(evt);
				return;
			}
            globalHotkeyHandle(VK_NETFLIX);
			return;
        case VK_YOUTUBE:
			if(appOpenFlag == 1 && top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix" )
        			return;
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");	
				top.$('main').contentWindow.keyProc(evt);
				return;
			}    	
			globalHotkeyHandle(VK_YOUTUBE);
			return;
		case VK_GLOBOPLAY:
			if(appOpenFlag == 1 && top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix" )
			{
				return;
			}
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");
				top.$('main').contentWindow.keyProc(evt);
				return;
			}
			globalHotkeyHandle(VK_GLOBOPLAY);
			return;
        case VK_INTERNET:
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");	
				top.$('main').contentWindow.keyProc(evt);
				return;
			}    	
			globalHotkeyHandle(VK_INTERNET);
			return;
		case VK_APPS:
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");
				top.$('main').contentWindow.keyProc(evt);
				return;
			}
			globalHotkeyHandle(VK_APPS);
			break;
        case VK_MEDIA:
			if(top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix"&&(top.appOpenFlag==1))
        			return;
			if (top.appOpenFlag==1)
			{	
				var appname = top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
				top.g_ulits.closeApplication(appname);
				top.scheduleApp = top.SCHEDULE_MEDIA;
				return;
			}
			if(recordStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenRecord();
				top.clearMyTimeout();
				top.$('main').src = "pvr/Pvr.html?usb";
				return;
			}
			else if(timeShiftStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenTimeShift();
				top.$('main').src = "pvr/timeshift.html?usb";
				return;
			}
			if(top.g_temp=="homePage")
				top.isFromOptionIntoUsb=0;
			else
				top.isFromOptionIntoUsb=1;
        	 if(top.preTempPage=="media")
			 {
				 top.$("operatePage").src = "";
				 top.$("otherPage").src = "";
				 top.resumeFocus();
				 top.setFrameFocusPage("main");	
				 top.$('main').contentWindow.keyProc(evt);
				 return;
			 } 
        	 globalHotkeyHandle(VK_MEDIA);
        	 
        	 return;
        case VK_VIRTUAL_REMOTE:
        	 globalHotkeyHandle(VK_VIRTUAL_REMOTE);
        	 return;
        case VK_GUIDE:
			if(recordStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenRecord();
				top.clearMyTimeout();
				top.$('main').src = "pvr/Pvr.html?guide";
				return;
			}
			else if(timeShiftStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenTimeShift();
				top.$('main').src = "pvr/timeshift.html?guide";
				return;
			}
			if(top.preTempPage=="media")
				return;        
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";        
            globalHotkeyHandle(VK_GUIDE);
			return;
		case VK_SLEEP://sleep
			if(top.preTempPage=="media"||top.appOpenFlag==1)
				return;		
			top.g_previousHtmlPage = "channelPlay.html";
			closePage($("operatePage"));
			if(top.preTempPage!="homePage"&&top.g_temp!="homePage")
			{
				$("main").src = "";
			}
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";
			$("otherPage").src = "sleepTimer.html";
			$("otherPage").style.display = "block";			
			top.requestFocus(top.otherPage, 0);
			setFrameFocusPage("otherPage");
			return;
		case VK_SOUND:
			if(top.preTempPage=="media"||top.appOpenFlag==1||top.preTempPage=="homePage"||top.g_temp=="homePage")
				return;	
			if(g_setting.footballMode==0)
			{
				top.g_previousHtmlPage = "channelPlay.html";
				closePage($("operatePage"));
				if(top.preTempPage!="homePage"&&top.g_temp!="homePage")
				{
					$("main").src = "";
				}
				if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
					top.g_temp="quickMenu";
				$("otherPage").src = "quickSoundpreset.html";
				$("otherPage").style.display = "block";			
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
			}
			else
			{
					closePage($("operatePage"));
					closePage($("otherPage"));
					g_remindWord = "notFunction";
					$("main").src = "intermediate.html";
					top.requestFocus(top.main, 1);
					setFrameFocusPage("main");					
			}	
			break;
		case VK_PIC:
			if(top.preTempPage=="media"||top.appOpenFlag==1||top.preTempPage=="homePage"||top.g_temp=="homePage")
				return;	
			if(g_setting.footballMode==0)
			{
				top.g_previousHtmlPage = "channelPlay.html";
				closePage($("operatePage"));
				if(top.preTempPage!="homePage"&&top.g_temp!="homePage")
				{
					$("main").src = "";
				}
				if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
					top.g_temp="quickMenu";
				$("otherPage").src = "quickPicMode.html";
				$("otherPage").style.display = "block";			
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
			}
			else
			{
					closePage($("operatePage"));
					closePage($("otherPage"));
					g_remindWord = "notFunction";
					$("main").src = "intermediate.html";
					top.requestFocus(top.main, 1);
					setFrameFocusPage("main");					
			}	
			break;
		case VK_FREEZE:
			if(top.preTempPage=="media"||top.appOpenFlag==1||top.preTempPage=="homePage"||top.g_temp=="homePage")
				return;		
			top.g_previousHtmlPage = "channelPlay.html";
			closePage($("operatePage"));
			if(top.preTempPage!="homePage"&&top.g_temp!="homePage")
			{
				$("main").src = "";
			}
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";
			$("otherPage").src = "quickFreeze.html";
			$("otherPage").style.display = "block";			
			top.requestFocus(top.otherPage, 0);
			setFrameFocusPage("otherPage");
			return;
		case VK_TUNER:
			if(top.preTempPage=="media"||top.appOpenFlag==1||top.preTempPage=="homePage"||top.g_temp=="homePage")
				return;
			if(g_channel.inputSource<=1)	
			{
				if(recordStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenRecord();
					top.clearMyTimeout();
					top.$('main').src = "pvr/Pvr.html?tuner";
					return;
				}
				else if(timeShiftStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenTimeShift();
					top.$('main').src = "pvr/timeshift.html?tuner";
					return;
				}
				if(top.preTempPage=="media")
					return;		
				top.g_previousHtmlPage = "channelPlay.html";
				closePage($("operatePage"));
				if(top.preTempPage!="homePage"&&top.g_temp!="homePage")
				{
					$("main").src = "";
				}
				if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
					top.g_temp="quickMenu";
				$("otherPage").src = "quickTuner.html";
				$("otherPage").style.display = "block";			
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
			}
			else
			{
				closePage($("operatePage"));
				closePage($("otherPage"));
				g_remindWord = "notFunction";
				$("main").src = "intermediate.html";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");					
			}
			return;
		case top.VK_LANG://lang
			if ((top.isLAFlag||top.isNAFlag)&&top.g_channel.inputSource==top.E_INPUT_ATV)
			{
				return;
			}
		case VK_MTS:
			if(top.preTempPage=="media"||(appOpenFlag == 1 && top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")!= "vod.netflix" )||top.preTempPage=="homePage"||(appOpenFlag == 0 &&top.g_temp=="homePage"))
					return;		
			if(g_channel.inputSource<=1&&g_channel.currentSignalStatus||appOpenFlag == 1)		
			{
				top.g_previousHtmlPage = "channelPlay.html";
				closePage($("operatePage"));
				if(top.preTempPage!="homePage"&&top.g_temp!="homePage")
				{
					$("main").src = "";
				}
				if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
					top.g_temp="quickMenu";
                var country = tcl.setting.zoneCode;
                var source = g_channel.inputSource;
				if((top.isAUFlag || top.isAPFlag) && source == top.E_INPUT_DTV)
                {
                    $("otherPage").src = "audioSetting.html";
                }
                else
                {
                    $("otherPage").src = "quickMTS.html";
                }

				$("otherPage").style.display = "block";			
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
				return;
			}
			else
			{
					closePage($("operatePage"));
					closePage($("otherPage"));
					g_remindWord = "notFunction";
					$("main").src = "intermediate.html";
					top.requestFocus(top.main, 1);
					setFrameFocusPage("main");					
			}	
			break;
		case VK_PRE_CH://pre-ch
			if(top.preTempPage=="media"||top.preTempPage=="homePage"||top.appOpenFlag)
				return;

			top.g_previousHtmlPage = "channelPlay.html";
			var source = g_channel.inputSource;
			if(source == 0 || source == 1)
			{
				if(g_channel.checkhbbtvStatus()==3)
				{
					 $("operatePage").src = "";
					 $("otherPage").src ="";
					 $("main").src = "hbbtvCancelRemind.html?"+VK_PRE_CH;
					 $("main").style.display = "block";
					 top.requestFocus(top.main, 1);
					 setFrameFocusPage("main");
					 return;
				}
				toPreKey();
				return;
			}
			else
			{
				$("operatePage").src = "";
				$("otherPage").src ="";
				g_remindWord = "notAvailable";
				$("main").src = "intermediate.html";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}

			return;
		case VK_FAV://fav
			if(top.preTempPage=="media"||top.preTempPage=="homePage"||top.appOpenFlag)
				return;
			if(g_channel.checkhbbtvStatus()==3)
			{
				 $("operatePage").src = "";
				 $("otherPage").src ="";
				 $("main").src = "hbbtvCancelRemind.html?"+VK_FAV;
				 $("main").style.display = "block";
				 top.requestFocus(top.main, 1);
				 setFrameFocusPage("main");
				 return;
			}
			if(getSportModeType() && top.g_factory.pvrOpenStatus)
			{
				console.log("will go sportMode!!!");
				return;
			}
			toFavList();
			return;
		case VK_LIST://list
			if(top.preTempPage=="media"||top.preTempPage=="homePage"||top.appOpenFlag)
				return;		
			if(g_channel.checkhbbtvStatus()==3)
			{
				 $("operatePage").src = "";
				 $("otherPage").src ="";
				 $("main").src = "hbbtvCancelRemind.html?"+VK_LIST;
				 $("main").style.display = "block";
				 top.requestFocus(top.main, 1);
				 setFrameFocusPage("main");
				 return;
			}
			if(getSportModeType() && top.g_factory.pvrOpenStatus)
			{
				console.log("will go sportMode!!!");
				return;
			}
			toChannelList();
			return;
		case VK_EXIT:
			//if(changeProjIdPwd == "041758650")
			//	enterProjIdPwd(keycode);
			if(top.preTempPage=="homePage"||top.preTempPage=="media"||top.g_temp=="homePage")
			{
				top.$("otherPage").src = "";
                top.$("operatePage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");	
			}
			else
				top.jumpPage();
			return;
		case VK_FRONT_PANEL_LOCKED:
            $("frontPanel").innerHTML = top.frontPanelRemind;
			ttsLog("ttsStr=" + top.frontPanelRemind);
			setTTSSay(SPEECH_TYPE_FLUSH,$("frontPanel").innerHTML);
			$("frontPanel").style.display = "block";
                if(frontPanelOnTimeoutIndex != null)
                {
                    clearTimeout(frontPanelOnTimeoutIndex);
                }
            frontPanelOnTimeoutIndex = setTimeout("$(\"frontPanel\").style.display = \"none\";",3000);
			break;
		case top.VK_STOP:
			if(recordStatusFlag==1)
			{
				top.$("operatePage").src = "";
				setTimeout(function () {
					top.$("globleShow").contentWindow.hiddenRecord();
					top.$('main').src = "pvr/Pvr.html?exit";
					top.requestFocus(top.main, 1);
				},300);
			}
			else if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("stop");
				return;
			}
			break;
		case top.VK_BLUE:
			if(recordStatusFlag==1)
			{
				$("globleShow").contentWindow.hiddenRecord();
				$('main').src = "pvr/Pvr.html?menu";
			}
			break;
		case top.VK_HOME:
			//check pwd for changing Prject Id
		//if((changeProjIdPwd == "062598")||(changeProjIdPwd == "041758"))
		//enterProjIdPwd(keycode);
			if(top.preTempPage=="media")
			{
				top.$("operatePage").src = "";
				top.$("otherPage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");
				top.$('main').contentWindow.keyProc(evt);
				return;
			}
		
			if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
				top.g_temp="quickMenu";
            var smartvservice = parseInt(g_setting.getProperty("app.ui.smart_tv_service", "1"));
            console.log("--hzm vk_home smart_tv_service = " + smartvservice);
			if (top.isEUFlag && smartvservice == 0)
            {
                closePage($("operatePage"));
                closePage($("otherPage"));
                $("otherPage").src="privacyPolicyRemind.html";
                top.requestFocus(top.otherPage, 0);
                setFrameFocusPage("otherPage");
            }
            else
            {
                toMenu();
            }
			break;
		case top.VK_MENU:
			//timeshift下不响应切换比例模式功能
			if(timeShiftStatusFlag == 1 || appOpenFlag == 1 /*|| hbbtvCancelKeyOperation(VK_MENU)==true*/)
			{
				return;
			}
			if(top.g_temp=="menu")
			{
				top.$("operatePage").style.display="none";
				top.$("operatePage").src = "";
				top.resumeFocus();
				top.setFrameFocusPage("main");	
			}
			else
			{
				top.jumpToOperatePage("index.html");
			}
			break;			
		case top.VK_0:
		case top.VK_1:
		case top.VK_2:
		case top.VK_3:
		case top.VK_4:
		case top.VK_5:
		case top.VK_6:
		case top.VK_7:
		case top.VK_8:
		case top.VK_9:
			//enterProjIdPwd(keycode);
			break;
		case top.VK_SUBTITLE:
			top.specialKeyDownProcess(evt);
			break;
		default:
			break;
    }
}
function toECOSetting()
{
	var source = g_channel.inputSource;
	var is4K1K = 0;//g_setting.checkPQis4K1k;
	if((source == 6 || source == 7 || source == 8 || source == 12)&&(g_setting.hdmiMode&65535)==1)
	{
		return;
	}
	else if(is4K1K == 1)
	{
		return;
	}
	else
	{
			top.g_previousHtmlPage = "channelPlay.html";
			$("operatePage").src = "";
			$("otherPage").src ="";
			$("main").src = "EcoSetting.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
	}
}
function toFavList()
{
	if(recordStatusFlag == 1)
	{
		$("globleShow").contentWindow.hiddenRecord();
		top.$('otherPage').src = "";
		top.$('operatePage').src = "";
		top.$('main').src = "pvr/Pvr.html?Fav";
		
		top.requestFocus(top.main, 1);
		setFrameFocusPage("main");
	}
	else if(timeShiftStatusFlag == 1)
	{
		operateWhenTimeshifting("Fav");
	}
	else
	{
		top.g_previousHtmlPage = "channelPlay.html";
		var source = g_channel.inputSource;
		if(source == 0 || source == 1)
		{
			g_isUsedHotKeyToIntoPage = 1;
			$("operatePage").src = "";
			$("main").src="channelPlay.html";
            g_CurrentchannelListType = g_channel.channelListType;
			g_channel.channelListType = FAV_LIST_TYPE;
			$("otherPage").src = "channelList.html";
			top.$("otherPage").style.display = "block";
			top.otherPage.focus();
			setFrameFocusPage("otherPage");
		}
		else
		{
			$("operatePage").src = "";
			$('otherPage').src = "";
			g_remindWord = "notAvailable";
			$("main").src = "intermediate.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");

		}
	}
}
function toChannelList()
{
	if(recordStatusFlag == 1)
	{
		$("globleShow").contentWindow.hiddenRecord();
		top.$('otherPage').src = "";
		top.$('operatePage').src = "";
		top.$('main').src = "pvr/Pvr.html?channelList";
		
		top.requestFocus(top.main, 1);
		setFrameFocusPage("main");
	}
	else if(timeShiftStatusFlag == 1)
	{
		operateWhenTimeshifting("channelList");
	}
	else
	{
		top.g_previousHtmlPage = "channelPlay.html";
		var source = g_channel.inputSource;
		if(source == top.E_INPUT_ATV || source == top.E_INPUT_DTV)
		{
			g_isUsedHotKeyToIntoPage = 1;
			$('operatePage').src = "";
			$("main").src="channelPlay.html";
			$("otherPage").src = "channelList.html";
			top.$("otherPage").style.display = "block";
			top.otherPage.focus();
			setFrameFocusPage("otherPage");
		}
		else
		{
			$("operatePage").src = "";
			$('otherPage').src = "";
			g_remindWord = "notAvailable";
			$("main").src = "intermediate.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");

		}
	}
}
function toPreKey()
{
	preIndex = g_channel.lastIndex;
	currentChannelIndex = preIndex;
	channelChange();
}
function sourceChangeCheck(dir)//dir 0: channelUpkey; 1: channelDownKey.
{
	if(top.g_factory.sourceLock ==0 ||top.g_factory.hotelEnable == 0)
	{
		return false;
	}
	var systemCountry = g_channel.systemCountry;
	if( systemCountry == 15 || systemCountry == 6 || systemCountry == 7 || systemCountry == 23 || "true" == top.isSCBCFlag)
	{
		return false;
	}
	var inputSource=g_channel.inputSource;
	var programStatus = g_channel.channelProgramStatus();
	if(dir == 0)
	{
		if(inputSource <= 1&&programStatus == 1 && top.inputLock != 1)
		{
			var currentIndex = g_channel.currentIndex;
			var endIndex = g_channel.endIndex;
			if(currentIndex>=endIndex)
			{
				return true;
			}

		}
		else if(inputSource >1)
		{
			return true;			
		}
		else if(inputSource <= 1&&(programStatus == 0 || top.inputLock == 1))
		{
			return true;
		}
	}
	else
	{
		if(inputSource <= 1 &&programStatus == 1  && top.inputLock != 1)
		{
			var currentIndex = g_channel.currentIndex;
			var firstIndex = g_channel.firstIndex;
			if(currentIndex<=firstIndex || firstIndex >= 65535 || currentIndex >= 65535)
			{
				return true;
			}
		}
		else if(inputSource > 1)
		{
			return true;
		}
		else if(inputSource <= 1&&(programStatus == 0 || top.inputLock == 1))
		{
			return true;
		}
	}
	return false;
}
function toChannelUp()
{
	var inputSource=g_channel.inputSource;
	var programStatus = g_channel.channelProgramStatus();
	if(inputSource <= 1 &&programStatus == 1  && top.inputLock != 1)
	{
		currentInputIndex = 0;
		var systemCountry = g_channel.systemCountry;
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
			var currentIndex = g_channel.currentIndex;
			currentChannelIndex = g_channel.getNextIndexByIndex(currentIndex);
			$("operatePage").src = "";
			channelChange();
			
		}
		else
		{
			var currentIndex = g_channel.currentIndex;
			var endIndex = g_channel.endIndex;
			if(currentIndex>=endIndex)
			{
				if(recordStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenRecord();
					top.$('main').src = "pvr/Pvr.html?inputsource&11";
					return;
				}
				else if(timeShiftStatusFlag == 1)
				{
					operateWhenTimeshifting("inputsource&11");
					return;
				}
				 if(top.currentPanel==1)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
						top.$("globleShow").contentWindow.hiddenGlassRemind();
					}
				}else if(top.currentPanel==2)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
					}
				}
				g_channel.inputSource = inputList[1].source;
				currentInputIndex = 1;
				g_isShowInfoBar = 1;
				top.jumpPage();
			}
			else
			{
				nextIndex = g_channel.getNextIndexByIndex(currentIndex);
				currentChannelIndex = nextIndex;
				$("operatePage").src = "";
				channelChange();
				
			}
		}
	}
	else if(inputSource <= 1 &&(programStatus == 0  || top.inputLock == 1))
	{
		currentInputIndex = 0;
		var systemCountry = g_channel.systemCountry;
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			g_channel.inputSource=inputList[1].source;
			currentInputIndex = 1;
			g_isShowInfoBar = 1;
			top.jumpPage();
		}
	}
	else if(inputSource > 1)
	{
		var source = top.g_channel.inputSource;
		for (var i=1; i< inputSourceCount; i++)
    	{
        	if (inputList[i].source == source)
        	{
           	 	currentInputIndex = i;
            	break;
        	}
    	}
		var systemCountry = g_channel.systemCountry;
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			if(currentInputIndex<(inputSourceCount-1))
            {
                currentInputIndex += 1;
				g_channel.inputSource = inputList[currentInputIndex].source;
            }
			else
			{
				currentInputIndex = 0;
				top.channelLock = 0;
				top.parentalLock = 0;
				top.inputLock = 0;
				var firstIndex=g_channel.firstIndex;
				if(firstIndex>=65535)
				{
					firstIndex=channel.currentIndex;
				}
				if(firstIndex<65535)
				{
					var previousChannel = channel.getChannelInfoByIndex(firstIndex);
					top.currentChannelIndex = firstIndex;
					if(previousChannel.serviceType==0)
					{
							g_channel.inputSource=0;
					}
					else
					{
							g_channel.inputSource=1;
					}
					g_channel.playByIndex(firstIndex);
				}
				else
				{
					g_channel.inputSource=1;
				}
			}
			g_isShowInfoBar = 1;
			top.jumpPage();
		}
	}
}
function toChannelDown()
{
	var inputSource=g_channel.inputSource;
	var systemCountry = g_channel.systemCountry;
	var programStatus = g_channel.channelProgramStatus();
	if(inputSource <= 1 &&programStatus == 1  && top.inputLock != 1)
	{
		currentInputIndex = 0;
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
			var currentIndex = g_channel.currentIndex;
			currentChannelIndex = g_channel.getPreviousIndexByIndex(currentIndex);
			$("operatePage").src = "";
			channelChange();
			return;
		}
		else
		{
			var currentIndex = g_channel.currentIndex;
			var firstIndex = g_channel.firstIndex;
			if(currentIndex<=firstIndex)
			{
				if(recordStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenRecord();
					top.$('main').src = "pvr/Pvr.html?inputsource&12";
					return;
				}
				else if(timeShiftStatusFlag == 1)
				{
					operateWhenTimeshifting("inputsource&12");
					return;
				}
				if(top.currentPanel==1)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
						top.$("globleShow").contentWindow.hiddenGlassRemind();
					}
				}else if(top.currentPanel==2)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
					}
				}
				currentInputIndex = inputSourceCount-1;
				g_channel.inputSource = inputList[currentInputIndex].source;
				g_isShowInfoBar = 1;
				top.jumpPage();
			}
			else
			{
				currentChannelIndex = g_channel.getPreviousIndexByIndex(currentIndex);
				$("operatePage").src = "";
				channelChange();
				
				return;
			}
		}
	}
	else if(inputSource <= 1 &&(programStatus == 0  || top.inputLock == 1))
	{
		currentInputIndex = 0;
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			currentInputIndex = inputSourceCount-1;
			g_channel.inputSource=inputList[currentInputIndex].source;
			g_isShowInfoBar = 1;
			top.jumpPage();
		}
	}
	else
	{
		var source = top.g_channel.inputSource;
		for (var i=1; i< inputSourceCount; i++)
    	{
        	if (inputList[i].source == source)
        	{
           	 	currentInputIndex = i;
            	break;
        	}
    	}
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{
		   if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			if(currentInputIndex==1)
			{
				top.channelLock = 0;
				top.parentalLock = 0;
				top.inputLock = 0;
				var endIndex=g_channel.endIndex;
				if(endIndex>=65535)
				{
					endIndex=channel.currentIndex;
				}
				if(endIndex<65535)
				{
					var previousChannel = channel.getChannelInfoByIndex(endIndex);
					top.currentChannelIndex = endIndex;
					if(previousChannel.serviceType==0)
					{
							g_channel.inputSource=0;
					}
					else
					{
							g_channel.inputSource=1;
					}
					g_channel.playByIndex(endIndex);
				}
				else
				{
					g_channel.inputSource=1;
				}
			}
			else if (currentInputIndex>1)
            {
                currentInputIndex -= 1;
				g_channel.inputSource=inputList[currentInputIndex].source;
            }
			g_isShowInfoBar = 1;
			top.jumpPage();
		}
	}
}
function tochangeCEC(value)
{
	//first close the app then switching source
	//If the homepage into the app, just close the app now, set the flags.Waiting for news to come over
	if (appOpenFlag==1)
	{	
		/*
		@param[in] key 全局唯一属性关键字.
		@param[in] defValue 默认的属性的值,若key不存在则直接返回该值.
		@return 成功返回属性的值,否则返回defValue.
		*/
		var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
		g_ulits.closeApplication(appname);
		scheduleApp = SCHEDULE_CEC;
	}
	else
	{
		if(recordStatusFlag == 1)
		{
			g_channel.testLog("cecInput===="+value);
			clearMyTimeout();
			top.$('otherPage').src = "";
			top.$('operatePage').src = "";
			$("globleShow").contentWindow.hiddenRecord();
			top.$('main').src = "pvr/Pvr.html?cec&"+value;
		
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
		}
		else if(timeShiftStatusFlag == 1)
		{
			operateWhenTimeshifting("cec&"+value);
		}
		else 
		{
			top.$('otherPage').src = "";
			top.$('operatePage').src = "";
            if(top.g_channel.checkhbbtvStatus() >= 1)//hbbtv处于打开状态
            {
                globleHBBTVClose();
            }
			g_channel.inputSource=value;
			top.g_isShowInfoBar = 1;
			top.$('main').src = "channelPlay.html";
			
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
		}
		$("main").style.display="block";
		$("operatePage").style.display="block";
		$("otherPage").style.display="block";		
	}
}
function toswitchSource(value)
{
	if(recordStatusFlag == 1)
	{
		g_channel.testLog("cecInput===="+value);
		clearMyTimeout();
		top.$('otherPage').src = "";
		top.$('operatePage').src = "";
		$("globleShow").contentWindow.hiddenRecord();
		top.$('main').src = "pvr/Pvr.html?inputsource&"+value;
		top.requestFocus(top.main, 1);
		setFrameFocusPage("main");
	}
	else if(timeShiftStatusFlag == 1)
	{
		operateWhenTimeshifting("inputsource&"+value);
	}
	else 
	{
		top.$('otherPage').src = "";
		top.$('operatePage').src = "";
		g_channel.inputSource=value;
		top.g_isShowInfoBar = 1;
		top.$('main').src = "channelPlay.html";
		top.requestFocus(top.main, 1);
		setFrameFocusPage("main");
	}
	$("main").style.display="block";
	$("operatePage").style.display="block";
	$("otherPage").style.display="block";
}
var forceCloseApps;
var prepareCI = 0;
var prepareCITimer;
/***
 * 待机之前先去隐藏UI或者退出菜单
 * add by hevens 20170627**/
function hideUItoPowerOff()
{
	if(g_setting.tvRunningMode == 0)
	{
		console.log("hevens ******** tvRunningMode = 0  force PowerOff!!!");
		g_setting.powerOff(0);
		g_setting.powerOff(3);
		return;
	}
    if(top.g_temp == "menu")//待机之前将setting等菜单退出
    {
        top.$("operatePage").style.display="none";
        top.$("operatePage").src = "";
		top.requestFocus(top.main, 1);
        top.setFrameFocusPage("main");
    }
	console.log("hevens ********************************** hideUItoPowerOff  main page =" + $("main").src);
	if($("main").src.indexOf("index.html") != -1             ||
			$("main").src.indexOf("programGuide") != -1 	 ||
			$("main").src.indexOf("deviceList.html") != -1   ||
			$("main").src.indexOf("mediaList.html") != -1    ||
			$("main").src.indexOf("videoPlay.html") != -1    ||
			$("main").src.indexOf("picturePlay.html") != -1  ||
			$("main").src.indexOf("musicPlay.html") != -1 ){
		if(top.g_channel.inputSource == 10){
			console.log("hevens ********************************** hideUItoPowerOff hide " + $("main").src);
			if(top.appOpenFlag == 1)
			{
				var appname = top.g_setting.getFocusApp();
				console.log("hevens ********************************** hideUItoPowerOff " + " appname = " + appname + "  set top.appOpenFlag 0 " );
				if (appname != "netflix.proxy")
				{
					top.appOpenFlag = 0;
				}
			}
			top.main.document.body.style.display = "none";
			top.$("operatePage").style.display="none";
			top.$("otherPage").style.display="none";
			return;
		}
	}
	if($("main").src.indexOf("index.html") != -1){
		if(top.g_channel.inputSource != 10)
		{//避免TV页待机，开机唤醒会显示TV画面
			top.g_channel.inputSource = 10;
		}
		top.scheduleApp = top.SCHEDULE_HOMEPAGE;
	}
	if(recordStatusFlag == 1)
	{
		g_pvr.recordStop();
		g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
		$("globleShow").contentWindow.hiddenRecord();
		pvrCurrentTime=0;
		recordStatusFlag =0;
		pvrTotalTime=2*60*60;
	}
	else if(timeShiftStatusFlag == 1)
	{
		//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
		g_pvr.timeshiftStop();
		g_pvr.returnToLive();//返回实时播放页面
		//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
		timeShiftStatusFlag = 0;
		$("globleShow").contentWindow.hiddenTimeShift();
	}
	//图文打开时需要退出图文
    if ($("main").src.indexOf("TeletextMenu.html") != -1)
    {
        top.g_setting.closettx();
        console.log("hevens ****** hideUItoPowerOff in ttx page and close ttx !! ");
    }
	if(top.appOpenFlag == 1)
	{
		var appname = top.g_setting.getFocusApp();
		console.log("hevens ****** hideUItoPowerOff " + " appname = " + appname + " set top.appOpenFlag 0 " );
		if (appname != "netflix.proxy")
		{
			top.appOpenFlag = 0;
		}
	}
	$("operatePage").src = "";
	$("otherPage").src ="";
	$("main").src="channelPlay.html";
	top.requestFocus(top.main, 1);
	setFrameFocusPage("main");
	menu_visible_status = 0;

	top.$("main").style.display="none";
	top.$("operatePage").style.display="none";
	top.$("otherPage").style.display="none";
}

/***
 * 调整待机流程，toDoPowerOff 判断PVR、timeShift、SportsMode打开状态，则进行提示,其他情况则执行待机
 * add by hevens 20170622**/
function toDoPowerOff()
{
	if (recordStatusFlag == 1)
	{
		top.$('otherPage').src = "";
		top.$('operatePage').src = "";
		setTimeout(function () {
			$("globleShow").contentWindow.hiddenRecord();
			top.$('main').src = "pvr/Pvr.html?power";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
		},300);
	}
	else if(timeShiftStatusFlag == 1 && !getSportsModeType())
	{
		operateWhenTimeshifting("stop&power");
	}
	else
	{
		console.log("framwork toPowerOff() test g_setting.suspendStatus = " + g_setting.suspendStatus);
		console.log("framwork toPowerOff() test appOpenFlag = " + appOpenFlag);
		console.log("framwork toPowerOff() test top.g_temp = " + top.g_temp);
        /****
         * shopmode 2.5需求
         * 遥控关机情况
         * ****/
        var isRunning9hours = parseInt(top.g_setting.getProperty("app.ui.isRunning9hours","0"));
		if (isRunning9hours == 1)//满足系统连续运行9小时
        {
            //属性记录次数
            var times = parseInt(top.g_setting.getProperty("app.ui.systemRunningTimer","0"));
            console.log("--hzm in toDoPowerOff systemRunningTimer test times = "+times);
            if(times < 6)
            {
                top.g_setting.setProperty("app.ui.systemRunningTimer",times+1);
            }
            if (1 == g_setting.suspendStatus)
                top.g_setting.setProperty("app.ui.isRunning9hours","2");//STR ON遥控关机，已经满足系统运行9小时标记
            else
                top.g_setting.setProperty("app.ui.isRunning9hours","3");//STR OFF遥控关机，已经满足系统运行9小时标记
        }
        else//不满足系统运行9小时的情况下又遥控待机,清除计时状态
        {
            top.g_setting.setProperty("app.ui.isRunning9hours","0");
            //top.g_setting.setProperty("app.ui.systemRunningTimer","0");//2.5需求，不清除计数
        }
        /****shopmode 2.5需求 end****/
		if (1 == g_setting.suspendStatus)
		{
			setTimeout("top.cancelForcePowerOff();", 500);   //取消强制待机计时
			if (g_isDownloading == 1)                        //暂停网络下载
			{
				uiPauseDownloadingUpFile();
			}
			if(top.g_temp == "media"){//在多媒体下待机，先去退出多媒体播放
				if(parent.frames["main"].window.toExitBySTR != undefined){
					console.log("hevens ******** toDoPowerOff from mediaplayer page!");
					parent.frames["main"].window.toExitBySTR();//STR退出后，会进入devicelist页面并待机，所以在此处返回。
					return;
				}
			}
			// setTimeout("g_setting.powerBacklightState = 0;", 50);
			//待机前退出ginga 已移置中间件处理
			//if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True )
			//{
				//待机前退出ginga
			//	top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_POWER_OFF);
			//}
			hideUItoPowerOff();
            suspend_ts = g_setting.getUtcTime;
            console.log("ldc *** get utctime for samba before str power off in toDoPowerOff(). suspend_ts="+suspend_ts);

			//这里直接调用poweroff，JSE去调用tos_am_standby，应用退出由AM去做
			g_setting.powerOff(0);
			setTimeout("g_setting.powerOff(2);", 200);
		}
		else
		{
			var standbyMusic = g_setting.getProperty("ro.sita.model.Apps.standbyMusic","")
			if (standbyMusic != "")
			{
				tcl.media.changeSourceToMedia();
				tcl.media.mediaOpen(standbyMusic);
				tcl.media.mediaPlay();
				setTimeout(function () {
					console.log("hevens ******** standbyMusic ");
                    console.log("ldc *** get utctime for samba before str power off");
                    suspend_ts = g_setting.getUtcTime;
					g_setting.powerOff(0);
					g_setting.powerOff(2);
				},2500);
			}
			else
			{
				console.log("hevens ******** force PowerOff()");
				g_setting.powerOff(0);
				g_setting.powerOff(3);
			}
		}
	}
}

function toPowerOff()
{
    console.log("framwork test toPowerOff()");
    clearTimeout(forceCloseApps);
    clearTimeout(prepareCITimer);
    if ($("main").src.indexOf("channelPlay.html") != -1 || $("main").src.indexOf("framework") != -1 || $("main").src.indexOf("ciUpdate") != -1)
    {
		/*** 在channelPlay，framework，ciUpdate响应的power键，信源在DTV且配置支持CI，
		 * 则通知CI待机，有CI待机释放的消息后再进行待机 add by hevens 20170622
		 ***/
		if (tcl.channel.inputSource == 1 && g_setting.getCardState() >= 1)
        {
		    if (!prepareCI)
            {
                tcl.ci.preparePowerOff();
                prepareCI = 1;
            }
			console.log("hevens ******** prohibitPowerOff = " +　tcl.ci.prohibitPowerOff);
            if (tcl.ci.prohibitPowerOff)
            {
                prepareCITimer =  setTimeout(function(){
					console.log("hevens ******** toPowerOff()");
					toPowerOff();
				},1000);
                return;
            }
        } 
    }
	/*** 其他页面响应的power键，则直接进行待机 add by hevens 20170622**/
	console.log("hevens ******** to do  toDoPowerOff!!!");
	toDoPowerOff();
}


function fastPowerOff()
{
//    if(top.isGingaOn)          //待机前退出ginga已移置到中间件处理
//    {
//        top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_POWER_OFF);
//        top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_NOT_PVR_STATUS);
//    }
	if (1 == g_setting.suspendStatus)
	{
        console.log("ldc *** get utctime for samba before str power off");
        suspend_ts = g_setting.getUtcTime;
		g_setting.powerOff(2);
		console.log("mute_status is "+mute_status+" force_mute_status = "+force_mute_status);
		if(force_mute_status == 1)
		{
			forceMute(0);
		}
		if(mute_status == 1)
		{
			$("mute").style.display = "none";
			showMute(0);
		}
		else
		{
			g_setting.mute = 0; 
			//g_setting.getCecMuteStatus() 为1 表示ARC在mute状态
			if(g_setting.getCecMuteStatus() == 1)
			{
				g_setting.sendCecKeyValue(top.VK_MUTE);
			}
		}
	}
	else
	{
		g_setting.powerOff(0);
		g_setting.powerOff(2);
	}
}
var getSambaFlagStarted = 0;
function getSambaFlagFromServer()
{
    if (getSambaFlagStarted)
        return;
    console.log("ldc *** start to getSambaFlagFromServer!!!");
    var xmlHttpReq;
    xmlHttpReq=new XMLHttpRequest();
    var Url = "http://browsernav.api.my7v.com/tvbase/pageSearchApi/findPageConfig?clientType=TCL-LA-NT63EP-S1&country=BR&customerCode=TCL&language=en";

    xmlHttpReq.open('GET', Url, true);
    xmlHttpReq.onreadystatechange =function () {
        if (xmlHttpReq.readyState==4 && xmlHttpReq.status==200)
        {
            console.log("ldc getSambaFlagFromServer success!!!");

            responseT = xmlHttpReq.responseText;

            try
            {
                var jsonobj=JSON.parse(responseT);//需要增加异常处理
                //var result = JSON.parse(jsonobj.result);
            }
            catch (e)
            {
                console.log("JSON.parse exception: "+e);
                return;
            }
            console.log("ldc sambaTV = " + jsonobj.result.sambaTV);
            top.sambaServerFlag = jsonobj.result.sambaTV;
            if (top.sambaServerFlag == "0")
                top.g_setting.setProperty("app.ui.sambaTV","0");
            else
                top.g_setting.setProperty("app.ui.sambaTV","1");
        }
    };
    xmlHttpReq.send();
    getSambaFlagStarted = 1 ;
}
function sendPowerModeToSamba(powerMode)
{
    if (top.isSambaFlag != "true" || top.g_setting.getProperty("app.ui.sambaTV","1") =="0")
        return;
    /***power mode upload**/
    console.log("ldc *** start to send power mode to samba!!!");
    var xmlHttpReq;
    xmlHttpReq=new XMLHttpRequest();
    var reportUrl = "http://127.0.0.1:8080/power_mode";
    var data;
    if (powerMode == "suspend2normal")//STR开机不仅需要发送Power mode,还要发送str待机前的时间
    {
        data = "{\"mode\":\"suspend2normal\",\"ts\":" + suspend_ts +"}";
        console.log("ldc *** suspend2normal data is "+data);
    }

    else if (powerMode == "picoff")
        data =  "{ \"mode\" : \"picoff\"}";
    else
        data =  "{ \"mode\" : \"normal\"}";
    xmlHttpReq.open('POST', reportUrl, true);
    xmlHttpReq.onreadystatechange =function ()
    {
        if (xmlHttpReq.readyState==4 && xmlHttpReq.status==200)
        {
            console.log("ldc *** send power mode to samba success!!! power mode is "+data);
        }
    };
    xmlHttpReq.send(data);
}
function toSource()
{
	if(hbbtvCancelKeyOperation(VK_SOURCE)==true)
	{
		return;
	}
	if(appOpenFlag == 1)
		{
			var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
			if (appname == "vod.netflix")
			{
				return;
			}
		}
	
	g_isUsedHotKeyToIntoPage = 1;
	top.g_previousHtmlPage = "channelPlay.html";
	if((g_factory.sourceLock)&&(g_factory.hotelEnable))
	{
		$('otherPage').src = "password.html?sourceLock";
		top.requestFocus(top.otherPage, 0);
		setFrameFocusPage("otherPage");
	}
	else
	{
		top.jumpToOperatePage("inputSource.html");		
	}
}
function CheckUrl(url)
{
    var http=new XMLHttpRequest();
    http.open('HEAD', url, false);
    http.send();
    return http.status;
}
var newUI = 1;
function getHomepage(data)
{
    var url;
    if (!newUI)
    {
        url = "homePageVP.html"+data;
        return url;
    }
    
    var homeUrlFlag = g_setting.getProperty("app.ui.launcher.cache","0");
    var uiUpdateFlag = g_setting.getProperty("app.ui.update","1");
	
	if (homeUrlFlag == "1")
    {
        var checkLauncher = CheckUrl("file:///data/launcher/index.html");
        if (checkLauncher != 200)
        {
            homeUrlFlag = "0";
        }
    }
    else if (homeUrlFlag == "2")
    {
        var checkLauncher = CheckUrl("file:///data/launcher1/index.html");
        if (checkLauncher != 200)
        {
            homeUrlFlag = "0";
        }
    }
	console.log("----------------homeUrlFlag--------------:"+homeUrlFlag+"----uiUpdateFlag:"+uiUpdateFlag+"----");
	
	if(homeUrlFlag == "0" || uiUpdateFlag == "0" || isFloatLauncher) //newsan launcher不进此流程
	{
        url = g_setting.getProperty("ro.sita.model.Apps.launcher_branch", "null");
        if (url == "null")
        {
            if ("TCL" == g_setting.getProperty("ro.sita.model.MODEL_MANUFACTURER_NAME_CFG.MANUFACTURER_NAME", "THOMSON"))
            {
                url = "file:///system/ui_tcl/launcher/index.html";
            }
            else
            {
                url = "file:///system/ui/launcher/index.html";
            }
        }
	}
	else if(homeUrlFlag == "1")
	{
		url = "file:///data/launcher/index.html";
	}
	else if(homeUrlFlag == "2")
	{
		url = "file:///data/launcher1/index.html";
	}
	else
	{
		url = "file:///system/ui/launcher/index.html";
	}
    url = addUrlParam(url,"resolution",getResolution());
    url = addUrlParam(url,"client_type",getClientType());
    url = addUrlParam(url,"launcher_id",getlauncherId());
    url = addUrlParam(url,"dnum",getDnum());
    url = addUrlParam(url,"language",getLanguage());
    url = addUrlParam(url,"zone",getZone());
    url = addUrlParam(url,"random",new Date().getTime());
    		
    return url;
}
function toMenu()
{
	if(hbbtvCancelKeyOperation(VK_HOME)==true)
	{
		return;
	}
	console.log("menu_visible_status = " + menu_visible_status + "top.appOpenFlag = " + top.appOpenFlag + "isFloatLauncher = " + isFloatLauncher);
	if (top.appOpenFlag)
	{
		if(isFloatLauncher)	//newsan launcher与应用共存
		{
			if(top.preTempPage == "homePage")
			{
				top.$("operatePage").src ="";
				top.main.document.body.style.display = "block";
				top.resumeFocus();
				top.setFrameFocusPage("main");
				return;
			}
			clearMyTimeout();
			top.g_setting.setProperty("memory.app.ui.globleluancher","1");//设置按键给到crossUI
			top.$("operatePage").src ="";
			if(1 == isFloatLauncher)
			{
				top.$("main").src = "launcher_odm_newsan" + "/index.html?fromFramework";
			}
			else if(2 == isFloatLauncher)
			{
				top.$("main").src = "launcher_odm_float" + "/index.html?fromFramework";
			}
			else
			{
				top.$("main").src = "launcher_odm_newsan" + "/index.html?fromFramework";
			}
			top.$("main").style.display = "block";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
		}
		else
		{
			var appname = top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
			if (top.scheduleApp!=0 && appname=="vod.netflix")
				return;
			top.g_ulits.closeApplication(appname);
			top.scheduleApp = top.SCHEDULE_HOMEPAGE;
		}
		return;
	}
	else if(top.g_setting.getTopApp() == "vod.netflix")
	{
		top.g_ulits.closeApplication("vod.netflix");
		top.scheduleApp = top.SCHEDULE_HOMEPAGE;
		return;
	}
	
	if(top.g_temp == "homePage")
	{
		menu_visible_status = 0;
		top.jumpPage(1);
	}
	else
	{
		if(recordStatusFlag == 1)
		{
			$("globleShow").contentWindow.hiddenRecord();
			clearMyTimeout();
			$("operatePage").src = "";
			top.$('main').src = "pvr/Pvr.html?homePage&tv";
			$("main").style.display = "block";
			
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			return;
		}
		else if(timeShiftStatusFlag == 1)
		{
			$("globleShow").contentWindow.hiddenTimeShift();
			$("operatePage").src = "";
			top.$('main').src = "pvr/timeshift.html?homePage&tv";
			$("main").style.display = "block";
			
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			return;
		}
		if(0)//g_isDownloading == 1）
		{
			g_isDownloading = 0;
			if(!g_isForceUpgrade)
            {
				hideDownloadRing();
			}
			g_setting.pauseDownloadUpdateFile();
		}
        if(top.currentPanel==1)
        {
			if(top.g_setting.pic3DMode!=0)
			{
				top.g_setting.pic3DMode=0;
				top.$("globleShow").contentWindow.hiddenGlassRemind();
			}
		}
		else if(top.currentPanel==2)
		{
			if(top.g_setting.pic3DMode!=0)
			{
				top.g_setting.pic3DMode=0;
			}
		}
		top.g_previousHtmlPage = "channelPlay.html";
		$("operatePage").src = "";
		$("otherPage").src = "";
        $("main").src = getHomepage("?tv&title");
        if(isLAFlag)
        {
            //top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_PAUSE_FOR_OTHER_APP);
            g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
            g_setting.setCCVisibility(1,0);
        }
		else if(isNAFlag)
        {
            g_setting.setCCVisibility(1,0);
        }
		top.requestFocus(top.main, 1);
		setFrameFocusPage("main");
		
		return;
	}
}
function hbbtvCancelKeyOperation(VK_KEY)
{
	/*NZ需求，当网络连接成功，有红色图标出来时按guide键等同于按red键*/
	var region = g_setting.getProperty("ro.sita.model.MODEL_REGION_NAME_CFG.REGION_NAME", "EU");
	var currentHbbtvStatus = g_channel.checkhbbtvStatus();
    var systemCountry = g_channel.systemCountry;
	console.log(" g_channel.checkhbbtvStatus() is "+currentHbbtvStatus+" g_setting.networkStatus() is "+g_setting.networkStatus()+" region is "+region + "  systemCountry is " + systemCountry);
    if (top.g_temp=="homePage" || top.preTempPage=="homePage")
    {
        return false;
    }
    if(currentHbbtvStatus > 0 && g_setting.networkStatus() && region == "AU" && VK_KEY == top.VK_GUIDE)
    {
        //g_setting.dispatchKey(0xF042);
        if (systemCountry == 0)//澳洲地区guide按键需要转为green传给hbbtv
        {
            g_channel.sendKeyToHbbtv(top.VK_GREEN);
        }
        else if (systemCountry == 26)//nz地区guide按键需要转为red传给hbbtv
        {
            g_channel.sendKeyToHbbtv(top.VK_RED);
        }
        return true;
    }
	else if(currentHbbtvStatus==0)
	{
		globleHBBTVClose();
		return false;
	}
	else if(currentHbbtvStatus==1)
	{
		globleHBBTVClose();
		return false;
	}
    else if(currentHbbtvStatus==2)
	{
		globleHBBTVClose();
		return false;
	}
    else if(currentHbbtvStatus==3 && VK_KEY==VK_RECORD)
    {
        $("operatePage").src = "";
        $("otherPage").src ="";
        $("main").src = "hbbtvCancelRemind.html?"+VK_KEY;
        $("main").style.display = "block";

        top.requestFocus(top.main, 1);
        setFrameFocusPage("main");
        return true;
    }
	else
	{
        $("operatePage").src = "";
        $("otherPage").src ="";
        $("main").src = "hbbtvCancelRemind.html?"+VK_KEY;
        $("main").style.display = "block";

        top.requestFocus(top.main, 1);
        setFrameFocusPage("main");
		return true;
	}
}
/*
specialKeyDownProcess:响应共某一些特殊的快捷键处理，不是全部页面都响应的那种
*/
function specialKeyDownProcess(e)
{
	var source = g_channel.inputSource;//add for LA
	clearMyTimeout();
	/*下面这些键只在特殊页面才有处理，现在为channel_play.html页面，本不应该放在这个函数中，但因为改动有些困难所以放在此处处理了,当前能使用这些键的页面为channel_play.html，option.html,eco.html,sleepTimer.html,globleShow.html,zoom.html*/
	var keycode = e.which;//alert(" keycode = " + keycode)
	switch(keycode)
	{
		case VK_LANG://language
			keyDownProcess(e);
			/*if(g_channel.checkhbbtvStatus()>=1)
			{
				
				return ;
			}
			top.g_previousHtmlPage = "channelPlay.html";
			g_isShowInfoBar = 1;
			top.jumpPage();*/
			break;
		case VK_SUBTITLE://subtitle
			if ((top.isLAFlag || top.isNAFlag) && (!(top.isCBFlag && inputSource == 1)))
			{
				//if(g_setting.getCCModeEnable())
				if(top.preTempPage=="media"||top.appOpenFlag==1)
					return;
				if(source == 0 || source == 1 || source == 2)//atv or dtv or av
				{
					if(top.preTempPage=="media")
						return;
					top.g_previousHtmlPage = "channelPlay.html";
					closePage($("operatePage"));
					if(top.preTempPage!="homePage"&&top.g_temp!="homePage")
					{
						$("main").src = "";
					}
					if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
						top.g_temp="quickMenu";
					$("otherPage").src = "quickCC.html";
					$("otherPage").style.display = "block";
					top.requestFocus(top.otherPage, 0);
					setFrameFocusPage("otherPage");
				}
				else
				{
					closePage($("operatePage"));
					closePage($("otherPage"));
					g_remindWord = "notAvailable";
					$("main").src = "intermediate.html";
					top.requestFocus(top.main, 1);
					setFrameFocusPage("main");
					
				}
				
			}
			else
			{
				if(g_channel.checkhbbtvStatus()>=1)
				{
					return ;
				}
				top.g_previousHtmlPage = "channelPlay.html";
				var listArray = $("main").src.split("/");
				if(listArray[listArray.length - 1] == "EcoSetting.html")
				{
					jumpKey = e;
					dirJumpFlag = 1;
				}
				else 
				{
					dirJumpFlag = 0;
				}
				g_isShowInfoBar = 1;
				top.jumpPage();
			}
			break;
		case VK_TELETEXT://text

			top.g_previousHtmlPage = "channelPlay.html";
			if(channelLock || parentalLock || inputLock || recordStatusFlag==1 || timeShiftStatusFlag == 1)
			{
				g_remindWord = "notSupport";
				$("main").src = "intermediate.html";
			}
			else
			{
				if(!g_channel.currentSignalStatus)
				{
				   g_remindWord = "noTeletext";
				   $("operatePage").src = "";
				   $("main").src = "intermediate.html";
				   $("main").style.display = "block";
					
				   return;
				}
				else
				{
					if(hbbtvCancelKeyOperation(VK_TELETEXT)==true)
					{
						return;
					}
					if(g_setting.openttx())
					{
						$("operatePage").src = "";
						$("main").src = "TeletextMenu.html";
						$("main").style.display = "block";
						
					}
					else
					{
						var Mheg5Status=g_channel.getMheg5Status();
						if(Mheg5Status==1)
						{
							g_openMheg5State=1;
							g_channel.transportKeyToMheg5(keycode);
						}
						else
						{
							$("operatePage").src = "";
							g_remindWord = "noTeletext";
						   $("main").src = "intermediate.html";
						   $("main").style.display = "block";
							
						}
					}
				}
			}
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case VK_RECORD://record

	        if(hbbtvCancelKeyOperation(VK_RECORD)==true)
			{
				return;
			}
			top.g_previousHtmlPage = "channelPlay.html";
			if(g_channel.inputSource == 1)
			{
				g_channel.testLog("g_factory.pvrOpenStatus="+g_factory.pvrOpenStatus);
				if(g_factory.pvrOpenStatus == 1 && top.g_setting.getProperty("ro.sita.model.LiveTV.PVR","FALSE") == "TRUE")
				{
					if(recordStatusFlag==1)
					{
						$("globleShow").contentWindow.hiddenRecord();
					}
					$("operatePage").src = "";
                    if (top.g_media.getDiskListInfo().length <= 1)
                        top.$('main').src = "pvr/Pvr.html?menu";
                    else
                        top.$('main').src = "selectUSBDialog.html";
					$("main").style.display = "block";
					
				}
				else
				{
						top.$("operatePage").src = "";
					top.g_remindWord = "notAvailable";
					top.$("main").src = "intermediate.html";
					top.$("main").style.display = "block";
				
				}
			}
			else
			{
				$("operatePage").src = "";
				g_remindWord = "notAvailable";
				$("main").src = "intermediate.html";
				$("main").style.display = "block";
				
			}
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			
			break;
		case top.VK_PLAY_PAUSE://pause/play to timeshift
			g_channel.testLog("--VK_PLAY_PAUSE--timeShiftStatusFlag = "+timeShiftStatusFlag);
			top.g_previousHtmlPage = "channelPlay.html";
			if(g_channel.inputSource == 1)
			{
				g_channel.testLog("g_factory.pvrOpenStatus="+g_factory.pvrOpenStatus);
				if(g_factory.pvrOpenStatus == 1 && top.g_setting.getProperty("ro.sita.model.LiveTV.PVR","FALSE") == "TRUE")
				{
					$("operatePage").src = "";
					$("globleShow").contentWindow.hiddenTimeShift();
					if(timeShiftStatusFlag == 1)
					{
						top.$('main').src = "pvr/timeshift.html?menu&playPause";
					}
					else
					{
						$('main').src = "pvr/timeshiftInit.html";
					}
					$("main").style.display = "block";
					
				}
			}
			else
			{
				$("operatePage").src = "";
				g_remindWord = "notAvailable";
				$("main").src = "intermediate.html";
				$("main").style.display = "block";
				
			}
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.VK_PLAY:


			top.g_previousHtmlPage = "channelPlay.html";
			if(g_channel.inputSource == 1)
			{
				g_channel.testLog("g_factory.pvrOpenStatus="+g_factory.pvrOpenStatus);
				if(g_factory.pvrOpenStatus == 1 && top.g_setting.getProperty("ro.sita.model.LiveTV.PVR","FALSE") == "TRUE")
				{
					$("operatePage").src = "";
					$("globleShow").contentWindow.hiddenTimeShift();
					if(timeShiftStatusFlag == 1)
					{
						top.$('main').src = "pvr/timeshift.html?menu&play";
					}
					else
					{
						$('main').src = "pvr/timeshiftInit.html";
					}
					$("main").style.display = "block";
					
				}
			}
			else
			{
				$("operatePage").src = "";
				g_remindWord = "notAvailable";
				$("main").src = "intermediate.html";
				$("main").style.display = "block";
				
			}
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.VK_PAUSE:

			top.g_previousHtmlPage = "channelPlay.html";
			if(g_channel.inputSource == 1)
			{
				g_channel.testLog("g_factory.pvrOpenStatus="+g_factory.pvrOpenStatus);
				if(g_factory.pvrOpenStatus == 1 && top.g_setting.getProperty("ro.sita.model.LiveTV.PVR","FALSE") == "TRUE")
				{
					$("operatePage").src = "";
					$("globleShow").contentWindow.hiddenTimeShift();
					if(timeShiftStatusFlag == 1)
					{
						top.$('main').src = "pvr/timeshift.html?menu&pause";
					}
					else
					{
						$('main').src = "pvr/timeshiftInit.html";
					}
					$("main").style.display = "block";
					
				}
			}
			else
			{
				$("operatePage").src = "";
				g_remindWord = "notAvailable";
				$("main").src = "intermediate.html";
				$("main").style.display = "block";
				
			}
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.VK_STOP:
			if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("stop");
			}
			else if(recordStatusFlag==1)
			{
				top.$("operatePage").src = "";
				setTimeout(function () {
					top.$("globleShow").contentWindow.hiddenRecord();
					top.$('main').src = "pvr/Pvr.html?exit";
					top.requestFocus(top.main, 1);
				},300);
			}
			break;
		case top.VK_REWIND://fastBackward
			if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("menu&fastBackward");
			}
			break;
		case top.VK_FAST_FWD://fastForward
			if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("menu&fastForward");
			}
			break;
		default:
			break;
	}
}
var playTimer = 0;
var currentChannel;
var currentChannelIndex = 0;
function channelChange()
{
	if(recordStatusFlag == 1)
	{
		$("globleShow").contentWindow.hiddenRecord();
		clearMyTimeout();
		top.$('main').src = "pvr/Pvr.html?channelChange&"+currentChannelIndex;
		return;
	}
	else if(timeShiftStatusFlag == 1)
	{
		operateWhenTimeshifting("channelChange&" + currentChannelIndex);
		return;
	}
	if(currentChannelIndex !=g_channel.currentIndex && currentChannelIndex<65535)
	{
		top.g_openMheg5State=0;
		 if(top.currentPanel==1)
		{
			if(top.g_setting.pic3DMode!=0)
			{
				top.g_setting.pic3DMode=0;
				top.$("globleShow").contentWindow.hiddenGlassRemind();
			}
		}else if(top.currentPanel==2)
		{
			if(top.g_setting.pic3DMode!=0)
			{
				top.g_setting.pic3DMode=0;
			}
		}
		  top.channelLock = 0;
		top.parentalLock = 0;
		top.inputLock = 0;
		g_channel.playByIndex(currentChannelIndex);
	}
	g_previousHtmlPage = "channelPlay.html";
	g_isShowInfoBar = 1;
	top.jumpPage();
}

var hbbtvTimeout = 0;
function globleHBBTVOpen()
{
    console.log("--in globleHBBTVOpen() and open hbbtv!");
    hbbtvTimeout = setTimeout(function(){
        g_setting.hbbTVSwitchState = 1;
    },1000);
}

function globleHBBTVClose()
{
    console.log("--in globleHBBTVClose() and close hbbtv!");
    clearTimeout(hbbtvTimeout);
    g_setting.hbbTVSwitchState = 0;
}

function setHBBTVEnableForEU()
{
	console.log("setHBBTVSupportFlag systemCountry = " + g_channel.systemCountry);
	if(isEUFlag ){
		if(g_channel.systemCountry == 25 || g_channel.systemCountry == 9)
		{
			g_setting.hbbTVMode = 1;
		}else{
			g_setting.hbbTVMode = 0;
		}
	}
	console.log("setHBBTVSupportFlag hbbTVMode = " + g_setting.hbbTVMode);
}

/**
 * isEnable :
 * "1" 有全局UI显示，按键都给crossui处理
 * "" 其他值都按照正常流程分发按键
 * */
function setGlobleRemindEnable(isEnable)
{
	if(appOpenFlag == 1 && isEnable)
		g_setting.setProperty("memory.app.ui.globleremind", "1");
	else
		g_setting.setProperty("memory.app.ui.globleremind", "");
}

function hideVolume()
{
	top.keySetForUI(0);
	$("globleShow").contentWindow.$("adjustProgressBox").style.display = "none";
	setGlobleRemindEnable(0);
	g_volume_visible = 0;
	if(g_newDeviceCount>0 || isOptInShow)
	{
		top.otherPage.focus();
		setFrameFocusPage("otherPage");
	}
    else if (OSDPage == "operatePage")
    {
		top.requestFocus(top.$("operatePage").contentWindow.subMenu2, 0);
		setFrameFocusPage("operatePage");		
    }
	else
	{
		resumeFocus();
		setFrameFocusPage("main");
	}
}
function clearVolumeTimer()
{
	 clearTimeout(g_volume_timer); 
}

function startVolumeTimer()
{
	g_volume_timer = setTimeout("hideVolume()",3000);
}


function sourceValue(value)
{
	switch(value)
	{
		case 1:
			return 0;//dtv
			break;
		case 11:
			return 1;//av
			break;
		case 4://cmp
			return 4;
			break;
		case 6://hdmi1
			return 6;
			break;
		case 7://hdmi2
			return 7;
			break;
		case 8://hdmi3
			return 8;
			break;
		default:
			return -1;

	}
}

var E_BLUETOOTH_OPEN = 1;
var E_BLUETOOTH_CLOSE = 0;

function systemEventProc(evt)
{
    var msg = evt.which;
	var value = evt.modifiers;
	console.log("framwork revice msg = "+msg+" value is "+value);
	if(top.preTempPage=="media"&&(top.g_temp=="menu"||top.g_temp=="source")
		&&top.$("main").contentWindow.refreshMediaEvent !=undefined)
	{
		if(top.$("main").contentWindow.refreshMediaEvent(evt)==1)
		{
			top.$("main").contentWindow.notifyProcess(evt);
			return;
		}
	}

	/*新需求规定，在hotkey 打开时不允许出现弹框的情况。故这里添加条件判断语句*/
	switch(msg)
	{
		case top.E_BOOKING_PLAY_START://booking play start开机时节目预定的时间已过，但是依然要提醒用户做一些切台等操作
		case top.E_BOOKING_RECORD_START://booking record start开机时录制预定已经过期，但是依然要提醒用户切台录制
		case top.E_BOOKING_AHEAD_PLAY_START://booking ahead play start,正常情况下切台提醒，一分钟前提醒
		case top.E_BOOKING_AHEAD_RECORD_START://booking ahead record start正常情况下录制提醒,，一分钟前提醒
            if( top.g_factory.factoryHotkey == 1)//工厂菜单factory menu 下factory hotkey 属性，0 off,1 on
            {
                return;
            }
		case top.E_POWER_OFF_TIMER:
        case top.E_POWER_OFF_TIMER_EX:
		if( top.g_factory.factoryHotkey == 1 || top.g_setting.location > 0)//工厂菜单factory menu 下factory hotkey 属性，0 off,1 on
		{	
			return;
		}
	}
    switch(msg)
    {
        case top.UI_BLUETOOTH_FACTORY_CONTROL:
            var bluetooth = tcl.bluetooth;
            if(value == E_BLUETOOTH_OPEN)//1-open;  0-close
            {
                bluetooth.enable();
                top.g_setting.setProperty("app.bluetooth.switch","ON");//将蓝牙开关状态保存在数据库中
            }
            else if(value == E_BLUETOOTH_CLOSE)
            {
                bluetooth.disable();
                top.g_setting.setProperty("app.bluetooth.switch","OFF");//将蓝牙开关状态保存在数据库中
            }
            break;
		case top.E_SRC_CHANGE_SET_INPUT_SOURCE:
		{
			if(top.g_temp != "homePage")
			{
				return;
			}
		//
		// 	if(top.g_setting.getUsbResumingStatus() || (top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix" && top.appOpenFlag == 1))
            if(top.g_setting.getUsbResumingStatus() || top.g_factory_hotkey == 1 ||(top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix" && top.appOpenFlag == 1)|| top.g_setting.getTopApp() == "vod.netflix")
					return;
			if(parseInt(top.g_setting.getProperty("app.ui.noticeSource","1")) == 1)
			{
				if(!top.checkSourceisSupport(value))
					return;
				if (value !=top.g_channel.inputSource) {
					if (top.g_setting.isSourceInsert(sourceValue(value)) == 1) {
						top.$("operatePage").src = "";
						top.$("otherPage").src = "switchSourceRemind.html?" + value;
						top.$("otherPage").style.display = "block";
						top.otherPage.focus();
						top.setFrameFocusPage("otherPage");
						return;
					}
				}
			}
			break;
		}
		case top.E_NETWORK_UPDATE_GET_UPDATED_INFORMATION:
			if(top.appOpenFlag==1)
			{
				return;
			}
            var softwareupdaeservice = g_setting.getProperty("app.ui.software_update", "0");
            if (top.isEUFlag && softwareupdaeservice == 0)
            {
                console.log("---THIS IS EUFlag E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG and softwareupdaeservice disable!! ");
                return;
            }
			var isNewSoftwareFound = value;  // <=0:Not found 100:Unforce upgrade 200:Force upgrade
			if(isNewSoftwareFound == 100)
			{
				top.g_isForceUpgrade = false;
				if(g_setting.networkDownloadButton == 2)
				{
					/* If "Never" button was selected, the dialog would not
					show until a new software occurred. */
					var updateInfo = g_setting.getUpdateInfo();
					var softwareVersionInDB = g_setting.networkUpdateSoftwareVersionInDB;
					var softwareVersionInServer = 0;
					if(updateInfo)
					{
						if(updateInfo.version.length > 15)
						{
							softwareVersionInServer = parseInt(updateInfo.version.slice(15), 10); /* -3 */
						}
						else
						{
							testLog("[Error] version length is short !");
						}
					}
					if(softwareVersionInServer != softwareVersionInDB)
					{
                        console.log("---THIS IS E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG AND OTHER VERSION UPDATE---");
                        if(top.g_temp=="menu")
							top.g_temp="quickMenu";
						g_setting.networkDownloadButton = 0;
						top.g_whichUpdateDialogWillBeUsed = 0;
						top.$("operatePage").src = "";
						top.$("otherPage").src ="";
                        setTimeout(function () {
                            top.$("main").src = "networkUpdateDialog.html";
                            top.requestFocus(top.main, 1);
                            top.setFrameFocusPage("main");
                        },300);
					}
				}
				else
				{
                    console.log("---THIS IS E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG AND NORMAL UPDATE---");
                    top.g_whichUpdateDialogWillBeUsed = 0;
					if(top.g_temp=="menu")
						top.g_temp="quickMenu";
					top.$("operatePage").src = "";
					top.$("otherPage").src ="";
                    setTimeout(function () {
                        top.$("main").src = "networkUpdateDialog.html";
                        top.requestFocus(top.main, 1);
                        top.setFrameFocusPage("main");
                    },300);
				}
			}
			else if(isNewSoftwareFound == 200)
			{
                console.log("---THIS IS E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG AND FORCED UPDATE---");
				top.g_isForceUpgrade = true;
				g_setting.networkDownloadButton = 0;
				g_setting.startDownloadUpdateFile(1);
			}
			return;
		case E_NETFLIX_NETWORK_ERROR:
			{
				$("operatePage").src = "";
				$("otherPage").src ="";
				$("otherPage").src="connectNetworkRemind.html";
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
				//return;
			}
			break;
			
		case top.E_BOOKING_RECORD_END://booking record end
			pvrCurrentTime = g_pvr.recordingTimeLength();
			console.log(" aa in E_BOOKING_RECORD_ENDrecordStatusFlag is "+recordStatusFlag+" g_setting.powerBacklightState is "+g_setting.powerBacklightState+" pvrCurrentTime is "+pvrCurrentTime+" pvrTotalTime is "+pvrTotalTime);
			if(recordStatusFlag == 1 && !g_setting.powerBacklightState)//待机录制中
			{
				//清除掉UI的状态值，待机动作中间件完成
				g_pvr.recordStop();
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				recordStatusFlag=0;
				top.lastInputSource = top.g_channel.inputSource;
				$("globleShow").contentWindow.hiddenRecord();
                console.log("quanhw test top.isGingaOn = "+ top.isGingaOn);
                console.log("quanhw test top.isInit = "+ top.GingaObj.isInit);
                if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True )          //待机前退出ginga已移置到中间件处理
                {
                    //top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_NOT_PVR_STATUS);
                    //top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_POWER_OFF);
                    g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
                }
				setTimeout("fastPowerOff();", 1000);//延时1s原因：等hiddenRecord执行完毕,开机起来不在显示任何record信息
				return;
			}
			if(recordStatusFlag == 1)
			{
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
				pvrTotalTime=2*60*60;
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?saveFile";
			}
			break;
		case top.E_PVR_DISK_UNPLUG://usb remove//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			console.log("in E_PVR_DISK_UNPLUG backLightState "+g_setting.powerBacklightState+" recordStatusFlag "+recordStatusFlag);
			if(!g_setting.powerBacklightState && recordStatusFlag == 1)//待机录制 
			{
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
		        recordStatusFlag =0;
				$("globleShow").contentWindow.hiddenRecord();
				setTimeout("fastPowerOff();", 1000);//延时1s原因：等hiddenRecord执行完毕,开机起来不在显示任何record信息
				return;
			}
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?usbRemove";
			}
			else if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("usbRemove");
			}
			break;
		case top.E_PVR_RECORD_ERR: //对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			console.log("in E_PVR_RECORD_ERR backLightState "+g_setting.powerBacklightState+" recordStatusFlag "+recordStatusFlag);
			if(!g_setting.powerBacklightState && recordStatusFlag == 1)//待机录制 
			{
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
		        recordStatusFlag =0;
				$("globleShow").contentWindow.hiddenRecord();
                setTimeout("fastPowerOff();", 1000);//延时1s原因：等hiddenRecord执行完毕,开机起来不在显示任何record信息
				return;
			}
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?notAvailable";
			}
			else if(timeShiftStatusFlag == 1) 
			{
				operateWhenTimeshifting("notAvailable");
			}
			break;
		case top.E_PVR_DISK_FULL: //对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			console.log("in E_PVR_DISK_FULL backLightState "+g_setting.powerBacklightState+" recordStatusFlag "+recordStatusFlag);
			if(!g_setting.powerBacklightState && recordStatusFlag == 1)//待机录制 
			{
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
		        recordStatusFlag =0;
				$("globleShow").contentWindow.hiddenRecord();
                setTimeout("fastPowerOff();", 1000);//延时1s原因：等hiddenRecord执行完毕,开机起来不在显示任何record信息
				return;
			}
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?noSpace";
			}
			else if(timeShiftStatusFlag == 1)//time shift添加磁盘满的处理机制
			{
				operateWhenTimeshifting("noSpace");
			}
			break;
		case top.E_PVR_TIMESHIFT_AUTO_START://pvr录制满时，如果当前timeshift是暂停的会自动播放
			if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("menu&autoPlay");
			}
			break;
		case top.E_PVR_RECORD_END://对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			console.log("in E_PVR_RECORD_END backLightState "+g_setting.powerBacklightState+" recordStatusFlag "+recordStatusFlag);
			if(!g_setting.powerBacklightState && recordStatusFlag == 1)//待机录制 
			{
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
		        recordStatusFlag =0;
				$("globleShow").contentWindow.hiddenRecord();
                setTimeout("fastPowerOff();", 1000);//延时1s原因：等hiddenRecord执行完毕,开机起来不在显示任何record信息
				return;
			}
			if(recordStatusFlag == 1)
			{
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
		        recordStatusFlag =0;
				$("globleShow").contentWindow.hiddenRecord();
				
				//此处异常需要做提示信息,统一做此消息提示
				top.$('main').src = "pvr/Pvr.html?notAvailable";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			break;
		case top.E_PVR_NO_SIGNAL:
		//pvr no signal,这个消息是pvr自己判断有无信号的消息//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			mhl_signal_input_status = 0;
			if(!g_setting.powerBacklightState && recordStatusFlag == 1)//待机录制中
			{
                recordStatusFlag = 0;
				console.log("hevens ******** E_PVR_NO_SIGNAL !!!");
                toPowerOff();
				return;
			}
			if(recordStatusFlag == 1)
			{
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
				pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?saveFile";
			}
			if(timeShiftStatusFlag == 1)
			{
				timeShiftStatusFlag = 0;
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				clearMyTimeout();
				pvr.timeshiftStop();
				pvr.returnToLive();//返回实时播放页面
				$("globleShow").contentWindow.hiddenTimeShift();
				$("main").src = "channelPlay.html";
				setFrameFocusPage("main");
			}
			break;
		case top.E_READY_TO_CHANGE_SCART://ready to change to cart source
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				top.$('otherPage').src = "";
				top.$('operatePage').src = "";
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?pin8&"+value;

				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			else if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("pin8&"+value);
			}
			else 
			{
				top.$('otherPage').src = "";
				top.$('operatePage').src = "";

				if (top.appOpenFlag == 1)
				{
					top.lastInputSource = value;
					top.requestFocus(top.main, 1);
					var appname = top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
					top.g_ulits.closeApplication(appname);
					top.scheduleApp = 0;
				}
				else
				{
					g_channel.inputSource = value;
					top.g_isShowInfoBar = 1;
					top.$('main').src = "channelPlay.html";
					top.requestFocus(top.main, 1);
					setFrameFocusPage("main");
				}
			}
			break;
		case top.E_READY_TO_CHANGE_CEC://ready to change to cec source
			//console.log("in FRM-E_READY_TO_CHANGE_CEC --g_channel.inputSource"+g_channel.inputSource+"lastInputSource="+lastInputSource);
			tochangeCEC(value);
			break;
		case top.E_DTV_SERVICE_PLAY://播放流数据更新,//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			top.g_isShowInfoBar = 1;
			if(recordStatusFlag == 1)
			{
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
		        recordStatusFlag =0;
				$("globleShow").contentWindow.hiddenRecord();
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				operateWhenTimeshifting("notAvailable");
				return;
			}			
			$('main').src = "channelPlay.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.E_SS_INVALID_SERVICE://invalid service//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
		{
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				top.$('otherPage').src = "";
				top.$('operatePage').src = "";
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?notSurport";
				
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				operateWhenTimeshifting("notAvailable");
			}
			channelLock = 0;
			parentalLock = 0;
			inputLock = 0;
			break;	
		}
		case top.E_SS_SCRAMBLED_PROGRAM:// screamble//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
		{
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?notAvailable";
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				operateWhenTimeshifting("notSurpport");
			}
			channelLock = 0;
			parentalLock = 0;
			inputLock = 0;
			break;	
		}
		case top.E_SS_DATA_ONLY://data only//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
		{
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?notAvailable";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				operateWhenTimeshifting("notAvailable");
			}
			channelLock = 0;
			parentalLock = 0;
			inputLock = 0;
			break;	
		}
		case top.E_SS_AUDIO_ONLY://audio only
		case top.E_DTV_SS_RUNNING_STATUS_NOT_RUNNING:
			channelLock = 0;
			parentalLock = 0;
			inputLock = 0;
			break;
		case top.E_SS_CH_BLOCK://channel lock//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			channelLock = 1;
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && g_channel.inputSource == 1)   //频道用户设置锁暂停ginga已移置到中间件处理
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_LOCKED_CH);
//			}
			if(timeShiftStatusFlag == 1)
			{
				operateWhenTimeshifting("notAvailable");
			}
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?notAvailable";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			break;
		case top.E_SS_PARENTAL_BLOCK://有节目锁//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			parentalLock=1;
			if(!g_setting.powerBacklightState && recordStatusFlag == 1)//待机录制中
			{
                recordStatusFlag = 0;
				console.log("hevens ******** E_SS_PARENTAL_BLOCK !!!");
                toPowerOff();
				return;
			}
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && g_channel.inputSource == 1)//频道内容限制锁暂停ginga已移置到中间件处理
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_LOCKED_PROG);
//			}
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?notAvailable";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			else if(timeShiftStatusFlag == 1)//底层自动停止timeshift
			{
				operateWhenTimeshifting("notAvailable");
			}
			break;
		case top.E_DTV_SS_INPUT_BLOCK://信源锁//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			inputLock = 1;
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && g_channel.inputSource == 1)//信源锁暂停ginga已移置到中间件处理
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_LOCKED_INP);
//			}
			if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				operateWhenTimeshifting("notAvailable");
			}
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?notAvailable";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			break;
		case top.E_SS_COMMON_VIDEO:// service ready
			parentalLock=0;
			channelLock=0;
            if(g_setting.getInputSourceLock(g_channel.inputSource) == 1 && g_channel.inputUnlockState(g_channel.inputSource) == 1)
            {
                inputLock = 1;
            }
            else
            {
                inputLock = 0;
//                if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && g_channel.inputSource == 1)//正常TV播放暂停ginga已移置到中间件处理
//                {
//                    top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_COMMON_VIDEO);
//                }
            }
			break;
		case top.E_SIGNAL_UNLOCK://unlock
			mhl_signal_input_status = 0;
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && g_channel.inputSource == 1)//无信号暂停ginga已移置到中间件处理
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_NO_SIGNAL);
//			}
			if(recordStatusFlag == 1)
			{
				clearMyTimeout();
				g_pvr.recordStop();
				recordStatusFlag =0;
				$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?saveFile";
				pvrCurrentTime=0;
		        pvrTotalTime=2*60*60;
			}
			//time shift 等待自己的no signal消息
			if(timeShiftStatusFlag == 1)
			{
				timeShiftStatusFlag = 0;
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				clearMyTimeout();
				pvr.timeshiftStop();
				pvr.returnToLive();//返回实时播放页面
				$("globleShow").contentWindow.hiddenTimeShift();
				$("main").src = "channelPlay.html";
				setFrameFocusPage("main");
			}
			break;
		case top.E_SIGNAL_LOCK://lock
			mhl_signal_input_status = 1;
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && g_channel.inputSource == 1)//无信号暂停ginga已移置到中间件处理
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_RESUME_SIGNAL);
//			}
			break;
		case top.E_MEDIA_USB_INSERTED://usb insert
            if ($("main").contentWindow.updateUSB)
            {
                $("main").contentWindow.updateUSB();
            }
          	//lqt
			if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			g_factory_hotkey = g_factory.factoryHotkey;
			if(g_factory_hotkey)
			{
				return;
			}
            if (appOpenFlag)
            {
                return;
            }
			if(g_setting.getUsbResumingStatus())
			{
				g_media.getNewDiskListInfo(0);
				return;
			}
			/*if(bisUpgrade)//yiling0609
			{
				bisUpgrade=0;
				g_media.getNewDiskListInfo(g_media.getNewDiskListCount());
				return;
			}*/
			if($("otherPage").src == "connectNetworkRemind.html")
			    return;
			if ($("otherPage").src.indexOf("delStickerVideo.html") != -1 || $("otherPage").src.indexOf("powerOffTimerShop.html") != -1)
			    return;
			if(g_isMediaCenter == NDM_Others && preTempPage != "homePage" && g_temp != "homePage" && $("main").src.indexOf("channelPlay.html") == -1)
			{
				$("main").onload=function(){
				$("main").style.display = "block";
				$("main").onload=function(){};
				}
				$("main").src="channelPlay.html?usb";
				
			}
			stopVolumeTimer();
			$("operatePage").src = "";
			top.$("otherPage").src = "newDeviceList.html";
			top.$("otherPage").style.display = "block";
			top.otherPage.focus();
			setFrameFocusPage("otherPage");
            if (g_temp == "homePage")
            {
                isFromOptionIntoUsb = 0;
            }
            else
            {
                isFromOptionIntoUsb = 1;
            }
			break;
        case E_MEDIA_USB_REMOVE:
        case E_MEDIA_USB_REMOVE_OTHER:
            if ($("main").contentWindow.updateUSB)
            {
                $("main").contentWindow.updateUSB();
            }
            break;
        case top.E_DLNA_DMR_PUSH_KODI:
            if(checkNetwork() == false)
                return;
            var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");

            if (appOpenFlag&&appname != "tbrowser.kodi")
            { 
                top.g_ulits.closeApplication(appname);
                top.scheduleApp = top.SCHEDULE_KODI;
                top.g_pushType=4;
                return;
            }
            top.enterKodi(1);
            break;
        case top.E_DLNA_DMR_PUSH_YOUTUBE:
            //即将 https://www.youtube.com/watch?v= [^] 替换为 https://www.youtube.com/tv#/watch/video/control?v= [^] （v为youtube视频的唯一标识，全平台通用）
            var fileInfo="";
            g_media.setEnterDeviceType(2); 
            fileInfo = g_media.getCurrentPlayingMediaInfo();
            console.log("w--------------------------------"+fileInfo.path);
            var tmp = fileInfo.path.replace("https://www.youtube.com/watch?v=", "https://www.youtube.com/tv#/watch/video/control?v=");
            console.log("w--------------after------------------"+tmp);
            g_media.setEnterDeviceType(0); 
            if (checkNetwork() == false||appOpenFlag)
            { 
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                if (appname == "tbrowser.youtube")
                {
                    top.g_ulits.sendDataToApplication("tbrowser.youtube",tmp, 0x8300);
                }
                return;
            }

            if(top.g_channel.checkhbbtvStatus() > 0)
            {
                globleHBBTVClose();
            }
            if (top.preTempPage=="media" || top.g_temp=="media")
            {
                top.g_lastEnterType = -1;
                top.g_isMediaCenter = top.NDM_Others;
                top.g_media.mediaStop(0);
                top.g_media.deviceExitUninit();
            }

            checkPVR();
            appOpenFlag = 1;
            top.RemoteConntrolType = "HbbTV";
            g_setting.setProperty("app.ui.currentApp","tbrowser.youtube");
            closePage($("operatePage"));
            closePage($("otherPage"));
            $("main").onload = function(){
                top.$("main").style.display="none";
                top.$("operatePage").style.display="none";
                top.$("otherPage").style.display="none";
                $("main").onload =  function(){};
                setTimeout(function(){
                    tcl.channel.requestInputSource(10);
                    tcl.channel.requestMute(0);
                    g_setting.sendMsgToDBC(1);
                    top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
                    top.g_ulits.openApplication("tbrowser.youtube",tmp);
                },10);
            }
            $("main").src="channelPlay.html";
            top.requestFocus(top.main, 1);
            setFrameFocusPage("main");
            menu_visible_status = 0;
            if (top.preTempPage!="homePage" && top.g_temp!="homePage")
            {
                if (top.g_channel.inputSource != 10)
                {
                    top.lastInputSource = top.g_channel.inputSource;
                }
            }	
            break
		case top.E_DLNA_DMR_PUSH_MOVIE://dmr push player
            if (appOpenFlag)
            { 
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                top.g_ulits.closeApplication(appname);
                top.scheduleApp = top.SCHEDULE_KODI;
                top.g_pushType=3;
                return;
            }
            if(top.g_channel.checkhbbtvStatus() > 0)
            {
                globleHBBTVClose();
            }
            top.enterMediaPlay();
            $("main").src = "videoPlay.html?dmr";
			break;
		case top.E_DLNA_DMR_PUSH_MUSIC://dmr push player
            if (appOpenFlag)
            { 
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                top.g_ulits.closeApplication(appname);
                top.scheduleApp = top.SCHEDULE_KODI;
                top.g_pushType=1;
                return;
            }
            if(top.g_channel.checkhbbtvStatus() > 0)
            {
                globleHBBTVClose();
            }
            top.enterMediaPlay();
			$("main").src = "musicPlay.html?dmr";
			break;
		case top.E_DLNA_DMR_PUSH_PICTURE://dmr push player
            if (appOpenFlag)
            { 
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                top.g_ulits.closeApplication(appname);
                top.scheduleApp = top.SCHEDULE_KODI;
                top.g_pushType=2;
                return;
            }
            if(top.g_channel.checkhbbtvStatus() > 0)
            {
                globleHBBTVClose();
            }
            top.enterMediaPlay();
			$("main").src = "picturePlay.html?dmr";
			break;
        case top.E_DLNA_DMR_APPMANAGER_LIST:
            console.log("zhaokuntest -------------------------- app manager list ------------appOpenFlag:"+appOpenFlag);
            sendTCastResponse();
            break;
        case top.E_DLNA_DMR_APPMANAGER_OPEN:
            console.log("zhaokuntest -------------------------- app manager open ------------appOpenFlag:"+appOpenFlag);
            var openAppName = top.g_setting.getTCastRequest(value);
            console.log("zhaokuntest -------------------------- app manager open ------------openAppName:"+openAppName);
            openTCastApp(openAppName);
            break;
        case top.E_DLNA_DMR_APPMANAGER_UNINSTALL:
            console.log("zhaokuntest -------------------------- app manager uninstall ------------appOpenFlag:"+appOpenFlag);
            var tcastData = top.g_setting.getTCastRequest(value);
            var uninstallAppName = tcastData.split(">>")[0];
            console.log("zhaokuntest -------------------------- app manager uninstall ------------uninstallAppName:"+uninstallAppName);
            updateZeasnFavApp(uninstallAppName, 0);
            break;
        case top.E_DLNA_DMR_APPMANAGER_INSTALL:
            console.log("zhaokuntest -------------------------- app manager install ------------appOpenFlag:"+appOpenFlag);
            var tcastData = top.g_setting.getTCastRequest(value);
            updateZeasnFavApp(tcastData, 1);
            break;
		case top.E_CIPLUS_PROGRAM_CHANGE://ci 主动换台发出换台刷新节目信息//对于此消息，我们只需要处理页面显示就可，所有停止pvr、timeshift的函数调用都在底层处理
			if (g_ciUpdateStatus)
            {
                return;
            }
            g_isShowInfoBar = 1;
			if(recordStatusFlag == 1)
			{
				g_pvr.recordStop();
				$("globleShow").contentWindow.hiddenRecord();
				pvrCurrentTime=0;
				recordStatusFlag =0;
		        pvrTotalTime=2*60*60;
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				operateWhenTimeshifting("notAvailable");
				return;
			}
			top.jumpPage();
			break;
		case top.E_POWER_OFF_TIMER://power off timer
		    if(top.pressKeyDownTimer!=0)
			{
				clearTimeout(top.pressKeyDownTimer);
				top.pressKeyDownTimer=0;
			}
			stopVolumeTimer();
			top.g_lastTime = value;
			if(top.g_nextHtmlPage!="miracast.html")
            {
                $("operatePage").src = "";
            }

			if(top.powerOffToShop() == "toShop")//(g_temp == "media" || g_temp == "pvr" || g_temp == "homePage")//在pvr和多媒体下执行预订倒计时只推出booking，不退出pvr或多媒体)
			{
                $("otherPage").src = "powerOffTimerShop.html";
                top.$("otherPage").style.display = "block";
                top.requestFocus(top.otherPage, 0);
                setFrameFocusPage("otherPage");
			}
			else
			{
                $("otherPage").src = "powerOffTimer.html";
                top.$("otherPage").style.display = "block";
                top.requestFocus(top.otherPage, 0);
                setFrameFocusPage("otherPage");
			}
			break;
        case top.E_POWER_OFF_TIMER_EX://power off timer
            if(top.pressKeyDownTimer!=0)
            {
                clearTimeout(top.pressKeyDownTimer);
                top.pressKeyDownTimer=0;
            }
            stopVolumeTimer();
            top.g_lastTime = 60;
            if(top.g_nextHtmlPage!="miracast.html")
            {
                $("operatePage").src = "";
            }
            if(top.powerOffToShop() == "toShop")
            {
                $("otherPage").src = "powerOffTimerShop.html";
                top.$("otherPage").style.display = "block";
                top.requestFocus(top.otherPage, 0);
                setFrameFocusPage("otherPage");
            }
            else
            {
                $("otherPage").src = "powerOffTimer.html";
                top.$("otherPage").style.display = "block";
                top.requestFocus(top.otherPage, 0);
                setFrameFocusPage("otherPage");
            }

            break;
		case top.E_BOOKING_PLAY_START://booking play start开机时节目预定的时间已过，但是依然要提醒用户做一些切台等操作
			bookingMode = 2;//reminder
			$("operatePage").src = "";
			if(g_temp == "media" || g_temp == "pvr" || g_temp == "homePage" || g_temp == "menu")//在pvr和多媒体下执行预订倒计时只推出booking，不退出pvr或多媒体)
			{
				stopVolumeTimer();
				$("otherPage").src = "bookingRemind.html?" + value;
				top.$("otherPage").style.display = "block";
				top.otherPage.focus();
				setFrameFocusPage("otherPage");
				//add chenhua for youtube app
				$("otherPage").style.display = "block";
			}
			else
			{
                $("otherPage").src = "bookingRemind.html?" + value;
				top.$("otherPage").style.display = "block";
				top.otherPage.focus();
				setFrameFocusPage("otherPage");
				//add chenhua for youtube app
				$("otherPage").style.display = "block";
			}
			break
		case top.E_DATABASE_FILE_DAMAGE:
			stopVolumeTimer();
			$("operatePage").src = "";
			$("otherPage").src = "databaseDamageRemind.html";
			$("otherPage").style.display = "block";
			top.otherPage.focus();
			setFrameFocusPage("otherPage");
			break;
		case top.E_BOOKING_RECORD_START://booking record start开机时录制预定已经过期，但是依然要提醒用户切台录制
			bookingMode = 1;//record
			$("operatePage").src = "";
			if(g_temp == "media" || g_temp == "pvr" || g_temp == "homePage" || g_temp == "menu")//在pvr和多媒体下执行预订倒计时只推出booking，不退出pvr或多媒体)
			{
				stopVolumeTimer();
				$("otherPage").src = "bookingRemind.html?" + value;
				top.otherPage.focus();
				setFrameFocusPage("otherPage");
				//add chenhua for youtube app
				$("otherPage").style.display = "block";
			}
			else
			{
                $("otherPage").src = "bookingRemind.html?" + value;
                top.otherPage.focus();
                setFrameFocusPage("otherPage");
                //add chenhua for youtube app
                $("otherPage").style.display = "block";
			}
			break;
		case top.E_BOOKING_AHEAD_PLAY_START://booking ahead play start,正常情况下切台提醒，一分钟前提醒
			bookingMode = 2;//reminder
			$("operatePage").src = "";
			if(g_temp == "media" || g_temp == "pvr" || g_temp == "homePage" || g_temp == "menu")//在pvr和多媒体下执行预订倒计时只推出booking，不退出pvr或多媒体)
			{
				stopVolumeTimer();
				$("otherPage").src = "bookingRemind.html?" + value;
				top.otherPage.focus();
				setFrameFocusPage("otherPage");
				//add chenhua for youtube app
				$("otherPage").style.display = "block";
			}
			else
			{
				$("main").src = "bookingRemind.html?" + value;
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
				//add chenhua for youtube app
				$("main").style.display = "block";
			}
			break;
		case top.E_BOOKING_AHEAD_RECORD_START://booking ahead record start正常情况下录制提醒,，一分钟前提醒
			bookingMode = 1;//record
			$("operatePage").src = "";
			if(g_temp == "media" || g_temp == "pvr" || g_temp == "homePage" || g_temp == "menu")//在pvr和多媒体下执行预订倒计时只推出booking，不退出pvr或多媒体)
			{
				stopVolumeTimer();
				$("otherPage").src = "bookingRemind.html?" + value;
				top.otherPage.focus();
				setFrameFocusPage("otherPage");
				//add chenhua for youtube app
				$("otherPage").style.display = "block";
			}
			else
			{

				$("main").src = "bookingRemind.html?" + value;
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
				//add chenhua for youtube app
				$("main").style.display = "block";
			}
			break;
		case top.E_BOOKING_PLAY_END://booking play end
			break;
		case top.E_CI_DATA_READY://ci data ready
            console.log("liyanru check CI+ E_CI_DATA_READY");
			var mmiType = top.g_setting.getMimiType();
			if(mmiType == -1)
			{
				break;
			}
			if(top.g_ciIsInUpdateForm == 0 && top.g_temp != "EPG")
			{
				stopVolumeTimer();
				//在页面common_interface.html中停止计时//stopTimeout();
				g_previousHtmlPage = "channelPlay.html";
				g_nextHtmlPage = "common_interface.html";
				g_ciCurrentCardName = g_setting.getCIName(value);
				// add liukl msg come must clean main page.showRemind
				top.jumpToOperatePage("index.html?id="+Math.random());
				//$("operatePage").src = "index.html?id="+Math.random();
				//$("operatePage").style.display = "block";
			}
			break;
		case top.E_CI_CAM_NAME_READY://CI_CAM_NAME_READY
			if(top.g_ciIsInUpdateForm == 0 && top.g_temp != "EPG")
			{
				stopVolumeTimer();
				//在页面ciList.html中有自己的计时，不用管，页面自己停止计时stopTimeout();
				g_isUsedNotifyIntoPage = 1;
				g_nextHtmlPage = "ciList.html";
				top.jumpToOperatePage("index.html");
				console.log("E_CI_CAM_NAME_READY load ciList.html ! " );
				//$("operatePage").src = "index.html";
				//$("operatePage").style.display = "block";
			}
			break;
		case top.E_CI_OP_UPDATE_CHANNEL://CMD_UI_NOTIFY_OP_UPDATE_CHANNEL
			top.g_ciIsInUpdateForm = 1;
			g_previousHtmlPage = "channelPlay.html";
			g_ciUpdateType = 0;
			top.g_temp ="quickMenu";
			$("operatePage").src ="";
			$("otherPage").src ="";
			g_nextHtmlPage = "";
			$("main").src = "ciUpdate.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.E_CI_OP_UPDATE_NIT://CMD_UI_NOTIFY_OP_UPDATE_NIT
			top.g_ciIsInUpdateForm = 1;
			g_previousHtmlPage = "channelPlay.html";
			g_ciUpdateType = 1;
			top.g_temp ="quickMenu";
			$("operatePage").src ="";
            $("otherPage").src ="";
			g_nextHtmlPage = "";
			$("main").src = "ciUpdate.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.E_CI_UPGR_INPROGRESS:
			g_ciUpdateStatus=1;
			break;
		case top.E_CI_UPGR_NOT_INPROGRESS://CI update end
			g_ciUpdateStatus=0;
			break;
        case E_CI_AI_PROHIBIT_POWER_OFF:
			{
				$("operatePage").src = "";
				$("otherPage").src ="";
				$("otherPage").src="notice.html?msg="+E_CI_AI_PROHIBIT_POWER_OFF;
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
			}
			break;
        case E_CI_AI_POWER_OFF:
			console.log("hevens ******** E_CI_AI_POWER_OFF !!!");
            //toPowerOff();
            break;
        case E_CI_AI_HDS_DISP_REQ:
            {
				$("operatePage").src = "";
				$("otherPage").src ="";
				$("otherPage").src="notice.html?msg="+E_CI_AI_HDS_DISP_REQ;
				top.requestFocus(top.otherPage, 0);
				setFrameFocusPage("otherPage");
			}
        case E_CI_AI_HDS_DISP_END:
            break;
		case top.E_SCART_CHANGE_INPUT_SRC://scart change start:CMD_UI_NOTIFY_SCART_CHANGE_INPUT_SRC
			parentalLock=0;
			channelLock=0;
			inputLock = 0;
			g_isShowInfoBar = 1;
			top.jumpPage();
			break;
		case top.E_TV_EXCHANGE_END://tv source change end
			//parentalLock=0;
			//channelLock=0;
			//inputLock = 0;//信源锁是在信源切换成功就发，
			break;
		case top.E_CI_MHEG_OPEN://ci MHEG打开，需要进入channel_play页面并
			g_MMHStatus = 1;
			if(top.g_temp != "EPG")
			{
				top.jumpPage();
			}
			break;
		case top.E_CI_MHEG_CLOSE://ci MHEG closed
			g_MMHStatus = 0;
			//$("main").src = "systemSetting/common_interface.html";
			break;
		case top.E_CI_EXIT_CI:
			if(top.g_temp != "EPG")
			{
				clearMyTimeout();
				timeoutFuc.timeoutEnable = 1;
				/*避免在otherpage等页面跳转回main页面时有显示main跳转前页面内容的情况*/
				$("main").onload=function(){
					$("main").style.display = "block";
					top.requestFocus(top.main, 1);
					$("main").onload=function(){};
					}
				$("main").src="channelPlay.html";
				setFrameFocusPage("main");
				menu_visible_status = 0;
				top.$("operatePage").src = "";
				top.$('otherPage').src = "";
			}
			break;
		case top.E_DTV_NIT_VERSION_CHANGED://nit refresh notify,此消息不作为停止pvr或timeshift的标志，如果底层切台的话会发送E_CHANNEL_PLAY_END的消息
			if(g_nitRefreshControl == 1)
				break;
			stopVolumeTimer();
			$("main").onload=function(){
                $("main").style.display = "block";
                $("main").contentWindow.show_moreInfo_flag=2;
                $("main").contentWindow.refreshChannelInfo();
                $("main").contentWindow.hideRemind();
                $("main").contentWindow.showInfoFrom();
                $("main").onload=function(){};
			}
			$("main").src = "channelPlay.html";
            if(1)//"1" == g_setting.getProperty("app.hotel.networkupdate","1"))
            {
                $("otherPage").onload = function () {
                    $("otherPage").style.display = "block";
                    $("otherPage").onload = function () {
                    };
                }
                $("otherPage").src = "nitRefresh.html";
                top.otherPage.focus();
                setFrameFocusPage("otherPage");
            }
			break;
		case top.E_CEC_COMMON://cec 切换，需要显示info信息
			g_isShowInfoBar = 1;
			top.jumpPage();
			break;
		case top.E_OSD_STATUS_ON:
			$("factoryOsdShow").style.display="none";
			break;
		case top.E_OSD_STATUS_OFF:
			$("factoryOsdShow").style.display="block";
			break;
		case top.E_FACTORY_PS_MODE_ON:
		case top.E_FACTORY_PS_MODE_OFF:
			g_factory_hotkey = g_factory.factoryHotkey;
			frames["globleShow"].window.showHotkey();
			break;
		case top.E_FACTORY_FRONT_PANEL_KEY_TEST:
			g_factory_keypad_state = value;
			frames["globleShow"].window.showHotkey();
			break;
		case top.E_FACTORY_OSD_SHOW:
			g_factory_mode = 1;
			$("main").src= "factory/factoryMenu.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.E_FACTORY_OSD_HIDE:
			if(g_factory_mode == 1)
				top.jumpPage();	
			g_factory_mode = 0;	
			break;	
		case top.E_FACTORY_INFORMATION_SHOW:
			g_factory_mode = 2;
			$("main").src = "factory/serviceMenu.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.E_FACTORY_INFORMATION_HIDE:
			if(g_factory_mode == 2)	
				top.jumpPage();
			g_factory_mode = 0;	
			break;
		case top.E_FACTORY_WARMUP_ON:
			$("main").src ="factory/factoryWarmUp.html";
			frames["globleShow"].window.showHotkey();
			//showFactoryHotkey();
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.E_FACTORY_WARMUP_OFF:
		    //showFactoryHotkey();//显示factory hotkey弹出框
		    frames["globleShow"].window.showHotkey();
		    top.jumpPage();
			break;
		case top.E_FACTORY_VOLUME_SHOW:
			clearVolumeTimer();
			$('globleShow').contentWindow.initVolume();
			g_volume_visible = 1;
			$("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
			setGlobleRemindEnable(1);
			top.requestFocus(top.globleShow, 0);
			setFrameFocusPage("globleShow");
			//showMute(0);
			//top.startVolumeTimer();
			break;
		case top.E_FACTORY_SOURCE_CHANGE:
			g_isUsedHotKeyToIntoPage = 1;
			top.g_isShowInfoBar = 1;
			top.jumpPage();
			/*
			clearMyTimeout();
			top.g_previousHtmlPage = "channelPlay.html";
			$('main').src = "inputSource.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");*/
			break;
		case top.E_MUTE_ON:
			showMute(1);
			break;
		case top.E_MUTE_OFF:
			showMute(0);
			break;
		case top.E_FACTORY_PORTAL_CHECK:
			 g_factory_IR_msg = 0;
			showFactoryIRStatus(value);
			 break;
		case top.E_FACTORY_PCLINK_CHECK:
			 g_factory_IR_msg = 1;
			 showFactoryIRStatus(value);
			 break;
		case top.E_FACTORY_COLOR_TEMP_SHOW:
			g_factory_IR_msg = 2;
			showFactoryIRStatus(value);
			 break;
		case top.E_FACTORY_USB_TO_NVM:
			 g_factory_IR_msg = 3;
			 showFactoryIRStatus(value);
			 break;			 
		case top.E_FACTORY_IR_SHOP_RESET:
			/*
			showMute(0);
			initGlobalVariable();
			top.showFactoryHotkey();
			*/
			top.prepareFactoryShop();
			g_factory_IR_msg = 4;
			showFactoryIRStatus(value);//when do reset shop the msg couldn't be recevied ,so this msg need some time to exe
			setTimeout(function(){
			top.sendEvent("vod.netflix", 0xf00c);
			top.startFactoryShop();			
			top.endFactoryShop();					
			$("main").src = "initSetup/initSetup.html";
			}, 300);
			break;
		case top.E_FACTORY_IR_NVM_RESET:
			g_factory_IR_msg = 5;
			showFactoryIRStatus(value);
			break;
		case top.E_UPDATE_DOWNLOAD_PROGRESS:
            if(g_temp=="homePage" || top.preTempPage=="homePage")
            {
                g_isDownloading = 0;
                if(!g_isForceUpgrade)
                {
                    hideDownloadRing();
                }
                g_setting.pauseDownloadUpdateFile();
            }
            else
            {
                g_isDownloading = 1;
                g_downloadProgress = value;
                if(!g_isForceUpgrade)
                {
                    drawDownloadRing(value);
                }
            }
			break;
		case top.E_UPDATE_DOWNLOAD_COMPLETE:
			g_isDownloading = -1;  //0
			if(!g_isForceUpgrade){
				hideDownloadRing();
			}
			g_setting.networkDownloadButton = 0;
			// value, 0: MD5 check failed. 1: MD5 check successful
			if(value == 1){
				g_whichUpdateDialogWillBeUsed = 1;
				 top.$("otherPage").src="";
	                top.$("operatePage").src="";
	                top.$('main').style.display="block";
				top.$('main').src = "networkUpdateDialog.html";
               
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			else{
				g_whichUpdateDialogWillBeUsed = 3;
				 top.$("otherPage").src="";
                top.$("operatePage").src="";
                top.$('main').style.display="block";
				top.$('main').src = "networkUpdateDialog.html?MD5CheckFailed";
               
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
			}
			break;
		case top.E_DOWNLOADING_NETWORK_ABNORMAL:
			g_isDownloading = -1; //0
			g_whichUpdateDialogWillBeUsed = 3;
			if(!g_isForceUpgrade){
				hideDownloadRing();
			}
			 top.$("otherPage").src="";
            top.$("operatePage").src="";
			setTimeout(function(){
				top.$('main').style.display="block";
				top.$('main').src = "networkUpdateDialog.html?networkAbnormal";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");},500);
			break;
		case top.E_CHANNEL_PLAY_END://add chenhua 2014.5.14 for pvr and timeshift
			if(top.g_channel.inputSource == 1)//dtv中因为切台后并不一定能发送屏保消息，所以没法复位锁的标志，所以在这里做了锁的标志的复位
			{
				top.channelLock = 0;
				top.parentalLock = 0;
				top.inputLock = 0;
			}
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True &&
//				g_channel.inputSource == 1 && top.GingaObj.isEnable == 1)//DTV and Ginga enable  //切频道暂停ginga已移置到中间件处理
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_AFTER_CHANNEL_CHANGE);
//			}
			if(recordStatusFlag == 1)
			{
				g_pvr.recordStop();
				$("globleShow").contentWindow.hiddenRecord();
				pvrCurrentTime=0;
				recordStatusFlag =0;
		         pvrTotalTime=2*60*60;
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				operateWhenTimeshifting("notAvailable");
			}
			break;
		case top.E_UPDATE_CHANNEL_GET_UPDATED_INFORMATION:
			stopVolumeTimer();
			clearMyTimeout();
			initNoFocusForMain = 1;
			top.$("operatePage").src = "";
			top.$('main').src = "channelPlay.html";
			top.$("otherPage").src = "OADSoftwareUpdate.html?" + value;
			top.$("otherPage").style.display = "block";			
			top.requestFocus(top.otherPage,0)
			setFrameFocusPage("otherPage");
			break;
		case top.E_UPDATE_CHANNALE_GET_FUTURE_UPDATED_INFO:
			var param = value;
			bisUpgrade =1; //yiling0609
			stopVolumeTimer();
			clearMyTimeout();
			top.$("operatePage").src = "";
			top.$("otherPage").src = "";
			//this msg is later than sofewareUpdate.html channging to channelPlay.html, no time out will lead to changing to channelPlay.html
			setTimeout(function(){
			top.$('main').src = "channelUpdateFuture.html?"+param;
			//top.$('main').src = "channelUpdateFuture.html?"+value;
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");},1000); 
			break;
		case top.E_UPDATE_BGM_TRIGGER://yiling0609
			stopVolumeTimer();
			clearMyTimeout();
			top.$("operatePage").src = "";
			top.$('otherPage').src = "";
			top.$("main").src = "channelUpdate.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case top.E_REFRESH_PICTURE_SIZE:
			break;
		case top.E_SHOW_PANEL_TEST_PICTURE:
		           panelTestPicture = value;
		           showPanelPicture();
			break;
		case top.E_FACTORY_P_MODE_CTRL:
			g_factory_hotkey = g_factory.factoryHotkey;
			frames["globleShow"].window.showHotkey();
			break;
		case top.E_3D_GLASSES_SUIT_OK:
			$("globleShow").contentWindow.showGlassRemind(1);
			break;
		case top.E_3D_GLASSES_SUIT_FAIL:
			$("globleShow").contentWindow.showGlassRemind(2);
			glassConnectFlag=0;
			break;
	    case top.E_IS_CURRENT_3D_MODE:
			if(evt.modifiers == 0)//hide 3d tips
			{
			    top.$("globleShow").contentWindow.hiddenGlassRemind();
			}
			break;
		case top.E_NETWORK_CONNECT_TEST_SUCCESS:
		//case top.E_WIRE_CONNECT_SUCCESS:
		//case top.E_WIRELESS_CONNECT_SUCCESS:
		{
            console.log("receive net connect msg "+msg);
			netCheckStatus = 1;
			isShowOnce = 0;
            preloadLauncher(0);
            updateInject(0);
            startUpload(0);
            reportDNS(0);
            tvFaultNetEventProcess();
            if ($("main").contentWindow.updateNetwork)
            {
                $("main").contentWindow.updateNetwork();
            }
            if (bootActionTimer)
            {
                clearTimeout(bootActionTimer);
                bootActionTimer = 0;
                handleBootAction();
            }
            //越南电子保单自动激活
            var skipQRCode = top.g_setting.getProperty("app.ui.skipQRCode", "0");
            var skipCustomerCenter = top.g_setting.getProperty("app.ui.skipCustomerCenter", "0");
            var isautoactivate = top.g_setting.getProperty("app.ui.isautoactivate", "0");
            if (isautoactivate == 0 && (skipQRCode == "200" || skipCustomerCenter == "200"))
            {
                autoactivate();
            }
            //越南电子保单自动激活end
			if (top.isSambaFlag == "true" )
                getSambaFlagFromServer();
				
            if (top.isSambaFlag == "true" && top.g_setting.getProperty("app.ui.sambaTV","1") =="1" && top.g_setting.getProperty("isInitEnvironmentSeting","0") == "0" && top.g_factory.factoryHotkey != 1)
                startOptIn();

		}
		break;
		case top.E_NETWORK_CONNECT_TEST_FAIL:
		case top.E_WIRE_CONNECT_FAILURE:
		case top.E_WIRELESS_CONNECT_FAILURE:
		case top.E_WIRELESS_DEVICE_NO_FOUND:
		{
            console.log("receive net disconnect msg "+msg);
			netCheckStatus = 0;
            tvFaultNetEventProcess();
            if ($("main").contentWindow.updateNetwork)
            {
                $("main").contentWindow.updateNetwork();
            }
		}
		break;
        case top.E_NETWORK_CONNECT_TEST_FAIL_NETFLIX:
		{
			$("operatePage").src = "";
            $("otherPage").src ="";
            $("otherPage").src="connectNetworkRemind.html";
            top.requestFocus(top.otherPage, 0);
            setFrameFocusPage("otherPage");
		}
        break;
		case top.E_MHL_CABLE_INSERTED:
			mhl_inserted_status = value;
			break;
		case top.E_HBBTV_STATE_CHANGE:
		    hbbtvStatus = value
			break;
		case top.E_FAC_SOUND_TEST:
			g_factory_IR_msg = 6;
			showFactoryIRStatus(value);
			 break;
		case top.E_FACTORY_AUDIO_BALANCE_TEST:
			g_factory_IR_msg = 7;
			showFactoryIRStatus(value);
			break;
		case top.E_FACTORY_NOTIFY_CMD:
		{
			if(value == 50)
			{
				g_factory_IR_msg = 8;
				showFactoryIRStatus(1);			
			}
			else if(value == 51)
			{
				g_factory_IR_msg = 8;
				showFactoryIRStatus(0);						
			}
		}
		break;
		case top.E_FACTORY_ENTER_MEDIA:
			 top.$('main').src = "deviceList.html";
			 break;
		case top.E_FACTORY_WIFI_ON:
			if(recordStatusFlag == 1)
			{
				return;
			}
			if(top.g_ciIsInUpdateForm == 0 && top.g_temp != "EPG")
			{
                g_setting.setInterfaceType(2);
                g_setting.switchNetwork();
                g_setting.wirelessNetworkConnect("\0", "\0", 0, "\0");
				clearMyTimeout();
				g_isUsedNotifyIntoPage = 1;
				g_nextHtmlPage = "wirelessScan.html";
				$("operatePage").src = "index.html";
				top.requestFocus(top.operatePage, 0);
				setFrameFocusPage("operatePage");
			}
			break;
		case top.E_CI_OP_UPDATE_INFO:
		case top.E_CHANNEL_LIST_UPDATE:
		{
			top.g_channel.updateChannleListExt();	
			break;
		}
		case top.E_APP_CLOSE:
		{
            console.log("framwork msg E_APP_CLOSE test top.scheduleApp = " + top.scheduleApp);
            if (scheduleApp == SCHEDULE_NETFLIX)
            {
                scheduleApp = 0;
                g_setting.sendMsgToDBC(1);
                top.g_setting.setProperty("app.ui.currentApp", "vod.netflix");
                openNetflix("hotkey");
                return;
            }
            else if (top.scheduleApp == top.SCHEDULE_CEC)
            {
                scheduleApp = 0;
                appOpenFlag = 0;
                tochangeCEC(lastInputSource);
                return;
            }
            else if (top.scheduleApp == top.SCHEDULE_YOUTUBE)
            {
                scheduleApp = 0;
                g_setting.sendMsgToDBC(1);
                tcl.channel.requestInputSource(10);
                top.g_setting.setProperty("app.ui.currentApp", "tbrowser.youtube");
                top.g_ulits.openApplication("tbrowser.youtube", "https://www.youtube.com/tv?launch=menu&additionalDataUrl=http%3a%2f%2flocalhost%3a56789%2fapps%2fYouTube%2fdial_data");
                return;
            }
            else if (top.scheduleApp == top.SCHEDULE_INTERNET)
            {
                scheduleApp = 0;
                g_setting.sendMsgToDBC(1);
                tcl.channel.requestInputSource(10);
                top.g_setting.setProperty("app.ui.currentApp", "tbrowser.browser");
                top.g_ulits.openApplication("tbrowser.browser", "http://eu.guide.huan.tv/huan123/skin/home2015List.action?skin=D1280_2015&data=GBR_mt56#");
                return;
            }
            else if (top.scheduleApp == top.SCHEDULE_DIAL)
            {
                scheduleApp = 0;
                sendEvent("T-DIAL", E_APP_PROCESS_READY);
                return;
            }
            else if (top.scheduleApp == top.SCHEDULE_SWITCHSRC)
            {
                scheduleApp = 0;
                appOpenFlag = 0;
                toswitchSource(lastInputSource);
                return;
            }
            else if (top.scheduleApp == top.SCHEDULE_MEDIA)
            {
                top.scheduleApp = 0;
                top.appOpenFlag = 0;
                var usbLock = top.g_factory.usbLock;
                var hotelEnable = top.g_factory.hotelEnable;
                if (top.g_temp == "homePage")
                {
                    delete sessionStorage.tabListIndex;//删除launcher记忆的tab
                    top.isFromOptionIntoUsb = 0;
                }
                else
                {
                    top.isFromOptionIntoUsb = 1;
                }
                if ((usbLock) && (hotelEnable))
                {
                    top.$('main').src = "password.html?usbLock";
                    top.main.focus();
                }
                else
                {
                    top.$('main').src = "deviceList.html";
                }
                return;
            }
            else if(top.scheduleApp == top.SCHEDULE_KODI)
            {
                top.scheduleApp = 0;
                top.appOpenFlag = 0;
                if(top.g_pushType<4)
                {
                    top.enterMediaPlay();
                    if(top.g_pushType==1)
                    {
                        top.$("main").src = "musicPlay.html?dmr";
                    }
                    else if(top.g_pushType==2)
                    {
                        top.$("main").src = "picturePlay.html?dmr";
                    }
                    else if(top.g_pushType==3)
                    {
                        top.$("main").src = "videoPlay.html?dmr";
                    }
                }
                else
                {
                    top.enterKodi(1);
                }
                return;
            }
			else if(top.scheduleApp == top.SCHEDULE_APPS)
			{
				scheduleApp = 0;
				g_setting.sendMsgToDBC(1);
				tcl.channel.requestInputSource(10);
				top.g_setting.setProperty("app.ui.currentApp", "tbrowser.common");
				var appStoreUrl;
				if(isLAFlag)
				{
					appStoreUrl = "http://5495564812.fxm6263467844.com/";
				}
				else if(isNAFlag)
				{
					appStoreUrl = "http://5495564812-na.fxm6263467844.com/";
				}else
				{
					appStoreUrl = "http://5495564812.fxm6263467844.com/";
				}
				top.g_ulits.openApplication("tbrowser.common",appStoreUrl);
				return;
			}
			else if (top.scheduleApp == top.SCHEDULE_GLOBOPLAY)
			{
				scheduleApp = 0;
				g_setting.sendMsgToDBC(1);
                tcl.channel.requestInputSource(10);
                top.g_setting.setProperty("app.ui.currentApp","globoSDK");
                top.g_ulits.openApplication("tvos.globoplay.activity","");
				return;
			}
            else if (top.scheduleApp == top.SCHEDULE_STR)
            {
                if (preTempPage=="homePage")
                {
                    $('main').contentWindow.document.onsystemevent(evt);
                }
                else
                {
                    scheduleApp = 0;
                    appOpenFlag = 0;
					console.log("hevens ******** SCHEDULE_STR !!!");
                    toPowerOff();
                }
            }
            if(top.$("main").src.indexOf("index.html") != -1 || top.$("main").src.indexOf("deviceList.html") != -1){
                console.log("hevens ********************************** E_APP_CLOSE  open  " + top.$("main").src);
                top.appOpenFlag = 0;
                top.scheduleApp = 0;
                top.main.document.body.style.display = "block";
                top.$("operatePage").style.display = "block";
                top.$("otherPage").style.display = "block";
                return;
            }
            top.g_channel.inputSource = top.lastInputSource;
            top.appOpenFlag = 0;
            g_setting.sendMsgToDBC(4);

            if (top.scheduleApp == top.SCHEDULE_LOCAL_EPG)
            {
                top.scheduleApp = 0;
                if (top.isNAFlag)
                {
                    top.$("main").src = "programGuide_NA.html";
                }
                else
                {
                    top.$("main").src = "programGuide.html";
                }
            }
            else if (top.scheduleApp == top.SCHEDULE_SETTING)
            {
                top.scheduleApp = 0;
                openSetting();
            }
            else if (top.scheduleApp == top.SCHEDULE_HOMEPAGE)
            {
                top.scheduleApp = 0;
                openHomePage();
            }
            else if (top.scheduleApp == top.SCHEDULE_SOURCE)
            {
                top.scheduleApp = 0;
                openInputSource();
            }

            top.$("main").onload = function ()
            {
                top.$("main").style.display = "block";
                top.main.document.body.style.display = "block";
                top.$("operatePage").style.display = "block";
                top.$("otherPage").style.display = "block";
                top.$("main").onload = function ()
                {
                };
            }
            //top.$("main").src="channelPlay.html"
            //top.requestFocus(top.main, 1);
            //setFrameFocusPage("main");
            break;
		}
		case top.E_APP_OPEN:
		{
			if(recordStatusFlag == 1)
			{
				g_pvr.recordStop();
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				$("globleShow").contentWindow.hiddenRecord();
				pvrCurrentTime=0;
				recordStatusFlag =0;
		        pvrTotalTime=2*60*60;
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				timeShiftStatusFlag = 0;
				$("globleShow").contentWindow.hiddenTimeShift();
			}
			if(top.g_channel.inputSource!=10&&top.appOpenFlag == 0)
			{
				top.lastInputSource = top.g_channel.inputSource;
				top.g_channel.inputSource = 10;
			}
            if(top.g_channel.checkhbbtvStatus() > 0)
            {
                globleHBBTVClose();
            }
			top.appOpenFlag = 1;
			$("operatePage").src = "";
			$("otherPage").src ="";
			$("main").src="channelPlay.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			menu_visible_status = 0;
		
			top.$("main").style.display="none";
			top.$("operatePage").style.display="none";
			top.$("otherPage").style.display="none";
			break;
		}
		case top.E_APP_PROCESS_INITIALIZATION:
		{
			//不需要对此消息进行处理，中间件之前都没有这个消息的枚举，后来UI3.0做ziggo加上了该枚举，接入ci卡会跑到这里处理导致黑屏（信源切到STORAGE）按键无响应（appOpenFlag=1）
		    return;
			if(recordStatusFlag == 1)
			{
				g_pvr.recordStop();
				g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				$("globleShow").contentWindow.hiddenRecord();
				pvrCurrentTime=0;
				recordStatusFlag =0;
		        pvrTotalTime=2*60*60;
			}
			else if(timeShiftStatusFlag == 1)
			{
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				g_pvr.timeshiftStop();
				g_pvr.returnToLive();//返回实时播放页面
				//现在底层还没有做停止的逻辑，所以这个部分我们自己先做
				timeShiftStatusFlag = 0;
				$("globleShow").contentWindow.hiddenTimeShift();
			}
            if (top.appOpenFlag == 1)
            {
                var appname = top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
				top.g_ulits.closeApplication(appname);
				top.scheduleApp = top.SCHEDULE_DIAL;
                return;
            }
			if(top.g_channel.inputSource!=10&&top.appOpenFlag == 0)
			{
				top.lastInputSource = top.g_channel.inputSource;
				top.g_channel.inputSource = 10;
			}
            tcl.channel.requestMute(0);
			top.appOpenFlag = 1;
			$("operatePage").src = "";
			$("otherPage").src ="";
			$("main").src="channelPlay.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			menu_visible_status = 0;
		
			top.$("main").style.display="none";
			top.$("operatePage").style.display="none";
			top.$("otherPage").style.display="none";
			sendEvent("T-DIAL",E_APP_PROCESS_READY);
			break;
		}
		case top.E_DLNA_DMR_CONNECT://nScreen connect to TV
			$("globleShow").contentWindow.showPhoneConnectToTV();
			//$("otherPage").src = "nScreenPhoneConnected.html";
			break;
		case top.E_FACTORY_CMD_SHOP_INIT:
			/*
			showMute(0);
			g_factory.resetShopAllApp();
			initGlobalVariable();
			top.showFactoryHotkey();
			$("main").src = "initSetup/initSetup.html";
			*/
			top.sendEvent("vod.netflix", 0xf00c);
			top.prepareFactoryShop();
			top.startFactoryShop();
			top.endFactoryShop();	
			setTimeout(function(){
			$("main").src = "initSetup/initSetup.html";
			},top.g_factory_delay_after_shop);
			break;
		case top.E_FACTORY_IR_3D_ON:
			top.g_setting.pic3DMode = 1;
			if(top.currentPanel == 1)
			{

					if(top.glassConnectFlag==0)
					{
						top.$("globleShow").contentWindow.showGlassRemind(0);
						if(top.bluetoothStart==0)
						{
							setTimeout("top.g_setting.bluetoothMaster()",800);
						}
						top.bluetoothStart=1;

					}
			}
			break;
		case top.E_FACTORY_IR_3D_OFF:
			top.g_setting.pic3DMode = 0;
			if(top.currentPanel == 1)
			{
				top.$("globleShow").contentWindow.hiddenGlassRemind();
			}
			break;
		case top.E_CEC_ARC_AUDIO_STATUS_CHANGE:
		{
			if(value == 1) 
			{
				top.g_setting.setProperty("app.ui.VolumeType","3");
				$('globleShow').contentWindow.initVolume();			
				if(top.$('globleShow').contentWindow.volumeCount  > 0 )
				{
					g_volume_visible = 1;
					closePage($("operatePage"));
					closePage($("otherPage"));
					if(top.g_temp == "option")
					{
						$("main").src="channelPlay.html";
					}
					$("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
					setGlobleRemindEnable(1);
					top.requestFocus(top.globleShow, 0);
					setFrameFocusPage("globleShow");
				}
			}
			updateCecMute();
		}
		break;
		//case top.UI_BLUETOOTH_EVENT_DEVICES_CHANGE: //add yums 蓝牙断开
        case top.E_NOTIFY_BTSPEAKER_DISCONNECT:
			console.log("YM framework UI_BLUETOOTH_EVENT_DEVICES_CHANGE");
			$("globleShow").contentWindow.showBluetoothDisconnectToTV();
			//Add 判断当前断开的设备是否是音频设备
			//var currentBluetoothDevice = bluetooth.getBluetoothDeviceById(evt.modifiers);//蓝牙消息时，modifiers为连接的蓝牙设备的ID
			//console.log("YM currentBluetoothDevice.deviceType:" + currentBluetoothDevice.deviceType);
			if(1)//(currentBluetoothDevice.deviceType == 1 || currentBluetoothDevice.deviceType == 2 || currentBluetoothDevice.deviceType == 0)
			{
				var devCurNum = g_setting.getProperty("app.ui.audioDeviceStatus","000");
				var devNewNum = devCurNum.charAt(0)+"0"+devCurNum.charAt(2);
				g_setting.setProperty("app.ui.audioDeviceStatus",devNewNum);

				if(g_setting.speakerStatus == 0 && devNewNum == "000")
				{
					g_setting.speakerStatus = 1;
				}
				if(bt_soundOutputShowFlag)
					bt_soundOutputShowFlag = false;
				
				//if(mute_status == 0)//判断当前是否为静音状态
				//{
				//	bluetooth.setAudioMute(0);
				//}
				bt_connectDevicePosition = -1
			}
			break;
		
		//case top.UI_BLUETOOTH_EVENT_CONNECT_SUCCESS:
        case top.E_NOTIFY_BTSPEAKER_CONNECT:
			console.log("YM framework UI_BLUETOOTH_EVENT_CONNECT_SUCCESS");
			$("globleShow").contentWindow.showBluetoothConnectToTV();
			//Add 判断当前连接的设备是否是音频设备
			//var currentBluetoothDevice = bluetooth.getBluetoothDeviceById(evt.modifiers);//蓝牙消息时，modifiers为连接的蓝牙设备的ID
			//console.log("YM currentBluetoothDevice.deviceType:" + currentBluetoothDevice.deviceType);
			if(1)//(currentBluetoothDevice.deviceType == 1 || currentBluetoothDevice.deviceType == 2 || currentBluetoothDevice.deviceType == 0)
			{
				bt_soundOutputShowFlag = true;
				var devCurNum = g_setting.getProperty("app.ui.audioDeviceStatus","000");//bit 2:ARC ;bit 1:bluetooth, bit 0:headphone
				var devNewNum = devCurNum.charAt(0)+"1"+devCurNum.charAt(2);
				g_setting.setProperty("app.ui.audioDeviceStatus",devNewNum);
				if(g_setting.speakerStatus == 1)
				{
					g_setting.speakerStatus = 0;
				}
				g_setting.setProperty(OUT_PUT_NAME_FOR_DB,"1");
				bt_soundOutPutValue = 1;//parseInt(g_setting.getProperty(OUT_PUT_NAME_FOR_DB,"0"));//获取上一次保存的蓝牙设置界面设置的通导值
				console.log("YM bt_soundOutPutValue:" + bt_soundOutPutValue);
				if(mute_status == 0)//判断当前是否为静音状态
				{
					if(bt_soundOutPutValue == 1)
					{
						//bluetooth.setBluetoothMute(0);//unmute
                        g_setting.bluetoothStatus = 1;
					}
					else
					{
						//bluetooth.setBluetoothMute(1);//mute
                        g_setting.bluetoothStatus = 0;
					}
					/*
					switch(bt_soundOutPutValue)
					{
						case 0:
							bluetooth.setAudioMute(0);//unmute
							bluetooth.setBluetoothMute(1);//mute
							break;
						case 1:
							bluetooth.setAudioMute(1);//mute
							bluetooth.setBluetoothMute(0);//unmute
							break;	
						case 2:
							bluetooth.setAudioMute(0);//unmute
							bluetooth.setBluetoothMute(0);//unmute
							break;
						default:
							bluetooth.setAudioMute(0);//unmute
							//bluetooth.setBluetoothMute(0);//unmute
							break;
					}*/
					//bluetooth.setBluetoothVolume(50);
				}
				else
				{
					//bluetooth.setAudioMute(1);
					//bluetooth.setBluetoothMute(1);
                    g_setting.bluetoothStatus = 0;
				}
			}
			break;
        case E_FACTORY_SET_PICTURE_MODE:
        {
            top.$('otherPage').src = "factory/factoryPromptDialog.html?pictureMode&"+value;
            break;
        }
		case top.E_TV_FAULT_DIAGNOSIS_CONNECT_ON: 
			{
				console.log("lwf  framework.html:E_TV_FAULT_DIAGNOSIS_CONNECT_ON");
				checkTVFaultLongConnectState(1);
		    }
			break;
		case top.E_TV_FAULT_DIAGNOSIS_CONNECT_OFF: 
			{
				console.log("lwf  framework.html:E_TV_FAULT_DIAGNOSIS_CONNECT_OFF");
				checkTVFaultLongConnectState(0);
			}
			break;
		case top.E_TERMINAL_MANAGER_START:
			console.log("E_TERMINAL_MANAGER_START!!!");
			//jumpHotkeyPage("tvExceptionDoctor.html");
			if(tvFaultInited == 0){
				g_tvfaultdiagnosis.init();
				tvFaultInited = 1;
			}
			if(g_isStartRemount == 0)
			{
				g_isStartRemount = 1;
			}

			g_tvfaultdiagnosis.setRemoteParam(1);

			if($("globleShow").contentWindow.getTvFaultShowType() == -1) {
				if(g_tvfaultdiagnosis.getConnectState() == LONG_CONNECT_OK){
					$("globleShow").contentWindow.showTvFaultDiagnosisTip(SHOW_CONNECTED);
				} else {
					$("globleShow").contentWindow.showTvFaultDiagnosisTip(0);
				}
			}			
			break;
        case top.E_NOTIFY_LAUNCHER_IP_RESOLVE_FLAG_CHANGE:
            $("globleShow").contentWindow.showTvFaultDiagnosisTip(3);
            setTimeout(function(){$("globleShow").contentWindow.hidTvFaultDiagnosisTip();},5000);
            break;
		case E_WFD_STATUS:
			if(value==12)
			{
				if ($("main").src.indexOf("index.html") == -1)//wifidisplay退出到主页，快速打开setting或其他页面，消息会透传到这里，切信源会导致主页有信源声音
					top.g_channel.changeToPrevSource();
			}
			else if(top.g_temp == "miracast")
			{
				top.$("main").contentWindow.notifyProcess(evt);
			}
			else if(top.g_temp == "menu")
			{
				top.$("operatePage").contentWindow.$("subMenu2").contentWindow.notifyProcess(evt);
			}
			break;
		case E_HP_PLUGIN:
			if(!supportHeadphone)
			{
				break;
			}
			var devCurNum = g_setting.getProperty("app.ui.audioDeviceStatus","000");//2 ARC; 1 bt; 0:hp
			var devNewNum = devCurNum.charAt(0)+devCurNum.charAt(1)+"1";
			g_setting.setProperty("app.ui.audioDeviceStatus",devNewNum);


			if(g_setting.speakerStatus == 1)
			{
				g_setting.speakerStatus = 0;
			}
			if(isEUFlag){
				var bmanualSetSpeaker = g_setting.getProperty("app.ui.bmanualSetSpeaker","2");
				if( bmanualSetSpeaker != 2 ){
					g_setting.speakerStatus = bmanualSetSpeaker;
				}
				console.log("hhf  E_HP_PLUGIN bmanualSetSpeaker = " + bmanualSetSpeaker + "g_setting.speakerStatus = " + g_setting.speakerStatus);
			}
			break;
		case E_HP_PLUGOUT:
			if(!supportHeadphone)
			{
				break;
			}
			var devCurNum = g_setting.getProperty("app.ui.audioDeviceStatus","000");//2 ARC; 1 bt; 0:hp
			var devNewNum = devCurNum.charAt(0)+devCurNum.charAt(1)+"0";
			g_setting.setProperty("app.ui.audioDeviceStatus",devNewNum);
			if(g_setting.speakerStatus == 0 && devNewNum == "000")
			{
				g_setting.speakerStatus = 1;
			}
			if(isEUFlag){
				var bmanualSetSpeaker = g_setting.getProperty("app.ui.bmanualSetSpeaker","2");
				if( bmanualSetSpeaker == 1 ) {
					g_setting.speakerStatus = bmanualSetSpeaker;
				}
				else if (bmanualSetSpeaker == 0 && devNewNum == "000" )
				{
					g_setting.speakerStatus = 1;

				}
				else
				{

				}
				console.log("hhf  E_HP_PLUGOUT bmanualSetSpeaker = " + bmanualSetSpeaker + "g_setting.speakerStatus = " + g_setting.speakerStatus);
			}
			break;
		case E_CEC_HDMI_DEVICE_INSERTED:
			var devCurNum = g_setting.getProperty("app.ui.audioDeviceStatus","000");//2 ARC; 1 bt; 0:hp
			if(getArcStatus() == true)
			{
				var devNewNum = "1"+devCurNum.charAt(1)+devCurNum.charAt(2);
				g_setting.setProperty("app.ui.audioDeviceStatus",devNewNum);
				if(g_setting.speakerStatus == 1)
				{
					g_setting.speakerStatus = 0;
				}
				showMute(0);//ARC设备接入，都去解mute，并隐藏静音图标，避免UI静音显示与ARC声音不同步
//				if(g_setting.sPDIFDDP != 1 && g_setting.sPDIFType == 0)
//				{
//					g_setting.sPDIFDDP = 1;
//				}
//				else if(setting.sPDIFType != 0)
//				{
//					g_setting.sPDIFDDP = 0;
//				}
			}
			else
			{
				var devNewNum = "0"+devCurNum.charAt(1)+devCurNum.charAt(2);
				g_setting.setProperty("app.ui.audioDeviceStatus",devNewNum);
				if(g_setting.speakerStatus == 0 && devNewNum == "000")
				{
					g_setting.speakerStatus = 1;
				}
//				if(devCurNum.charAt(0) == "1"&& g_setting.sPDIFDDP != 0)
//				{
//					g_setting.sPDIFDDP = 0;
//				}
			}
			break;
        case E_STR_SCREEN_OFF:
        {
            if (top.preTempPage == "media")
            {
                top.$("operatePage").src = "";
                top.$("otherPage").src = "";
                top.resumeFocus();
                top.setFrameFocusPage("main");
                top.$('main').contentWindow.notifyProcess(evt);
                return;
            }
            else
            {
                if (recordStatusFlag == 1 || timeShiftStatusFlag == 1)
                {
                    sendEvent("vod.netflix", 0xf303);
                }
                if(g_setting.powerBacklightState == 0 && (recordStatusFlag == 1 || timeShiftStatusFlag == 1 || weakUpStatus == 8))
                {
					console.log("in E_STR_SCREEN_OFF force_mute_status = "+top.mute_status);
					if(force_mute_status == 1)
					{
						forceMute(0);
					}
					weakUpStatus = 0;
                    g_setting.powerBacklightState = 1;
                    return ;
                }
				console.log("hevens ******** E_STR_SCREEN_OFF !!!");
                toPowerOff();
                break;
            }
        }
        case E_STR_SCREEN_ON:
			if(8 == value)//weak up is  EN_FPP_PM_WAKEUPSRC_RTC2  8 此刻是待机预约录制的唤醒
			{
				weakUpStatus = 8;
			}
			else
			{
				weakUpStatus = 0; 
			}
            prepareCI = 0;
			if (mute_status == 1)
			{
				top.$("mute").style.display = "none";
				setTimeout('top.$("mute").style.display = "block";',0);
			}
			/****
             * shopmode 2.5需求
             * STR开机情况
             * ****/
            var times = parseInt(top.g_setting.getProperty("app.ui.systemRunningTimer","0"));
            console.log("--hzm in E_STR_SCREEN_ON times = " + times);
            if (times < 6)
            {
                if (times == 5)
                {
                    top.g_setting.setProperty("app.ui.systemRunningTimer",100);
                    //首先判断是否满足弹出提示条件
                    $("otherPage").src = "powerOffTimerShop.html";
                    top.$("otherPage").style.display = "block";
                    top.requestFocus(top.otherPage, 0);
                    setFrameFocusPage("otherPage");
                }
                else
                {
                    var autoShopmodeValue = parseInt(top.g_setting.getProperty("app.ui.autoshopmode.switch","0"));
                    if (g_setting.autoStandby == 0 && g_setting.location == 0 && autoShopmodeValue == 1)
                    {
                        if(runningTimer)
                        {
                            clearTimeout(runningTimer);
                        }
                        runningTimer = setTimeout("systemRunning9hours()",SYSTEM_RUNNING_TIME);
                    }
                }
            }
            else //systemRunningTimer = 100将不再执行
            {
                console.log("--hzm in E_STR_SCREEN_ON times = 100 and do nothing !!");
            }
            /****shopmode 2.5需求 end****/
            //STR ON时，开关机也要启动应用
            bootActionTimer = setTimeout(handleBootAction, 30000);
            preloadLauncher(1);
            updateInject(1);
            startUpload(1);
            reportDNS(1);
            break;
        case E_CHANNEL_CLEANED:
            top.g_channel.updateChannleListExt();	
            break;
		case E_FACTORY_SET_OSD_LANGUAGE:
        {
            doChangeMultilanguage(g_setting.menuLanguage);
            break;
        }
        case E_VOICE_COLLECT_ENTRIES:
        {
            if (top.appOpenFlag==0)
            {
                evt.target.ownerDocument.defaultView.tcl_voice_post();
            }
            break;
        }
        case E_VOICE_CONTROL:
        {
            if (top.appOpenFlag==0)
            {
                evt.target.ownerDocument.defaultView.tcl_voice_match(value);
            }
            break;
        }
        case top.E_NOTIFY_VRC_SET_VOL:
            console.log("--hzm revice E_NOTIFY_VRC_SET_VOL  value= "+ value + "  top.g_volume_visible = "+ top.g_volume_visible);
            top.$("globleShow").contentWindow.setVolumeByType(top.$("globleShow").contentWindow.curVolumeType,value);
            if (1)//(top.g_volume_visible == 0)
            {
                top.g_volume_visible = 1;
                top.$("operatePage").src = "";
                top.$("otherPage").src = "";
                top.$('globleShow').contentWindow.initVolume();
                top.$("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
                //top.startVolumeTimer();
            }
            break;
        case top.E_NOTIFY_VRC_SET_CHANNEL_INDEX:
            console.log("--hzm revice E_NOTIFY_VRC_SET_CHANNEL_INDEX  value= "+ value);
            //onInsertNum(value);
            break;
        case top.E_NOTIFY_VRC_SET_INPUT_SOURCE:
            console.log("--hzm revice E_NOTIFY_VRC_SET_INPUT_SOURCE  value= "+ value + "  top.appOpenFlag = " + top.appOpenFlag);
            if (value == 10)
            {
                //暂时不实现
                //top.globalHotkeyHandle(top.VK_MEDIA);
                //var event = new Object();
                //event.which = top.VK_MEDIA;
                //top.document.getElementById("main").contentWindow.keyproc(event);
            }
            else
            {
                if (top.appOpenFlag == 1) return;
                top.toSourceEx(0,value);
            }
            break;
        case top.E_NOTIFY_VRC_START_AUTO_CHANNEL_SCAN:
            console.log("--hzm revice E_NOTIFY_VRC_START_AUTO_CHANNEL_SCAN  value = "+ value + "  top.appOpenFlag = " + top.appOpenFlag);
            if (top.appOpenFlag == 1) return;
            if(programStatus == 1)
            {
                if(top.timeShiftStatusFlag == 1)
                {
                    top.g_pvr.timeshiftStop();
                    top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
                    top.g_pvr.returnToLive();//返回实时播放页面
                    top.timeShiftStatusFlag = 0;
                    top.$("globleShow").contentWindow.hiddenTimeShift();
                    top.$("operatePage").src = "";
                    top.requestFocus(top.main, 1);
                }
                if(top.recordStatusFlag==1)
                {
                    top.g_pvr.recordStop();
                    top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
                    top.pvrCurrentTime = 0;
                    top.recordStatusFlag = 0;
                    top.pvrTotalTime = 2*60*60;
                    top.$("globleShow").contentWindow.hiddenRecord();
                    top.$("operatePage").src = "";
                    top.requestFocus(top.main, 1);
                }
            }
            top.cmd_vrc_auto_search_type = value;
            top.g_nextHtmlPage = "autoSearch.html";
            top.jumpToOperatePage("index.html");
            break;
		default:
			break;
    }
}
function stopVolumeTimer()
{
	clearVolumeTimer();
	top.keySetForUI(0);
	$("globleShow").contentWindow.$("adjustProgressBox").style.display = "none";
	setGlobleRemindEnable(0);
	g_volume_visible = 0;
}
function showTVMiddleRemind(string)
{
	top.g_remindWord = string;
	top.$("main").src = "intermediate.html";
	top.$("operatePage").src = "";
	top.$('otherPage').src = "";
	top.requestFocus(top.main, 1);
	top.setFrameFocusPage("main");
}

function operateWhenTimeshifting(operate)
{
		top.$("operatePage").src = "";
	top.$('otherPage').src = "";
	top.$("globleShow").contentWindow.hiddenTimeShift();
	top.$('main').src = "pvr/timeshift.html?" + operate;
	top.$("main").style.display = "block";

	top.requestFocus(top.main, 1);
	top.setFrameFocusPage("main");
}

// flag : 0 unmute 1 mute
function forceMute(flag)
{
	if(flag == 1)
	{
		force_mute_status = 1;
		g_setting.muteAll(1); 
	}
	else
	{
		force_mute_status = 0;
		g_setting.muteAll(0); 
	}
}
// flag : 0 hidden 1 auto
function showMute(flag)
{
	console.log("YM showMute flag:" + flag+" mute_status = "+mute_status);
	console.log("YM showMute top.bt_soundOutPutValue:" + top.bt_soundOutPutValue);
    if (flag==0)
    {
        if (mute_status == 1)
        {
			/*原来的逻辑
            top.$("mute").style.display = "none";
            mute_status = 0;
			g_setting.mute = 0;
			*/
			//添加蓝牙音箱的逻辑
			top.$("mute").style.display = "none";
            mute_status = 0;
			switch(top.bt_soundOutPutValue)
			{
				case 0:
					g_setting.mute = 0;
					//bluetooth.setBluetoothMute(1);
                    g_setting.bluetoothStatus = 0;
					break;
				case 1:
					if(!(top.bt_soundOutputShowFlag))//判断是否有音频蓝牙设备连上
					{
						g_setting.mute = 0;
					}
					else
					{
						//bluetooth.setBluetoothMute(0);
                        g_setting.bluetoothStatus = 1;
					}
					break;
				case 2:
					g_setting.mute = 0;
					if(top.bt_soundOutputShowFlag)
                        g_setting.bluetoothStatus = 1;//bluetooth.setBluetoothMute(0);
					break;
				default:
					g_setting.mute = 0;
					break;
			}
				top.ttsLog("ttsStr="+"unmute");//mute
				setTTSSay(SPEECH_TYPE_FLUSH,"unmute");
        }
    }
    else
    {
        if (mute_status == 1)
        {
			/*原来的逻辑
            top.$("mute").style.display = "none";
            mute_status = 0;
			g_setting.mute = 0;
			*/
			//添加蓝牙音箱的逻辑
			top.$("mute").style.display = "none";
            mute_status = 0;
			top.ttsLog("ttsStr="+"unmute");//解mute
			setTTSSay(SPEECH_TYPE_FLUSH,"unmute");
			switch(top.bt_soundOutPutValue)
			{
				case 0:
					g_setting.mute = 0;
					//bluetooth.setBluetoothMute(1);
                    g_setting.bluetoothStatus = 0;
					break;
				case 1:
					if(!(top.bt_soundOutputShowFlag))//判断是否有音频蓝牙设备连上
					{
						g_setting.mute = 0;
					}
					else
					{
						//bluetooth.setBluetoothMute(0);
                        g_setting.bluetoothStatus = 1;
					}	
					break;
				case 2:
					g_setting.mute = 0;
					if(top.bt_soundOutputShowFlag)
                        g_setting.bluetoothStatus = 1;//bluetooth.setBluetoothMute(0);
					break;
				default:
					g_setting.mute = 0;
					break;
			}
        }
        else
        {
			/*原来的逻辑
            top.$("mute").style.display = "block";
            mute_status = 1;
			g_setting.mute = 1;
			*/
			//添加蓝牙音箱的逻辑

			if(1 == top.g_setting.ttsSwitch)
			{
				top.ttsLog("ttsStr="+"mute");//mute
				setTTSSay(SPEECH_TYPE_FLUSH,"mute");
				setTimeout(function () {
					top.$("mute").style.display = "block";
					mute_status = 1;
					switch(top.bt_soundOutPutValue)
					{
						case 0:
							g_setting.mute = 1;
							//bluetooth.setBluetoothMute(1);
                            g_setting.bluetoothStatus = 0;
							break;
						case 1:
							if(!(top.bt_soundOutputShowFlag))//判断是否有音频蓝牙设备连上
							{
								g_setting.mute = 1;
							}
							else
							{
								//bluetooth.setBluetoothMute(1);
                                g_setting.bluetoothStatus = 0;
                                g_setting.speakerStatus = 0;
							}
							break;
						case 2:
							g_setting.mute = 1;
							if(top.bt_soundOutputShowFlag)//判断是否有音频蓝牙设备连上
                                g_setting.bluetoothStatus = 0;//bluetooth.setBluetoothMute(1);
							break;
						default:
							g_setting.mute = 1;
							break;
					}
					if(mute_status == 1)
					{
						if(g_setting.getCecMuteStatus() == 0)
						{
							g_setting.sendCecKeyValue(top.VK_MUTE);
						}
					}
					else
					{
						if(g_setting.getCecMuteStatus() == 1)
						{
							g_setting.sendCecKeyValue(top.VK_MUTE);
						}
					}
				},250);
				return;
			}else
			{
				top.$("mute").style.display = "block";
				mute_status = 1;
				switch(top.bt_soundOutPutValue)
				{
					case 0:
						g_setting.mute = 1;
						//bluetooth.setBluetoothMute(1);
                        g_setting.bluetoothStatus = 0;
						break;
					case 1:
						if(!(top.bt_soundOutputShowFlag))//判断是否有音频蓝牙设备连上
						{
							g_setting.mute = 1;
						}
						else
						{
							//bluetooth.setBluetoothMute(1);
                            g_setting.bluetoothStatus = 0;
                            g_setting.speakerStatus = 0;
						}
						break;
					case 2:
						g_setting.mute = 1;
						if(top.bt_soundOutputShowFlag)//判断是否有音频蓝牙设备连上
                            g_setting.bluetoothStatus = 0;//bluetooth.setBluetoothMute(1);
						break;
					default:
						g_setting.mute = 1;
						break;
				}
			}
        }
    }
}

/**mute按键的时候才需要发mute按键给cec设备*/
function sendMuteKey2Cec()
{
	//g_setting.getCecMuteStatus() 为1 表示ARC在mute状态
	if(mute_status == 1)
	{
		if(g_setting.getCecMuteStatus() == 0)
		{
			g_setting.sendCecKeyValue(top.VK_MUTE);
		}
	}
	else
	{
		if(g_setting.getCecMuteStatus() == 1)
		{
			g_setting.sendCecKeyValue(top.VK_MUTE);
		}
	}
}

function updateCecMute()
{
	if(g_setting.getCecARCStatus() ==1)
	{
		if(g_setting.getCecMuteStatus()==0)
		{
			 top.$("mute").style.display = "none";
			 if(mute_status == 1)
			 {
				g_setting.mute = 0; 
			    mute_status = 0;
			 }
		}
		else
		{
			 top.$("mute").style.display = "block";
			 if(mute_status == 0)
			 {
				g_setting.mute = 1; 
			    mute_status = 1;
			 }
		}
	}
	else
	{
		if(g_setting.mute==0 || g_factory.warnUpStatus==1)
		{
			 top.$("mute").style.display = "none";
			  if(mute_status == 1)
			 {
				g_setting.mute = 0; 
			    mute_status = 0;
			 }
		}
		else
		{
			 top.$("mute").style.display = "block";
			 if(mute_status == 0)
			 {
				g_setting.mute = 1; 
			    mute_status = 1;
			 }
		}
	}
}
function getArcStatus()
{
	var devicenum= g_setting.devTotalNum;
	var deviceinfo;
	var tsdevtype;
	var tsdevnum;
	if(g_setting.tlinkStatus == 0)
	{
		return false;	
	}
	for(var i = 0; i<devicenum; i++)
	{
		deviceinfo = g_setting.getDeviceInfo();
		tsdevtype = parseInt(deviceinfo.substring(9,12));
		tsdevnum = parseInt(deviceinfo.substring(6,9));
		if(tsdevtype == 5 && g_setting.getArcStatus(tsdevnum) == 1)
		{
			console.log("ARC is inserted");
			return true;
		}
	}
	return false;
}
function showFactoryHotkey()
{
	g_factory.designModeHotkey = g_factory_designModeHotkey;
	g_factory.factoryHotkey = g_factory_hotkey;
	frames["globleShow"].window.showHotkey();
}

function showFactoryIRStatus(flag)
{	
		g_factory_IR_status = flag;
		clearMyTimeout();
		g_temp="quickMenu";
		$("operatePage").src = "";
		$("otherPage").src = "factory/factoryIRNotify.html";	
		top.$("otherPage").style.display = "block";			
		top.otherPage.focus();
		setFrameFocusPage("otherPage");
}
function showPanelPicture()
{	
		clearMyTimeout();
		$("main").src = "factory/panelTest.html";			
		top.requestFocus(top.main, 1);
		setFrameFocusPage("main");
}

function prepareFactoryShop()
{	
	if(top.g_isDownloading == 1)
	{
		top.g_isDownloading = -1;
		if(!top.g_isForceUpgrade)
		{
			top.g_setting.pauseDownloadUpdateFile();
			top.hideDownloadRing();
		}
	}
	top.showMute(0);
}

function startFactoryShop()
{	
	top.initGlobalVariable();
	top.showFactoryHotkey();
	top.g_factory.resetShop();
}

function endFactoryShop()
{	
	//var action = top.g_setting.getProperty("ro.sita.model.FACTORY_FUNCTION_SETTING.factory_shop_after", "null"); //poweron or standby 
	var cType = top.g_factory.getClientTypeKey();
	var arrList = cType.split("-");
	var action = "standby";
	if(arrList.length>=2)
	{
		var locale = arrList[1];
		if(locale == "EU")
		{
			action = "poweron";
		}
	}
	
	if ("standby" == action)
	{
		setTimeout(function(){
			top.g_setting.powerOff(3);
			},g_factory_delay_after_shop);		
	}
	top.g_language = top.g_setting.menuLanguage;

}

//初始化AU配置，主要是语言和国家
function initAuData()
{
	mlmLangIndex 	= [6,7,9,5,12,
						0,10,2,13,14,
						15,16,17,19,25,
						26,499,/*45,52,*/20,21,
						22,23,35,8,24,
						18,33,279,36,468];				//要显示的语言在语言数组中对应的位置
						
	mlmCountryIndex 	= [0,22,8,9,12,
							5,4,6,11,14,
							15,16,17,18,31,
							0,0,/*0,0,*/21,20,
							7,23,32,10,3,
							19,30,58,28,59];//选择要显示的语言后，默认对应的国家在国家数组中的位置
	
	mlmName 			= ["English","Spanish","French","German","Italian",
								"Czech","Croatian","Danish","Hungarian","Dutch",
								"Norwegian","Polish","Portuguese","Romanian","Slovak",
								"Chinese","ChineseTraditional",/*"English","Achinese",*/"Slovenian","Serbian","Finnish","Swedish","Turkish",
								"Greek","Bulgarian","Russian","Latvian","Lithuanian",
								"Estonian","Ukrainian"];//选择语言后对应的翻译文件
	
	sysMenuLang 		= ["English","Español","Français","Deutsch","Italiano", 
								"Čeština","Hrvatski","Dansk","Magyar","Nederlands",
								"Norsk","Polski","Português","Română","Slovenčina",
								"简体中文","繁體中文",/*"Maori","Achinese",*/"Slovenščina","Srpski",
								"Suomi","Svenska","Türkçe","Ελληνικά","Български",
								"Русский","Latviešu","Lietuvių","Eesti","Українська"]; 				//UI中要显示的语言
}
function initAfData()
{
	mlmLangIndex = [31,160,6,9,34,362,17,18,7,471];
	mlmCountryIndex =[67,125,122,68,82,
						60,61,77,96,71];
	mlmName = ["Arabic","Egyptian","English","French","Hebrew","Persian","Portuguese","Russian","Spanish","Uzbekistan"];
	sysMenuLang = ["عربي","Egyptian","English","Français","עברית","فارسی ","Português","Türkçe","Español","O‘zbekiston"]; 
	audioSttlTtxLang		= [31,160,6,9,34,362,17,18,7,471];	
}
function initAPData()
{
    if (top.isIRNFlag)
    {
        mlmLangIndex 			= [6,474,442,18,9,
            31,503,362,7,17,
            319,223,293,26,499,
            471];				//按照上面的语言排序得到的多语言index
        mlmCountryIndex 		= [0,0,0,0,0,
            0,0,0,0,0,
            0,0,0,0,0,
            0];					//多语言mlmLangIndex对应的country index
        mlmName 				= ["English","Vietnamese","Thai","Russian","French",
            "Arabic","ArabicEgypt","Persian","Spanish","Portuguese",
            "Mongolian","Indonesian","Malay","Chinese","ChineseTraditional",
            "Uzbek"];
        sysMenuLang				= ["English","Tiếng Việt","ไทย","Русский","Français",
            "العربية","العربية مصر","فارسی","Español","Português",
            "Монгол","bahasa Indonesia","Malay","简体中文","繁體中文",
            "O'zbekiston"];
        audioSttlTtxLang		= [6,474,442,18,9,
            31,503,362,7,17,
            319,223,293,26,499,
            471];
    }
    else
    {
        mlmLangIndex 			= [6,474,442,18,9,
            31,503,7,17,319,
            34,223,293,26,499,
            471];				//按照上面的语言排序得到的多语言index
        mlmCountryIndex 		= [0,0,0,0,0,
            0,0,0,0,0,
            0,0,0,0,0,
            0];					//多语言mlmLangIndex对应的country index
        mlmName 				= ["English","Vietnamese","Thai","Russian","French",
            "Arabic","ArabicEgypt","Spanish","Portuguese","Mongolian",
            "Hebrew","Indonesian","Malay","Chinese","ChineseTraditional",
            "Uzbek"];
		sysMenuLang				= ["English","Tiếng Việt","ไทย","Русский","Français",
			"العربية","العربية مصر","Español","Português","Монгол",
            "עִברִית","bahasa Indonesia","Malay","简体中文","繁體中文",
            "O'zbekiston"];
        audioSttlTtxLang		= [6,474,442,18,9,
            31,503,7,17,319,
            34,223,293,26,499,
            471];
    }
}

//function gingaCallBack(eventId,data1,data2)
//{
//	console.log("ginga callback "+eventId+" "+data1+" "+data2);
//	switch(eventId)
//	{
//		case E_GINGA_APP_STATUS_CHANGE:
//		{
//			GingaObj.curAPPStatus = data1;
//			top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_APP_STATUS_CHANGE);
//		}
//			break;
//		case E_GINGA_AUDIO_SETTING_CHANGE:
//		{
//			GingaObj.audioConfig.configType = data1;
//			GingaObj.audioConfig.value = data2;
//			top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_AUD_CONFIG_CHANGE);
//		}
//			break;
//		case E_GINGA_CHANNEL_CHANGE:
//		{
//			var cur_channel = g_channel.getCurrentChannelInfo();
//			var curr_freq = cur_channel.frequency;
//			var next_channel_index = g_channel.convertChannelIndex(data1,0);
//			var next_channel = g_channel.getChannelInfoByIndex(next_channel_index);
//			var next_freq = next_channel.frequency;
//			if(curr_freq == next_freq)
//			{
//				top.GingaObj.isSameTS = true;
//			}
//			else
//			{
//				top.GingaObj.isSameTS = false;
//			}
//			top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_BEFORE_CHANNEL_CHANGE);
//			g_channel.playByIndex(next_channel_index);
//			Ginga.channelChangeResult(0);
//		}
//			break;
//		case E_GINGA_VIDEO_SIZE_CHANGE:
//		{
//			top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_VIDEO_RESIZE);
//		}
//			break;
//		case E_GINGA_RESUME_MAIN_TV:
//		{
//			top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_RESUME_MAIN_TV);
//		}
//			break;
//		default:
//			break;
//	}
//}
function initGinga()
{
	//Ginga.init(); //初始化Ginga功能 //已移置Ginga.loadGinga();中处理
	//Ginga.eventListener = gingaCallBack; // callback已移置中间件处理
    g_ginga.loadGinga();
	console.log("zenglm ginga init for console!! "+GingaObj);
	g_channel.testLog("zenglm ginga init for testLog!! "+GingaObj);
	if(GingaObj.isInit == GingaStates.False)
	{
		GingaObj.isInit = GingaStates.True;
	}
	if(Ginga.isEnable == GingaStates.True)
	{
		GingaObj.isEnable = GingaStates.True;
	}
	else
	{
		GingaObj.isEnable = GingaStates.False;
	}
}
function gingaEvtProc(msg)  //已移置中间件接受Ginga msg
{
}
//function gingaEvtProc(msg)  //已移置中间件接受Ginga msg
//{
//	//g_channel.testLog
//	//console.log
//	console.log("[Ginga]============================================="+"\n"+
//				">>>>>gingaEvtProc<<<<<>>>>>>before<<<<<< msg is "+msg+"\n"+
//				 "GingaStates:"+GingaObj.GingaStatus+"\n"+
//				 "GingaObj.GingaStatus:"+GingaObj.GingaStatus+"\n"+
//				 "GingaObj.isInit:"+GingaObj.isInit+"\n"+
//				 "GingaObj.isEnable:"+GingaObj.isEnable+"\n"+
//				 "GingaObj.isSameTS:"+GingaObj.isSameTS+"\n"+
//				 "GingaObj.svcSelect:"+GingaObj.svcSelect+"\n"+
//				 "GingaObj.tsSelect:"+ GingaObj.tsSelect+"\n"+
//				 "GingaObj.curAPPStatus:"+ GingaObj.curAPPStatus+"\n"+
//				 "==========================");
//	if(GingaObj.isInit == GingaStates.False)
//	{
//		console.log("Ginga is not running!!! Message is invalid for Ginga!!")
//		return;
//	}
//	//var curr_app_state = Ginga.getCurrAppState();
//	switch(msg)
//	{
//		case GingaStates.Events.GINGA_EVT_BEFORE_CHANNEL_CHANGE:
//			 GingaObj.channelChangeFlag = 1;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.isSameTS == GingaStates.False)
//			{
//				GingaObj.GingaStatus |= GingaStates.Status.PauseFirDifTS;
//				if(GingaObj.tsSelect != GingaStates.False)
//				{
//					Ginga.enableScreen(GingaStates.False);
//					Ginga.deactive();
//					resumeAudioConfig();
//					Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//					GingaObj.tsSelect = GingaStates.False;
//				}
//			}
//			else
//			{
//				if(GingaObj.isEnable == GingaStates.True && GingaObj.svcSelect != GingaStates.False)
//				{
//					Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_SERVICE_UNSELECTED);
//					GingaObj.svcSelect = GingaStates.False;
//				}
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_AFTER_CHANNEL_CHANGE:
//			{
//				Ginga.cleanAppList();
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_COMMON_VIDEO:
//			GingaObj.GingaStatus &= ~(GingaStates.Status.PauseFirDifTS|GingaStates.Status.PauseForNoAv|GingaStates.Status.PauseForNoSignal);
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				Ginga.enableScreen(GingaStates.True);
//				Ginga.active();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				GingaObj.tsSelect = GingaStates.True;
//			}
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.isSameTS == GingaStates.False)
//			{
//				GingaObj.isSameTS = GingaStates.True;
//			}
//			else
//			{
//				if(GingaObj.isEnable == GingaStates.True && GingaObj.svcSelect != GingaStates.True)
//				{
//					Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_SERVICE_SELECTED);
//					GingaObj.svcSelect = GingaStates.True;
//				}
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_NO_SIGNAL:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForNoSignal;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_RESUME_SIGNAL:
//			GingaObj.GingaStatus &= ~GingaStates.Status.PauseForNoSignal;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				Ginga.enableScreen(GingaStates.True);
//				Ginga.active();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				GingaObj.tsSelect = GingaStates.True;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_LOCKED_CH:
//		case GingaStates.Events.GINGA_EVT_LOCKED_INP:
//		case GingaStates.Events.GINGA_EVT_LOCKED_PROG:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForNoAv;
//		    if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_BEFORE_AV_CHANGE:
//			Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_SERVICE_COMPONENT_UNSELECTED);
//			break;
//		case GingaStates.Events.GINGA_EVT_AFTER_AV_CHANGE:
//			Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_SERVICE_COMPONENT_SELECTED);
//			break;
//		case GingaStates.Events.GINGA_EVT_TUNER_MODE_CHANGE:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForNoAv;
//		    if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_PAUSE_FOR_CONTROL_LOST:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForOtherPage;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_RESUME_FROM_CONTROL_LOST:
//			GingaObj.GingaStatus &= ~GingaStates.Status.PauseForOtherPage;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.True &&
//			GingaObj.GingaStatus == GingaStates.Status.Normal && g_channel.inputSource == 1)
//			{
//				var programStates = g_channel.channelProgramStatus();
//				var channelInfo = g_channel.getCurrentChannelInfo();
//				if(programStates > 0 && channelInfo.serviceType>0)
//				{
//				Ginga.enableScreen(GingaStates.True);
//				Ginga.active();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				GingaObj.tsSelect = GingaStates.True;
//				}
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_PAUSE_FOR_OTHER_APP:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForOtherApp;
//            Ginga.unInitOnly();
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_RESUME_FROM_OTHER_APP:
//			GingaObj.GingaStatus &= ~GingaStates.Status.PauseForOtherApp;
//            Ginga.initOnly();
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				Ginga.enableScreen(GingaStates.True);
//				Ginga.active();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				GingaObj.tsSelect = GingaStates.True;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_START_SCAN:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForNoAv ;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_STOP_SCAN:
//			GingaObj.GingaStatus &= ~GingaStates.Status.PauseForChannelScan;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				Ginga.enableScreen(GingaStates.True);
//				Ginga.active();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				GingaObj.tsSelect = GingaStates.True;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_CHANNEL_LIST_CHANGED:
//			if(GingaObj.isEnable == GingaStates.True)
//			{
//			Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_LIST_CHANGED);
//				/*if(GingaObj.tsSelect == GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//				{
//					Ginga.enableScreen(GingaStates.False);
//					Ginga.deactive();
//					Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//					Ginga.enableScreen(GingaStates.True);
//					Ginga.active();
//					Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				}*/
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_SOURCE_CHANGED:
//			if(g_channel.inputSource == 1)
//				break;
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForNoAv ;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_APP_STATUS_CHANGE:
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.curAPPStatus == GingaStates.GingaAPPStatus.GINGA_APP_STARTED && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				if(GingaObj.tsSelect != GingaStates.True)
//				{
//					Ginga.enableScreen(GingaStates.True);
//					Ginga.active();
//					Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//					GingaObj.tsSelect = GingaStates.True;
//				}
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_DIABLE_GINGA:
//			GingaObj.tsSelect = GingaStates.False;
//			break;
//		case GingaStates.Events.GINGA_EVT_ENABLE_GINGA:
//			if(GingaObj.tsSelect != GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				Ginga.enableScreen(GingaStates.True);
//				Ginga.active();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				GingaObj.tsSelect = GingaStates.True;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_IN_PVR_STATUS:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForPvr ;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_NOT_PVR_STATUS:
//			GingaObj.GingaStatus &= ~GingaStates.Status.PauseForPvr;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				Ginga.enableScreen(GingaStates.True);
//				Ginga.active();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
//				GingaObj.tsSelect = GingaStates.True;
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_AUD_CONFIG_CHANGE:
//			console.log("[GingaEvtProc] GINGA_EVT_AUD_CONFIG_CHANGE configType "+GingaObj.audioConfig.configType+" value "+GingaObj.audioConfig.value);
//			if(GingaObj.tsSelect == GingaStates.True && GingaObj.GingaStatus == GingaStates.Status.Normal)
//			{
//				gingaAudioConfig(GingaObj.audioConfig.configType, GingaObj.audioConfig.value);
//			}
//			else
//			{
//				g_channel.testLog("[GingaEvtProc] error -> GINGA_EVT_AUD_CONFIG_CHANGE in the case of ginga not running!!");
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_VIDEO_RESIZE:
//                if(g_setting.zoomSmallWindowsState == 0)
//                {
//                    g_setting.setCCVisibility(1,1);
//                }
//                else
//                {
//                    g_setting.setCCVisibility(1,0);
//                }
//			break;
//		case GingaStates.Events.GINGA_EVT_COUNTRY_CHANGE:
//			//if(GingaObj.isEnable == GingaStates.True)
//			{
//				var countryIndex = g_channel.systemCountry;
//				if(countryIndex == 40)//argentina
//				{
//					Ginga.setCountry(GingaStates.GingaCountry.GINGA_CNRY_AGR);
//					Ginga.setGingaProperty("system.caption", "es");
//					Ginga.setGingaProperty("system.subtitle", "es");
//				}
//				else
//				{
//					Ginga.setCountry(GingaStates.GingaCountry.GINGA_CNRY_BRZ);
//					Ginga.setGingaProperty("system.caption", "pt");
//					Ginga.setGingaProperty("system.subtitle", "pt");
//				}
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_MENU_LANGUAGE_CHANGE:
//			var menulanguage = g_setting.menuLanguage;
//			if(menulanguage == 17)
//			{
//				Ginga.setGingaProperty("system.language", "pt");
//			}
//			else if(menulanguage == 7)
//			{
//				Ginga.setGingaProperty("system.language","es");
//			}
//			else
//			{
//				Ginga.setGingaProperty("system.language", "en");
//			}
//			break;
//		case GingaStates.Events.GINGA_EVT_POWER_OFF:
//			GingaObj.GingaStatus |= GingaStates.Status.PauseForNoAv;
//			if(GingaObj.isEnable == GingaStates.True && GingaObj.tsSelect != GingaStates.False)
//			{
//				Ginga.enableScreen(GingaStates.False);
//				Ginga.deactive();
//				resumeAudioConfig();
//				Ginga.sendNetworkEvent(GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
//				GingaObj.tsSelect = GingaStates.False;
//			}
//			Ginga.unInit();
//            Ginga.killGinga();
//			break;
//		case top.GingaStates.Events.GINGA_EVT_RESUME_MAIN_TV:
//			if(GingaObj.isEnable == GingaStates.True)
//			{
//				var index = g_channel.currentIndex;
//				g_channel.playByIndex(index);
//			}
//			break;
//        case top.GingaStates.Events.GINGA_EVT_STR_POWER_ON:
//            {
//                if(g_setting.zoomSmallWindowsState == 0)
//                {
//                    g_setting.setCCVisibility(1,1);
//                }
//                else
//                {
//                    g_setting.setCCVisibility(1,0);
//                }
//                Ginga.restartGinga();
//                initGinga();
//            }
//            break;
//		default:
//			g_channel.testLog("[GingaEvtProc]>> unknown message!!");
//			break;
//	}
//	console.log("[Ginga]============================================="+"\n"+
//				">>>>>gingaEvtProc<<<<<>>>>>after<<<<<< msg is "+msg+"\n"+
//				 "GingaStates:"+GingaObj.GingaStatus+"\n"+
//				 "GingaObj.GingaStatus:"+GingaObj.GingaStatus+"\n"+
//				 "GingaObj.isInit:"+GingaObj.isInit+"\n"+
//				 "GingaObj.isEnable:"+GingaObj.isEnable+"\n"+
//				 "GingaObj.isSameTS:"+GingaObj.isSameTS+"\n"+
//				 "GingaObj.svcSelect:"+GingaObj.svcSelect+"\n"+
//				 "GingaObj.tsSelect:"+ GingaObj.tsSelect+"\n"+
//				 "GingaObj.curAPPStatus:"+ GingaObj.curAPPStatus+"\n"+
//				 "==========================");
//}
function gingaAudioConfig(configType,value)
{
	switch(configType)
	{
		case GingaStates.GingaAudioConfigType.GINGA_AUD_CFG_TYPE_VOLUME:
			var curVolume = g_channel.volume;
			var gingaSeting = gingaTVAudioConvertion(0,100,curVolume,value);
			console.log("gingaAudioConfig >>>>>>>>>>>>>>> VOLUME curVolume "+curVolume+" gingaSeting "+gingaSeting);
			g_channel.volume = gingaSeting;
			GingaObj.isGingaVolume = GingaStates.True;
			g_setting.setProperty("app.ginga.defaultVolume",gingaSeting.toString());
			g_setting.setProperty("app.ginga.userVolume",curVolume.toString());
			break;
		case GingaStates.GingaAudioConfigType.GINGA_AUD_CFG_TYPE_BALANCE:
			var curBalance = g_setting.soundBalance;
			var gingaSeting = gingaTVAudioConvertion(-50,50,curBalance,value);
			console.log("gingaAudioConfig >>>>>>>>>>>>>>> BALANCE curBalance "+curBalance+" gingaSeting "+gingaSeting);
			g_setting.soundBalance = gingaSeting;
			GingaObj.isGingaBalance = GingaStates.True;
			g_setting.setProperty("app.ginga.defaultBalance",gingaSeting.toString());
			g_setting.setProperty("app.ginga.userBalance",curBalance.toString());
			break;
		case GingaStates.GingaAudioConfigType.GINGA_AUD_CFG_TYPE_BASS:
			break;
		case GingaStates.GingaAudioConfigType.GINGA_AUD_CFG_TYPE_TREBLE:
			break;
		case GingaStates.GingaAudioConfigType.GINGA_AUD_CFG_TYPE_RESTORE:
			break;
		default:
			break;
	}
}
function resumeAudioConfig()
{
	console.log("resumeAudioConfig >>>>>>>>>>>>>>> GingaObj.isGingaVolume "+ GingaObj.isGingaVolume+" GingaObj.isGingaBalance "+GingaObj.isGingaBalance);
	if(GingaObj.isGingaVolume == GingaStates.True)
	{
		GingaObj.isGingaVolume = GingaStates.False;
		var curVolume = g_channel.volume;
		var gingaSeting = parseInt(g_setting.getProperty("app.ginga.defaultVolume","1000"));
		console.log("resumeAudioConfig >>>>>>>>Volume>>>>>>> gingaSeting "+ gingaSeting);
		if(curVolume == gingaSeting)
		{
			g_channel.volume = parseInt(g_setting.getProperty("app.ginga.userVolume","30"));
		}
	}
	if(GingaObj.isGingaBalance == GingaStates.True)
	{
		GingaObj.isGingaBalance = GingaStates.False;
		var curBalance = g_setting.soundBalance;
		var gingaSeting = parseInt(g_setting.getProperty("app.ginga.defaultBalance","0"));
		console.log("resumeAudioConfig >>>>>>>>Balance>>>>>>> gingaSeting "+ gingaSeting);
		if(curBalance == gingaSeting)
		{
			g_setting.soundBalance = parseInt(g_setting.getProperty("app.ginga.userBalance","0"));
		}
	}
	//if()
}
function gingaTVAudioConvertion(appMin, appmax, userValue, gingaValue) //return ginga setting;
{
    /* i2_app_min <= i2_crt_max <= i2_app_max && 0 <= ui1_level <= 100*/
	var gingaSet;
    if(userValue > appmax ||
        userValue < appMin)
    {
        console.log("[GingaTV] invalid parameters: appMin "+appMin+" appmax "+appmax+" userValue "+userValue);
    }
    if(appMin < 0)
    {
        if(gingaValue < 0)
        {
            gingaSet = userValue + (userValue - appMin)*gingaValue/100;
        }
        else
        {
           gingaSet = userValue + (appmax - userValue)*gingaValue/100;
        }
    }
    else
    {
        gingaSet = appMin + (userValue - appMin) * gingaValue/ 100;
    }
	return gingaSet;
}
function init()
{
	g_setting.setTBrowserVisible(1);//浏览器开机loading页面时会画黑屏，在load页面时先隐藏，然后在init中show出浏览器页面
    g_channel.initChannelList();
	g_language = g_setting.menuLanguage;
	lastInputSource = g_channel.getLastinputSource();
	initAllProperty();
	initSetRegion();
    top.requestFocus(top.main, 1);
	setFrameFocusPage("main");
	//doChangeMultilanguage(g_language);

	if(isAUFlag)//澳洲平台 重新初始化变量
	{
		initAuData();
	}
	else if(top.isAFFlag)
	{
		initAfData();
	}
	else if(top.isAPFlag || top.isIRNFlag)
	{
		initAPData();	
	}
    if((g_factory.hotelEnable == 1)&&(cleanBrowserCacheFlag==0))
    {
        cleanBrowserCacheFlag = 1;
        g_setting.cleanBrowserCache();
        g_setting.cleanBrowser2Cache();
    }
	if(g_setting.getProperty("ro.sita.model.FUNCTION_ENABLE_CFG.cfg_ginga_enable", "0") == "1" &&
	isLAFlag && top.g_setting.getTopApp() != "vod.netflix")
	{
		isGingaOn = true;
		initGinga();
	}

	if(checkSourceProperty())
	{
		SourceSupportFlag = 1;
	}
	else
	{
		SourceSupportFlag = 0;
	}
	if(g_setting.getProperty("app.ui.miracast.disablenetwork","0")== "1")
	{
		g_setting.networkEnable = 1;
		g_setting.setProperty("app.ui.miracast.disablenetwork","0");
	}

	doChangeMultilanguage(g_language);
	g_setting.setProperty("memory.app.ui.virtualRemote.state","off");//设置对按键的响应逻辑为默认的逻辑，非虚拟遥控器的。-lqt
	// init source configuration
	inputList[0].name = 0;
    inputList[0].source = top.E_INPUT_DTV;
    inputSourceCount++;
	if (supportSCARTSource == 1)
    {
        inputList[inputSourceCount].name = 1;
        inputList[inputSourceCount].source = top.E_INPUT_SCART;
        inputSourceCount++;
    }
    else if(supportAV1Source == 1)
    {
    	inputList[inputSourceCount].name = 1;
        inputList[inputSourceCount].source = top.E_INPUT_AV_I;
        inputSourceCount++;
    }
    else if(supportAV2Source == 1)
    {
    	inputList[inputSourceCount].name = 1;
        inputList[inputSourceCount].source = top.E_INPUT_AV_II;
        inputSourceCount++;
    }
    if (supportYPBPRSource == 1)
    {
        inputList[inputSourceCount].name = 2;
        inputList[inputSourceCount].source = top.E_INPUT_YPBPR;
        inputSourceCount++;
    }
    if (supportHDMI1Source == 1)
    {
        inputList[inputSourceCount].name = 3;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_I;
        inputSourceCount++;
    }
    if (supportHDMI2Source == 1)
    {
        inputList[inputSourceCount].name = 4;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_II;
        inputSourceCount++;
    }
    if (supportHDMI3Source == 1)
    {
        inputList[inputSourceCount].name = 5;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_III;
        inputSourceCount++;
    }
    if (supportHDMI4Source == 1)
    {
        inputList[inputSourceCount].name = 6;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_IV;
        inputSourceCount++;
    }
    if (supportVGASource == 1)
    {
        inputList[inputSourceCount].name = 7;
        inputList[inputSourceCount].source = top.E_INPUT_PC;
        inputSourceCount++;
    }
    if (supportUSBSource == 1)
    {
        inputList[inputSourceCount].name = 8;
        inputList[inputSourceCount].source = top.E_INPUT_STORAGE;
        inputSourceCount++;
    }
	if(top.g_channel.inputSource == 1 || top.g_channel.inputSource == 0)
	{
		currentInputIndex = 0;
	}
	else
	{
    	for (var i=1; i< inputSourceCount; i++)
    	{
        	if (inputList[i].source == top.g_channel.inputSource)
        	{
           	 	currentInputIndex = i;
            	break;
        	}
    	}
	}
	var devCurNum = "000";
	if(0 == g_setting.getHeadphonePlugin())
	{
		devCurNum = devCurNum.charAt(0)+devCurNum.charAt(1)+"1";
	}
	if(getArcStatus() == true)
	{
		devCurNum = "1"+devCurNum.charAt(1)+devCurNum.charAt(2);
//		if(g_setting.sPDIFDDP != 1 && g_setting.sPDIFType == 0)
//		{
//			g_setting.sPDIFDDP = 1;
//		}
//		else if(g_setting.sPDIFType != 0)
//		{
//			g_setting.sPDIFDDP = 0;
//		}
	}
	else
	{
//		if(g_setting.getProperty("app.ui.audioDeviceStatus","000").charAt(0) == "1")
//		{
//			if(g_setting.sPDIFDDP != 0)
//			{
//				g_setting.sPDIFDDP = 0;
//			}
//		}
	}

	if(devCurNum != "000")
	{
		if(supportHeadphone)
		{
			g_setting.setProperty("app.ui.audioDeviceStatus",devCurNum);
			g_setting.speakerStatus = 0;
		}
	}
	else
	{
		if(g_setting.speakerStatus == 0)//in case stanby TV with other
		{
			g_setting.setProperty("app.ui.audioDeviceStatus","000");
			g_setting.speakerStatus = 1;
		}
	}
	if(isEUFlag){
		var bmanualSetSpeaker = g_setting.getProperty("app.ui.bmanualSetSpeaker","2");
		if( bmanualSetSpeaker != 2 ) {
			g_setting.speakerStatus = bmanualSetSpeaker;
		}
		console.log("hhf  init bmanualSetSpeaker = " + bmanualSetSpeaker + "g_setting.speakerStatus = " + g_setting.speakerStatus);
	}
	g_motionClarity = g_setting.getProperty("ro.sita.model.FUNCTION_ENABLE_CFG.cfg_motion_clarity_enable", "Off");
	var powerontype = window.location.search;
	console.log("hevens ******************************  powerontype = " + powerontype);
	setTimeout(function(){
		$("main").onload=function(){
            if(top.isFirstInitNotifyThread)//初始化消息接收线程
            {
                $("main").style.display = "block";
                                    
                g_setting.createNotifyThread();
                sendEvent("vod.netflix", 0xf301);
                g_setting.browserIsStart();
                top.isFirstInitNotifyThread = 0;
                $("main").onload=function(){};
            }
        };
		$("frontPanel").innerHTML = top.frontPanelRemind;
		g_factory_designModeHotkey = g_factory.designModeHotkey;
		g_factory_hotkey = g_factory.factoryHotkey;
		if(g_factory_hotkey == 1 || g_factory_designModeHotkey == 1)
		{
				showFactoryHotkey();
				if(g_factory.warnUpStatus==1)
				{
					$("main").src = "factory/factoryWarmUp.html";
				}		
				else
				{
					if((g_factory.hotelEnable == 1) && (g_factory.hotelPowerLogo == 1) &&(powerLogoFlag == 1))
					{
						clearMyTimeout();
						timeoutFuc.timeoutEnable = 1;
						$("operatePage").src = "";
						$("main").src="factory/powerLogo.html";
						top.requestFocus(top.main, 1);
						setFrameFocusPage("main");

						menu_visible_status = 0;
						
						//setTimeout(function(){$("main").style.display = "block";},20);
						$("main").style.display = "block";

						if((g_factory.hotelEnable == 1) && (g_factory.hotelPowerLogo == 1) && (powerLogoFlag == 1))
						{
							setTimeout(function()
										{

											$("operatePage").src = "";
											$("main").src="channelPlay.html";
											top.requestFocus(top.main, 1);
											setFrameFocusPage("main");
											//menu_visible_status = 0;
											powerLogoFlag = 0;
											//$("operatePage").src = "";
										},5000);
						}
					}
					else
					{
		    			top.jumpPage();
					}
				}				
		}
		else if(g_setting.tvRunningMode == 0)
		{
			clearMyTimeout();
			//进入初始化页面设置下次开机启动信源为 E_BOOT_INPUT_STORAGE，直到开机向导结束才会把下次开机信源设置为自动模式。
			g_setting.setBootInput(11);
			$("main").src = "initSetup/initSetup.html";
		}
		else if(g_setting.tvRunningMode == 1)
		{
			if((g_factory.hotelEnable == 1) && (g_factory.hotelPowerLogo == 1) &&(powerLogoFlag == 1))
			{
				clearMyTimeout();
				$("operatePage").src = "";
				timeoutFuc.timeoutEnable = 1;
				$("main").src="factory/powerLogo.html";
				top.requestFocus(top.main, 1);
				setFrameFocusPage("main");
				menu_visible_status = 0;

				//setTimeout(function(){$("main").style.display = "block";},20);
				$("main").style.display = "block";
				if((g_factory.hotelEnable == 1) && (g_factory.hotelPowerLogo == 1) && (powerLogoFlag == 1))
				{
					setTimeout(function()
								{
									$("operatePage").src = "";
								//	$("main").style.display = "none";
									$("main").src="channelPlay.html";
									top.requestFocus(top.main, 1);
									setFrameFocusPage("main");
								//	menu_visible_status = 0;
									powerLogoFlag = 0;
								//	$("operatePage").src = "";
								},5000);
				}
			}
			else
			{
				if(powerontype != null && powerontype == "?powerbynetflix") {
					console.log("hevens ******************************  powerOnbyNetflixPage");
					top.powerOnbyNetflixPage();
				}else {
                    if (g_channel.inputSource == 10)
                    {
                        console.log("--hzm framework init and source is storage,so load launcher!!");
                        $("main").src = getHomepage();
                    }
                    else
                    {
                        if((g_channel.inputSource == 0||g_channel.inputSource == 1)&&(g_setting.getTunerCount()<1))
                        {
                            g_channel.inputSource = top.E_INPUT_AV_I ;
                        }
                        top.jumpPage();
                    }
				}
			}
		}
		else if(g_setting.tvRunningMode == 2)
		{
			var locationValue = g_setting.location;
			if(locationValue == 1)
			{
				var usbList = "";
				var playUsb = "";
				//获取usb设备列表
				if (g_media.deviceStatus()) {
					usbList = g_media.getDiskListInfo();
				}
				var list;
				g_media.setMediaFileParser(g_media.getMediaFileParser());
				for(var i = 0;i < usbList.length;i++)
				{
					list = g_media.getMediaFileList(0, 2, usbList[i].path+"/TCL DEMO", 0, -1);
					if (list.length != 0)
					{
						playUsb = usbList[i].path+"/TCL DEMO";
						break;
					};
				}
				if (playUsb != "")
				{
					top.jumpHotkeyPage("eSticker/eStickerVideo.html");
				}
				else
				{
					if(powerontype != null && powerontype == "?powerbynetflix") {
						console.log("hevens ******************************  powerOnbyNetflixPage");
						top.powerOnbyNetflixPage();
					}else {
						top.jumpPage();
					}
				}
			}
			else
			{
				if(powerontype != null && powerontype == "?powerbynetflix") {
					console.log("hevens ******************************  powerOnbyNetflixPage");
					top.powerOnbyNetflixPage();
				}else {
					top.jumpPage();
				}
			}
		}
		else
		{
			clearMyTimeout();
			$("main").src="channelPlay.html";
		}
	},100);

	//获取蓝牙状态并打开蓝牙 add yums
	
	setTimeout(function(){
		if(bluetooth.isSupport() == 1)//平台支持蓝牙
		{
			if(g_setting.getProperty(BT_SWITCH_STATE_FOR_DB,"OFF") == "ON")
			{
				setTimeout(function(){
					var res = bluetooth.enable();
					if(res == 1)
					{
						console.log("YM enable success!");
						g_setting.setProperty("bluetoothSwitchState","ON");
					}
					else
					{
						console.log("YM enable failed!");
					}
				},2500);
				
			}
		}
	
	},1000);//延迟一秒，规避bluetooth初始化未完成时，程序已经执行到这
	
	
	
    g_channel.resetChannelListType(g_channel.channelListType);
	//updateCecMute();

	top.g_media.getNewDiskListInfo(0);//for device driver init(ndm/multimedia)
	if(g_setting.isStartedBy5n1())
	{
		setTimeout(function(){
			top.$('globleShow').contentWindow.display5n1Logo();
			}, 2000);
	}
    setTimeout(function() {
        preloadForPerformance();
        if (newUI)
        {
            preloadLauncher(0);
            startUpload(0);
        }
        updateInject(0);
        reportDNS(0);
    }, 5000);
    
    printfRunningTime();
    setTimeout(function (){
        window.onfocus=function(){main.focus();console.log("framework on focus");};
        document.onsystemevent = function(evt)
        {
            var msg = evt.which;
            console.log("warnning, framework focused");
            main.focus();
            if ($("main").contentWindow.document.onsystemevent != undefined)
            {
                $("main").contentWindow.document.onsystemevent(evt);
            }
            else
            {
                systemEventProc(evt);
            }
        };

        document.onkeydown = function (evt)
        {
            var msg = evt.which;
            console.log("warnning, framework focused");
            main.focus();
            if ($("main").contentWindow.document.onkeydown != undefined)
            {
                $("main").contentWindow.document.onkeydown(evt);
            }
            else
            {
                keyDownProcess(evt);
            }
        };

    },3000);

    setTimeout(function(){
        var dataFreeSize = top.g_setting.getDataFreeSize();
        if (dataFreeSize < 400)
        {
            delStickerVideo();
        }
    }, 2000);

    /****shopmode 2.5需求****/
    var times = parseInt(top.g_setting.getProperty("app.ui.systemRunningTimer","0"));
    console.log("--hzm in init times = " + times);
    var isRunning9hours = parseInt(top.g_setting.getProperty("app.ui.isRunning9hours","0"));
    console.log("--hzm in init isRunning9hours = " + isRunning9hours);
    var autoShopmodeValue = parseInt(top.g_setting.getProperty("app.ui.autoshopmode.switch","0"));
    console.log("--hzm in init autoShopmodeValue = " + autoShopmodeValue);
    console.log("--hzm in init autoStandby = " + g_setting.autoStandby + "  location = " + g_setting.location);
    if (times < 6)
    {
        if (times == 5 || (times == 4 && isRunning9hours == 1))
        {
            top.g_setting.setProperty("app.ui.systemRunningTimer",100);
            setTimeout(function(){
                //首先判断是否满足弹出提示条件
                $("otherPage").src = "powerOffTimerShop.html";
                top.$("otherPage").style.display = "block";
                top.requestFocus(top.otherPage, 0);
                setFrameFocusPage("otherPage");
            },2000);
        }
        else
        {
            if (g_setting.autoStandby == 0 && g_setting.location == 0 && autoShopmodeValue == 1)//shopmode2.3需求前提条件：autoshopmode 为ON，autoStandby 为OFF，home模式
            {
                //console.log("--hzm in case ");
                if (isRunning9hours == 1)//上一次满足系统运行9小时后，断电上电情况
                {
                    top.g_setting.setProperty("app.ui.isRunning9hours","0");
                    top.g_setting.setProperty("app.ui.systemRunningTimer",times+1);
                }
                else if (isRunning9hours == 2)//STR ON上一次满足系统运行9小时，遥控开机情况
                {
                    top.g_setting.setProperty("app.ui.isRunning9hours","0");
                    //top.g_setting.setProperty("app.ui.systemRunningTimer","0");
                }
                else if (isRunning9hours == 3)//STR OFF上一次满足系统运行9小时，遥控开机情况
                {
                    top.g_setting.setProperty("app.ui.isRunning9hours","0");
                }
                else//上一次不满足系统运行9小时，断电上电情况
                {
                    top.g_setting.setProperty("app.ui.isRunning9hours","0");
                    //top.g_setting.setProperty("app.ui.systemRunningTimer","0");//shop 2.5需求，不清计数
                }
                runningTimer = setTimeout("systemRunning9hours()",SYSTEM_RUNNING_TIME);
            }
        }
    }
    else //systemRunningTimer = 100时，不执行
    {
        console.log("--hzm in init times = 100 and do nothing !!");
    }

    /****shopmode 2.5需求 end****/

    /**
     *越南电子保单
     * */
    if (isAPFlag && g_setting.location == 0 && g_setting.tvRunningMode == 1 && (g_channel.systemCountry == 58 || g_channel.systemCountry == 82))
    {
        var skipQRCode = top.g_setting.getProperty("app.ui.skipQRCode", "0");
        var skipCustomerCenter = top.g_setting.getProperty("app.ui.skipCustomerCenter", "0");
        if (skipQRCode == "100" || skipCustomerCenter == "100" || skipQRCode == "200" || skipCustomerCenter == "200")
        {
            console.log("--hzm This TV is activated or already show tips more than three times!");
        }
        else
        {
            setTimeout(function () {
                $("operatePage").src = "";
                $("otherPage").src = "activationTips.html";
                $("otherPage").style.display = "block";
                otherPage.focus();
                setFrameFocusPage("otherPage");
            },5000);
        }
    }
    /**
     * 越南电子保单
     * */
	 
	//越南DVB network update 默认OFF
	var networkupdatestate = g_setting.dvbNetworkUpdate;
	if(g_channel.systemCountry == 58 && networkupdatestate == 1)
	{
		g_setting.dvbNetworkUpdate = 0;
	}
	 
	document.onglobalevent = function (evt)
	{
		var msg = evt.which;
		var p1 = evt.modifiers;
		console.log("framework receive global event "+msg+" p1 is "+p1);
		switch (msg)
		{
			case E_GLOBLEMSG_KEYDOWN:
			{
				keyPressAutoStandBy();
				break;
			}
			case E_STR_SCREEN_OFF_EX:
			{
                if (1 == g_setting.suspendStatus)
                {
                    console.log("ldc *** send normal to samba from picoff");//STR打开时，待机刻录开机时发送normal给samba
                    sendPowerModeToSamba("normal");
                }
				preSTRPowerOff();
                break;
			}
            case E_STR_SCREEN_ON_EX:
            {
                console.log("--in E_STR_SCREEN_ON_EX mute_status = " + mute_status);
                console.log("in E_STR_SCREEN_ON_EX force_mute_status = "+force_mute_status);
//                if(top.isGingaOn)          //开关机暂停Ginga已移置中间件处理
//                {
//                    top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_STR_POWER_ON);
//                }
				if(force_mute_status == 1)
				{
					forceMute(0);
				}
                if (mute_status == 1)
                {
                    top.$("mute").style.display = "none";
                    setTimeout('top.$("mute").style.display = "block";',0);
                }
                else
                {
                    top.$("mute").style.display = "none";
                }
                break;
            }
            case E_POWER_ON_BY_NETFLIX:
            {
                console.log("hevens ******** onglobalevent E_POWER_ON_BY_NETFLIX ");
                PowerOnByNetflix();
                break;
            }
			case E_GLOBLEMSG_APP_OPEN:
			{/** app通过其他服务打开，只有APP层被pause的状态，由于主页不让更改，所以在此通过全局消息来处理进入app时crossUI的处理*/
				//console.log("hevens ******** onglobalevent E_GLOBLEMSG_APP_OPEN main page = " + $("main").src);
//				if($("main").src.indexOf("index.html") == -1)
//					break;
				console.log("hevens ******** onglobalevent E_GLOBLEMSG_APP_OPEN hide Launcher page = " + $("main").src);
				if(top.g_channel.inputSource != 10 && top.appOpenFlag == 0){
					top.lastInputSource = top.g_channel.inputSource;
					top.g_channel.inputSource = 10;
				}
				top.appOpenFlag = 1;
				top.main.document.body.style.display = "none";
				top.$("operatePage").style.display="none";
				top.$("otherPage").style.display="none";
				break;
			}
			case E_GLOBLEMSG_GARBAGE_COLLECT:
			{/** 进入应用和STR待机需要进行内存清理*/
				console.log("hevens onglobalevent E_GLOBLEMSG_GARBAGE_COLLECT!" );
				Util.garbageCollectNow();
				break;
			}
			case E_GLOBLEMSG_NETWORK_MSG:
			{
				/** APP播放时，若外网断开，则需要进行网络断开的提示，且在此次网络恢复前不再提示（待机或退出APP需要重置标志）*/
                if (isShowOnce == 0)
                {
                    closePage($("operatePage"));
                    $('otherPage').src = "netDisconnetRemind.html";
                    top.$("otherPage").style.display="block";
                    top.requestFocus(top.otherPage, 0);
                    setFrameFocusPage("otherPage");
                }
			}
			case E_GINGA_BEFORE_SOURCE_CHANGE:
			{
//				if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)//切信源暂停Ginga已移置中间件处理
//				{
//					//g_channel.testLog("==>ginga receveri msg of source  change, value is "+value);
//					top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_SOURCE_CHANGED);
//				}
                break;
			}
			case E_CHANNEL_LIST_UPDATE:
            {
//                if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)//节目变更暂停Ginga已移置中间件处理
//                {
//                    top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_CHANNEL_LIST_CHANGED);
//                }
				break;
            }
            case E_SS_CH_BLOCK:
			{
				top.channelLock = 1;
                break;
			}
            case E_SS_PARENTAL_BLOCK:
			{
				top.parentalLock = 1;
                break;
			}
            case E_DTV_SS_INPUT_BLOCK:
			{
				top.inputLock = 1;
                break;
			}
            case E_APP_LOADING_START:
            {
                showLoading();
                break;
            }
            case E_APP_LOADING_FINISHED:
            {
                hideLoading();
                break;
            }
			case E_EAS:
			{
				if(p1 == 1 && isEASFlag == 0)//1 禁止按键
				{
					isEASFlag = 1;
					$("main").src = "EAS.html";
					top.requestFocus(top.main, 1);
					$("operatePage").src = "";
				}
				else if(p1 == 0 && isEASFlag == 1)//0 允许按键
				{
					isEASFlag = 0;
				}
				break;
			}
            case E_VOICE_UI:
            {
                var x1 = p1>>16;
                var x2 = p1&0x0000ffff;
                if (x1 == 1)
                {
                    //hide
                    hideVoiceControl();
                }
                else if (x1 == 2)
                {
                    //recording
                    showVoiceControl(0);
                }
                else if (x1==3)
                {
                    //recognizing
                    showVoiceControl(1);
                }
                else if (x1==4)
                {
                    //voice result
                    showVoiceText(x2);
                }
                else if (x1==5)
                {
                    //match result
                    showVoiceControl(2);
                    showVoiceText(x2);
                }
                else if (x1==6)
                {
                    //help
                    showVoiceText(x2);
                }
                else if (x1==7)
                {
                    //error
                    showVoiceControl(2);
                    showVoiceText(x2);
                }
                else
                {
                    //
                }
      
                break;
            }
            case E_VOICE_COLLECT_ENTRIES:
            {
                break;
            }
            case E_VOICE_CONTROL:
            {
                var x1 = p1>>16;
                var x2 = p1&0x0000ffff;
                if (x1 == 1)
                {
                    //control page
                    hideVoiceControl();
                }
                else if (x1==2)
                {
                    //open app
                }
                else if (x1==3)
                {
                    //change channel
                    hideVoiceControl();
                    var result = tcl.setting.getVoiceResult(x2);
                    if ($("main").src.indexOf("channelPlay.html")!=-1)
                    {
                        $("main").contentWindow.playChannelByNum(parseInt(result));
                    }
                }
                else if (x1==4)
                {
                    //search youtube
                    hideVoiceControl();
                    var result = tcl.setting.getVoiceResult(x2);
                    if (top.appOpenFlag)
                    {	
                        var appname = top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                        top.g_ulits.closeApplication(appname);
                        top.scheduleApp = top.SCHEDULE_SEARCH;
                        return;
                    }

                    $("operatePage").src = "";
                    $("otherPage").src = "";
                    $("main").src = "launcher/search/resultSearch.html?searchKey="+result;

                    top.requestFocus(top.main, 1);
                    setFrameFocusPage("main");
                }
                else if (x1==5)
                {
                    //global
                    hideVoiceControl();
                    var result = tcl.setting.getVoiceResult(x2);
                    if (result == "ajustbrightness")
                    {
                        //
                    }
                    else if (result == "system")
                    {
                        top.g_nextHtmlPage = "systemSet.html";
                        top.jumpToOperatePage("index.html");
                    }
                    else if (result == "sound")
                    {
                        top.g_nextHtmlPage = "soundSet.html";
                        top.jumpToOperatePage("index.html");
                    }
                    else if (result == "network")
                    {
                        top.g_nextHtmlPage = "networkSetting.html";
                        top.jumpToOperatePage("index.html");
                    }
                    else if (result == "picture")
                    {
                        top.g_nextHtmlPage = "userPictureSet.html";
                        top.jumpToOperatePage("index.html");
                    }
                    else if (result == "channelset")
                    {
                        top.g_nextHtmlPage = "channelSet.html";
                        top.jumpToOperatePage("index.html");
                    }
                    else if (result == "scanchannel")
                    {
                        top.g_nextHtmlPage = "channelScan.html";
                        top.jumpToOperatePage("index.html");
                    }
                    else if (result == "playchannel")
                    {
                        //
                    }
                    else if (result == "amazon")
                    {
                        //
                    }
                    else if (result == "chili")
                    {
                        //
                    }
                    else if (result == "browser")
                    {
                        //
                    }
                    else if (result == "videotab")
                    {
                        //
                    }
                    else if (result == "search")
                    {
                        //
                    }
                    else if (result == "history")
                    {
                        //
                    }
                    else if (result == "appstore")
                    {
                        //
                    }
                    else if (result == "google")
                    {
                        //
                    }
                    else if (result == "golive")
                    {
                        //
                    }
                    else if (result == "music")
                    {
                        //
                    }
                    else if (result == "esticker")
                    {
                        //
                    }
                }
                else
                {
                    //
                }
                break;
            }
			default:
				break;
		}
	};
    if("1" == g_setting.getProperty("memory.app.ui.requestPoweroff","0"))
    {
        preSTRPowerOff();
    }
    if(top.g_setting.getTopApp() == "vod.netflix")
    {
        initGingaByNetflixFlag = 1;
        appOpenFlag = 1;
        g_setting.setProperty("app.ui.currentApp","vod.netflix");
    }
    if (g_setting.tvRunningMode == 1)
    {
        bootActionTimer = setTimeout(handleBootAction, 30000);
    }
	var cecvalue = g_setting.getProperty("ro.sita.state.cec","");
	if(cecvalue != ""){
		console.log("ro.sita.state.cec  cecvalue  = " + Number(cecvalue));
		if(Number(cecvalue) != NaN)
			tcl.utils.sendTBrowserTVOSEvent(top.E_READY_TO_CHANGE_CEC, Number(cecvalue));
	}
    uploadTCastName();
}

function uploadTCastName()
{
    var mac_addr = tcl.setting.networkMACByDevice(0);
    var tCastName = "TV_0001";
    if(mac_addr != "null")
    {
        tCastName = "TV_" + mac_addr.split(":")[4] + mac_addr.split(":")[5];
    }
    tCastName += ">>0";
    console.log("zhaokun -------------------------- tCastName: " + tCastName);
    top.g_setting.sendTCastResponse(6, tCastName);
}

var updateInjectWorker;
var injectUpdated = 0;
var localInjectVersion = 0;
function updateInject(force)
{
    if (force)
    {
        injectUpdated = 0;
    }
    
    if (injectUpdated)
    {
        return;
    }
    var status = tcl.setting.networkStatus()//网络正常，状态为1，status = 1
    console.log("updateInject,the network state is " + status);
    if (!status)//如果 网络不正常
    {
        return;
    }
    var branch = g_setting.getProperty("app.browser.inject.cache", "0");
    if (branch==0)
    {
        branch = 1;
    }
    else if (branch==1)
    {
        branch = 2;
    }
    else if (branch==2)
    {
        branch = 1;
    }
    if (!updateInjectWorker)
    {
        updateInjectWorker = new Worker("tbrowserConfigDownload.js");
        updateInjectWorker.onmessage = function (event) {
            var cc = JSON.parse(event.data);
            if (cc.action=="checkVersion")
            {
                if (parseInt(cc.version) > parseInt(localInjectVersion))
                {
                    if (cc.version!=localStorage.getItem("TbrowserConfigVersion"))
                    {
                        updateInjectWorker.postMessage("updateConfig("+branch+")");
                    }
                }
            }
            else if (cc.action=="updateConfig")
            {
                localStorage.setItem("TbrowserConfigVersion",cc.version);
                g_setting.setProperty("app.browser.inject.cache", branch);
            }
            else if (cc.action=="requestFile")
            {
                var subp = "inject";
                if (branch==2)
                {
                    subp = "inject1";
                }
                var s = cc.url.indexOf("/");
                tcl.utils.saveFileEx("/data/tbrowser/"+subp+"/"+cc.url.substring(0,cc.url.indexOf("/"))+"/",cc.url.substring(cc.url.indexOf("/")+1,cc.url.length),cc.data);
            }
        };
    }
    var xhr = new XMLHttpRequest();

    xhr.open("GET","/system/tbrowser/config/inject/inject_file_list.json",true);
    xhr.onreadystatechange = function ()
    {
        if (xhr.readyState==4 && xhr.status==200)
        {
            var cc = JSON.parse(xhr.responseText);
            localInjectVersion = cc.version;
            if (parseInt(localInjectVersion) > parseInt(localStorage.getItem("TbrowserConfigVersion")))
            {
                g_setting.setProperty("app.browser.inject.cache", 0);
            }
            updateInjectWorker.postMessage("checkVersion()");
        }
    }
    xhr.send();
    
    injectUpdated = 1;
}

var uploadWorker;
function uploadForLauncher(data)
{
    if (!uploadWorker)
    {
        uploadWorker = new Worker("uploadForLauncher.js");
        uploadWorker.onmessage = function (event) {
            var cc = JSON.parse(event.data);
            if (cc.action=="getUploadPeriod")
            {
                uploadPeriod = cc.period*1000;
                clearInterval(uploadTimer);
                uploadTimer = setInterval("uploadData()", uploadPeriod);
            }
        };
    }
    uploadWorker.postMessage(data);
}

function startUpload(force)
{
    if (g_setting.getProperty("ro.sita.model.Apps.launcher_server","0") == "null")
    {
        // 没有配置 launcher 运营更新
        return;
    }
    
	if(top.g_factory.factoryHotkey == 1)//工厂菜单factory menu 下factory hotkey 属性，0 off,1 on
	{
		//P模式打开时，不需要上报
		return;
	}
	
    if (force)
    {
        // 强制重新获取上报周期
        periodUploaded = 0;
    }
    
    if (periodUploaded)
    {
        // 已获取上报周期
        return;
    }
        
    var status = tcl.setting.networkStatus();//网络正常，状态为1，status = 1
    console.log("startUpload,the network state is " + status);
    if (!status)//如果 网络不正常
    {
        return;
    }
    uploadForLauncher("getUploadPeriod('"+ prefixUrl +"')");
    clearInterval(uploadTimer);
    uploadTimer = setInterval("uploadData()", uploadPeriod);
    periodUploaded = 1;
}

var endPointEnabled;
var endPointExplicit;
function powerOnCount()
{
    console.log("ldc *** powerOnTimes = "+ g_setting.getProperty("powerOnTimes","0"));
    if (g_setting.getProperty("powerOnTimes","0") === '[object Undefined]')
    {
        g_setting.setProperty("powerOnTimes","0");
    }

    if (g_setting.getProperty("powerOnTimes","0") == "7")
        return;
    var lastCount;

    lastCount = parseInt(g_setting.getProperty("powerOnTimes","0"));

    g_setting.setProperty("powerOnTimes",lastCount+1);
    console.log("ldc *** new powerOnTimes is "+g_setting.getProperty("powerOnTimes","0"));
}
var isOptInShow = 0;
function jumpOptInPage(page)
{
    console.log("ldc *** show OptIn Page");
    clearMyTimeout();
    closePage($("operatePage"));
    closePage($("otherPage"));

    $("otherPage").src = page;
    top.requestFocus(top.otherPage, 0);
    setFrameFocusPage("otherPage");
    isOptInShow = 1;
}
function showoptInNetworkSetup()
{
    var powerOnTimes = g_setting.getProperty("powerOnTimes","0");
    var upgradeFlag = isUpgrade();

    console.log("ldc *** optInFlag= "+g_setting.getProperty("optInFlag","false")+" upgradeFlag="+upgradeFlag+" powerOnTimes= "+powerOnTimes+" endPointEnabled="+endPointEnabled+" endPointExplicit="+endPointExplicit);

    if (g_setting.getProperty("optInFlag","false") == "true" || ((endPointExplicit && endPointEnabled) == false && (powerOnTimes == 3||powerOnTimes == 6)) || upgradeFlag )
    {
        g_setting.setProperty("optInFlag","false");

        if(powerOnTimes == 3)
            g_setting.setProperty("powerOnTimes","4");
        if (powerOnTimes == 6)
            g_setting.setProperty("powerOnTimes","7");
        if (upgradeFlag)
            jumpOptInPage("optInFirmwareUpdate.html");
        else
            jumpOptInPage("optInNetworkSetup.html");
    }
}

function getEndPoint()
{
    console.log("ldc get endpoint!!!");
    var xmlHttpReq;
    xmlHttpReq=new XMLHttpRequest();
    var EndpointUrl = "http://127.0.0.1:8080/acr_enabled?s=mfg";

    xmlHttpReq.open('GET', EndpointUrl, true);
    xmlHttpReq.onreadystatechange =function () {
        if (xmlHttpReq.readyState==4 && xmlHttpReq.status==200)
        {
            console.log("ldc get endpoint success!!!");

            responseT = xmlHttpReq.responseText;

            try
            {
                var jsonobj=JSON.parse(responseT);//需要增加异常处理
            }
            catch (e)
            {
                console.log("JSON.parse exception: "+e);
                return;
            }
            console.log("ldc get enabled : " + jsonobj.enabled+"get explicit : "+jsonobj.explicit);
            endPointEnabled = jsonobj.enabled;
            endPointExplicit = jsonobj.explicit;
            if(!endPointEnabled)//确保拿到了EndPoint，并且没有enable过,才去计数和show
            {
                powerOnCount();
                showoptInNetworkSetup();
            }
        }
    };
    xmlHttpReq.send();
}
var optInStarted = 0;
function startOptIn()
{
    if(optInStarted) //为开机联网后只执行一次做标记
        return;
    getEndPoint();
    optInStarted =1;
}

/** 根据软件版本号的改变，判断是否升级过软件**/
function isUpgrade()
{
    var sw = tcl.factory.getProductInfo().swName;
    console.log("ldc *** softwareVersion= "+g_setting.getProperty("softwareVersion","0") +" sw= "+sw+" resetShopFlag= "+g_setting.getProperty("resetShopFlag","0"));

    if (g_setting.getProperty("softwareVersion","0") == "0")
    {
        if (g_setting.getProperty("resetShopFlag","0") == "1")//复位的情况
        {
            g_setting.setProperty("resetShopFlag", "0");
            g_setting.setProperty("softwareVersion",sw);
        }

        else//旧软件升级到新软件的情况
        {
            g_setting.setProperty("powerOnTimes","1");//升级新软件后，将powerOnTimes复位，重新执行第三次/第五次弹出optin page的逻辑
            g_setting.setProperty("softwareVersion",sw);
            return 1;
        }

    }

    if (g_setting.getProperty("softwareVersion","0") != sw)//新软件之间的升级
    {
        g_setting.setProperty("softwareVersion",sw);
        g_setting.setProperty("powerOnTimes","1");//升级新软件后，将powerOnTimes复位，重新执行第三次/第五次弹出optin page的逻辑
        return 1;
    }
    else
        return 0;
}
var launcherLoaded = 0;
function preloadLauncher(force)
{
    if (g_setting.getProperty("ro.sita.model.Apps.launcher_server","0") == "null")
    {
        // 没有配置 launcher 运营更新
        return;
    }
    
	if(top.g_factory.factoryHotkey == 1)//工厂菜单factory menu 下factory hotkey 属性，0 off,1 on
	{
		//P模式打开时，不需要下载并更新Launcher模板
		return;
	}
	
    if (force)
    {
        // 强制更新,一般是换语言,换国家,STR开机,需要强制更新
        launcherLoaded = 0;
    }
    
    if (launcherLoaded)
    {
        // 已更新过
        return;
    }
        
    var status = tcl.setting.networkStatus();//网络正常，状态为1，status = 1
    console.log("UI will preload Launcher,the network state is " + status);
    if (!status)//如果 网络不正常
    {
        return;
    }

    initDownLoadEnvironment();
    DownloadCacheFiles();
    launcherLoaded = 1;
}

function initDownLoadEnvironment()
{
	console.log("---initDownLoadEnvironment---");
	
	var uiFormTest = g_setting.getProperty("app.ui.testserver","0");
	console.log("---uiFormTest---"+uiFormTest);
	if(uiFormTest == 0)//正式服务器
	{
		prefixUrl = "https://europe.tcllauncher.com/api/v2";
	}
	else if(uiFormTest == 1)//测试服务器
	{
		prefixUrl = "https://hwlauncher-t.api.my7v.com/api/v2";
	}
	else
	{
		prefixUrl = "https://europe.tcllauncher.com/api/v2";
	}
	console.log("---prefixUrl---"+prefixUrl);
	//1、清空数组
	ajaxCount = 0;
	statusCode = "normal";
	picRepetition = false;
	
	filesArray = [];//所有的通过ajax请求的URL，包括html、js、css
	picArray = [];//所有的需要的图片
	//2、清空map
	map.clear(); //md5的map
	console.log("-MD5-map.size()--"+map.size());
	ajaxArrayPool.clear();
	//3、停止请求ajax
	var tempAjaxArr = ajaxMap.getKeysArray();
	console.log("--tempAjaxArr.length--"+tempAjaxArr.length);
	for(var i = 0;i<tempAjaxArr.length;i++)
	{
		console.log("--abort ajaz--"+tempAjaxArr[i]);
		ajaxMap.get(tempAjaxArr[i]).abort();
	}
	ajaxMap.clear();
	//4、停止图片下载
	tcl.utils.stopCacheLauncher();
}

function DownloadCacheFiles()
{
	var launcherID = getlauncherId();
	
	if(launcherID != "null")//如果launcherID已存在
	{
		downLoadFiles();
	}
	else
	{
		checkLauncherID();//获取launcherID，此为：出厂第一次，或者清了缓存
	}
}

//去服务器获取最新的LauncherID
function checkLauncherID()
{
	xmlHttpReq=new XMLHttpRequest();
    
    var tarGeturl = prefixUrl+"/device/getlauncherid";//请求launcherid的url
    
    tarGeturl = addUrlParam(tarGeturl,"client_type",getClientType());
    tarGeturl = addUrlParam(tarGeturl,"device_id",getDeviceId());
    tarGeturl = addUrlParam(tarGeturl,"mac",getMac());
    tarGeturl = addUrlParam(tarGeturl,"language",getLanguage());
    tarGeturl = addUrlParam(tarGeturl,"dnum",getDnum());
    tarGeturl = addUrlParam(tarGeturl,"timezone",getTimeZone());
    tarGeturl = addUrlParam(tarGeturl,"app_version","1.0");
    tarGeturl = addUrlParam(tarGeturl,"sys_version",tcl.factory.getProductInfo().swName);
    tarGeturl = addUrlParam(tarGeturl,"zone",getZone());

    tarGeturl = addUrlParam(tarGeturl,"video_provider",getVideoProvider());
    tarGeturl = addUrlParam(tarGeturl,"ip_resolve_flag",getIpResolveFlag());
    tarGeturl = addUrlParam(tarGeturl,"param",new Date().getTime());
    xmlHttpReq.open("GET",tarGeturl,true);
    xmlHttpReq.onreadystatechange=getLauncherIDText;//发送事件后，收到信息了调用函数
    xmlHttpReq.send();
}

//得到服务器返回的内容--launcherID
function getLauncherIDText()
{
    if (xmlHttpReq.readyState==4 && xmlHttpReq.status==200)
    {
        var responseT = xmlHttpReq.responseText;
        try
        {
            var jsonobj=JSON.parse(responseT);//需要增加异常处理
        }
        catch (e)
        {
            console.log("JSON.parse exception: "+e);
            return;
        }

        launcher_id = jsonobj.launcher_id;
            
        if(launcher_id!=undefined&&launcher_id!="undefined"&&launcher_id!=""&&launcher_id!=null)
        {
            g_setting.setProperty("app.ui.launcherId",launcher_id);
            downLoadFiles();
        }
            
    }
}





var baseUrlForLauncher;


function downLoadFiles()
{
	tcl.utils.initCacheLauncher();
	var baseUrlFlag = g_setting.getProperty("app.ui.launcher.cache","0");
		
	if(baseUrlFlag == "0")//默认为0，此时没有任何缓存，此次第一次下载，内容放在launcher下
	{
		baseUrlForLauncher = "file:///data/launcher/";
		tcl.utils.md5sum(1);//更新生成一下md5.txt,防止发生异常时，md5.txt与本地图片不匹配
	}
	else if(baseUrlFlag == "1")//为1，表示之前已有缓存，且上次缓存位置为launcher，此次下载，内容放在launcher1下
	{
		baseUrlForLauncher = "file:///data/launcher1/";
		tcl.utils.md5sum(2);//更新生成一下md5.txt,防止发生异常时，md5.txt与本地图片不匹配
	}
	else if(baseUrlFlag == "2")//为2，表示之前已有缓存，且上次缓存位置为launcher1，此次下载，内容放在launcher下
	{
		baseUrlForLauncher = "file:///data/launcher/";
		tcl.utils.md5sum(1);//更新生成一下md5.txt,防止发生异常时，md5.txt与本地图片不匹配
	}
	else//防止不清楚的错误，放在launcher下
	{
		baseUrlForLauncher = "file:///data/launcher/";
		tcl.utils.md5sum(1);//更新生成一下md5.txt,防止发生异常时，md5.txt与本地图片不匹配
	}
	
	getLocationPicMD5(baseUrlForLauncher);
		
}
var map = new Map();  
function getLocationPicMD5(url)
{
	
	var xmlHttpReq=new XMLHttpRequest();
	var tarGeturl = url+"md5.txt?time="+new Date().getTime();//请求md5的url
	
	console.log("-getLocationPicMD5-tarGeturl-:"+tarGeturl);
	
	xmlHttpReq.open("GET",tarGeturl,true);
	xmlHttpReq.onreadystatechange=function()
	{
		if (xmlHttpReq.readyState==4)
		{
			if(xmlHttpReq.status==200)
			{
				var responseText = xmlHttpReq.responseText;
				var tempArray = new Array();
				var md5PicUrlArray = new Array();
  				tempArray = responseText.split("\n");
  				for(var i = 0;i<tempArray.length;i++)
  				{
  					md5PicUrlArray = tempArray[i].split(/\s\s/);
  					map.put(md5PicUrlArray[0],md5PicUrlArray[1]);  
  				}
  				console.log("-getLocationPicMD5--map.size()--"+map.size());
  	  			 
  	  			for(var i = 0;i<map.size();i++)
  	  			{
  	  				console.log("----getLocationPicMD5------"+"key:"+map.keys[i]+"values:"+map.get(map.keys[i]));
  	  			}
  	  			
			}
			else if(xmlHttpReq.status==404)
			{
				console.log("---no found----tarGeturl-"+tarGeturl);
			}
			
			beginCache();//开始下载，从index开始
		}
		
	};
	xmlHttpReq.send();
	
} 






var statusCode = "normal";
var ajaxCount;

var filesArray  = new Array();//所有的通过ajax请求的URL，包括html、js、css
var picArray = new Array();//所有的需要的图片

var picRepetition = false;

function beginCache()
{
	var mainUrl = prefixUrl+"/layout/gethtmltpl";
    			   
    //1、拼装Url
    mainUrl = addUrlParam(mainUrl,"resolution",getResolution());
    mainUrl = addUrlParam(mainUrl,"client_type",getClientType());
    mainUrl = addUrlParam(mainUrl,"launcher_id",getlauncherId());
    mainUrl = addUrlParam(mainUrl,"dnum",getDnum());
    mainUrl = addUrlParam(mainUrl,"language",getLanguage());
    mainUrl = addUrlParam(mainUrl,"zone",getZone());
    mainUrl = addUrlParam(mainUrl,"mac",getMac());
    mainUrl = addUrlParam(mainUrl,"sys_version",tcl.factory.getProductInfo().swName);

    mainUrl = addUrlParam(mainUrl,"video_provider",getVideoProvider());
    mainUrl = addUrlParam(mainUrl,"ip_resolve_flag",getIpResolveFlag());
    mainUrl = addUrlParam(mainUrl,"param",new Date().getTime());
    
	requestUrl(mainUrl,"index.html");
    //for launcher_ui3.0由于服务器框架原因，launcher2.0的模板不能下载新增的HTML页面。通过拼接请求新增HTML页面
    var url = g_setting.getProperty("ro.sita.model.Apps.launcher_branch", "null");
    if (url.indexOf("launcher_ui3") != -1)
    {
        requestHtmlPage("recentContent");
        requestHtmlPage("apphistory");
        requestHtmlPage("recenthistory");
    }
}

function requestHtmlPage(pagename)
{
    var mainUrl = prefixUrl+"/layout/gethtmlsec";

    //1、拼装Url
    mainUrl = addUrlParam(mainUrl,"secRes", pagename);
    mainUrl = addUrlParam(mainUrl,"resolution",getResolution());
    mainUrl = addUrlParam(mainUrl,"client_type",getClientType());
    mainUrl = addUrlParam(mainUrl,"launcher_id",getlauncherId());
    mainUrl = addUrlParam(mainUrl,"dnum",getDnum());
    mainUrl = addUrlParam(mainUrl,"language",getLanguage());
    mainUrl = addUrlParam(mainUrl,"zone",getZone());
    mainUrl = addUrlParam(mainUrl,"mac",getMac());
    mainUrl = addUrlParam(mainUrl,"sys_version",tcl.factory.getProductInfo().swName);

    mainUrl = addUrlParam(mainUrl,"video_provider",getVideoProvider());
    mainUrl = addUrlParam(mainUrl,"param",new Date().getTime());

    requestUrl(mainUrl,pagename+".html");
}

var ajaxMap = new Map();
var ajaxArrayPool = new Map();

function requestUrl(url,name)
{
	
	var xmlHttpReq=new XMLHttpRequest();
	var tarGeturl = url;//请求tab的url
	if(tarGeturl.indexOf("http")==-1||hasRepeated(name))//如果发来请求的url是重复的，就移除这个，再发一次
	{
		ajaxArrayPool.remove(url);
		sendAjax();
		return ;
	}
	ajaxCount++;
	ajaxMap.put(url,xmlHttpReq);
	filesArray.push(name);
	xmlHttpReq.open("GET",tarGeturl,true);
	xmlHttpReq.onreadystatechange=function()
	{
		if (xmlHttpReq.readyState==4)
		{
			if(xmlHttpReq.status==200)
			{
				var responseText = xmlHttpReq.responseText;
				if((name=="index.html"||name=="index.js")&&responseText.indexOf("tclLauncherUpdateDate")==-1)
				{
					console.log("error-index.html");
					return;
				}
				
				try
		        {
		            var jsonobj=JSON.parse(responseText);//需要增加异常处理
		            statusCode = jsonobj.error_code;
		            console.log("statusCode:"+statusCode);
		        }
		        catch (e)
		        {
		            console.log("resource download success, "+"  url:"+url);
		        }
		        
		        if(statusCode!="normal")
		        {
		        	console.log("resource download error: "+statusCode+"  url:"+url);
                    statusCode = "normal";
		        	return ;
		        }
				
				var replaceArray = new Array();
				
				//1、替换URL
				replaceArray = analysisWeb(responseText,replaceArray,name);
				//2、替换js、css
				replaceArray = analysisJsCss(responseText,replaceArray);
				//3、替换图片
				replaceArray = analysisPicture(responseText,replaceArray);
				
				//4、保存文件
				updateAndSaveFile(responseText,replaceArray,name);//原文本、替换的信息、保存的名字
			}
			else
			{
				console.log("error on ajax: "+xmlHttpReq.status+"  url:"+url);
				return ;
			}
			
			ajaxMap.remove(url);
		    --ajaxCount;
		    console.log("--ajaxCount--"+ajaxCount);
		    sendAjax();
		    if(ajaxCount == 0)
		    {
		    	console.log("--ajaxArrayPool.size()--"+ajaxArrayPool.size());
		    	console.log("-----------------deleteUselessFile------------");
		    	deleteUselessFile();
		    	console.log("-----------------startCacheLauncher------------");
			    tcl.utils.startCacheLauncher();
		    }
		}
		
	};
	xmlHttpReq.send();
	
}  

function sendAjax()
{
    if(ajaxArrayPool.size()>0)
	{
    	var tempAjaxArr = ajaxArrayPool.getKeysArray();
    	var tempCount = tempAjaxArr.length-(5-ajaxCount);
    	if(tempCount>0)
    	{
    		for(var i = 0;i<5-ajaxCount;i++)
        	{
        		//继续解析url
				requestUrl(tempAjaxArr[i],ajaxArrayPool.get(tempAjaxArr[i]));
				ajaxArrayPool.remove(tempAjaxArr[i]);
        	}
    	}
    	else
    	{
    		for(var i = 0;i<tempAjaxArr.length;i++)
        	{
        		//继续解析url
				requestUrl(tempAjaxArr[i],ajaxArrayPool.get(tempAjaxArr[i]));
				ajaxArrayPool.remove(tempAjaxArr[i]);
        	}
    	}
    	
		
	}
}
  
//1、解析页面的网址  
function analysisWeb(responseText,replaceArray,name)
{
	
	var urlPattern = /((\.\/gethtml[^\?]*)(\?\S*))(?:'|")/g;
	do
	{
		var match = urlPattern.exec(responseText);
		if(match == null) 
		{
			break;
		}
		
		//1、得到保存的文件名
		var fileName = getParameter(match[1],"secRes");
		if(fileName == "null")
		{
			fileName = getParameter(match[1],"tab_id");
			if(fileName == "null")
			{
				console.log("-------fileName == null----return-");
				return replaceArray;
			}
		}
		
		//2、得到下载地址
		var tempUrl = match[1];
		while(tempUrl.indexOf("&amp;")!=-1)
		{
			tempUrl = tempUrl.replace("&amp;","&");
			tempUrl = tempUrl.replace(".","");
		}
					
		var tarUrl = prefixUrl+"/layout"+tempUrl;
		
		//3、替换
		replaceArray.push(match[2]);
		replaceArray.push(baseUrlForLauncher+fileName+".html");
					
		if(!isCssOrJs(name))//如果此文件不是js或css
		{
			if(ajaxCount<5)
			{
				//4、继续解析url
				requestUrl(tarUrl,fileName+".html");//继续解析网页：下载路径  保存名 
			}
			else
			{
				ajaxArrayPool.put(tarUrl,fileName+".html");
			}
			
		}
		
	}
	while(1);
	
	
	return replaceArray;
}

function isCssOrJs(name)
{
	var urlPattern = /\S*\.(js|css)$/g;
	var match = urlPattern.exec(name);
	if(match != null)//表示匹配到了js或css
	{
		console.log("-----------urlName---"+name);
		return true;
	}
	return false;
}
  
//2、解析页面中的js、css
function analysisJsCss(responseText,replaceArray)
{
	//下面循环的功能是：得到index页面的js和css的路径-----2
	var jsCssPattern =  /(http:\/\/\S*\/(\S*\.(?:js|css)))('|")/g;
				
	do
	{
		var match = jsCssPattern.exec(responseText);
		if(match == null) 
		{
			break;
		}
		
		//1、得到保存的文件名
		var fileName = match[2];
		
		//2、得到下载地址
		var tarUrl = match[1];
		
		//3、替换
		replaceArray.push(match[1]);
		replaceArray.push(baseUrlForLauncher+match[2]+"?param="+new Date().getTime());
					
		
		if(ajaxCount<5)
		{
			//4、继续解析url
			requestUrl(tarUrl,fileName);//开始请求，解析出来的js和css路径
		}
		else
		{
			ajaxArrayPool.put(tarUrl,fileName);
		}
		
	}
	while(1);
	
	return replaceArray;
}


//3、解析页面的图片
function analysisPicture(responseText,replaceArray)
{
	//下面循环的功能是：得到页面的图片的路径
	var PicPattern = /(http:\/\/\S*\/(\S*\.(?:png|jpg|bmp|gif|jpeg))(\S*=([a-zA-Z\d]+))*)/gi;	
	do
	{
		var match = PicPattern.exec(responseText);
		if(match == null) 
		{
			break;
		}
		
		//1、得到保存的文件名
		var fileName = match[2];
		
		//2、得到下载地址
		var tarUrl = match[0];
		
		//3、替换
		replaceArray.push(tarUrl);
		replaceArray.push(baseUrlForLauncher+"images/"+fileName);
		
		var picMd5 = match[4];
		
		//4、继续解析url
		request("images/"+fileName,tarUrl,picMd5);//下载图片，传参：图片名、图片路径
		
		
	}
	while(1)	
	
	return replaceArray;
}

function getSportModeType()//return: [0]simply [1]full
{
	var src1 = $('otherPage').contentWindow.location.href;
	var src2 = $('operatePage').contentWindow.location.href;
	console.log(" in framework src1 is "+src1+"src2 is "+src2);
	if("TRUE" != g_setting.getProperty("ro.sita.model.LiveTV.FullySportsMode", "FALSE"))
	{
		return 0;
	}
	//"top.g_pvr.getUsbStatus() != 1"		-> 	no usb
	//"!top.g_setting.footballMode"		-> 	sportMode is off
	//"top.g_channel.inputSource != 1"	-> 	current source is not dtv
	if(g_pvr.getUsbStatus() != 1 || !g_setting.footballMode 
		|| g_channel.inputSource != 1 || channelLock == 1 || inputLock == 1)
	{
		return 0;
	}
	else
	{
		return 1;
	}
}
  
  
function hasRepeated(url)
{
	for(var i=0;i<filesArray.length;i++)
	{
		if(filesArray[i]==url)
		{
			return true;
		}
	}
	
	return false;
}  
  
function updateAndSaveFile(responseText,replaceArray,fileName)//原文本、替换的信息、保存的名字
{
	var responseText = responseText;
	var replaceArray = replaceArray;
	var fileName = fileName;
	for(var i = 0;i<replaceArray.length;i=i+2)
	{
		responseText = responseText.replace(replaceArray[i], replaceArray[i+1]);
	}
	
	while(responseText.indexOf("./gethtmlsec?secRes=searchresult")!=-1)//有这个字符串
	{
		responseText = responseText.replace("./gethtmlsec?secRes=searchresult",baseUrlForLauncher+"searchresult.html?secRes=searchresult");
	}
	
	tcl.utils.saveFile(fileName,responseText);
}  
  
 
  

function getParameter(str,key)
{
  	var n=str.indexOf("?");
  	var urlStr=str.substring(n+1,str.length);
  	var result=urlStr.split('&amp;');

  	for(var i=0;i<result.length;i++)
  	{
  		var keyValue=result[i].toString();
  		if(keyValue.indexOf(key)==0)
  		{
  			var n2=keyValue.indexOf('=');
  			var strr=keyValue.substring(n2+1,keyValue.length);
  			return strr;
  		}
  	}
  	console.log("--getParameter fail return defaulName: null--"+key);
  	return "null";
}
  

  

function request(name,picUrl,picMd5)
{
	for(var i=0;i<picArray.length;i++)
	{
		if(picArray[i] == picUrl)
		{
			picRepetition = true;
			break;
		}
	}
	  
	if(!picRepetition)
	{
		//如果图片的md5属性没有，或者/data/launcher/md5.txt内容为空，或者没有此文件。 下载
		if(picMd5 == undefined||map.size()==0)
		{
			tcl.utils.requestFile(name,picUrl); 
		}
		else
		{
			if(map.get(picMd5) == undefined)//如果，新模板的图片的md5值，在电视中没有找到的话。 下载
			{
				tcl.utils.requestFile(name,picUrl); 
				console.log("downloadpic,There is no md5: "+name+"-----"+picUrl+"picMd5: "+picMd5);
			}
			else
			{
				if(map.get(picMd5).indexOf(name)==-1)//如果，新模板的图片的md5值，在电视中找到的话。 但是图片名不一致。 下载
				{
					tcl.utils.requestFile(name,picUrl);
					console.log("downloadpic, Although md5 has been existing but The name is different: "+name+"-----"+picUrl);
				}
				else
				{
					map.remove(picMd5);//如果，新模板的图片的md5值，在电视中找到的话。 不下载，并且在map中删除。剩余的就是用不到的图片，需要执行删除操作
					console.log("has been existing :"+name+"-----"+picUrl+"---"+map.size());
				}
				
			}
		}
		picArray.push(picUrl);
	}
	  
	picRepetition = false;
}

//接收到储存完成的通知，就开始删除
function deleteUselessFile()
{
	var tempArr = map.getKeysArray()
	for(var i = 0;i<tempArr.length;i++)
	{
		var deletePicName = map.get(tempArr[i])
		if(deletePicName!=undefined)
		{
			tcl.utils.clearCache(deletePicName);	
			console.log("-deleteUselessFile-"+deletePicName);
		}
		else
		{
			console.log("-deletePicName undefined = "+deletePicName);
		}
	}
	tcl.utils.systemSync();//完成删除之后再进行sync
}

  
function Map() 
{   
    this.keys = new Array();   
    this.data = new Object();   
       
    this.put = function(key, value) 
    {   
        if(this.data[key] == null)
        {   
            this.keys.push(key);   
        }   
        this.data[key] = value;   
    };   
       
    this.get = function(key) 
    {   
        return this.data[key];   
    };   
    
    this.size = function()
    {   
        return this.keys.length;   
    };  
    
    this.remove = function(key) 
    {   
        this.keys.remove(key);   
        this.data[key] = null;   
    }; 
       
    this.getKeysArray = function() 
    {     
        var len = this.keys.length;     
        var array = new Array(len);     
        for (var i = 0; i < len; i++) 
        {     
        	array[i] = this.keys[i];     
        }     
        return array;     
    };   
    
   //删除MAP所有元素
   this.clear = function() 
   {
	   this.keys = new Array();   
	   this.data = new Object();
   };
}   

Array.prototype.remove = function(s) 
{   
    for (var i = 0; i < this.length; i++) 
    {   
        if (s == this[i])
        {
        	this.splice(i, 1);   
        }
            
    }   
};   



function preloadForPerformance()
{
    var i = 0;
    preload[0] = new Image("images/TV-Set_icon_Source.png");
    preload[i++] = new Image("images/TV-Set_icon_Setting.png");
    preload[i++] = new Image("images/TV-Set_icon_Media.png");
    preload[i++] = new Image("images/TV-Set_icon_EPG.png"); 
    preload[i++] = new Image("images/TV-Posters_bg.png"); 
    preload[i++] = new Image("images/TV-Default-Posters.png"); 
    preload[i++] = new Image("images/TV-Set_icon_SmartTV.png"); 
    preload[i++] = new Image("images/Channel_list-Bg.png"); 
    preload[i++] = new Image("images/Bg-Pop_up_box-01.png");
    preload[i++] = new Image("images/opera_dump-1111.png");
    preload[i++] = new Image("images/nScreen_background01.png");
    preload[i++] = new Image("images/nScreen_background02.png");
    preload[i++] = new Image("images/BG_60.jpg");
    preload[i++] = new Image("images/App-Icon.png");
    preload[i++] = new Image("images/Bg-Card-2.png");
    preload[i++] = new Image("images/opera_dump-AU.png");
    preload[i++] = new Image("images/initSetup_foxxum.png");
    if (!newUI)
    {
        if (tcl.setting.manufacturer=="JVC")
        {
            preload[i++] = new Image("images/BG_TV_1080.png");
        }
        else
        {
            preload[i++] = new Image("images/BG_TV_2.png");
        }
    }
}

var background_visible = 1;
function showBackground(visible)
{
    if (visible && !background_visible)
    {
        background_visible = 1;
        //document.body.style.background = "url(images/background_3.jpg) no-repeat";
        document.body.style.background = "rgba(0,0,0,0.9)";
    }
    else if (!visible && background_visible)
    {
        background_visible = 0;
        document.body.style.background = "transparent";
    }
}

function powerOnbyNetflixPage()
{
	clearMyTimeout();
	if(top.g_channel.inputSource!=10&&top.appOpenFlag == 0)
	{
		top.lastInputSource = top.g_channel.inputSource;
		top.g_channel.inputSource = 10;
	}
	top.appOpenFlag = 1;
	$("operatePage").src = "";
	$("otherPage").src ="";
	$("main").src="channelPlay.html";
	if(initNoFocusForMain == 1)
	{
		initNoFocusForMain = 0;
	}
	else
	{
		top.requestFocus(top.main, 1);
		setFrameFocusPage("main");
	}
	menu_visible_status = 0;

	top.$("main").style.display="none";
	top.$("operatePage").style.display="none";
	top.$("otherPage").style.display="none";
	menu_visible_status = 0;
}

function jumpPage(flag)
{
	clearMyTimeout();
    $("operatePage").src = "";
    top.$('otherPage').src = "";
	timeoutFuc.timeoutEnable = 1;
    /*避免在otherpage等页面跳转回main页面时有显示main跳转前页面内容的情况*/
    $("main").onload=function(){
        if (flag)
        {
            tcl.channel.requestMute(0);
        }
        $("main").style.display = "block";
		if(dirJumpFlag == 1)
		{
			$("main").contentWindow.hideInfoAndShowRemind();
			$("main").contentWindow.keyproc(jumpKey);
			dirJumpFlag = 0;
        	//$("main").contentWindow.hideInfoForm();
		}
        $("main").onload=function(){};
    };
    if(initNoFocusForMain == 1)
    {
        initNoFocusForMain = 0;
    }
    else
    {
        top.requestFocus(top.main, 1);
        setFrameFocusPage("main");
    }
    $("main").src="channelPlay.html?changesource="+flag;
    menu_visible_status = 0;

}
function jumpHotkeyPage(page)
{
	clearMyTimeout();
	$("operatePage").src = "";
	$("main").src=page;
	
	top.requestFocus(top.main, 1);
	setFrameFocusPage("main");
}

function SettingToOhterPage(page)
{
	clearMyTimeout();
	$("operatePage").src = "";
	$("main").onload=function(){
		$("main").style.display = "block";
		$("main").onload=function(){};

	};
	$("main").src = page;
	requestFocus(top.main, 1);
	setFrameFocusPage("main");
}

function changeUrl(url)
{
    clearMyTimeout();
    top.g_temp="quickMenu";
    $("operatePage").src = "";
    $("main").src = url;
}
/*
功能描述：init时按红色键需要切换信源
参数： 
全局变量：
*/
function changeSource()
{
	//console.log("g_channel.channelProgramStatus is "+g_channel.channelProgramStatus());
	if( g_channel.channelProgramStatus() == 0)
	{
		top.g_channel.inputSource = 1;
	}
	else
	{
		var currentChannel = g_channel.getCurrentChannelInfo();
		//console.log("serviceType = "+currentChannel.serviceType);
		top.g_channel.inputSource = (currentChannel.serviceType==0)?0:1;
	}
}
/*
功能描述：需要跳转到operatePage页面处理的情况
参数：page:需要跳转到的页面（相对于framework.html页面的相对位置）
全局变量：
*/
function jumpToOperatePage(page)
{
	clearMyTimeout();
	if(top.appOpenFlag)
        top.keySetForUI(1);
	if(top.preTempPage!="homePage"&&top.preTempPage!="media"&&top.g_temp!="homePage"&&top.g_temp!="media")
	{
		$("main").src = "";
	}
	if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
		top.g_temp="quickMenu";
	$("otherPage").src = "";
	top.$("operatePage").src = page;
	top.$("operatePage").style.display = "block";
	top.requestFocus(top.operatePage, 0);
	setFrameFocusPage("operatePage");
}

/*
功能描述：从别的页面恢复到main iframe的页面index页面
参数：focusIndex:焦点编号:0 homeMenu focus,1 subMenu1 focus,2 subMenu2 focus,3 subMenu3 focus,4 subMenu4 focus
全局变量：
*/
function focusToIndexHtml(focusIndex)
{
	//contentWindow是父窗口的iframe document对象的属性，所以不能用top.main.contentWindow,而需要用document.getElementById("main").contentWindow;
	$("main").style.display = "block";
	if(focusIndex == 0)
	{
		top.requestFocus($("main").contentWindow.homeMenu, 1);
		$("main").contentWindow.setIndexFocusPage("homeMenu");
		$("main").contentWindow.$("homeMenu").contentWindow.timeoutInit()
	}
	else if(focusIndex == 1)
	{
		top.requestFocus($("main").contentWindow.subMenu1, 1);
		$("main").contentWindow.setIndexFocusPage("subMenu1");
		$("main").contentWindow.$("subMenu1").contentWindow.timeoutInit()
	}
	else if(focusIndex == 2)
	{
		top.requestFocus($("main").contentWindow.subMenu2, 1);
		$("main").contentWindow.setIndexFocusPage("subMenu2");
		$("main").contentWindow.$("subMenu2").contentWindow.timeoutInit()
	}
	else if(focusIndex == 3)
	{
		top.requestFocus($("main").contentWindow.subMenu3, 1);
		$("main").contentWindow.setIndexFocusPage("subMenu3");
		$("main").contentWindow.$("subMenu3").contentWindow.timeoutInit()
	}
	else if(focusIndex == 4)
	{
		top.requestFocus($("main").contentWindow.subMenu4, 1);
		$("main").contentWindow.setIndexFocusPage("subMenu4");
		$("main").contentWindow.$("subMenu4").contentWindow.timeoutInit()
	}
	$("operatePage").src = "";
}


/*
描述：根据输入的对话框宽高，电视分辨率宽高，相对左位移和相对上位移调整dialog的位置
参数：DiaTag：对话框的容器标签；DiaHeight,DiaWidth：对话框高和宽；WindowHeight,WindowWidth：窗口的高和宽；
offsetLeft,offsetTop：页面相对于（0,0）的相对左偏移和上偏移
*/
function showDialogPosition(DiaTag,DiaWidth,DiaHeight,WindowWidth,WindowHeight,offsetLeft,offsetTop)
{
	var topV = parseInt((WindowHeight - DiaHeight)/2 -  offsetTop,10);
	var leftV = parseInt((WindowWidth -  DiaWidth)/2 - offsetLeft,10);
	if(1 == topV%2)
	{
		topV -= 1;
	}
	if(1 == leftV%2)
	{
		leftV -= 1;
	}
	DiaTag.style.top = topV + "px";
	DiaTag.style.left = leftV + "px";
}

/*
描述：用来切换多语言js脚本
参数：m_language：语言的枚举
ENG（英语）	SPA,GLG,BAQ,EUS,CAT（西班牙）	FRE（法语）	GER（德语）	ITA（意大利语）	CZE（捷克斯洛伐克语）
SCR（塞尔维亚语或者波斯尼亚语）	DAN（丹麦语）	HUN（匈牙利语）	DUT（荷兰语）	NOR（挪威语）	POL（波兰语）
POR（葡萄牙语）	RUM（罗马尼亚语）	SLO（斯洛伐克语）	SLV（斯洛文尼亚语）	SCC（塞尔维亚语或者波斯尼亚语）	FIN（芬兰语）
SWE（瑞典语）	TUR（土耳其）	GRE（希腊语）	BUL（保加利亚语）	RUS（俄语）	LAT（拉脱维亚语）	LIT（立陶宛语）
EST（爱沙尼亚语）	UKR（乌克兰语）
English,Spanish,French,German,Italian,
Czech,Serbian,Danish,Hungarian,Dutch,
Norwegian,Polish,Portuguese,Romanian,Slovak,
Slovenian,Bosnian,Finnish,Swedish,Turkish,
Greek,Bulgarian,Russian,Latvian,Lithuanian,
Estonian,Ukrainian
*/
function doChangeMultilanguage(m_language)
{
	console.log("in doChangeMultilanguage m_language = " + m_language);
    if (m_language == 31 || m_language == 34 || m_language == 160 || m_language == 362 || m_language == 503)//HEB,PER,ARA,ARE
    {
        textDirection = "rtl";
    }
    else
    {
        textDirection = "ltr";
    }
    g_setting.setProperty("app.ui.textDirection",textDirection)
	$("translation").innerHTML = "";
	var languageSrc = "translation/";
	for(var i = 0; i < mlmLangIndex.length; i++)
	{
		if(m_language == mlmLangIndex[i])
		{
			break;
		}
	}
	if(top.isLAFlag)//current product is LA
	{
		languageSrc = languageSrc + mlmName[i]+"_LA" + ".js";
	}
	else if(top.isNAFlag)//current product is NA
	{
		if(top.isCAFlag)
			languageSrc = languageSrc + mlmName[i]+"_CA" + ".js";
		else
			languageSrc = languageSrc + mlmName[i]+"_NA" + ".js";
	}
	else
    {
        languageSrc = languageSrc + mlmName[i] + ".js";
    }
	console.log("in doChangeMultilanguage languageSrc = " + languageSrc);
	var piece = document.createElement('script');
	piece.setAttribute("type","text/javascript");//firefox
	piece.setAttribute("src",languageSrc);//firefox
	$("translation").appendChild(piece);
}
function drawDownloadRing(progress) {
	$("downloadProgressValue").innerHTML = progress + "%";
	$("downloadProgressValue").style.display="block";
    $("bgDownloadTitle").innerHTML =   top.netBGDownloadTitle;
    $("bgDownloadTitle").style.display="block";
	var outerRingRadius=70;
	var ringRadius=55;
	var canvasWidth=$("backgroundDownloadRing").width;
	var canvasHeight=$("backgroundDownloadRing").height;
	var centerX=canvasWidth/2;
	var centerY=canvasHeight/2;
	var c=$("backgroundDownloadRing");
	var ctx=c.getContext("2d");

	ctx.clearRect(0,0,canvasWidth,canvasHeight);
	// Draw outer ring
	ctx.beginPath();
	ctx.lineWidth=3;
	ctx.strokeStyle="rgba(255,255,255,0.4)";
	ctx.arc(centerX,centerY,outerRingRadius,1.5*Math.PI,3.5*Math.PI);
	ctx.stroke();
	// Draw progress Indicator
	ctx.beginPath();
	ctx.lineWidth=20;
	ctx.strokeStyle="rgba(255,255,255,0.4)";
	ctx.arc(centerX,centerY,ringRadius,1.5*Math.PI,(2*progress/100+1.5)*Math.PI);
	ctx.stroke();
}
function hideDownloadRing(){
	$("downloadProgressValue").style.display="none";
    $("bgDownloadTitle").style.display="none";
	var canvasWidth=$("backgroundDownloadRing").width;
	var canvasHeight=$("backgroundDownloadRing").height;
	var c=$("backgroundDownloadRing");
	var ctx=c.getContext("2d");

	ctx.clearRect(0,0,canvasWidth,canvasHeight);
}

function uiPauseDownloadingUpFile()
{
    console.log("framework PauseDownloadingUpFile g_isDownloading="+g_isDownloading);
    if(g_isDownloading == 1){
        g_isDownloading = 0;
        if(!g_isForceUpgrade){
            hideDownloadRing();
        }
        g_setting.pauseDownloadUpdateFile();
    }
}

function uiResumeDownloadingUpFile()
{
    g_channel.testLog("framework ResumeDownloadingUpFile g_isDownloading="+g_isDownloading);
    if(g_isDownloading == 0){
        g_isDownloading = 1;
        g_setting.restartDownloadUpdateFile();
    }
}

//check Remote Project ID Password
function enterProjIdPwd(keycode)
{
	if(setProjTimeoutId == 0)
	{
		changeProjIdPwd = "" + (keycode - 48);
		setProjTimeoutId = setTimeout("changeProjId()",10000);
	}
	else
	{
		changeProjIdPwd += (keycode - 48);
		if(changeProjIdPwd.length == 11)
		{
			//clearTimeout(setProjTimeoutId);
			//setProjTimeoutId = 0;
			changeProjId();
		}
	}
}
//062598+65(VK_MENU)+Project ID
function changeProjId()
{
	var tempPwd = 0;
	g_channel.testLog("changeProjId = " + changeProjIdPwd);
	//for erg pwd :041758+65(VK_MENU:113-48)+0+72(VK_EXIT:120-48)
	if(changeProjIdPwd == "04175865072")
	{
		//g_factory.setPvrOpenStatus(1);
		g_factory.pvrOpenStatus = 0;
		clearTimeout(setProjTimeoutId);
		setProjTimeoutId = 0;
		changeProjIdPwd = "";
		setTimeout(function(){g_factory.systemReboot()},200)
	}
	else if(changeProjIdPwd.length == 11)
	{
		//alert("changeProjIdPwd:"+changeProjIdPwd);
		tempPwd = parseInt(changeProjIdPwd,10);
		//alert("tempPwd:"+tempPwd);
		tempPwd = tempPwd -6259865000;
		//alert("tempPwd_2:"+tempPwd);
		if((tempPwd >= 0)&&(tempPwd <255))
		{
			g_factory.projectId = tempPwd;
			clearTimeout(setProjTimeoutId);
			setProjTimeoutId = 0;
			changeProjIdPwd = "";
			setTimeout(function(){g_factory.systemReboot()},200)
			//alert("projectId:"+g_factory.projectId);
		}
		else
		{
			changeProjIdPwd = "";
			clearTimeout(setProjTimeoutId);
			setProjTimeoutId = 0;
		}
	}
	else
	{
			changeProjIdPwd = "";
			clearTimeout(setProjTimeoutId);
			setProjTimeoutId = 0;
	}
}
function  timeoutMyFuc(evt)
{
	timeoutFuc.osdTimeoutEndFuc();
	timeoutFuc.osdTimeoutStartFuc();
	
	//按键回调函数处理中可能也会涉及到对timeout的开关的控制，所以子页面的开关应该放在最后面，而不受timeoutFuc.osdTimeoutStartFuc()重启timeout的影响。
	timeoutFuc.keydownFuc(evt);
}
function  timeoutMyOpFuc(evt)
{
	timeoutFuc.osdTimeoutEndFuc();
	timeoutFuc.osdTimeoutStartOpFuc();
	
	//按键回调函数处理中可能也会涉及到对timeout的开关的控制，所以子页面的开关应该放在最后面，而不受timeoutFuc.osdTimeoutStartFuc()重启timeout的影响。
	timeoutFuc.keydownFuc(evt);
}
var timeoutFuc = 
{
	timeoutEnable : 1,
	timeoutTimes  : 30,   //from 15 to 30
	timeoutTimer  : 0,
    osdTimeoutStartFuc: function ()
    {
        clearTimeout(timeoutFuc.timeoutTimer);
        timeoutFuc.timeoutTimer = 0;
        if (timeoutFuc.timeoutEnable == 1 && top.appOpenFlag == 0 && top.main.src != "channelPlay.html")
        {
            timeoutFuc.timeoutTimer = setTimeout(function ()
            {
                if (top.g_temp == "homePage" || top.g_temp == "menu")
                {
                    top.$("main").style.display = "block";
                    top.$("operatePage").src = "";
                    top.requestFocus(top.main, 1);
                    setFrameFocusPage("main");
                }
                else
                {
                    top.jumpPage();
                }
                timeoutFuc.timeoutTimes = 30;  //from 15 to 30
                timeoutFuc.timeoutTimer = 0;
            }, timeoutFuc.timeoutTimes * 1000)
        }
        if (timeoutFuc.timeoutEnable == 1 && top.appOpenFlag ==1 && top.main.src != "channelPlay.html"&&top.g_temp == "menu")
        {
            timeoutFuc.timeoutTimer = setTimeout(function ()
            {
                top.$("operatePage").src = "";
                top.resumeFocus();
		  top.setFrameFocusPage("main");	
                timeoutFuc.timeoutTimes = 30;  //from 15 to 30
                timeoutFuc.timeoutTimer = 0;
            }, timeoutFuc.timeoutTimes * 1000)
        }
    },
	osdTimeoutStartOpFuc : function(){
			clearTimeout(timeoutFuc.timeoutTimer);
			timeoutFuc.timeoutTimer=setTimeout(function(){
			top.jumpPage();
			timeoutFuc.timeoutTimes=30;  //from 15 to 30
			timeoutFuc.timeoutTimer=0;
			},timeoutFuc.timeoutTimes*1000)
	},
	osdTimeoutEndFuc : function(){
			clearTimeout(timeoutFuc.timeoutTimer);
			timeoutFuc.timeoutTimer=0;
		},
	resetValue : function (timeoutEnable,timeoutTimes,timeoutTimer){
		timeoutFuc.timeoutEnable=timeoutEnable;
		timeoutFuc.timeoutTimes=timeoutTimes;
		timeoutFuc.timeoutTimer=timeoutTimer;
	},
	keydownFuc :"",
}
function clearMyTimeout()
{
	timeoutFuc.osdTimeoutEndFuc();
}
/*
最好不要使用该函数，使用clearMyTimeout和restartTimeout就Ok
*/
function stopTimeout()
{
	timeoutFuc.timeoutEnable=0;
	timeoutFuc.osdTimeoutEndFuc();
}
function restartTimeout()
{
	timeoutFuc.timeoutEnable=1;
	timeoutFuc.osdTimeoutStartFuc();
}

/*
描述：实现弹出列表菜单初始化显示
参数：formTag：弹出列表菜单的句柄，可以用来访问里面的内容；
topOffset：菜单相对于窗口顶部的位置
leftOffset：菜单相对于窗口最左边的位置
listFormLis：formTag里面所有标签为li的集合
optionContents：所有要显示的选项的内容保存在该数组中
optionSum：选项的总个数
focusIndex：选项在菜单列表当前显示的列表中的位置，用来确定焦点位置的
positionOffset：当前显示的列表的第一个元素在整个optionContents中的位置。
*/
function initListForm(formTag,topOffset,leftOffset,listFormLis,optionContents,optionSum,focusIndex,positionOffset)
{
	//g_channel.testLog("in framework" + "," + formTag + "," + topOffset + "," + leftOffset + "," + listFormLis + "," + optionContents[0] + "," + optionSum + "," +  focusIndex + "," + positionOffset);
	var LIST_FORM_START = 10;
	var LIST_FORM_STEP = 80;
	var UP_DOWN_IMG_HEIGHT = 40;
	var MAX_OPTION_IN_ONE_PAGE = 5;
	formTag.style.top = topOffset + "px";
	formTag.style.left = leftOffset + "px";
	var listImgList = formTag.getElementsByTagName("img");
	if(optionSum > 5)
	{
		formTag.style.height = UP_DOWN_IMG_HEIGHT*2 + LIST_FORM_START + LIST_FORM_STEP*MAX_OPTION_IN_ONE_PAGE + "px";
		if(positionOffset > 0)
		{
			listImgList[0].style.display = "block";
		}
		else
		{
			listImgList[0].style.display = "none";
		}
		
		if((positionOffset + 4) >= (optionSum - 1))
		{
			listImgList[2].style.display = "none";
		}
		else
		{
			listImgList[2].style.display = "block";
		}
		
		for(i = 0; i < 5; i++)
		{
			listFormLis[i].innerHTML = optionContents[i + positionOffset];
			listFormLis[i].style.display = "block";
		}
	}
	else
	{
		formTag.style.height = LIST_FORM_START + LIST_FORM_STEP*optionSum + "px";
		listImgList[0].style.display = "none";
		listImgList[2].style.display = "none";
		for(var i = 0; i < optionSum; i++)
		{
			listFormLis[i].innerHTML = optionContents[i];
			listFormLis[i].style.display = "block";
		}
		for(var i = optionSum; i < 5; i++)
		{
			listFormLis[i].style.display = "none";
		}
	}
	formTag.style.display = "block";
	listImgList[1].style.top = focusIndex*LIST_FORM_STEP + "px";//list focus img
	doEleScrForNoOption(listFormLis, focusIndex, 0);
	//g_channel.testLog("in framework end");
}
function checkNetStatus()
{
	var  currentIp = g_setting.networkIP;
	var invalidIp = "169.254";
	console.log("currentIp="+currentIp+" "+netCheckStatus);
	try
	{
		if(currentIp.substring(0,7)==invalidIp || currentIp=="0.0.0.0")
		{
			return false;
		}
		else if(netCheckStatus==0)
		{
			return false;
		}
		else 
		{
			return true;
		}
	}catch(er)
	{
		console.log("checkNetStatus:"+er);
	}
	
}
function Log(str)
{
	console.log(str);
}
function showEsticker()
{
	if(appOpenFlag == 1 || preTempPage=="media"||top.preTempPage=="homePage")
	{
		return;
	}
	var locationValue = g_setting.location;
	if(locationValue == 1)
	{
		/*var usbList = "";
		var playUsb = "";
		//获取usb设备列表
		if (g_media.deviceStatus()) {
			usbList = g_media.getDiskListInfo();
		}
		var list;
		g_media.setMediaFileParser(g_media.getMediaFileParser());
		for(var i = 0;i < usbList.length;i++)
		{
			list = g_media.getMediaFileList(0, 2, usbList[i].path+"/TCL DEMO", 0, -1);
			if (list.length != 0) 
			{
				playUsb = usbList[i].path+"/TCL DEMO";
				break;
			};
		}
		if (playUsb != "") 
		{
			globleHBBTVClose();
			if(top.g_temp=="menu")
				top.g_temp="quickMenu";			
			top.jumpHotkeyPage("eSticker/eStickerVideo.html");
		}*/
        globleHBBTVClose();
        if(top.g_temp=="menu")
            top.g_temp="quickMenu";
        top.jumpHotkeyPage("eSticker/eStickerVideo.html");
	}
	else if(locationValue == 2)
	{
		globleHBBTVClose();
		if(top.g_temp=="menu")
			top.g_temp="quickMenu";
        var manufacturer = g_setting.getProperty("ro.sita.model.MODEL_MANUFACTURER_NAME_CFG.MANUFACTURER_NAME", "TCL");
        if (isEUFlag == 1)
		{
            if(manufacturer == "THOMSON")
            {
                top.jumpHotkeyPage("eSticker/eSticker_eu_thom.html");
            }
            else
            {
                top.jumpHotkeyPage("eSticker/eSticker_eu_tcl.html");
            }
        }
        else
        {
            if (manufacturer == "TCL")
            {
                top.jumpHotkeyPage("eSticker/eSticker_tcl.html");
            }
            else
            {
                top.jumpHotkeyPage("eSticker/eSticker.html");
            }
        }
	}
}

function stopeSticker()
{
    g_media.mediaStop(0);
    g_media.deviceExitUninit();
    g_media.toRestoreSource(0,0);
    iseStickerPlaying = 0;
    eStickerPlayingList = "";
    eStickerPlayingVideoFlag = 0;
    eStickerPlayingVideoDemoFlag = 0;
}
/*
FramePage,指定Framework页面中的Iframe的焦点页面
*/
function setFrameFocusPage(FramePage)
{
	switch(FramePage)
	{
		case "main":
			$("main").style.zIndex = 100;
			$("operatePage").style.zIndex = 1;
			$("otherPage").style.zIndex = 2;
			//$("globleShow").style.zIndex = 1000;
			$("globleShow").style.pointerEvents = "none";
			break;
		case "operatePage":
			$("main").style.zIndex = 0;
			$("operatePage").style.zIndex = 100;
			$("otherPage").style.zIndex = 2;
			//$("globleShow").style.zIndex = 1000;
			$("globleShow").style.pointerEvents = "none";
			break;
		case "otherPage":
			$("main").style.zIndex = 0;
			$("operatePage").style.zIndex = 1;
			$("otherPage").style.zIndex = 100;
			//$("globleShow").style.zIndex = 1000;
			$("globleShow").style.pointerEvents = "none";
			break;
		case "globleShow":
			$("main").style.zIndex = 0;
			$("operatePage").style.zIndex = 1;
			$("otherPage").style.zIndex = 2;
			//$("globleShow").style.zIndex = 1000;
			$("globleShow").style.pointerEvents = "auto";
			break;
		default:
			break;
	}
}

function setContext5In1Type(tmp)
{
	if(g_setting.contextOf5in1 == CONTEXT_PANEL_OPERATION)
	{
		contentBackup = tmp;
	}
	else
	{
		g_setting.contextOf5in1 = tmp;
	}
}

function panelMenu()
{
	switch(g_isMediaCenter)
	{
		case NDM_Others:
        case NDM_Device_List://go back to home or channelplay
        case NDM_Media_List:
        case NDM_VIDEO_Play:
        case NDM_Music_Play:
        case NDM_Pic_Play:
			openSetting();
			break;
		case NDM_PVR_List:
		case NDM_PVR_Play:
		case NDM_DMR_Video:
		case NDM_DMR_Music:
		case NDM_DMR_Pic:
			break;
	}
}

function panelSource()
{
	switch(g_isMediaCenter)
	{
		case NDM_Others:
        case NDM_Device_List://go back to home or channelplay
        case NDM_Media_List:
        case NDM_VIDEO_Play:
        case NDM_Music_Play:
        case NDM_Pic_Play:
			openInputSource();
			break;
		case NDM_PVR_List:
		case NDM_PVR_Play:
		case NDM_DMR_Video:
		case NDM_DMR_Music:
		case NDM_DMR_Pic:
			break;
	}
}

function panelHomePage()
{
	switch(g_isMediaCenter)
	{
		case NDM_Others:
			openHomePage();
			break;
		case NDM_Device_List://go back to home or channelplay
			top.$("main").contentWindow.toHomePage();
			break;
		case NDM_Media_List:
			top.$("main").contentWindow.toHomePage();
			break;
		case NDM_VIDEO_Play:
		case NDM_Music_Play:
		case NDM_Pic_Play:
			top.$("main").contentWindow.focusTab = top.$("main").contentWindow.DISPLAY_AREA;
			top.$("main").contentWindow.toHomePage();
			break;
		case NDM_PVR_List:
			break;
		case NDM_PVR_Play:
			break;
		case NDM_DMR_Video:
		case NDM_DMR_Music:
		case NDM_DMR_Pic:
			top.$("main").contentWindow.toBack();
			break;
	}
}

function panelGoback()
{
    tcl.setting.dispatchKey(0xF048);
    return;
	switch(g_isMediaCenter)
	{
		case NDM_Others:
			top.$("operatePage").src = "";
			top.$("otherPage").src = "";
			top.$("main").src = "channelPlay.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			break;
		case NDM_Device_List://go back to home or channelplay
			top.$("main").contentWindow.toBack();
			break;
		case NDM_Media_List:
			top.$("main").src = "deviceList.html?media";
			break;
		case NDM_VIDEO_Play:
		case NDM_Music_Play:
		case NDM_Pic_Play:
			top.$("main").contentWindow.focusTab = top.$("main").contentWindow.DISPLAY_AREA;
			top.$("main").contentWindow.toBack();
			break;
		case NDM_PVR_List:
			break;
		case NDM_PVR_Play:
			break;
		case NDM_DMR_Video:
		case NDM_DMR_Music:
		case NDM_DMR_Pic:
			top.$("main").contentWindow.toBack();
			break;
	}
}

function panelPowerOff()
{
	toPowerOff();
}

function keyPressAutoStandBy()
{
	console.log("=====> keyPressAutoStandBy update!");
	clearTimeout(top.pressKeyDownTimer);
	top.pressKeyDownTimer=0;
	top.pressKeyDownTimer=setTimeout(function(){
			try
			{
				switch(top.standByTime)
				{
					case 0:
					break;
					case 1:
					g_setting.autoStandby = top.standByTime;
					break;
					case 2:
					g_setting.autoStandby = top.standByTime;
					break;
					case 3:
					g_setting.autoStandby = top.standByTime;
					break;
					default:
					break;
				}
				//console.log("top.standByTime=="+top.standByTime);
			}
			catch(er)
			{
				g_channel.testLog(er);
			}
			top.pressKeyDownTimer=0;
		},30*1000);
}
function doElementScroll(spanList, position)
{
	setTimeout(
	function(){setScrollAttribute(spanList, position);
	setTimeout(resetScrollHtmlInner(spanList), 1);}, 1);
}
function doEleScrForNoOption(spanList, position, moveFlag)/*moveFlag :0 初始 1 down -1 up*/
{
    setTimeout(
            function ()
            {
                setScrollAttrForNoOption(spanList, position);
                setTimeout(resetScrollHtmlInner(spanList), 1);
            }, 1);
}
function clearCurrentSroll(spanList,position)
{
	setTimeout(function(){
	spanList[position].setAttribute("contentText",spanList[position].innerHTML);
	spanList[position].style.overflowX = "hidden";
	spanList[position].style.textOverflow = "ellipsis";
	setTimeout(resetScrollHtmlInner(spanList), 1);
	},1);
}
function isOverflowed(element)
{
	//console.log("isOverflowed:element.scrollWidth="+element.scrollWidth +"element.clientWidth="+element.clientWidth);
    return element.scrollWidth > element.clientWidth;
}
function setScrollAttrForNoOption(htmlTagList,focusPosition)
{
	//console.log("setScrollAttribute: htmlTagList.length="+htmlTagList.length+"focusPosition="+focusPosition);
	for(var i = 0; i < htmlTagList.length; i++)
	{
		/*var tempText = htmlTagList[i].innerHTML;*/
		htmlTagList[i].setAttribute("contentText",htmlTagList[i].innerHTML);
		if(focusPosition == i && isOverflowed(htmlTagList[i]))//如果当前焦点选项真实句子长度长于预留的长度则需要做滚动显示
		{
			htmlTagList[i].style.overflowX = "-webkit-marquee";
			htmlTagList[i].style.textOverflow = "clip";
			htmlTagList[i].style.webkitMarqueeDirection = "backwards";
			htmlTagList[i].style.webkitMarqueeStyle = "scroll";
			htmlTagList[i].style.webkitMarqueeSpeed = "fast";
			htmlTagList[i].style.webkitMarqueeIncrement = "small";
			htmlTagList[i].style.webkitMarqueeRepetition = "infinite";
			/*htmlTagList[i].innerHTML = tempText;*/
		}
		else
		{
			htmlTagList[i].style.overflowX = "hidden";
			htmlTagList[i].style.textOverflow = "ellipsis";
			/*htmlTagList[i].innerHTML = tempText;*/
			htmlTagList[i].innerHTML = "";
		}
	}
}
/*
把整个列表属性更改，如果当前焦点选项真实句子长度长于预留的长度则需要做滚动显示
htmlTagList:内容标签列表；ListLength：当前有内容的列表标签的个数；focusPosition：当前焦点选项在内容标签上的位置
*/
function setScrollAttribute(htmlTagList,focusPosition)
{
	//console.log("setScrollAttribute: htmlTagList.length="+htmlTagList.length+"focusPosition="+focusPosition);
	for(var i = 0; i < htmlTagList.length; i++)
	{
		/*var tempText = htmlTagList[i].innerHTML;*/
		htmlTagList[i].setAttribute("contentText",htmlTagList[i].innerHTML);
		if(i==0&& isOverflowed(htmlTagList[i]))
		{
		    htmlTagList[i].style.overflowX = "-webkit-marquee";
			htmlTagList[i].style.textOverflow = "clip";
			htmlTagList[i].style.webkitMarqueeDirection = "backwards";
			htmlTagList[i].style.webkitMarqueeStyle = "scroll";
			htmlTagList[i].style.webkitMarqueeSpeed = "fast";
			htmlTagList[i].style.webkitMarqueeIncrement = "small";
			htmlTagList[i].style.webkitMarqueeRepetition = "infinite";
		}
		else if(focusPosition+1 == i && isOverflowed(htmlTagList[i]))//如果当前焦点选项真实句子长度长于预留的长度则需要做滚动显示
		{
			htmlTagList[i].style.overflowX = "-webkit-marquee";
			htmlTagList[i].style.textOverflow = "clip";
			htmlTagList[i].style.webkitMarqueeDirection = "backwards";
			htmlTagList[i].style.webkitMarqueeStyle = "scroll";
			htmlTagList[i].style.webkitMarqueeSpeed = "fast";
			htmlTagList[i].style.webkitMarqueeIncrement = "small";
			htmlTagList[i].style.webkitMarqueeRepetition = "infinite";
		}
		else
		{
			htmlTagList[i].style.overflowX = "hidden";
			htmlTagList[i].style.textOverflow = "ellipsis";
		}
	}
}
/*
重新为整个列表属性更改完成的列表赋值
htmlTagList:内容标签列表；ListLength：当前有内容的列表标签的个数
*/
function resetScrollHtmlInner(htmlTagList)
{
	for(var i = 0; i < htmlTagList.length; i++)
	{
		htmlTagList[i].innerHTML = "";
		htmlTagList[i].innerHTML = htmlTagList[i].getAttribute("contentText");
	}
}

function resetFramePacking3DMode()
{
	if(g_setting.getFramePackingMode()==1)
	{
		g_setting.pic3DMode = 9;//top - bottom
		if(top.bluetoothStart==0)
		{
			top.bluetoothStart=1;
			setTimeout("g_setting.bluetoothMaster()",800);
		}
		
	}
}
var currentSubtitleModeIndex = 0;
var currentSubtitleStatus = 0;
function getCurrentSubtitleIndex()
{
	var currentChannel=g_channel.getChannelInfoByIndex(top.g_channel.currentIndex);
	var str = currentChannel.programSubtitleMode;
	str = str.substring(str.indexOf("#") + 1);
	currentSubtitleModeIndex = parseInt(str.substring(0,str.indexOf("#")),10);
	str = str.substring(str.indexOf("#") + 1);
	var subtitleModeCount = parseInt(str.substring(0,str.indexOf("#")),10);
	if(currentSubtitleModeIndex>=subtitleModeCount || currentSubtitleModeIndex==255)
	{
		currentSubtitleModeIndex = -1;
	}
	//console.log("subtitleModeCount=="+subtitleModeCount+"currentSubtitleModeIndex=="+currentSubtitleModeIndex);
}
function closeSubtitle()
{
	getCurrentSubtitleIndex();
	if(g_setting.enableSubtitle==1)
	{
		currentSubtitleStatus = 1;
	}
	else
	{
		currentSubtitleStatus = 0;
	}
	g_setting.enableSubtitle = 0;
	//console.log("I will close the subtitle");
}
function restartSubtitle()
{
	if(currentSubtitleStatus==1)
	{
		g_setting.enableSubtitle = 1;
	}
	if(currentSubtitleModeIndex==-1)
	{
		//return;
	}
	else
	{
		g_channel.setSubtitleByIndex(currentSubtitleModeIndex);
	}
	//console.log("I will open the subtitle  currentSubtitleModeIndex =="+currentSubtitleModeIndex);
}
function printfRunningTime()
{
    var runningTime = parseInt(g_setting.getRuningTime()/60);
    var year = runningTime/(365*24*60);
    var year1 = runningTime%(365*24*60);
    var month = year1/(30*60*24);
    var month1 = year1%(30*60*24);
    var day = month1/(60*24);
    var day1 = month1%(60*24);
    var hour = day1/60;
    var minute = day1%60;
    console.log("Total running time is " + Math.floor(year)+"Y/"+Math.floor(month)+"M/"+Math.floor(day)+"D "+Math.floor(hour)+":"+minute);
}

function handleVolume(distance)
{
    $('globleShow').contentWindow.initVolume();
    if(top.$('globleShow').contentWindow.volumeCount > 0)
    {
	    g_volume_visible = 1;
	    $("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
		setGlobleRemindEnable(1);
	    globleShow.focus();
	    setFrameFocusPage("globleShow");
	    startVolumeTimer();
	    $('globleShow').contentWindow.changeVolume(distance);
    }
}

function checkNetwork()
{
    if(checkNetStatus() == false)
    {
        $("operatePage").src = "";
        $("otherPage").src ="";
        $("otherPage").src="connectNetworkRemind.html";
        requestFocus(otherPage, 0);
        setFrameFocusPage("otherPage");
        return false;
    }
    return true;
}

function checkPVR()
{
    if(recordStatusFlag == 1)
    {
        g_pvr.recordStop();
        g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
        $("globleShow").contentWindow.hiddenRecord();
        pvrCurrentTime=0;
        recordStatusFlag =0;
        pvrTotalTime=2*60*60;
		
		//还需要检查待机录制的情况
		var checkBacklightState = tcl.setting.powerBacklightState;
		console.log("in checkPVR checkBacklightState is "+checkBacklightState);
		if(checkBacklightState == 0)
		{
            sendPowerModeToSamba("normal");//待机刻录时，按netflix键开机发送normal
			if(mute_status == 1)
			{
				top.$("mute").style.display = "none";
				showMute(0);
			}
			else
			{
				console.log("in checkPVR force unmute !!!");
				forceMute(0);//不管待机录制前是否静音，再次打开都需要开声音
				//g_setting.getCecMuteStatus() 为1 表示ARC在mute状态
				if(g_setting.getCecMuteStatus() == 1)
				{
					g_setting.sendCecKeyValue(top.VK_MUTE);
				}
			}
			tcl.setting.powerBacklightState = 1; //待机录制由UI关闭背光，此刻也需要UI打开背光
		}
    }
    else if(timeShiftStatusFlag == 1)
    {
		timeShiftStatusFlag = 0;
		g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
        //现在底层还没有做停止的逻辑，所以这个部分我们自己先做
        g_pvr.timeshiftStop();
        g_pvr.returnToLive();//返回实时播放页面
        //现在底层还没有做停止的逻辑，所以这个部分我们自己先做
        $("globleShow").contentWindow.hiddenTimeShift();
    }
}

function openEPG()
{
    if(g_channel.inputSource != 1 || inputLock == 1)
    {
        g_remindWord = "notAvailable";
        $("main").src = "intermediate.html";
        return;
    }
	/*NZ需求，当网络连接成功，有红色图标出来时按guide键等同于按red键*/
	var region = g_setting.getProperty("ro.sita.model.MODEL_REGION_NAME_CFG.REGION_NAME", "EU");
	console.log(" g_channel.checkhbbtvStatus() is "+g_channel.checkhbbtvStatus()+" g_setting.networkStatus() is "+g_setting.networkStatus()+" region is "+region);
    if(g_channel.checkhbbtvStatus() > 0 && g_setting.networkStatus() && region == "NZ")
	{
		g_setting.dispatchKey(0xF042);
		return ;
	}
	
    if(0/*checkNetStatus() && g_setting.guideOnSwitch == 1*/)
    {
        lastInputSource = g_channel.inputSource;
        appOpenFlag = 1;
        g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
        $("main").style.display = "none";
        $("operatePage").style.display = "none";
        $("otherPage").style.display = "none";
        $("main").src = "channelPlay.html";
        g_setting.setProperty("app.ui.currentApp","tbrowser.ipepg");
        g_ulits.openApplication("tbrowser.ipepg","http://eurepg.huan.tv/");
    }
    else
    {
		top.$("operatePage").src = "";
		top.$("otherPage").src = "";
		appOpenFlag=0;
		if(top.isNAFlag)
		{
			$("main").src = "programGuide_NA.html";
		}
		else
		{
			$("main").src = "programGuide.html";
		}
    }
}

function openSetting()
{
    if (appOpenFlag==1)
    {
        var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
        scheduleApp = SCHEDULE_SETTING;
        g_ulits.closeApplication(appname);
    }
    else
    {
        $("otherPage").src = "";
        $("operatePage").src = "index.html";
        requestFocus(operatePage, 0);
        setFrameFocusPage("operatePage");
    }
}

function openHomePage()
{
    if (appOpenFlag==1)
    {
        var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
        scheduleApp = SCHEDULE_HOMEPAGE;
        g_ulits.closeApplication(appname);
    }
    else
    {
        /*
        $("operatePage").src = "";
        $("otherPage").src = "";
        $("main").src = top.getHomepage("?tv&title");
        requestFocus(main, 1);
        setFrameFocusPage("main");
        */
        toMenu();
    }
}

function openInputSource()
{
    if (appOpenFlag==1)
    {
        var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
        scheduleApp = SCHEDULE_SOURCE;
        g_ulits.closeApplication(appname);
    }
    else
    {
        toSource();
    }
}

function openMedia()
{
    if (appOpenFlag==1)
    {
        var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
        scheduleApp = SCHEDULE_MEDIA;
        g_ulits.closeApplication(appname);
    }
    else
    {
        var usbLock = factory.usbLock;
        hotelEnable = factory.hotelEnable;
        if (g_temp == "homePage")
        {
            isFromOptionIntoUsb = 0;
        }
        else
        {
            isFromOptionIntoUsb = 1;
        }
        if((usbLock) && (hotelEnable))
        {
            top.$('main').src = "password.html?usbLock";
            top.requestFocus(top.main, 1);
        }
        else
        {
            top.$('main').src = "deviceList.html";
            top.requestFocus(top.main, 1);
        }
    }
}

function closePage(page)
{
    if (page.src != "")
        page.src = "";
}
/****shopmode 2.5需求 ****/
function systemRunning9hours()
{
    console.log("--hzm in systemRunning9hours and set isRunning9hours=1 every 9 hour");
    top.g_setting.setProperty("app.ui.isRunning9hours","1");
}
function startrecord()
{
    console.log("--hzm in startrecord!");
    top.g_setting.setProperty("app.ui.isRunning9hours","0");
    if(runningTimer)
    {
        clearTimeout(runningTimer);
    }
    runningTimer = setTimeout("systemRunning9hours()",SYSTEM_RUNNING_TIME);
}
function cancelrecord()
{
    console.log("--hzm in cancelrecord!");
    top.g_setting.setProperty("app.ui.isRunning9hours","0");
    if(runningTimer)
    {
        clearTimeout(runningTimer);
    }
}
/****shopmode 2.5需求 end****/
/**
 * 主页下Netflix STR开机会遮挡应用，此函数处理打开netflix open前的一些处理
 * **/
function PowerOnByNetflix()
{
	console.log("hevens globalHotkeyForNetflix open netflix by netflix poweron !!!");
	globleHBBTVClose();
	if(appOpenFlag == 1)
	{
		if (scheduleApp!=0)
			return;
		var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
		if(top.g_temp=="menu"||top.g_temp=="source")
		{
			top.$("operatePage").src = "";
			top.resumeFocus();
			top.setFrameFocusPage("main");
		}
		if (appname == "vod.netflix")
		{
			return;
		}
		g_ulits.closeApplication(appname);
		scheduleApp = SCHEDULE_NETFLIX;
		return;
	}
	checkPVR();
	appOpenFlag = 1;
	top.RemoteConntrolType = "Netflix";//lqt- 设置虚拟遥控器的场景类型
	closePage($("operatePage"));
	closePage($("otherPage"));
	$("main").onload = function(){
		top.$("main").style.display="none";
		top.$("operatePage").style.display="none";
		top.$("otherPage").style.display="none";
		$("main").onload =  function(){};
		setTimeout(function(){
			top.g_channel.inputSource=10;
			tcl.channel.requestMute(0);
			g_setting.sendMsgToDBC(1);
			openNetflix("poweron_netflix");
		},10);
	}
	$("main").src="channelPlay.html";
	top.requestFocus(top.main, 1);
	setFrameFocusPage("main");
	menu_visible_status = 0;
	if (top.preTempPage!="homePage" && top.g_temp!="homePage")
	{
		if (top.g_channel.inputSource != 10)
		{
			top.lastInputSource = top.g_channel.inputSource;
		}
	}
}

function globalHotkeyHandle(key)
{
    switch (key)
    {
        case VK_MENU:
        {
            //
        }
        break;
        case VK_HOME:
        {
            if(hbbtvCancelKeyOperation(VK_HOME)==true)
            {
                return;
            }
            if(top.checkNetStatus()==false)
            {
                closePage($("operatePage"));
                closePage($("otherPage"));
                $("otherPage").src="connectNetworkRemind.html";
                top.requestFocus(top.otherPage, 0);
                setFrameFocusPage("otherPage");
                return;
            }
            if(recordStatusFlag == 1)
            {
                g_pvr.recordStop();
                g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
                $("globleShow").contentWindow.hiddenRecord();
                pvrCurrentTime=0;
                recordStatusFlag =0;
                pvrTotalTime=2*60*60;
            }
            else if(timeShiftStatusFlag == 1)
            {
                //现在底层还没有做停止的逻辑，所以这个部分我们自己先做
                g_pvr.timeshiftStop();
                g_pvr.returnToLive();//返回实时播放页
                g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
                $("globleShow").contentWindow.hiddenTimeShift();
                timeShiftStatusFlag = 0;
            }
            top.appOpenFlag = 1;
            if(top.preTempPage == "media")
            {
                top.g_lastEnterType = -1;
                top.g_isMediaCenter = top.NDM_Others;
                top.g_media.mediaStop(0);
                top.g_media.deviceExitUninit();
                top.g_media.toRestoreSource(0, 0);
            }

            g_setting.contextOf5in1 = top.CONTEXT_PANEL_OPERATION;
            closePage($("operatePage"));
            closePage($("otherPage"));
            $("main").onload = function(){
                top.$("main").style.display="none";
                top.$("operatePage").style.display="none";
                top.$("otherPage").style.display="none";
                $("main").onload =  function(){};
            }
            $("main").src="channelPlay.html";
            top.requestFocus(top.main, 1);
            setFrameFocusPage("main");
            menu_visible_status = 0;
            top.lastInputSource = top.g_channel.inputSource;
			g_channel.requestInputSource(10);
            if(top.isAUFlag)
            {
                g_setting.setProperty("app.ui.currentApp","tbrowser.common");
                g_ulits.openApplication("tbrowser.common","http://5495564812.fxm6263467844.com/");
            }
			else if(isLAFlag)
			{
				g_setting.setProperty("app.ui.currentApp","tbrowser.common");
				g_ulits.openApplication("tbrowser.common","http://1577279406.fxm6263467844.com");
			}
            else
            {
                g_setting.setProperty("app.ui.currentApp","tbrowser.mmh");
                g_ulits.openApplication("tbrowser.mmh","https://5ee0c98f1dcfd0ea1049c70a166bb78b.002d734450b3be6f5d0cb4939aa0a4bc.com");
            }
        }
        break;
        case VK_OPTION:
        {
            //
        }
        break;
        case VK_GUIDE:
        {
            if (appOpenFlag == 1)
            {
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                if (appname != "tbrowser.ipepg")
                {
                    scheduleApp = SCHEDULE_EPG;
                }
                g_ulits.closeApplication(appname);
                return;
            }
            openEPG();
        }
        break;
        case VK_NETFLIX:
        {
			globleHBBTVClose();
            if(appOpenFlag == 1)
            {
                if (scheduleApp!=0)
                    return;
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                if(top.g_temp=="menu"||top.g_temp=="source")
                {
                    top.$("operatePage").src = "";
                    top.resumeFocus();
                    top.setFrameFocusPage("main");	
                }
                if (appname == "vod.netflix")
                {
                    return;
                }
                g_ulits.closeApplication(appname);
                scheduleApp = SCHEDULE_NETFLIX;
                return;
			}
            checkPVR();
            appOpenFlag = 1;
            top.RemoteConntrolType = "Netflix";//lqt- 设置虚拟遥控器的场景类型
            g_setting.setProperty("app.ui.currentApp","vod.netflix");
            closePage($("operatePage"));
            closePage($("otherPage"));
            $("main").onload = function(){
                top.$("main").style.display="none";
                top.$("operatePage").style.display="none";
                top.$("otherPage").style.display="none";
                $("main").onload =  function(){};
                setTimeout(function(){
                    top.g_channel.inputSource=10;
                    tcl.channel.requestMute(0);
                    g_setting.sendMsgToDBC(1);
                    openNetflix("hotkey");
                },10);
            }
            $("main").src="channelPlay.html";
            top.requestFocus(top.main, 1);
            setFrameFocusPage("main");
            menu_visible_status = 0;
            if (top.preTempPage!="homePage" && top.g_temp!="homePage")
            {
                if (top.g_channel.inputSource != 10)
                {
                    top.lastInputSource = top.g_channel.inputSource;
                }
            }
        }
        break;
        case VK_GLOBOPLAY:
        {
            if (checkNetwork() == false)
			{
				return;
			}
            if(appOpenFlag == 1)
            {
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                if(top.g_temp=="menu"||top.g_temp=="source")
                {
                    top.$("operatePage").src = "";
                    top.resumeFocus();
                    top.setFrameFocusPage("main");	
                }
                g_ulits.closeApplication(appname);
                scheduleApp = SCHEDULE_GLOBOPLAY;
                return;
            }
            if(top.g_channel.checkhbbtvStatus()==3)
			{
				globleHBBTVClose();
			}
            checkPVR();
            appOpenFlag = 1;
            top.RemoteConntrolType = "HbbTV";//lqt- 设置虚拟遥控器的场景类型---在channelPlay中按SmartTV快捷键进入SmartTV。
            g_setting.setProperty("app.ui.currentApp","globoSDK");
            closePage($("operatePage"));
            closePage($("otherPage"));
            $("main").onload = function(){
                top.$("main").style.display="none";
                top.$("operatePage").style.display="none";
                top.$("otherPage").style.display="none";
                $("main").onload =  function(){};
                setTimeout(function(){
                    tcl.channel.requestInputSource(10);
                    tcl.channel.requestMute(0);
                    g_setting.sendMsgToDBC(1);
                    top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
                    top.g_ulits.openApplication("tvos.globoplay.activity","");
                },10);
            };
            $("main").src="channelPlay.html";
            top.requestFocus(top.main, 1);
            setFrameFocusPage("main");
            menu_visible_status = 0;
            if (top.preTempPage!="homePage" && top.g_temp!="homePage")
            {
                if (top.g_channel.inputSource != 10)
                {
                    top.lastInputSource = top.g_channel.inputSource;
                }
            }
        }
        break;
		case VK_YOUTUBE:
		{
			if (checkNetwork() == false)
				return;
			if(appOpenFlag == 1)
			{
				var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
				if(top.g_temp=="menu"||top.g_temp=="source")
				{
					top.$("operatePage").src = "";
					top.resumeFocus();
					top.setFrameFocusPage("main");
				}
				if (appname == "tbrowser.youtube")
				{
					return;
				}
				g_ulits.closeApplication(appname);
				scheduleApp = SCHEDULE_YOUTUBE;
				return;
			}
			if(top.g_channel.checkhbbtvStatus()==3)
			{
				globleHBBTVClose();
			}
			checkPVR();
			appOpenFlag = 1;
			top.RemoteConntrolType = "HbbTV";//lqt- 设置虚拟遥控器的场景类型---在channelPlay中按SmartTV快捷键进入SmartTV。
			g_setting.setProperty("app.ui.currentApp","tbrowser.youtube");
			closePage($("operatePage"));
			closePage($("otherPage"));
			$("main").onload = function(){
				top.$("main").style.display="none";
				top.$("operatePage").style.display="none";
				top.$("otherPage").style.display="none";
				$("main").onload =  function(){};
				setTimeout(function(){
					tcl.channel.requestInputSource(10);
					tcl.channel.requestMute(0);
					g_setting.sendMsgToDBC(1);
					top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
					top.g_ulits.openApplication("tbrowser.youtube","https://www.youtube.com/tv?launch=menu&additionalDataUrl=http%3a%2f%2flocalhost%3a56789%2fapps%2fYouTube%2fdial_data");
				},10);
			}
			$("main").src="channelPlay.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			menu_visible_status = 0;
			if (top.preTempPage!="homePage" && top.g_temp!="homePage")
			{
				if (top.g_channel.inputSource != 10)
				{
					top.lastInputSource = top.g_channel.inputSource;
				}
			}
		}
			break;
        case VK_INTERNET:
        {
            if (checkNetwork() == false)
                return;
            if(appOpenFlag == 1)
            {
                var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
                if(top.g_temp=="menu"||top.g_temp=="source")
                {
                    top.$("operatePage").src = "";
                    top.resumeFocus();
                    top.setFrameFocusPage("main");	
                }
                if (appname == "tbrowser.youtube")
                {
                    return;
                }
                g_ulits.closeApplication(appname);
                scheduleApp = SCHEDULE_INTERNET;
                return;
            }
            if(top.g_channel.checkhbbtvStatus()==3)
			{
				globleHBBTVClose();
			}
            checkPVR();
            appOpenFlag = 1;
            top.RemoteConntrolType = "HbbTV";//lqt- 设置虚拟遥控器的场景类型---在channelPlay中按SmartTV快捷键进入SmartTV。
            g_setting.setProperty("app.ui.currentApp","tbrowser.browser");
            closePage($("operatePage"));
            closePage($("otherPage"));
            $("main").onload = function(){
                top.$("main").style.display="none";
                top.$("operatePage").style.display="none";
                top.$("otherPage").style.display="none";
                $("main").onload =  function(){};
                setTimeout(function(){
                    tcl.channel.requestInputSource(10);
                    tcl.channel.requestMute(0);
                    g_setting.sendMsgToDBC(1);
                    top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
                    top.g_ulits.openApplication("tbrowser.browser","http://eu.guide.huan.tv/huan123/skin/home2015List.action?skin=D1280_2015&data=GBR_mt56#");
                },10);
            }
            $("main").src="channelPlay.html";
            top.requestFocus(top.main, 1);
            setFrameFocusPage("main");
            menu_visible_status = 0;
            if (top.preTempPage!="homePage" && top.g_temp!="homePage")
            {
                if (top.g_channel.inputSource != 10)
                {
                    top.lastInputSource = top.g_channel.inputSource;
                }
            }
        }
        break;
		case VK_APPS:
		{
			if (checkNetwork() == false)
				return;
			if(appOpenFlag == 1)
			{
				var appname = g_setting.getProperty("app.ui.currentApp","tbrowser.mmh");
				if(top.g_temp=="menu"||top.g_temp=="source")
				{
					top.$("operatePage").src = "";
					top.resumeFocus();
					top.setFrameFocusPage("main");
				}
				if (appname == "tbrowser.youtube")
				{
					return;
				}
				g_ulits.closeApplication(appname);
				scheduleApp = SCHEDULE_APPS;
				return;
			}
			if(top.g_channel.checkhbbtvStatus()==3)
			{
				globleHBBTVClose();
			}
			checkPVR();
			appOpenFlag = 1;
			top.RemoteConntrolType = "HbbTV";//lqt- 设置虚拟遥控器的场景类型---在channelPlay中按SmartTV快捷键进入SmartTV。
			g_setting.setProperty("app.ui.currentApp","tbrowser.common");
			closePage($("operatePage"));
			closePage($("otherPage"));
			$("main").onload = function(){
				top.$("main").style.display="none";
				top.$("operatePage").style.display="none";
				top.$("otherPage").style.display="none";
				$("main").onload =  function(){};
				setTimeout(function(){
					tcl.channel.requestInputSource(10);
					tcl.channel.requestMute(0);
					g_setting.sendMsgToDBC(1);
					top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
					var appStoreUrl;
					if(isLAFlag)
					{
					    if("PH" == top.g_setting.getProperty("ro.sita.cfg.app.countryForUI","NULL"))
					    {
						   appStoreUrl = "http://linux.store.zeasn.com/odm/v1.1/index.html?language="+tcl.setting.menuLanguageCode+
            "&user_id="+tcl.setting.getUserId +"&client_type="+tcl.factory.getClientTypeKey();
					    }
					    else
					    {
						   appStoreUrl = "http://1022774893-odm.fxm6263467844.com";
					    }
					}
					else if(isNAFlag)
					{
						appStoreUrl = "http://5495564812-na.fxm6263467844.com/";
					}
					else
					{
						appStoreUrl = "http://1022774893-odm.fxm6263467844.com";
					}
					top.g_ulits.openApplication("tbrowser.common",appStoreUrl);
				},10);
			}
			$("main").src="channelPlay.html";
			top.requestFocus(top.main, 1);
			setFrameFocusPage("main");
			menu_visible_status = 0;
			if (top.preTempPage!="homePage" && top.g_temp!="homePage")
			{
				if (top.g_channel.inputSource != 10)
				{
					top.lastInputSource = top.g_channel.inputSource;
				}
			}
		}
		break;
        case VK_MEDIA:
        {
            console.log("---top.g_temp-----"+top.g_temp);
            var usbLock = top.g_factory.usbLock;
            var hotelEnable = top.g_factory.hotelEnable;
            if(top.g_temp=="homePage")
            {
                isFromOptionIntoUsb = 0;
                delete sessionStorage.tabListIndex;//删除launcher记忆的tab
            }
            else
            {
                isFromOptionIntoUsb = 1;
            }

            if((usbLock) && (hotelEnable))
            {
                top.$('main').src = "password.html?usbLock";
                top.main.focus();
            }  
            else
            {
                if(top.g_temp=="menu"||top.g_temp=="source")
                    top.g_temp="quickMenu";
                top.$("operatePage").src = "";
                top.$("otherPage").src = "";
                top.$('main').src = "deviceList.html";
                requestFocus(top.main, 1);
                setFrameFocusPage("main");
            }
        }
        break;
        case VK_VIRTUAL_REMOTE:
        {
        	
        }
        break;
        case VK_SOURCE:
        {
            //
        }
        break;
        default:
        {
            //
        }
        break;
    }
}

var checkTvFaultStateTimer;
var checkTime = 5000;
var tvFaultInited = 0;//0:not inition; 1: has inition;
var LONG_CONNECT_OK = 1;
var LONG_CONNECT_NO = 0;
var SHOW_NONE = -1;
var SHOW_CONNECTING = 0;
var SHOW_CONNECTED = 1;
var SHOW_DISCONNECT = 2;

function checkTVFaultLongConnectState(connect){
  // var state = g_tvfaultdiagnosis.getConnectState();
  var showType = $("globleShow").contentWindow.getTvFaultShowType();
  console.log("tvExceptionDoctors===> showType "+showType);

  if(showType == -1) {
      return;
  }

  if(connect == LONG_CONNECT_OK){//connected
     if(showType != SHOW_CONNECTED){
         $("globleShow").contentWindow.showTvFaultDiagnosisTip(SHOW_CONNECTED);
     }
  }else if(connect == LONG_CONNECT_NO){//disconnect
      if(showType != SHOW_DISCONNECT){
          $("globleShow").contentWindow.showTvFaultDiagnosisTip(SHOW_DISCONNECT);
      }
  }
}

function tvFaultNetEventProcess(){
    var showType = $("globleShow").contentWindow.getTvFaultShowType();
    console.log("tvExceptionDoctors===> tvFaultNetEventProcess:netCheckStatus"+netCheckStatus+" showType "+showType);  
    if(showType == SHOW_NONE){//not start long connect
      return;
    }
    if(netCheckStatus == 0){
      $("globleShow").contentWindow.showTvFaultDiagnosisTip(SHOW_DISCONNECT);
    }else{
       var state = g_tvfaultdiagnosis.getConnectState();
       if(state == LONG_CONNECT_NO){//disconnect, need connect auto 
           g_tvfaultdiagnosis.startLongConnect();
           $("globleShow").contentWindow.showTvFaultDiagnosisTip(SHOW_CONNECTING);
       }else{
          $("globleShow").contentWindow.showTvFaultDiagnosisTip(SHOW_CONNECTED);
       }
    }
}

var focusFrame = null;
function requestFocus(frame, sign)
{
    if (frame.src != undefined)
        console.log("requestFocus "+frame.src);
    else
        console.log("requestFocus "+frame.location);
    if (sign)
        focusFrame = frame;
    frame.focus();
}

function resumeFocus()
{
    /*if (frame.src != undefined)
        console.log("resumeFocus "+frame.src);
    else
        console.log("resumeFocus "+frame.location);
	*/
    if (focusFrame != null)
    {
        focusFrame.focus();
    }
}

function parseDtvCHNum(type, num)//for la: type[0]low 8 [1]high 8; num[]the dtv's program number
{
	var result = type ? (num >> 8) : (num & 0x00ff);
	return result;
}

function parseChNumber(obj)
{
	if(isCBFlag)
	{
		return obj.number;
	}
	else if(obj.serviceType == 1 || obj.serviceType == 2)//目前NA有EN_SERVICETYPE_RADIO需要移位显示
	{
		return (parseDtvCHNum(1, obj.number) + "." + parseDtvCHNum(0, obj.number));
	}
	else 
	{
		return obj.number;
	}
}
function getClientType()
{
    return tcl.factory.getClientTypeKey();
}

function getResolution()
{
    return "1080";
}

function getlauncherId()
{
	var launcherId = g_setting.getProperty("app.ui.launcherId", "null");
	console.log("--getlauncherId--launcherId-:"+launcherId);
	return launcherId;
    
}

function getLanguage()
{
    return tcl.setting.menuLanguageCode;
}

function getTimeZone()
{
    return tcl.setting.timeZone;
}

function getZone()
{
    return tcl.setting.zoneCode;
}


function getDeviceId()
{
    return tcl.setting.tvDeviceID;
}

function getDnum()
{
    return tcl.setting.getUserId;
}

function getMac()
{
    return tcl.setting.networkMAC;
}

function getIpResolveFlag()
{
    return g_setting.getProperty("app.ui.launcher.ip_resolve_flag","1");
}

function getVideoProvider()
{
	var videoProvider = g_setting.getProperty("ro.sita.model.Apps.video_provider","null");
	if(videoProvider=="null")
	{
		videoProvider = g_setting.getProperty("ro.sita.content.provider","null");
        if(videoProvider=="null")
        {
            return "";
        }
	}
    return videoProvider;
}

//拼装url的参数：url：url   name：参数名        value：参数内容
function addUrlParam(url,name,value)
{
    url += (url.indexOf("?") == -1 ? "?":"&");
    url += name + "=" + value;

    return url;
}

function getUploadPeriod() 
{// 获取上报时间周期
	var url = prefixUrl+"/log/getconfig?param=" + new Date().getTime();
	// 创建XMLHttpRequest对象
	var getConfigxmlHttp = new XMLHttpRequest();
	// 监听响应并进行处理
	getConfigxmlHttp.onreadystatechange = function() {
		if (getConfigxmlHttp.readyState === 4) 
        {
			if(getConfigxmlHttp.status === 200){
				var JSONobj = JSON.parse(getConfigxmlHttp.responseText);
				if (JSONobj.error_code == "1000") {
					uploadPeriod = JSONobj.upload_interval * 1000;// 秒转毫秒
                    clearInterval(uploadTimer);
                    uploadTimer = setInterval("uploadData()", uploadPeriod);
				}
			}
		}
	};

	getConfigxmlHttp.open('GET', url, true);
	getConfigxmlHttp.send();
}

function preSTRPowerOff()
{
    g_setting.setProperty("memory.app.ui.requestPoweroff","0");
	var backLightState = g_setting.powerBacklightState;
    console.log("framework test preSTRPowerOff recordStatusFlag = "+ recordStatusFlag+" backLightState is "+backLightState+" weakUpStatus is "+weakUpStatus+" powerOffStatus is "+powerOffStatus);
    //背光是关闭状态不做poweroff逻辑,待机预约录制暂时添加后面需求要修改
	//weak up is  EN_FPP_PM_WAKEUPSRC_RTC2  8 此刻是待机预约录制的唤醒
	if(1 != recordStatusFlag && timeShiftStatusFlag != 1 && backLightState == 1 && weakUpStatus != 8 && powerOffStatus == 0)
    {
        console.log("framework test preSTRPowerOff g_setting.powerOff(0)");
        g_setting.powerOff(0);
        showMute(0);
        initDownLoadEnvironment();
        console.log("framework test preSTRPowerOff tcl.factory.otherBGM = " + tcl.factory.otherBGM);
        if (tcl.factory.otherBGM != 1)
        {
            forcePowerOffTimeOutIndex = setTimeout("g_setting.powerOff(3)", 10000);
        }
    }
}

function cancelForcePowerOff()
{
    console.log("framework test cancelForcePowerOff");
    if (1 == g_setting.suspendStatus)
    {
        console.log("ldc *** send suspend2normal to samba when str power on");
        sendPowerModeToSamba("suspend2normal");
    }
    clearTimeout(forcePowerOffTimeOutIndex);
}
function closeLauncherUI()
{
	var inputSource= g_channel.inputSource;
	console.log("in framework inputSource is "+inputSource);
	tcl.channel.requestMute(0);	
	top.g_previousHtmlPage = "channelPlay.html";
	top.g_remindWord = "TvHotKey";
	top.$("main").src = "channelPlay.html";
	top.preTempPage = top.g_temp;
	top.g_temp = "quickMenu";
}

var loadTimer = 0;
var loadProgress = 1;
function showLoading()
{
    $("loadingPic").src = "images/loading/Comp 1_00000.png";
    loadProgress = 0;
    $("loading").style.display = "block";
    clearInterval(loadTimer);
    loadTimer = setInterval("loadingProgress()",50);
}

function hideLoading()
{
    clearInterval(loadTimer);
    $("loading").style.display = "none";
}

function loadingProgress()
{
    if (loadProgress>=21)
    {
        loadProgress = 0;
    }
    if (loadProgress<10)
    {
        $("loadingPic").src = "images/loading/Comp 1_0000"+loadProgress+".png";
    }
    else
    {
        $("loadingPic").src = "images/loading/Comp 1_000"+loadProgress+".png";
    }
    loadProgress++;
}

var voiceControlTimer = 0;
var voiceProgress = 1;
var voiceProgressType = 0;
var voiceControlHideTimer = 0;
function showVoiceControl(type)
{
    voiceProgress = 0;
    clearInterval(voiceControlHideTimer);
    $("voiceResult").innerText = "";
    $("voiceControl").style.display = "block";
    if (type==0)
    {
        $("voiceControlPic").style.display = "block";
        $("voiceControlPic1").style.display = "none";
        $("voiceControlPic2").style.display = "none";
        $("voiceControlPic").src = "images/voiceUI/comp0.png";
        clearInterval(voiceControlTimer);
        voiceControlTimer = setInterval("voiceControlProgress(0)",50);
    }
    else if (type==1)
    {
        $("voiceControlPic").style.display = "block";
        $("voiceControlPic1").style.display = "none";
        $("voiceControlPic2").style.display = "none";
        $("voiceControlPic").src = "images/voiceUI/comp0.png";
        clearInterval(voiceControlTimer);
        voiceControlTimer = setInterval("voiceControlProgress(1)",50);
    }
    else if (type==2)
    {
        $("voiceControlPic").style.display = "none";
        $("voiceControlPic1").style.display = "block";
        $("voiceControlPic2").style.display = "block";
        $("voiceControlPic1").src = "images/voiceUI/comp0.png";
        clearInterval(voiceControlTimer);
        voiceControlTimer = setInterval("voiceControlProgress(2)",50);
        voiceControlHideTimer = setTimeout("hideVoiceControl()",5000);
    }
}

function hideVoiceControl()
{
    clearInterval(voiceControlTimer);
    $("voiceControl").style.display = "none";
}

function voiceControlProgress(type)
{
    if (type==0)
    {
        if (voiceProgress>=75)
        {
            voiceProgress = 0;
        }
        $("voiceControlPic").src = "images/voiceUI/comp"+voiceProgress+".png";
    }
    else if (type==1)
    {
        if (voiceProgress>=33)
        {
            voiceProgress = 0;
        }
        if (voiceProgress<10)
        {
            $("voiceControlPic").src = "images/voiceUI/loading_0000"+voiceProgress+".png";
        }
        else
        {
            $("voiceControlPic").src = "images/voiceUI/loading_000"+voiceProgress+".png";
        }
    }
    else if (type==2)
    {
        if (voiceProgress>=46)
        {
            voiceProgress = 0;
        }
        if (voiceProgress<10)
        {
            $("voiceControlPic1").src = "images/voiceUI/red_0000"+voiceProgress+".png";
        }
        else
        {
            $("voiceControlPic1").src = "images/voiceUI/red_000"+voiceProgress+".png";
        }
    }
    voiceProgress++;
}

function showVoiceText(index)
{
    $("voiceResult").innerText = tcl.setting.getVoiceResult(index);
}

function uploadURL()
{
	var reportUrl = prefixUrl + "/log/upload4html";
	reportUrl = addUrlParam(reportUrl,"client_type",getClientType());
	reportUrl = addUrlParam(reportUrl,"dnum",getDnum());
	reportUrl = addUrlParam(reportUrl,"mac",getMac());
	reportUrl = addUrlParam(reportUrl,"launcher_id",getlauncherId());
	reportUrl = addUrlParam(reportUrl,"app_version","1.0");
	reportUrl = addUrlParam(reportUrl,"sys_version",tcl.factory.getProductInfo().swName);
	reportUrl = addUrlParam(reportUrl,"ip",tcl.setting.networkIP);
	reportUrl = addUrlParam(reportUrl,"param",new Date().getTime());
	
    return reportUrl;
}

function uploadData()
{
    var data = localStorage.getItem("launcherLog");
    if (!data || data.length==0)
    {
        return;
    }
    
    if (!tcl.setting.networkStatus())
    {
        if (data.length>1048576)
        {
            console.log("uploadData over 1M");
            localStorage.removeItem("launcherLog");
        }
        return;
    }

	var url = uploadURL();

    uploadForLauncher("uploadData('"+ url +"','"+ data + "')");
    localStorage.removeItem("launcherLog");
}



function checkSourceisSupport(value)
{
	if((value == 11||value == 4) && SourceSupportFlag == 1)
    {
        return false;
    }
	else
    {
        return true;
    }
}


function checkSourceProperty()
{
	var YPbPrOutput = -1;
	var AVOutput = -1;
	var str1 = g_setting.getProperty("ro.sita.model.Apps.source_support","FALSE");

	if(str1 == "FALSE")
	{
		return false;
	}
	var str2 = str1.substr(1,str1.length-2);
	var supportSource = str2.split(",");
	for(var i = 0;i < supportSource.length;i++)
	{
		if(YPbPrOutput == -1)
		{
			if("YPBPR:YPBPR" == supportSource[i] || "YPBPR:CMP" == supportSource[i])
			{
				YPbPrOutput = i;
			}
		}
		if(AVOutput == -1)
		{
			if ("YPBPR:AV" == supportSource[i]) {
				AVOutput = i;
			}
		}
		if(YPbPrOutput != -1 && AVOutput != -1)
		{
				return true;
		}
	}
	return false;
}

/*
	mode: 1  配置文件中的数据以 XX:XX 格式做解析
		  2  配置文件中的数据以 XX,XX 格式做解析
*/
/*	
	top.checkProperty("PC","ro.sita.model.Apps.source_support",1);OK
	top.checkProperty("VGA","ro.sita.model.Apps.source_support",1);FALSE
	top.checkProperty("TVB-C","ro.sita.model.Apps.tuner_type",2);OK
	top.checkProperty("TVB-D","ro.sita.model.Apps.tuner_type",2);FALSE
*/
function checkProperty(property,key,mode)
{
	switch(mode)
	{
		case 1:
			var str1 = g_setting.getProperty(key,"FALSE");
			if(str1 == "FALSE")
			{
				return false;
			}
			var str2 = str1.substr(1,str1.length-2);
			var supportSource = str2.split(",");
			for(var i = 0;i < supportSource.length;i++)
			{
				if(property == supportSource[i].split(":")[0])
				{
					switch(property)
					{
						case "ATV" :
						case "DTV" :
							sourceOptions[0] = supportSource[i].split(":")[1];
							break;
						case "AV1" :
						case "AV2" :
						case "SCART" :
							sourceOptions[1] = supportSource[i].split(":")[1];
							break;
						case "YPBPR" :
							sourceOptions[2] = supportSource[i].split(":")[1];
							break;
						case "HDMI1" :
							sourceOptions[3] = supportSource[i].split(":")[1];
							break;
						case "HDMI2" :
							sourceOptions[4] = supportSource[i].split(":")[1];
							break;
						case "HDMI3" :
							sourceOptions[5] = supportSource[i].split(":")[1];
							break;
						case "HDMI4" :
							sourceOptions[6] = supportSource[i].split(":")[1];
							break;
						case "PC" :
							sourceOptions[7] = supportSource[i].split(":")[1];
							break;
						case "USB" :
							sourceOptions[8] = supportSource[i].split(":")[1];
							break;
						default :
							break;
					}
					console.log("supportSource[i] is "+supportSource[i].split(":")[0]);
					return true;
				}	
			}
			return false;
			break;
		case 2:
			var str1 = g_setting.getProperty(key,"FALSE");
			if(str1 == "FALSE")
			{
				return false;
			}
			//var str2 = str1.substr(1,str1.length-2);
			var arry = str1.split(",");

			for(var i = 0;i < arry.length;i++)
			{
				if(property == arry[i])
				{
					return true;
				}	
			}
			return false;
			break;
		default:
			return false;
			break;
	}
}

function openZoomMenu()
{
	//timeshift下不响应切换比例模式功能
    if(timeShiftStatusFlag == 1 || g_channel.checkhbbtvStatus()==3||top.preTempPage=="media"||top.preTempPage=="homePage"||top.appOpenFlag)
    {
        return;
    }
    if(top.g_temp=="menu"||top.g_temp=="source"||top.g_temp=="sleep")
    {
        top.g_temp="quickMenu";
    }
    var source = g_channel.inputSource;
    if(recordStatusFlag == 0&& (g_channel.inputUnlockState(source)==0&&g_channel.currentSignalStatus==1&&g_setting.zoomSmallWindowsState==0)&&((source!=1 && source!=0) || (source==1&&g_channel.channelProgramStatus()==1&&top.parentalLock != 1 && top.channelLock != 1 && g_channel.currentScreenSaverMode==8) ||(source==0&&g_channel.channelProgramStatus()==1&& top.channelLock != 1)))
    {
        closePage($("operatePage"));
        closePage($("otherPage"));
        top.g_previousHtmlPage = "channelPlay.html";
        $("main").src = "zoom.html";
        top.requestFocus(top.main, 1);
        setFrameFocusPage("main");

    }
    else
    {
        closePage($("operatePage"));
        closePage($("otherPage"));
        g_remindWord = "notFunction";
        $("main").src = "intermediate.html";
        top.requestFocus(top.main, 1);
        setFrameFocusPage("main");

    }
}

var screenUpdated = true;
function enableUpdateScreen(enable)
{
    if (enable && !screenUpdated)
    {
        screenUpdated = true;
        Util.enableUpdateScreen(true);
    }
    else if (!enable)
    {
        Util.enableUpdateScreen(false);
        screenUpdated = false;
        setTimeout("enableUpdateScreen(true)",2000);
    }
}

function getSportsModeType()//return: [0]simply [1]full
{
	if("TRUE" != g_setting.getProperty("ro.sita.model.LiveTV.FullySportsMode", "FALSE"))
	{
		return 0;
	}
	//"pvr.getUsbStatus() != 1"		-> 	no usb
	//"!footballModeIndex"		-> 	sportMode is off
	//"channel.inputSource != 1"	-> 	current source is not dtv
	if(g_pvr.getUsbStatus() != 1 || !g_setting.footballMode || g_channel.inputSource != 1)
	{
		return 0;
	}
	else
	{
		return 1;
	}
}

function initTextDirection(obj)
{
    obj.document.body.style.direction = textDirection;
}

function openNetflix(by)
{
    console.log("open netflix in framework by "+ by);
	top.g_setting.setProperty("app.ui.currentApp","vod.netflix");
    if (by=="hotkey")
    {
        top.g_ulits.sendMsgToApplication("vod.netflix", 0xF063);
        top.g_ulits.sendMsgToApplication("vod.netflix", START_NETFLIX_BY_HOTKEY);
    }
    else if (by == "poweron_netflix")
    {
		top.g_ulits.openApplication("vod.netflix","source_type=19");
    }
}

function sendEvent(target, msg)
{
    console.log("send msg in framework: "+msg+" to "+target);
    top.g_ulits.sendMsgToApplication(target, msg);
}

function toSourceEx(key, value)
{
    if(hbbtvCancelKeyOperation(key)==true)
    {
        return;
    }

    if(top.g_isDownloading == 0){
        top.g_isDownloading = 1;
        top.g_setting.restartDownloadUpdateFile();
    }

    if(top.recordStatusFlag == 1)
    {
        top.$("globleShow").contentWindow.hiddenRecord();
        top.$('main').src = "pvr/Pvr.html?inputsource&1";
        return;
    }
    else if(top.timeShiftStatusFlag == 1)
    {
        top.$("globleShow").contentWindow.hiddenTimeShift();
        top.$('main').src = "pvr/timeshift.html?inputsource&1";
        return;
    }

    if((g_factory.sourceLock)&&(g_factory.hotelEnable))
    {
        $('main').src = "password.html?sourceLock";
        top.main.focus();
        setFrameFocusPage("main");
    }
    else
    {
        g_channel.inputSource = value;
        g_isShowInfoBar = 1;
        top.jumpPage();
    }
}
//无操作关机若干次后，自动转成shop模式
function powerOffToShop()
{
    var autoshopmodeValue = top.g_setting.getProperty("app.ui.autoshopmode.switch","0");
    console.log("--in powerOffToShop test autoshopmodeValue = " + autoshopmodeValue);
    if (autoshopmodeValue == 1)
    {
        var times = parseInt(top.g_setting.getProperty("app.ui.powerOffTimer","0"));
        console.log("powerOffToShop test times = "+times);
        if(times < 6)
        {
            if(times == 5)
            {
                top.g_setting.setProperty("app.ui.powerOffTimer",100);
                return "toShop";
            }
            else
            {
                top.g_setting.setProperty("app.ui.powerOffTimer",times+1);
            }
        }
        return "powerOff";
    }
    else
    {
        console.log("--in powerOffToShop and autoshopmodeValue is OFF ");
        return "powerOff";
    }
}

function openCarevision()
{
    /*if(hbbtvCancelKeyOperation(VK_HOME)==true)
    {
        return;
    }*/
    if(top.checkNetStatus()==false)
    {
        closePage($("operatePage"));
        closePage($("otherPage"));
        $("otherPage").src="connectNetworkRemind.html";
        top.requestFocus(top.otherPage, 0);
        setFrameFocusPage("otherPage");
        return;
    }
    if(recordStatusFlag == 1)
    {
        g_pvr.recordStop();
        g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
        $("globleShow").contentWindow.hiddenRecord();
        pvrCurrentTime=0;
        recordStatusFlag =0;
        pvrTotalTime=2*60*60;
    }
    else if(timeShiftStatusFlag == 1)
    {
        //现在底层还没有做停止的逻辑，所以这个部分我们自己先做
        g_pvr.timeshiftStop();
        g_pvr.returnToLive();//返回实时播放页
        g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
        $("globleShow").contentWindow.hiddenTimeShift();
        timeShiftStatusFlag = 0;
    }
    top.appOpenFlag = 1;
    if(top.preTempPage == "media")
    {
        top.g_lastEnterType = -1;
        top.g_isMediaCenter = top.NDM_Others;
        top.g_media.mediaStop(0);
        top.g_media.deviceExitUninit();
        top.g_media.toRestoreSource(0, 0);
    }

    g_setting.contextOf5in1 = top.CONTEXT_PANEL_OPERATION;
    closePage($("operatePage"));
    closePage($("otherPage"));
    $("main").onload = function(){
        top.$("main").style.display="none";
        top.$("operatePage").style.display="none";
        top.$("otherPage").style.display="none";
        $("main").onload =  function(){};
    }
    $("main").src="channelPlay.html";
    top.requestFocus(top.main, 1);
    setFrameFocusPage("main");
    menu_visible_status = 0;
    top.lastInputSource = top.g_channel.inputSource;
    g_channel.requestInputSource(10);

    g_setting.setProperty("app.ui.currentApp","tbrowser.common");
    if (g_factory.hotelEnable == 1)
    {
        g_ulits.openApplication("tvos.CommonWebApp.NoErrorPage","https://tcl.app.hotelvision.tv/");
    }
    else
    {
        g_ulits.openApplication("tvos.CommonWebApp.NoErrorPage","https://tcl.app.carevision.com/");
    }
}

function handleBootAction()
{
    bootActionTimer = 0;
    var action = g_setting.getProperty("ro.sita.model.Apps.BootAction", "null");
    console.log("------in handleBootAction() action = " + action);
    if (action != "null")
    {
        //action = JSON.parse(action);
        var list = action.split(",");
        var action_name;
        var action_method;
        var action_url;
        var action_url_hotel;
        for (var i = 0; i < list.length; i++)
        {
            console.log("------in handleBootAction() list[" + i + "] = " + list[i]);
            var list2 = list[i].split(":");
            if (list2[0] == "name")
                action_name = list2[1];
            else if (list2[0] == "method")
                action_method = list2[1];
            else if (list2[0] == "url")
                action_url = list2[1]+":"+list2[2];
            else if (list2[0] == "url_hotel")
                action_url_hotel = list2[1]+":"+list2[2];
        }
        console.log("------in handleBootAction() action_name = " + action_name + "  action_method = " + action_method + "  action_url = " + action_url + "  action_url_hotel = " + action_url_hotel);
        console.log("------in handleBootAction() networkStatus = " + g_setting.networkStatus());
        if (action_method == "openApplication" && g_setting.networkStatus())
        {
            if(top.appOpenFlag == 1)
            {
                return;
            }
            if(top.g_channel.checkhbbtvStatus()==3)
            {
                globleHBBTVClose();
            }
            top.checkPVR();
            top.appOpenFlag = 1;
            top.RemoteConntrolType = "HbbTV";
            top.g_setting.setProperty("app.ui.currentApp", action_name);
            top.$("operatePage").style.display="none";
            top.$("otherPage").style.display="none";

            top.$("main").style.display="none";
            if (top.g_channel.inputSource != 10)
            {
                top.lastInputSource = top.g_channel.inputSource;
            }

            g_setting.contextOf5in1 = top.CONTEXT_PANEL_OPERATION;
            closePage($("operatePage"));
            closePage($("otherPage"));
            $("main").onload = function(){
                top.$("main").style.display="none";
                top.$("operatePage").style.display="none";
                top.$("otherPage").style.display="none";
                $("main").onload =  function(){};
            }
            $("main").src="channelPlay.html";
            top.requestFocus(top.main, 1);
            setFrameFocusPage("main");
            menu_visible_status = 0;

            tcl.channel.requestInputSource(10);
            tcl.channel.requestMute(0);
            top.g_setting.sendMsgToDBC(1);
            top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
            if (g_factory.hotelEnable == 1)
            {
                top.g_ulits.openApplication(action_name, action_url_hotel);
            }
            else
            {
                top.g_ulits.openApplication(action_name, action_url);
            }

            top.requestFocus(top.main, 1);
            top.setFrameFocusPage("main");
            top.menu_visible_status = 0;
        }
    }
}

var DNSReported = 0;
function reportDNS(force)
{
	if(top.g_factory.factoryHotkey == 1)//工厂菜单factory menu 下factory hotkey 属性，0 off,1 on
	{
		//P模式打开时，不需要reportDNS
		return;
	}
	
    if (force)
    {
        DNSReported = 0;
    }
    
    if (DNSReported)
    {
        return;
    }
    DNSReported = 1;
	var xhr = new XMLHttpRequest();
    
    var url = "http://tv.gole.tv/index.php?m=member&c=golive&a=get_recommend&is_server=false";
    
    url = addUrlParam(url,"clienttype",getClientType());
    url = addUrlParam(url,"mac",getMac());
    url = addUrlParam(url,"language",getLanguage());
    url = addUrlParam(url,"dns",tcl.setting.networkPrimaryDNS);

    url = addUrlParam(url,"param",new Date().getTime());
    xhr.open("GET",url,true);
    xhr.onreadystatechange = function(){
        //
    };
    xhr.send();
}

var SPEECH_TYPE_SAY = 0; //将当前text加入到tts的待处理队列中
var SPEECH_TYPE_FLUSH = 1; //清除tts处理队列，立即执行语音读当前text
var lastTTSWords = null;
var ttsCleanTimer = 0;
function setTTSSay(type, words)
{
	if(undefined != words && "" != words && null != words)
	{
		var cleanTime = 600 * words.split(" ").length;	//一个单词的发音大概0.6秒
		clearTimeout(ttsCleanTimer);
		ttsCleanTimer = setTimeout(function()
		{
			lastTTSWords = null;
		},cleanTime);
	}
	if(lastTTSWords != words || words.length < 3)	//消除重复的播报 小于3是避免消除输入时间时每一位的播报
	{
		lastTTSWords = words;
		if(getLanguage() == "en")
		{
			g_setting.setTtsSay(type, words);
		}
		else
		{
			console.log("  setTTSSay  --------- not support language！！！" );
		}
	}
	else
	{
		ttsLog("lastwords=words  words="+words);
	}
}

/***
 * CA区域要求更改国家时，要去设置对应的时区
 * countryIndex 为国家代号
 * */
function setTimeZoneForCA(countryIndex)
{
	var timeZoneValue = 30;
	switch(countryIndex){
		case 136:
			//GMT -3:00
			timeZoneValue = 32;
			break;
		case 138:
		case 139:
		case 140:
		case 141:
		case 142:
		case 143:
		case 144:
		case 145:
		case 146:
		case 147:
		case 148:
		case 150:
		case 156:
		case 157:
			//GMT -4:00
			timeZoneValue = 30;
			break;
		case 55:
		case 137:
		case 149:
		case 151:
		case 153:
			//GMT -5:00
			timeZoneValue = 29;
			break;
		case 44:
		case 47:
		case 48:
		case 49:
		case 54:
		case 92:
		case 152:
			//GMT -6:00
			timeZoneValue = 28;
			break;
		case 56:
			//GMT 9:00
			timeZoneValue = 15;
			break;
		default:
			break;
	}
	console.log("setTimeZoneForCA countryIndex = " + countryIndex + "  timeZoneValue = " + timeZoneValue);
	g_setting.timeZone = timeZoneValue;
}

function ttsLog(str)
{
	console.log("---------ttstest---------"+str);
}

/*********************************************** T-Cast App Manager ***************************************************/

function getPackageName() {
    return 0;
}

function getVersionCode() {
    return 0;
}

function getVersionName() {
    return 0;
}

function getCacheSize() {
    return 0;
}

function getDataSize() {
    return 0;
}

function getCodeSize() {
    return 0;
}

function isSystemApp(value) {
    return value == 0 ? 0 : 1;
}

function getTCastFileName()
{
    var country = tcl.setting.zoneCode;
    var cType = tcl.factory.getClientTypeKey(); //Client type
    var filename;

    switch(cType)
    {
        case "TCL-AP-NT63DT-S1":
        {
            switch(country)
            {
                case "vn":
                    filename = "/system/tcast/vietnam";
                    break;
                case "th":
                    filename = "/system/tcast/thailand";
                    break;
                default:
                    filename = "/system/tcast/ap";
                    break;
            }
            break;
        }
        case "TCL-AU-NT63DT-S1":
        {
            switch(country)
            {
                case "au":
                    filename = "/system/tcast/australia";
                    break;
                default:
                    filename = "/system/tcast/ap";
                    break;
            }
            break;
        }
        case "TCL-ME-NT63DT-S1":
        {
            switch(country)
            {
                case "ru":
                    filename = "apps_nt72563_russia.xml";
                    break;
                default:
                    filename = "apps_nt72563_AP.xml";
                    break;
            }
            break;
        }
        case "TCL-LA-NT63EP-S1":
        {
            switch(country)
            {
                case "ph":
                    filename = "/system/tcast/philippines";
                    break;
                case "ar":
                    filename = "/system/tcast/argentina";
                    break;
                case "br":
                    filename = "/system/tcast/brasil";
                    break;
                default:
                    filename = "/system/tcast/la_custom";//++
                    break;
            }
            break;
        }
        case "TCL-CA-NT63EP-S1":
        {
            switch(country)
            {
                case "mx":
                case "sv":
                case "gt":
                case "ni":
                case "pa":
                case "do":
                case "cu":
                case "ht":
                case "hn":
                case "cr":
                    filename = "/system/tcast/mexico";//++
                    break;
                default:
                    filename = "/system/tcast/ca";
                    break;
            }
            break;
        }
        default:
            filename = "/system/tcast/ap";
            break;
    }

    return filename;
}

function getLocalAppsInfo() {
    var data = '[]';
    if (!tcl.utils.getData)
        return;
    var filename = getTCastFileName();
    console.log("zk --------------------------------  getTCastFileName:"+filename);
    var fav = JSON.parse(tcl.utils.getTCastData(filename, data));

    var localAppsData;
    var appname;
    var appicon;
    var issysapp;
    for (var i = 0; i < fav.length; i++) {
        appname = fav[i].name;
        appicon = fav[i].icon;
        issysapp = 0;//fav[i].issysapp;
        //console.log("zhaokun ----  sysAppName:"+appname+" ---appIcon:"+appicon+" ---isSysApp:"+issysapp);
        if(i==0){
            localAppsData = appname+"::"+appname+"::"+appicon+"::"+getVersionCode()+"::"+getVersionName()+"::"+getCacheSize()+"::"+getDataSize()+"::"+getCodeSize()+"::"+issysapp;
        }
        else{
            localAppsData = localAppsData+">"+appname+"::"+appname+"::"+appicon+"::"+getVersionCode()+"::"+getVersionName()+"::"+getCacheSize()+"::"+getDataSize()+"::"+getCodeSize()+"::"+issysapp;
        }
    }
    return localAppsData;
}

function getInstalledAppsInfo() {
    var data = '[]';
    if (!tcl.utils.getData)
        return;
    var fav = JSON.parse(tcl.utils.getData("zeasn-fav-app", data));

    var response_data;
    var appname;
    var appicon;
    var issysapp = 1;
    for (var i = 0; i < fav.length; i++) {
        var appname = fav[i].name;
        var appicon = fav[i].icon;
        //console.log("zhaokun ----  installedAppName:"+appname+" ---appIcon:"+appicon+" ---isSysApp:"+issysapp);
        if(i==0){
            response_data = appname+"::"+appname+"::"+appicon+"::"+getVersionCode()+"::"+getVersionName()+"::"+getCacheSize()+"::"+getDataSize()+"::"+getCodeSize()+"::"+issysapp;
        }
        else{
            response_data = response_data+">"+appname+"::"+appname+"::"+appicon+"::"+getVersionCode()+"::"+getVersionName()+"::"+getCacheSize()+"::"+getDataSize()+"::"+getCodeSize()+"::"+issysapp;
        }
    }

    return response_data;
}

function getAllAppsInfo() {
    var allAppsInfo;
    var devInfo = ">>>>";
    allAppsInfo = getLocalAppsInfo();

    var instApps = getInstalledAppsInfo();
    if(instApps != "null" && instApps != undefined){
        allAppsInfo = allAppsInfo+">"+instApps;
    }
    allAppsInfo = allAppsInfo+devInfo;
    console.log("zhaokun------------------allAppsInfo:"+allAppsInfo+" ---instApps:"+instApps+" ---devInfo:"+devInfo);

    return allAppsInfo;
}
/*
function getAppsIconPath()
{
    var iconPath;
    var homeUrlFlag = top.g_setting.getProperty("app.ui.launcher.cache","0");
    var uiUpdateFlag = top.g_setting.getProperty("app.ui.update","1");

    if(homeUrlFlag == "0" || uiUpdateFlag == "0" || 1 == isNewsanLauncher) //newsan launcher不进此流程
    {
        url = top.g_setting.getProperty("ro.sita.model.Apps.launcher_branch", "null");
        if (url == "null")
        {
            if ("TCL" == top.g_setting.getProperty("ro.sita.model.MODEL_MANUFACTURER_NAME_CFG.MANUFACTURER_NAME", "THOMSON"))
            {
                url = "file:///system/ui_tcl/launcher/index.html";
                iconPath = "/system/ui_tcl/launcher/";
            }
            else
            {
                url = "file:///system/ui/launcher/index.html";
                iconPath = "/system/ui/launcher/";
            }
        }
        else {
            iconPath = url.substring(7, url.length-10);
        }
    }
    else if(homeUrlFlag == "1")
    {
        url = "file:///data/launcher/index.html";
        iconPath = "/data/launcher/";
    }
    else if(homeUrlFlag == "2")
    {
        url = "file:///data/launcher1/index.html";
        iconPath = "/data/launcher1/";
    }
    else
    {
        url = "file:///system/ui/launcher/index.html";
        iconPath = "/system/ui/launcher/";
    }
    console.log("--- getAppsIconPath :"+iconPath);

    return iconPath;
}

function getAppsInfo() {
    console.log("--- getAppsInfo ---");

    var response_data = 0;
    var iconPath = getAppsIconPath();

    var container = document.getElementById('appsPage');
    var root = document;
    if (!container)
    {
        var tabs = document.getElementById("iframeDiv").getElementsByTagName("iframe");
        for (var i=0; i<tabs.length; i++)
        {
            container = tabs[i].contentWindow.document.getElementById('appsPage');
            if (container)
            {
                root = tabs[i].contentWindow.document;
                break;
            }
        }
        if (!container)
            return;
    }
    var apps = container.getElementsByClassName('appicon');
    var borders = container.getElementsByClassName('border');

    for (var i=1;i<apps.length;i++)
    {
        var icon = apps[i].getElementsByClassName("app_foreground")[0].getAttribute("src");
        //var icon = apps[i].getElementsByTagName("img")[0].getAttribute("src");
        var name = apps[i].getElementsByTagName("span")[0].innerHTML;
        // console.log("--- icon： "+icon);
        // console.log("--- name： "+name);
        // console.log("--- isSysApp： "+isSystemApp(i));

        if(i==1){
            response_data = getPackageName()+"::"+name+"::"+iconPath+icon+"::"+getVersionCode()+"::"+getVersionName()+"::"+getCacheSize()+"::"+getDataSize()+"::"+getCodeSize()+"::"+isSystemApp(i);
        }
        else{
            response_data = response_data+">"+getPackageName()+"::"+name+"::"+iconPath+icon+"::"+getVersionCode()+"::"+getVersionName()+"::"+getCacheSize()+"::"+getDataSize()+"::"+getCodeSize()+"::"+isSystemApp(i);
        }
    }
    //var devMsg = ">>mDeviceNum::mDeviceId::mDidtoken::mHuanToken::mHuanId::mDevClientType::mRegion::mTimezone::mLanguageType::mVersion::mCallID>>";
    var devMsg = ">>>>";
    var response_data = response_data+devMsg;
    //response_data = "null::::images/APP_store.png?md5=fdabd820f19a486bc1024f9df9819803::null::null::0::0::0::1>null::YouTube::images/APP_bg.png?md5=606d3cca9424a58a1ea63f54eb8523d5::null::null::0::0::0::1>>mDeviceNum::mDeviceId::mDidtoken::mHuanToken::mHuanId::mDevClientType::mRegion::mTimezone::mLanguageType::mVersion::mCallID>>";

    return response_data;
    //top.g_setting.sendTCastResponse(3, response_data);
}
*/
function sendTCastResponse() {
    var resp_data = getAllAppsInfo();
    console.log("zhaokun ---------------------resp_data:"+resp_data);
    top.g_setting.sendTCastResponse(3, resp_data);
}
function getSysAppName()
{
    var appName = arguments[0];
    switch(appName)
    {
        case "YouTube":
            appName = "youtube";
            break;
        case "Yupp TV":
            appName = "yupptv";
            break;
        case "Viewster":
            appName = "viewster-v5";
            break;
        case "Indysong Kids":
            appName = "indysong_kids";
            break;
        case "T-Browser":
            appName = "browser";
            break;
        case "Doonung Comedy":
            appName = "doonung_comedy";
            break;
        case "GMM25Thailand":
            appName = "gmm25thailand";
            break;
        case "T-Cast":
            appName = "tcast";
            break;
        case "Baeble Music":
            appName = "baeblemusic";
            break;
        case "Radioline":
            appName = "radioline";
            break;
        case "Toon Goggles":
            appName = "toongoggles-h5";
            break;
        case "Filmbox Live":
            appName = "filmboxlive";
            break;
        default:
            break;
    }
    return appName;
}

function getInstalledApp(name)
{
    var data = '[]';
    if (!tcl.utils.getData)
        return;
    var fav = JSON.parse(tcl.utils.getData("zeasn-fav-app", data));

    var appName = arguments[0];
    var appUrl;
    for (var i = 0; i < fav.length; i++)
    {
        if(appName == fav[i].name)
        {
            appUrl = fav[i].url;
            break;
        }
    }
    return appUrl;
}

function openTCastApp(name)
{
    var appName = name;
    var appUrl = getInstalledApp(name);
    if(appUrl != "null" && appUrl != undefined)
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common", appUrl);
    }
    else {
        appName = getSysAppName(name);
        if((appName == "miracast") || (appName == "emanual") || (appName == "nscreen") || (appName == "tcast"))
        {
            jumpLocalApps(appName);
        }
        else
            jumpToApp(appName);
    }
}

function jumpLocalApps(name)
{
    //delete sessionStorage.tabListIndex;
    if (name == "miracast")
    {
        top.jumpToOperatePage("networkSetting/miracast.html");
    }
    else if (name == "emanual")
    {
        top.preTempPage = "homePage";
        top.jumpToOperatePage("eManual/eManualFirst.html?0");
    }
    else if (name == "nscreen")
    {
        top.jumpToOperatePage("nScreenStart.html");
    }
    else if (name == "tcast")
    {
        top.jumpToOperatePage("tcast.html");
    }
}

function jumpToApp()
{

    var appName = arguments[0];
    if(appName !== "netflix" && top.checkNetStatus()==false)
    {
        top.$("operatePage").src="";
        top.preTempPage = "homePage";
        top.$("otherPage").src="connectNetworkRemind.html";
        top.requestFocus(top.otherPage, 0);
        top.setFrameFocusPage("otherPage");
        top.$("otherPage").style.display = "block";
        parent.onBodyBlur();
        return;
    }

    top.g_setting.scaleVideoWindow(0,0,0,0);
    sessionStorage.pipWindow = 0;
    //if (appName == "mmh")
    {
        setTimeout(function () {
            tcl.channel.requestMute(0);
        },1000);
    }

    top.appOpenFlag = 1;
    top.g_setting.contextOf5in1   = top.CONTEXT_PANEL_OPERATION;

    top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
    //top.$("main").style.display="none";
    top.main.document.body.style.display = "none";
    top.$("operatePage").style.display="none";
    top.$("otherPage").style.display="none";
    if (appName == "youtube")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.youtube");
        top.g_ulits.openApplication("tbrowser.youtube","https://www.youtube.com/tv?launch=menu&additionalDataUrl=http%3a%2f%2flocalhost%3a56789%2fapps%2fYouTube%2fdial_data");
    }else if (appName == "youtube-test")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.youtube");
        top.g_ulits.openApplication("tbrowser.youtube","http://2017.qual-e.appspot.com/");
    }else if (appName == "html-test")
    {
        tcl.channel.requestInputSource(10)
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.youtube");
        top.g_ulits.openApplication("tbrowser.youtube","http://sm.sw.tclking.com/tcl_browser_test/index.htm");
    }
    else if (appName == "mmh")
    {
        top.RemoteConntrolType = "HbbTV";//lqt- 设置虚拟遥控器的场景类型
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.mmh");
        top.g_ulits.openApplication("tbrowser.mmh","https://5ee0c98f1dcfd0ea1049c70a166bb78b.002d734450b3be6f5d0cb4939aa0a4bc.com");
    }
    else if (appName == "netflix")
    {
        top.RemoteConntrolType = "Netflix";//lqt- 设置虚拟遥控器的场景类型
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","vod.netflix");
        top.g_ulits.sendMsgToApplication("vod.netflix", 0xF063);
        top.g_ulits.sendMsgToApplication("vod.netflix",0xF042);
    }
    else if (appName == "ipla")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/270?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "golive")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.golive");
        top.g_ulits.openApplication("tbrowser.golive","http://tv.gole.tv/?clientType="+tcl.factory.getClientTypeKey()+"&language="+tcl.setting.menuLanguageCode+"&client_mac="+tcl.setting.networkMAC);
    }
    else if (appName == "browser")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.browser");
        if (localStorage.getItem("navigationURL"))
        {
            top.g_ulits.openApplication("tbrowser.browser",localStorage.getItem("navigationURL"));
        }
        else
        {
            top.g_ulits.openApplication("tbrowser.browser","http://eu.guide.huan.tv/huan123/skin/home2015List.action?skin=D1280_2015&data=GBR_mt56");
        }
    }
    else if (appName == "chili")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","https://zeasn.chili.com/");
    }
    else if (appName == "Chili-eu")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","https://zeasn.chili.com/");
    }
    else if (appName == "viewster")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://www.viewster.tv/viewster_v3/telesystem.html");
    }
    else if (appName == "viewster-foxxum")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=viewster-16");
    }
    else if (appName == "Viewster-eu")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/171?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "viewster-v5")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://www.viewster.tv/Viewster_v5/index.html?viewsterKeyboard=true");
    }
    else if (appName == "crash")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://crash.app.nrmmh.tv/live/");
    }
    else if (appName == "sbs")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://s3.tcllauncher.com/html5/SBS/indexTcl.html");
    }
    else if (appName == "yupptv")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://www.yupptv.com/tcl/index.html");
    }
    else if (appName == "foxxum")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://5495564812.fxm6263467844.com/");
    }
    else if (appName == "foxxum-la")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://9723638891.fxm6263467844.com/");
    }
    else if (appName == "foxxum-ida")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://5495564812-india.fxm6263467844.com/");
    }
    else if (appName == "foxxum-ap")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1577279406.fxm6263467844.com/");
    }
    else if (appName == "foxxum-nt72563-la")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://2376258617.fxm6263467844.com/");
    }
    else if (appName == "orf")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","orf");
        top.g_ulits.openApplication("orf","http://orfhbbtv.orf.apa.net/orf/tvthek/index.html?rb=false&portal=false");
    }
    else if (appName == "deezer")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.zeasn.tv/deezer_music_h5/html/");
    }
    else if (appName == "deezer-foxxum")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=deezer");
    }
    else if (appName == "deezer-eu")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.mmh");
        top.g_ulits.openApplication("tbrowser.mmh","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/55?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "deezer-ph")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.mmh");
        top.g_ulits.openApplication("tbrowser.mmh","https://tv.deezer.com/smarttv/8caf9315c1740316053348a24d25afc7/philips/");
    }
    else if (appName == "dailymotion-foxxum")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=dailymotion");
    }
    else if (appName == "dailymotion")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","https://tvapp.zeasn.tv/homepage_api/rect/dailymotion");
    }
    else if (appName == "cinetrailer")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=cinetrailer");
    }
    else if (appName == "Cinetrailer-eu")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/222?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "hellokids")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=hellokids");
    }
    else if (appName == "icflix")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://native.icflix.com/cotjnlort7gnfAsWFelr/tcl/index.html");
    }
    else if (appName == "lanacion")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://smart.lanacion.com/");
    }
    else if (appName == "EpicTV")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/58?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "epic_tv")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://www.yupptv.com/tcl/index.html");
    }
    else if (appName == "vilanoise")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=vilanoise");
    }
    else if (appName == "ToonGoggles")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/161?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "toongoggles-h5")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://html5.toongoggles.com");
    }
    else if (appName == "amazon")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.amazon");
        top.g_ulits.openApplication("tbrowser.amazon","https://atv-ext-eu.amazon.com/blast-app-hosting/html5/index.html?deviceTypeID=A3T3XXY42KZQNP&geoLocation=de");
    }
    else if (appName == "Crackle")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://crackleott.s3.amazonaws.com/svod/tcl/prod/index.html");
    }
    else if (appName == "crackle-a")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://crackleott.s3.amazonaws.com/tcl/prod/index.html");
    }
    else if (appName == "CrackleTest")//暂时给AU测试  使用
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://crackleott.s3.amazonaws.com/svod/tcl/qa/index.html?geoCode=MX");
    }
    else if (appName == "Euronews")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/62?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "euronews-zeasn")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://www.euronews.com/_partners/philips/");
    }
    else if (appName == "iConcerts")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/87?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "iconcerts")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","https://www3.iconcerts.com/tvapps/nettv/index.html");
    }
    else if (appName == "Banaxi")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/201?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "Euroleague")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/61?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "Howdini")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/81?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "Babbidiboo")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=babi");
    }
    else if (appName == "dbu")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/229?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "Deutscher-Kanu-Verband")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/232?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "Goodwood-Festival-of-Speed")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/75?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "Inside-Sailing")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/91?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "lfl")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/101?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "Mongoose-Jam")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://backend.drupal7.netrangemmh.com/netrange/v1/open_url/113?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "kodi")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.kodi");
        top.g_ulits.openApplication("tbrowser.common","http://127.0.0.1:1234/index.html");
    }
    else if (appName == "bigstar")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://preview.bigstar.tv/tcl/");
    }
    else if (appName == "bigstar-latino")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://bigstarlatino.com/tcl/");
    }
    else if (appName == "hungama")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://vizio.tvapps.hungama.com/");
    }
    else if (appName == "filmboxlive")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://www.filmboxliveapp.net/opr/tvapp/");
    }
    else if (appName == "tunein")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://tv.tunein.com/");
    }
    else if (appName == "zeasn")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://tcl.store.zeasn.com/v1.1/?language="+tcl.setting.menuLanguageCode+"&region="+tcl.setting.zoneCode+"&client_type="+tcl.factory.getClientTypeKey()+"&userid="+tcl.setting.getUserId);
    }
    else if (appName == "zeasn-scbc")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://linux.store.zeasn.com/odm/v1.1/index.html?language="+tcl.setting.menuLanguageCode+
            "&user_id="+tcl.setting.getUserId +"&client_type="+tcl.factory.getClientTypeKey());
    }
    else if (appName == "wuaki")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","https://tcl-app.wuaki.tv/");
    }
    else if (appName == "wsj")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://api-cbd.netrange.com/netrange/v1/open_url/174?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "sailing")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://api-cbd.netrange.com/netrange/v1/open_url/159?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "giong-hat-viet")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/btcgionghatvietnhi/show.html");
    }
    else if (appName == "yan_news")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/YanNewsTube/show.html");
    }
    else if (appName == "60_giay_official")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/UCRjzfa1E0gA50lvDQipbDMg/show.html");
    }
    else if (appName == "the_voice_global")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/thevoiceglobal/show.html");
    }
    else if (appName == "abs_cbn_news")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/abscbnnews/show.html");
    }
    else if (appName == "myxtv")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/myxtvusa/show.html");
    }
    else if (appName == "indysong_kids")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/indysong/show.html");
    }
    else if (appName == "doonung_comedy")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/UCNOuO6uOrpyw-hpf8pyB0eQ/show.html");
    }
    else if (appName == "gmm25thailand")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/gmmchannel/show.html");
    }
    else if (appName == "weather_nation")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://data.weathernationtv.com/apps/operatv/index.html?uid=7f377ecb70d038b4efc4181f943af986e7b53f1fd347adbd02088b2dbd487d05xweathernation");
    }
    else if (appName == "ivi")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://stb.ivi.ru");
    }
    else if (appName == "megogo")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://tcl-app.megogo.net");
    }
    else if (appName == "tvigle")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://zeasn.v4.tvigle.ru");
    }
    else if (appName == "bonus-tv")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://bonus-tv.ru:90/nettv/");
    }
    else if (appName == "adagio_tv")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.tvstore.opera.com/video_application/?bg=jpg&target_user=adagio_tv&app_id=134944#fix");
    }
    else if (appName == "tvrain")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://smarttv.tvrain.ru/");
    }
    else if (appName == "btv-tvigle")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://zeasn.btv.tvigle.ru");
    }
    else if (appName == "yandex")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common"," http://hw.yandex.ru/ph");
    }
    else if (appName == "ludo")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://smartgames.tv/SG/ludo/");
    }
    else if (appName == "see-ua")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://nettv.see.ua");
    }
    else if (appName == "meteonews")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://meteo.dotscreen.com/2.0/phg.phcehtml?utm_source=NetTV&utm_medium=portal&utm_campaign=V2");
    }
    else if (appName == "qubit")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=qubit");
    }
    else if (appName == "globo")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","globoSDK");
        top.g_ulits.openApplication("tvos.globoplay.activity","");
    }
    else if (appName == "looke")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://tcllooke.ottvs.com.br/");
    }
    else if (appName == "kidsplay")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=playkids");
    }
    else if (appName == "sbt")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=sbt");
    }
    else if (appName == "babidiboo")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://brasil.fxmconnect.com/babidiboo/app/");
    }
    else if (appName == "russia_24")//LZZV069  russia  SCBC-EU-MT5655-0PKVL
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/Russia24TV/show.html");
    }
    else if (appName == "tnt_music")//LZZV069  russia  SCBC-EU-MT5655-0PKVL
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://tntmusic.tv.infolio-lab.com/tntmusic/");
    }
    else if (appName == "radioline")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://zeasn.radioline.co/");
    }
    else if (appName == "soundcloud")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","https://apps.zeasn.tv/soundcloud_web/html/index.html?snum=TCL_v1.0.0");
    }
    else if (appName == "skuff-foxxum")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=skufftv");
    }
    else if (appName == "telediario")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://1067564395.a.fxmconnect.com/?app=telediario");
    }
    else if (appName == "vilanoise-mmh")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://api-cbd.netrange.com/netrange/v1/open_url/172?prkey=MzM1I2RlYjU0ZmZiNDFlMDg1ZmQ3ZjY5YTc1YjYzNTljOTg5");
    }
    else if (appName == "baeblemusic")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://smarttv.baeblemusic.com/");
    }
    else if (appName == "sports5")
    {
        tcl.channel.requestInputSource(10);
        top.g_setting.setProperty("app.ui.currentApp","tbrowser.common");
        top.g_ulits.openApplication("tbrowser.common","http://apps.store.zeasn.com/UCXDG9ue-emCN8Ad3h7lERqQ/show.html");
    }
    else if (arguments.length>1)
        {
            var mode;
            var url;
            if (arguments.length==2)
            {
                mode = "tbrowser.common";
                url = arguments[1];
            }
            else if (arguments.length==3)
            {
                mode = arguments[1];
                url = arguments[2];
            }
            tcl.channel.requestInputSource(10);
            top.g_setting.setProperty("app.ui.currentApp",mode);
            top.g_ulits.openApplication(mode,url);
        }
        else
        {
            var targetUrl = appName.replace("client_type","clienttype");
            targetUrl = targetUrl.replace("mac","client_mac");
            tcl.channel.requestInputSource(10);
            top.g_setting.setProperty("app.ui.currentApp","tbrowser.golive");
            top.g_ulits.openApplication("tbrowser.golive","http://tv.gole.tv/index.php?"+targetUrl);


            var title=getParameter4General2(appName,"title");
            var pic_url=getParameter4General2(appName,"pic_url");

            storeHistoryData('42',targetUrl,title,pic_url);//42:golive视频
        }
}

function updateZeasnFavApp() {
    var data = '[]';
    if (!tcl.utils.getData)
        return;
    var fav = JSON.parse(tcl.utils.getData("zeasn-fav-app", data));

    var appName = arguments[0];
    var isInstall = arguments[1];

    if(isInstall == 0)
    {
        for (var i = 0; i < fav.length; i++)
        {
            if(appName == fav[i].name)
            {
                fav.splice(i, 1);
                var tmp = JSON.stringify(fav);
                console.log("zk test --------------------------------------tmp:"+tmp);
                tcl.utils.setData('zeasn-fav-app', tmp);
                break;
            }
        }
    }
    else if(isInstall == 1)
    {
        //
    }

}

//提示删除视频
function delStickerVideo() {
    $("operatePage").src = "";
    $("otherPage").src = "delStickerVideo.html";
    $("otherPage").style.display = "block";
    otherPage.focus();
    setFrameFocusPage("otherPage");
}

/****
 *
 * @type {string}
 * EU区根据国家来显示GDPR的翻译
 * 传入国家索引
 */
var termsAndConditionsText = "";
var privacyNoticeText = "";
var cookieNoticeText = "";
function getGDPRText(country) {
    console.log("--getGDPRText country = " + country);
    termsAndConditionsText = "";
    privacyNoticeText = "";
    cookieNoticeText = "";
    var languageSrc = "translation/";
    var list = [];
    switch (country)
    {
        case 1://Austria
        case 9://Germany
            list=["German.js"];
            break;
        case 2://Belgium
            list=["Dutch.js","French.js","German.js"];
            break;
        case 127://Cyprus
        case 10://Greece
            list=["Greek.js"];
            break;
        case 5://Czech
            list=["Czech.js"];
            break;
        case 6://Denmark
            list=["Danish.js"];
            break;
        case 28://Estonia
            list=["Estonian.js"];
            break;
        case 7://Finland
            list=["Finnish.js"];
            break;
        case 8://France
            list=["French.js"];
            break;
        case 12://Italy
            list=["Italian.js"];
            break;
        case 30://Latvia
            list=["Latvian.js"];
            break;
        case 120://Lithuania
            list=["Lithuanian.js"];
            break;
        case 13://Luxembourg
            list=["French.js","English.js"];
            break;
        case 14://Netherlands
            list=["Dutch.js"];
            break;
        case 15://Norway
            list=["Norwegian.js"];
            break;
        case 16://Poland
            list=["Polish.js"];
            break;
        case 17://Portugal
            list=["Portuguese.js"];
            break;
        case 19://Russia
            list=["Russian.js"];
            break;
        case 31://Slovakia
            list=["Slovak.js"];
            break;
        case 22://Spain
            list=["Spanish.js"];
            break;
        case 23://Sweden
            list=["Swedish.js"];
            break;
        case 24://Switzerland
            list=["French.js","German.js","Italian.js"];
            break;
        case 59://Ukraine
            list=["Ukrainian.js"];
            break;
        default:
            list=["English.js"];
            break;
    }
    var tmpindexS;
    var tmpindexE;
    console.log("--getGDPRText list.length = " + list.length);
    var getTextHttp = [];
    for (var i = 0; i < list.length; i++)
    {
        (function (i) {//使用闭包 防止变量污染,否则返回的不是我们想要的结果
            getTextHttp[i] = new XMLHttpRequest();
            getTextHttp[i].onreadystatechange = function() {
                if (getTextHttp[i].readyState === 4)
                {
                    if(getTextHttp[i].status === 200){
                        var tmptermsAndConditionsText = "";
                        var tmpprivacyNoticeText = "";
                        var tmpcookieNoticeText = "";
                        var responseText = getTextHttp[i].responseText;

                        var index = responseText.indexOf("termsAndConditions");
                        var index1 = responseText.indexOf("privacyNotice");
                        var index2 = responseText.indexOf("cookieNotice");
                        var index3 = responseText.lastIndexOf("privacyPolicy");

                        tmptermsAndConditionsText = responseText.substring(index,index1);
                        tmpindexS = tmptermsAndConditionsText.indexOf("\"");
                        tmpindexE = tmptermsAndConditionsText.lastIndexOf("\"");
                        tmptermsAndConditionsText = tmptermsAndConditionsText.substring(tmpindexS+1,tmpindexE);

                        tmpprivacyNoticeText = responseText.substring(index1,index2);
                        tmpindexS = tmpprivacyNoticeText.indexOf("\"");
                        tmpindexE = tmpprivacyNoticeText.lastIndexOf("\"");
                        tmpprivacyNoticeText = tmpprivacyNoticeText.substring(tmpindexS+1,tmpindexE);

                        tmpcookieNoticeText = responseText.substring(index2,index3);
                        tmpindexS = tmpcookieNoticeText.indexOf("\"");
                        tmpindexE = tmpcookieNoticeText.lastIndexOf("\"");
                        tmpcookieNoticeText = tmpcookieNoticeText.substring(tmpindexS+1,tmpindexE);


                        termsAndConditionsText += tmptermsAndConditionsText+"<br><br><br><br>";
                        privacyNoticeText += tmpprivacyNoticeText+"<br><br><br><br>";
                        cookieNoticeText += tmpcookieNoticeText+"<br><br><br><br>";

                        console.log("--getGDPRText tmptermsAndConditionsText = " + tmptermsAndConditionsText);
                        console.log("--getGDPRText tmpprivacyNoticeText = " + tmpprivacyNoticeText);
                        console.log("--getGDPRText tmpcookieNoticeText = " + tmpcookieNoticeText);
                    }
                }
            };
            getTextHttp[i].open('get',languageSrc+list[i],true);
            getTextHttp[i].send();
        })(i);
    }
}

// ajax 对象
function ajaxObject() {
    var xmlHttp;
    try {
        // Firefox, Opera 8.0+, Safari
        xmlHttp = new XMLHttpRequest();
    }
    catch (e) {
        // Internet Explorer
        try {
            xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {
                alert("您的浏览器不支持AJAX！");
                return false;
            }
        }
    }
    return xmlHttp;
}
var isautoactivate = 0;
function autoactivate(){
    var sn = tcl.factory.getProductInfo().sn;
    var token = g_setting.getProperty("app.ui.token","null");
    var status = 0;
    var countryCode = g_setting.zoneCode;
    var clientCode = g_setting.manufacturer;

    var data = "sn=" + sn + "&token=" + token + "&status=" + status + "&contryCode=" + countryCode + "&clientCode=" + clientCode;
    console.log("--autoactivate sn = " + sn + "  token = " + token + "  status = " + status + "  countryCode = " + countryCode + "  clientCode = " + clientCode);
    var url = "http://overseabaodan.api.my7v.com/auth/activity/activationStatus?"+data;

    var ajax = ajaxObject();
    ajax.open( "get" , url , true );
    //ajax.setRequestHeader( "Content-Type" , "application/x-www-form-urlencoded" );
    ajax.onreadystatechange = function () {
        if( ajax.readyState == 4 ) {
            if( ajax.status == 200 ) {
                //fnSucceed( ajax.responseText );
                g_setting.setProperty("app.ui.isautoactivate","1");
                console.log("--eWarrantyCard autoactivate success ajax.responseText = " + ajax.responseText);
            }
            else {
                //fnFail( "HTTP请求错误！错误码："+ajax.status );
                g_setting.setProperty("app.ui.isautoactivate","0");
                console.log("--eWarrantyCard autoactivate fail error code = " + ajax.status);
            }
        }
        else {
            //fnLoading();
            console.log("--eWarrantyCard autoactivate loading ");
        }
    }
    //ajax.send( data );
    ajax.send();
}

</script>
</head>

<body onload="init()">
	<div id="factoryOsdShow">
        <div id="translation"><script type="text/javascript" src="translation/English.js"></script></div>
        <iframe id="main" name="main" src="" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe>
        <!--全局功能对话框，对话框出现的时候需要隐藏主菜单，但是返回后主菜单需要再次显示，比如搜台对话框，图像设置中对比度等对话框-->
        <iframe id="operatePage" name="operatePage" src="" frameborder="0"  marginheight="0" marginwidth="0" scrolling="no"></iframe>
        <!--全局弹出式对话框，比如poweroff弹出框，booking倒计时框等-->
        <iframe id="otherPage" name="otherPage" src="" frameborder="0"  marginheight="0" marginwidth="0" scrolling="no"></iframe>
        <!--globleShow 包括mute/factoryHotkey/volume-->
        <iframe id="globleShow" name="globleShow" src="globleShow.html" frameborder="0"  marginheight="0" marginwidth="0" scrolling="no"></iframe>
        <!-- lqt-虚拟遥控器 -->
        <iframe id="virtualRemote" name="virtualRemote" src="virtualRemote.html" frameborder="0"  marginheight="0" marginwidth="0"></iframe>
        
        <div id="backgroundDownloadContainer" class="backgroundDownload">
            <div id="downloadProgressValue" class="backgroundDownload"></div>
            <div id="bgDownloadTitle" class="backgroundDownload" style="position: absolute;width:186px;left:-186px;overflow: hidden"></div>
            <canvas id="backgroundDownloadRing" width="160" height="160"></canvas>
        </div>
         
        
        <img id="mute" src="images/volume_MUTE.png">
        
         <!--工厂模式打开后左下角的闪烁提示-->
         <div id="factoryHotkeyForm">
            <span id="warnUptime" class="atrrH" style="top:5px;"></span>
            <span class="atrrH" style="top:35px;"></span>
            <span class="atrrL" style="top:70px;"></span>
            <span class="atrrR" style="top:70px;"></span>
            <span class="atrrL" style="top:105px;"></span>
            <span class="atrrR" style="top:105px;"></span>
            <span class="atrrL" style="top:140px;"></span>
            <span class="atrrL" style="top:175px;"></span>
			<span class="atrrL" style="top:210px;"></span>  
			<span class="atrrL" style="top:245px;"></span>  
        </div>
        
        <span id="frontPanel"></span>
         
        
        <!--3D 眼睛佩戴提示框-->
    	<div id="glassRemind"></div>
        <div id="volumeOffRemind"></div>
        <!--nScreen phone connected to tv-->
    	<div id="nScreenPhoneConnectToTvRemind"><span></span></div>
    	<div id="tvFaultDiagnosisRemind"></div>
     </div>
     
     
    <div style="position:absolute;left:0px;top:0px;width:1920px;height:1080px;background:rgba(0,0,0,0.85);display:none;" id="loading">
        <img src="images/loading/Comp 1_00000.png" style="position:absolute;left:810px;top:390px;" id="loadingPic">
    </div>
    <div style="position:absolute;left:0px;top:671px;width:1920px;height:409px;background:url(images/voiceUI/bg.png);z-index:1010;display:none;" id="voiceControl">
        <img src="images/voiceUI/comp0.png" style="position:absolute;left:210px;top:159px;width:1500px;height:250px;" id="voiceControlPic">
        <img src="images/voiceUI/red_00010.png" style="position:absolute;left:810px;top:109px;width:300px;height:300px;display:none;" id="voiceControlPic1">
        <img src="images/voiceUI/red.png" style="position:absolute;left:875px;top:174px;width:170px;height:169px;display:none;" id="voiceControlPic2">
        <div id="voiceResult" style="position:absolute;left:0px;top:50px;width:1920px;height:40px;text-align:center;color:#fff;font-size:36px;"></div>
    </div>
</body>
</html>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
document.onsystemevent = notifyProcess;
document.onkeydown = keyproc;

var ciListWords			= [top.sysOptions[9],top.sysCiDes[0]];

var SUB_MENU_START 		= 10;				//ä¸‰å››çº§èœå•ç„¦ç‚¹ç§»åŠ¨èµ·å§‹ä½ç½?
var SUB_MENU_STEP 		= 70;				//ä¸‰å››çº§ä¸»èœå•ç„¦ç‚¹ç§»åŠ¨çš„step
var list_position_h 	= 0;				//ç„¦ç‚¹åºå·
var STEP 				= 50;
var cardState 			= 0;				//ci cardçŠ¶æ€ï¼Œ0ï¼šæ— å¡ï¼›1ï¼šæœ‰å?
var ciCount 			= 0;				//ci card count
var setting 			= top.g_setting;
var channel				= top.g_channel;
var osdTimer 			= 0;
var vedioMode 			= 0;
var liList;									//
var spanList;								//å†…å®¹åˆ—è¡¨

function notifyProcess(evt)
{
	channel.testLog("in ciList notifyProcess");
	var msg = evt.which;
	var value = evt.modifiers;
	console.log("--hzm in ciList notifyProcess msg = " + msg);
	switch(msg)
	{
		case top.E_SIGNAL_UNLOCK://unlock signal
		case top.E_PVR_NO_SIGNAL:
			top.jumpPage();
			break;
		case top.E_CI_CARD_INSERTED://CI insert
			init();
			break;
		case top.E_CI_CARD_REMOVE://CI remove
			top.jumpPage();
			break;
		case top.E_CI_DATA_READY:// CI data ready
			top.systemEventProc(evt);
			break;
		case top.E_CI_CAM_NAME_READY://ci card name ready
			showCiCardList();
			break;
		case top.E_CI_EXIT_CI:
			top.jumpPage();
			break;
		case top.E_SS_COMMON_VIDEO:
			if(vedioMode == 3)//scramble
			{
				top.jumpPage();
			}
			break;
		default:
			top.systemEventProc(evt);
			break;
	}
    console.log("--hzm in ciList notifyProcess osdTimer = " + osdTimer);
	if(osdTimer)
	{
		clearTimeout(osdTimer);
		osdTimer = setTimeout(function(){top.jumpPage();},10*1000);
	}
}

function keyproc(e)
{
	var ret = true;
	var keycode = e.which;top.g_channel.testLog("in ciList keyproc g_ciUpdateStatus = " + top.g_ciUpdateStatus + ",g_isUsedNotifyIntoPage = " + top.g_isUsedNotifyIntoPage);
	console.log("--hzm in ciList keyproc g_ciUpdateStatus = " + top.g_ciUpdateStatus + ",g_isUsedNotifyIntoPage = " + top.g_isUsedNotifyIntoPage);
	console.log("--hzm in ciList keyproc keycode = " + keycode);
	//å¿«æ·é”®å¤„ç?
	if(top.g_ciUpdateStatus == 0 || top.g_isUsedNotifyIntoPage != 1)//æ²¡æœ‰åœ¨ci å‡çº§ä¸?éžæ¶ˆæ¯è¿›å…¥cilist
	{
		switch(keycode)
		{
			case top.VK_UP:// up
				toUp();
				ttsRead();
				ret = false;
				break;
			case top.VK_DOWN://down
				toDown();
				ttsRead();
				ret = false;
				break;
			case top.VK_ENTER:
				doEnter();
				ttsRead();
				ret = false;
				break;
			case top.VK_LEFT:
			case top.VK_BACK:
				toBack();
				ttsRead();
				ret = false;
				break;
			case top.VK_EXIT://exit
				doExit();
				ttsRead();
				break;
			case top.VK_VOLUME_UP://volume up
        	case top.VK_VOLUME_DOWN://volume down
            	top.document.getElementById('main').src = "channelPlay.html";
            	top.requestFocus(top.main, 1);
				top.keyDownProcess(e);
            	return true;
			default:
				top.keyDownProcess(e);
				ret = true;
				break;
		}
		return ret;
	}
	else
	{
		switch (keycode)
		{
			case top.VK_POWER://power
			{
				top.keyDownProcess(e);
				break;
			}
			default:
				break;
		}
	}
}

function $(id)
{
	return document.getElementById(id);
}

function toUp()
{
	if(cardState != 0)
	{
		if(list_position_h > 0)
		{
			list_position_h--;
		}
		else
		{
			list_position_h = ciCount - 1;
		}
		$("thdListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
	}
}

function toDown()
{
	if(cardState != 0)
	{
		if(list_position_h  < (ciCount - 1))
		{
			list_position_h++;
		}
		else
		{
			list_position_h = 0;
		}
		$("thdListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
	}
}

function doEnter()
{
	if(cardState != 0)//æœ‰ï¼£ï¼©å¡
	{
		setting.selectNameListItem(list_position_h);//ä»?å¼€å§?
		//ç­‰å¾…data readyçš„æ¶ˆæ¯ã€‚ã€?
	}
}

function doExit()
{
	top.jumpPage();
	//setting.exitCI();
}

function toBack()
{
    console.log("--hzm ciList toback isDirectToPage = " + isDirectToPage);
    console.log("--hzm ciList toback parent = " + parent.location);
	if(isDirectToPage == 1)
	{
        top.jumpPage();
		//parent.$("subMenu1").src = "systemSet.html?backFromCiList";
	}
	else
	{
		parent.returnPage(2);
	}
}

/*
åŠŸèƒ½æè¿°ï¼šåˆ·æ–°Ci card nameåˆ—è¡¨
å‚æ•°ï¼šciCountï¼šci card nameæ•°é‡ï¼›list_position_h:å½“å‰ç„¦ç‚¹ci cardçš„ä½ç½?
å…¨å±€å˜é‡ï¼?
*/
function showCiCardList()
{
	ciCount = setting.getCICount();
	//channel.testLog("ciCount = " + ciCount);
	if( ciCount > 0 )
	{
		for(var i = 0; i < 10; i++)
		{
			if(i >= ciCount)
			{
				liList[i + 1].style.display = "none";
			}
			else
			{
				spanList[i+1].innerHTML = setting.getCIName(i);
				//channel.testLog("name = " + spanList[i].innerHTML);
			}
		}
		$("thdListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
		$('thdListFocus').style.display = "block";
	}
	else
	{
		spanList[1].innerHTML = ciListWords[1];
		$('thdListFocus').style.display = "none";
		for(var i = 2; i < 11; i++)
		{
			liList[i].style.display = "none";
		}
	}
}
function timeoutInit()
{
}
var isDirectToPage = 0;//æ˜¯å¦æ˜¯ciå¡æ¶ˆæ¯ç›´æŽ¥è¿›å…¥æ­¤é¡µé¢ï¼? å¦ï¼Œ1æ˜?
function init()
{
    top.initTextDirection(window);
	liList = $("thdMenuRight").getElementsByTagName("li");
	spanList = $("thdMenuRight").getElementsByTagName("span");
	if(osdTimer)
	{
		clearTimeout(osdTimer);
	}
	osdTimer = setTimeout(function(){top.jumpPage();},10*1000);
	top.stopTimeout();
	//é¢æ¿æŒ‰é”®å¤„ç†åœºæ™¯è®¾ç½®
	setting.contextOf5in1 = top.CONTEXT_MENU_SELECT;
	
    console.log("--hzm ciList init top.g_nextHtmlPage = " + top.g_nextHtmlPage);
	if(top.g_nextHtmlPage == "ciList.html")
	{
		$("sndMenuLeft").style.display = "block";
		isDirectToPage = 1;
		/*å¿…é¡»åœ¨æ­¤å¤„æ¶ˆé™¤æŽ‰ï¼Œä¸èƒ½å†uninitä¸­æ¶ˆé™¤ã€‚ä¸ç„¶çš„è¯å†è¯¥é¡µé¢æ¥data ready æ¶ˆæ¯å°†g_nextHtmlPageç½®ä¸ºcommon_interface.htmlï¼?
		ä½†æ˜¯å½“è·³è½¬é¡µé¢çš„æ—¶å€™g_nextHtmlPageåœ¨uninitä¸­åˆç½®ä¸ºç©ºäº†ï¼Œè¿™æ ·ä¼šå‡ºé”™*/
		top.g_nextHtmlPage = "";
		top.requestFocus(parent.subMenu1, 1);
	}
	else
	{
		$("sndMenuLeft").style.display = "none";
		isDirectToPage = 0;
	}
	
	vedioMode = channel.currentScreenSaverMode;//ä¿å­˜å½“å‰å±ä¿çŠ¶æ€ï¼Œåœ¨æ”¶åˆ°è§†é¢‘æ­£å¸¸æ’­æ”¾çš„æ¶ˆæ¯çš„æ—¶å€™éœ€è¦ç”¨å®ƒæ¥åˆ¤æ–­æ˜¯å¦æ˜¯è§£å¯†å‡ºæ¥çš„ç»“æžœ
	$("titleNameSpan").innerHTML = ciListWords[0];
	cardState = setting.getCardState();
	channel.testLog("cardState = " + cardState);
    console.log("--hzm ciList init cardState = " + cardState);
	if(cardState != 2)//ci card not available
	{
		spanList[1].innerHTML = ciListWords[1];
		$('thdListFocus').style.display = "none";
		//liList[1].style.backgroundColor = "#000";
		for(var i = 2; i < 11; i++)
		{
			liList[i].style.display = "none";
		}
	}
	else
	{/*
		if(top.g_isUsedNotifyIntoPage == 1)
		{
			osdTimer = setTimeout(function(){top.jumpPage();},10*1000);
		}*/
		list_position_h = 0;		
		showCiCardList();
	}
	top.g_isUsedNotifyIntoPage = 0;
	addMouseListener();
	ttsRead();
}

function uninit()
{
	top.timeoutFuc.timeoutEnable=1;
	top.clearMyTimeout();
}
var PROGRESS_START_LEFT_OFFSET = 480 + 310;//è¿›åº¦æ¡å®¹å™¨å¼€å§‹ä½ç½®ç›¸å¯¹äºŽframeworkçš„å·¦åç§»ï¼?80æ˜¯è¿›åº¦æ¡çš„çˆ¶å®¹å™¨çš„ç›¸å¯¹framworkçš„å·¦åç§»ï¼?10æ˜¯è¿›åº¦æ¡å®¹å™¨ç›¸å¯¹äºŽè¿›åº¦æ¡çˆ¶å®¹å™¨çš„å·¦åç§?
function addMouseListener()
{
	document.body.onmousedown = function(evt){evt.preventDefault();
		if(osdTimer)
		{
			clearTimeout(osdTimer);
			osdTimer = setTimeout(function(){top.jumpPage();},10*1000);
		}
		if(evt.button == 2){
			if(top.g_ciUpdateStatus == 0 || top.g_isUsedNotifyIntoPage != 1)//æ²¡æœ‰åœ¨ci å‡çº§ä¸?éžæ¶ˆæ¯è¿›å…¥cilist
			{
				toBack();//right key
			}
		}
	}
	
	//menu
	for(var i = 1; i < 11; i++)
	{
		liList[i].setAttribute("newAttr",i);
		liList[i].onmousedown = function(evt){
			if(osdTimer)
			{
				clearTimeout(osdTimer);
				osdTimer = setTimeout(function(){top.jumpPage();},10*1000);
			}
			if(evt.button == 0){//left key
				if(cardState != 0)
				{
					list_position_h = parseInt(this.getAttribute("newAttr")) - 1;
					$("thdListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
					doEnter();
				}
			}
		}
	}
}

function ttsRead()
{
	if(0 == top.g_setting.ttsSwitch)
	{
		top.ttsLog("ttsSwitch is off");
		return;
	}
	top.ttsLog("parent.currentShowMenu=" + parent.currentShowMenu);
	var ttsStr = "";
	var currentStatus = "";
	var ttsName = "";
	if(2 == parent.currentShowMenu)
	{
		ttsName = ciListWords[1];
		currentStatus = "";
	}
	else
	{
		top.ttsLog("focusOn=" + focusOn);
	}
	ttsStr = ttsName + currentStatus;
	if("" != ttsStr)
	{
		top.ttsLog("ttsStr=" + ttsStr);
		top.setTTSSay(top.SPEECH_TYPE_FLUSH, ttsStr);
	}
}

</script>

<link rel="stylesheet" type="text/css" href="../all.css" />
<style type="text/css">
#title
{
	position:absolute;
	top:60px; 
}
</style>
</head>

<body onLoad="init()" onUnload="uninit()">
	<div id="sndMenuLeft" style="display:none"></div>
    <div id="thdMenuLeft"></div>
    <div id="thdMenuRight">
        <div class="titleName">
            <span id="titleNameSpan" style="top:60px; position:absolute"></span>
        </div>
        <div class="showMenu">
            <ul>
                <img id="thdListFocus" src="../images/Focus_Frame/Focus.png">
                <!--<li class="titleName">-->
                <!--<lable  id="title"></lable>-->
                <!--</li>-->
                <li></li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
                <li class="list">
                    <span class="listFirstProperty"></span>
                </li>
            </ul>
        </div>
    </div>
</body>
</html>

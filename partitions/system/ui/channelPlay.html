<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="all.css">
<title> New Document </title>
<meta name="Generator" content="EditPlus">
<meta name="Author" content="">
<meta name="Keywords" content="">
<meta name="Description" content="">

<style>
body
{
    background: transparent;
}

#channel_info_1
{
    position: absolute;
	left:1462px;
    top: 30px;
    width: 400px;
    height: 200px;
	border:4px solid #1b1b1b;
	border-left:none;
    background: #000000;
	opacity:0.92;
    display:none;
	z-index:100;
}
#channel_info_2
{
	position: absolute;
	left:58px;
	top: 30px;
	opacity:0.92;
	width: 1400px;
	height: 200px;
	background: #000000;
	border:4px solid #1b1b1b;
	border-right:none;
	display:none;	
}
#channel_content_contain
{
	position: absolute;
	left:58px;
	top: 250px;
	width: 1800px;
	height: 252px;
	opacity:0.92;
	border:4px solid #1b1b1b;
	background: #000000;
	overflow:hidden;
	display:none;
		
}
#channel_content
{
	position: absolute;
	width:100%;
	font-size:24px;
	color:#FFF;
	font-weight:bold;
	line-height:30px;
}
#channel_content_
{
	position: absolute;
	height:210px;
	width:100%;
	overflow:hidden;
}
.channel_info_font
{
	position:absolute; 
	font-size:24px;
	color:#FFF;
	font-weight:bold;
	overflow:hidden;
	white-space:nowrap;
	text-overflow:ellipsis;
}
#channelRemind
{
	position:absolute; 
	font-size:28px;
	color:#FFF;
	font-weight:bold;
	top:100px; 
	left:800px;
	display:none;
}
.channel_signal_strength_bar
{
	position:absolute;
	bottom:0px; 
	width:6px; 
	border:thin solid #FFF;
	border-radius:2px;
}
#channel_num
{
    position:absolute;
    left:0px;
    top:10px;
    width:400px;
    font-size:70px;
    font-weight: bold;
    text-align: center;
    color: #ff0;
	overflow:hidden;
}

#channel_name
{
    position:absolute;
    left:0px;
    top:100px;
    width:400px;
    font-size:28px;
    font-weight: bold;
    text-align: center;
    color: #fff;
	overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
}
#input_format
{
	position:absolute;
    left:0px;
    top:150px;
    width:400px;
    font-size:28px;
    font-weight: bold;
    text-align: center;
    color: #fff;
	overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
}
#remind
{
	position: absolute;
    left: 660px;
    top: 400px;
    width: 570px;
    height: 150px;
    padding-top:80px;
    background: #000000;
    border:solid 4px #1b1b1b;
    color:#fff;
    font-size:30px;
    font-weight:bold;
    text-align: center;
    display: none;
}
#unSupportDialog
{
    position:absolute;
    top:400px;
    left:720px;/*650px;*/
    width:500px;/*600px;*/
    height:200px;
    border:4px  solid #1b1b1b;
    opacity:0.92;
    background:#000;
    overflow:hidden;
    display:none;
}
#unSupportContent
{
    position:absolute;
    top:70px;
    width:100%;
    left:0px;
    text-align:center;
    font-size:28px;
    font-weight:bold;
    color:#FFF;
}
.Rating
{
	position:absolute;
	top:150px;
	left:10px;
	width:250px;
	height:50px;
}
.subtitle
{
	position:absolute;
	top:150px;
	left:250px;
	width:500px;
	height:50px;
}
.cc
{
    position: absolute;
    width: 80px;
    color: rgb(255, 0, 0);
    text-align: center;
    border-radius: 10px;
    border: 1px solid rgb(255, 255, 255);
    font-size: 20px;
    left: 255px;
    display: none;
}
#program_audio
{
	position:absolute;
	top:60px;
	left:700px;
	width:80px;
	height:50px;
	text-align:right;	
}
#lang_eye_picture
{
    position:absolute;
	width:80px;
	height:32px;
	top:150px; 
	left:350px; 
	display:none;
}
#lang_ear_picture
{
    position:absolute;
    width:80px;
    height:32px;
    top:150px;
    left:350px;
    display:none;
}
#ttx_picture
{
	position:absolute;
	top:0px;
	left:350px;
	width:80px;
	height:32px;
	display:none;
}

#era_picture
{
	position:absolute;
	top:0px;
	left:6px;
	width:80px;
	height:32px;
	display:none;
}

#era_picture_list
{
	position:absolute;
	top:0px;
	left:300px;
	width:38px;
	height:20px;
	display:none;
}

#sttl_picture
{
	position:absolute;
	top:0px;
	left:255px;
	width:80px;
	height:32px;
	display:none;
}
#subtitle_language
{
	position:absolute; 
	top:0px; 
	left:460px;
	font-size:24px;
	color:#FFF;
	font-weight:bold;
	width:150px;
	overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
}
#data_Service
{
	position:absolute; 
	top:0px; 
	left:610px;
	font-size:24px;
	color:#FFF;
	font-weight:bold;
	width:150px;
	overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
}
#ginga_Service
{
    position:absolute;
    top:0px;
    left:800px;
    font-size:24px;
    color:#FFF;
    font-weight:bold;
    width:150px;
    overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
}
#prompt
{
	position:absolute;
	background: rgba(27, 27, 27, 0.6);
	bottom:300px;
	left:560px;
	width:800px;
	height:400px;
	display:none;
	-webkit-transition-duration: 800ms;
	border:thin  solid #1b1b1b;/*设置边框颜色;*/
	-webkit-border-radius: 10px;
}
#promptContent
{
	top:80px;
	left:150px;
    color: white;
    font-size: 35px;
    font-weight: bold;
	text-align:center;
	width:500px;
	position:absolute;
}
#sameLcnRemind
{
	position:absolute;
	height:200px;
	width:1500px;
	top:500px;
	left:210px;
	background:#000;
	opacity:0.92;
	border:4px #1b1b1b solid;
	padding-top:30px;
	text-align:center;
	font-size:33px;
	font-weight:bold;
	color:#fff;
	display:none;
}
#sound_channel
{
	position:absolute; 
	top:60px; 
	left:1200px;
}
#sound_channel_img
{
	position: absolute;
	top: -11px;
	width: 80px;
	height: 80px;
}
#sound_channel_text
{
	position: absolute;
	width: 180px;
	left: 18px;
	font-size: 24px;
	color: #FFF;
	font-weight: bold;
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	top: 0px;
}
#program_content_genre
{
	position:absolute;
	font-size:30px;
	color:#fff;
	top:12px; 
	left:1000px; 
	width:400px; 
	overflow:hidden;
	white-space:nowrap;
	text-overflow:ellipsis;
}
#preSetBarPlay
{
	position:absolute;
	background:#000;
	/*bottom:100px;*/
	overflow:hidden;
	opacity:0.92;
	background:url(images/History_bg.png);
	width:360px;
	height:1080px;
	top:0px;
	left:0px;
	display:none;
}
#preSetOptionPlay
{
	position:absolute;
	top:55px;
	left:20px;
    right:20px;
	font-size:28px;
	color:#b0b0b0;
}
#detailImg
{
	position:absolute;
	top:218px;
	left:1300px;
}
#detailSpan
{
	position:absolute;
	top:218px;
	left:1400px;
	height:32px;
	font-size:30px;
	line-height:32px;
	color:#fff;
}
#ewbsRemind
{
	position:absolute;
	height:410px;
	width:830px;
	top:334px; 
	left:544px; 
	background:url(./images/Bg-Pop_up_box-04.png);
	display:none;
}
#dialogName
{
	position:absolute;
	width:710px;
	top:30px;
	color:#b0b0b0; 
	font-size:32px;
	left:60px; 
	/*text-align:left;*/
}
#dialogContent
{
	position:absolute;
	width:710px;
	top:125px;
	color:#b0b0b0; 
	font-size:28px;
	left:60px; 
	/*text-align:left;*/
	line-height:48px;
}
</style>
<script>
var channel_play_main                   = [top.others[0],top.others[25]+ ":",top.souSoundType[1]];
var channel_remind                      = top.screenSavers;
var weekday                           = top.weekday;
var source_titles 					  = top.sourceOptions;
var sound_type						  =top.souSoundType;
var dtvSoundChannels                  = top.soundChannels;
var sameLcnRemindWord                 = top.lcnConfflict;
var sdOrHd                            = top.sdHd;
var pOrI                              = top.pOrI;
var mode_option                       = [top.souOptions[8]];
var parentRateWord 				      = top.others[10];
var genre_first_level 			= top.chEpgFirstGenre;
var promptContent                     = top.inShopMode;
var mEPSTips						  = top.mEPSTips;
var tuner_name                        = top.tuner
var viewDetail                        = top.viewDetail
var tuner_picture                     = ["images/icon_Cable_focus.png","images/icon_Antenna_focus.png","images/icon_Satellite_focus.png"];
var audioType 						  = top.audioType;

var channelInfo_visible               = 0;
var channelInfo_timer                 = 0;
var channelInfoDuaration			  = 5000;//ms .i.e 5s
var currentChannel                    = 0;
var channelIndex                      = 0;
var show_moreInfo_flag                = 2;//0 去除所有,1 全部显示 ，2 去除简介，3 去除简介和节目频道节目信息，4 去除所有，5 显示节目编号，6 显示节目编号和节目频道节目信息，7 全部显示,

var setting = top.g_setting;
var language = top.g_language;
var channel = top.g_channel;
var Ginga = top.g_ginga;

var inputSource;
var backInputSource;
var programStatus                     = 0;//0 无节目，1 有节目,无频道列表
//var level = 0;//优先级：(no program info = 3) > (no signal = 2)> (other = 1) > common
/*sunjianping add 
getsubtitlestate();得到subtitle 图标的一些属性这些属性放在一个结构体
*/

var imglist;
//var Mheg5Status=0;//是否有Mheg5 0：没有1：有
var CI_Mheg5OpenStatus                = 0;//is ci mheg opend.0 not open,1 opened
var channelNumShowStatus              = 0;
var channelMhegLevel                  = 0;
var channelNumber                     = 0;
var playChannelNumber                 = 0;
var enterNumFlag                      = 0;
var channelChangeStatus               = 0;//0 不在在切换台状态，1 在切换台状态
var powerDownTimer                    = 0;
var backLightState                    = 0;
var channelUpFlag                     = 0; //表示channel up键按下
var channelDownFlag                   = 0; //表示channel down键按下
var nextIndex                         = 0;
var preIndex                          = 0;
var presetFocusWidth                  = 274;
var appOpenPowerOff                   = 0;
var showEsticker                      = 0;
var oldKey                            = 0xffff;
var channelOldKeyTimer                = 0;
var showPageType                      = "";
var positionV                         = 0;
var currentPlayChannelNumber          = 0;
var nscreenTimer = 0;
var manualInfoStatus  = 0;
var inputSourceCount = 0;
var currentInputIndex = -1;
var inputList =[
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
{name:"",source:0},
];
//la
var CH_MAIN_NUM_MAX_ANTENNA 		= 999;
var CH_SUB_NUM_MAX_ANTENNA			= 999;
var inputSpotFlag					= false;
var inputMainChNum					= -1;
var inputSubChNum					= -1;
var currentTunerMode				= -1;
var needSearchFlag					= -1;//[-1]do not need search; [0]atv [1]dtv & atv
var isSearchingFlag					= false;
var atvScanCount = -1;
var dtvScanCount = -1;
var sourceToDtvFlag                = 0;
var sourceToDtvIndex               = 0;
var refreshInfoTimer   = 0;
var soundTypeInfo;
var soundTypeItems;
var soundTypeLength;
var soundTypeIndex;
var refreshInfobarFlag = 1;// add
var lastChannelInfo = 0;	//for tts
document.onkeydown = keyproc;
document.onsystemevent = notifyProcess;

setTimeout("document.onkeyup = keyupproc",100);

function testLog(str)
{
	console.log("===========> Areos: " + str);
}

function notifyRefreshInfo()
{
	console.log("in notifyRefreshInfo channelInfo_visible is "+channelInfo_visible+" programStatus is "+programStatus);
	if(!channelChangeStatus)
	{
		if(channelInfo_visible && programStatus != 0)
		{
			if(channelChangeTimer)
			{
				clearTimeout(channelChangeTimer);
			}
			channelChangeTimer = 0;
			if(show_moreInfo_flag == 0 ) 
			{
				//show_moreInfo_flag = 1;
			}
			else if(show_moreInfo_flag == 3 || show_moreInfo_flag == 4 || show_moreInfo_flag == 5)
			{
				//show_moreInfo_flag = 6;
			}
			
			//切换台以后分辨率等信息要清空
			//$("channel_resolution").innerText = "";
			//$("channel_name").innerText = "";
			if(CI_Mheg5OpenStatus>0 || channel.checkhbbtvShowInfo()==0)
			{
				return;
			}
			hideRemind();
			refreshChannelInfo();

		}
		else
		{
			if(!programStatus)//无频道，不显示info信息
			{
				hideInfoForm();
			}
			showRemind();
		}
	}
	else
	{
		if(channelChangeTimer)
		{
			clearTimeout(channelChangeTimer);
		}
		channelChangeTimer = 0;
		if(show_moreInfo_flag == 0 ) 
		{
			//show_moreInfo_flag = 1;
		}
		else if(show_moreInfo_flag == 3 || show_moreInfo_flag == 4 || show_moreInfo_flag == 5)
		{
			//show_moreInfo_flag = 6;
		}
		//切换台以后分辨率等信息要清空
		$("channel_resolution").innerText = "";
		$("channel_name").innerText = "";
		if(CI_Mheg5OpenStatus>0)
		{
			return;
		}
		hideRemind();
		refreshChannelInfo();
	}
}

function sourceValue(value)
{
	switch(value)
	{
		case 1:
			return 0;//dtv
			break;
		case 11:
			return 1;//av
			break;
		case 4://cmp
			return 4;
			break;
		case 6://hdmi1
			return 6;
			break;
		case 7://hdmi2
			return 7;
			break;
		case 8://hdmi3
			return 8;
			break;
		default:
			return -1;

	}
}

function notifyProcess(evt)
{

    var msg = evt.which;//alert(msg)
	//对信号消息做特殊处理看是否需要定时关闭电视
	var value = evt.modifiers;
    console.log("channelplay  revice msg = "+msg);
	switch(msg)
	{
		case top.E_SRC_CHANGE_SET_INPUT_SOURCE:
		{
			//alert("the name is " + top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh") +"appopenflag " +top.appOpenFlag );
			//if(top.g_setting.getUsbResumingStatus() || (top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix" && top.appOpenFlag == 1))
			if(top.g_setting.getUsbResumingStatus() || top.g_factory_hotkey == 1 ||(top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix" && top.appOpenFlag == 1)|| top.g_setting.getTopApp() == "vod.netflix")
					return;
			if(parseInt(top.g_setting.getProperty("app.ui.noticeSource","1")) == 1)
			{
				if(!top.checkSourceisSupport(value))
					return;
				if (value !=top.g_channel.inputSource) {
					if (top.g_setting.isSourceInsert(sourceValue(value)) == 1) {
						top.$("operatePage").src = "";
						top.$("otherPage").src = "switchSourceRemind.html?" + value;
						top.$("otherPage").style.display = "block";
						top.otherPage.focus();
						top.setFrameFocusPage("otherPage");
						return;
					}
			    }
			}
			break;

		}
		case top.E_SS_NO_CI_MODULE:
		case top.E_SS_INVALID_SERVICE://invalid service
		case top.E_SS_SCRAMBLED_PROGRAM:// screamble
		case top.E_SS_AUDIO_ONLY://audio only
		case top.E_SS_DATA_ONLY://data only
		case top.E_SIGNAL_UNLOCK://unlock signal
		case top.E_PVR_NO_SIGNAL:
		case top.E_SIGNAL_LOCK://lock signal
		case top.E_DTV_SS_RUNNING_STATUS_NOT_RUNNING:
			if(channel.currentSignalStatus == 1)//当前有信号
			{
				if(powerDownTimer)
				{
					clearTimeout(powerDownTimer);
				}
				powerDownTimer = 0;
			}
			else//当前无信号
			{
				if(noSignalStillFlag == 1)//上次的记录也是无信号的
				{
					//继续上次的计时不用做任何操作
				}
				else//上次的记录是有信号的
				{
					if(powerDownTimer)
					{
						clearTimeout(powerDownTimer);
					}
					powerDownTimer = setTimeout("powerOffForSpecialSituation()",14*60*1000);
				}
			}
			if(top.appOpenFlag==1)
			{
				return;
			}
			top.systemEventProc(evt);
			break;
		case top.E_DLNA_DMR_PUSH_MOVIE:
		case top.E_DLNA_DMR_PUSH_MUSIC:
		case top.E_DLNA_DMR_PUSH_PICTURE:
		case top.E_DLNA_DMR_PUSH_KODI:
		case top.E_DLNA_DMR_PUSH_YOUTUBE:
			top.systemEventProc(evt);
			break;
		case top.E_CHANNEL_LIST_UPDATE:
		case top.E_DTV_NIT_VERSION_CHANGED:
			channel.updateChannleListExt();
            programStatus = channel.channelProgramStatus();
			if(channelChangeStatus==0)
			{
				channelIndex=channel.currentIndex;
			}
			if(top.appOpenFlag==1)
			{
				return;
			}
			top.systemEventProc(evt);
		break;
		case top.E_FACTORY_SET_DTV_CHANNEL:
		testLog("notify fucntion recv E_ATV_TUNE_PREQUENCY_CHANGE11111111111");
		inputMainChNum = value;
		inputSubChNum = -1;
		
		inputNumCheck();
		break;
		case top.E_CHANNEL_CHANGE_FINISH:
			{
				channelIndex=channel.currentIndex;
				if(top.appOpenFlag==1)
				{
					return;
				}
				top.systemEventProc(evt);
			}
			break;

		//la
		case top.E_ATV_TUNE_PREQUENCY_CHANGE://atv
			if(!top.isLAFlag && !top.isNAFlag && !top.isCBFlag) break;
			testLog("notify fucntion recv E_ATV_TUNE_PREQUENCY_CHANGE");
			refreshSearchResult(-1);
			break;
	  	case top.E_DTV_TUNE_FREQUENCY_CHANGE://dtv
	  		testLog("notify fucntion recv E_DTV_TUNE_FREQUENCY_CHANGE");
	  		if(!top.isLAFlag && !top.isNAFlag && !top.isCBFlag) break;
			refreshSearchResult(-1);
			break;
		case top.E_ATV_SCAN_FINISHED://atv
			if(!top.isLAFlag && !top.isNAFlag && !top.isCBFlag) break;
			testLog("notify fucntion recv E_ATV_SCAN_FINISHED");
			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)//恢复Ginga
			{
				//top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_STOP_SCAN);
                top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
			}
			refreshSearchResult(0);
		  	break;
	  	case top.E_DTV_SCAN_FINISHED://dtv
	  		if(!top.isLAFlag && !top.isNAFlag && !top.isCBFlag) break;
	  		testLog("notify fucntion recv E_DTV_SCAN_FINISHED");
			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)//恢复Ginga
			{
				//top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_STOP_SCAN);
                top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
			}
		  	refreshSearchResult(1);
		  	break;
		case top.E_HP_PLUGIN:
        case top.E_HP_PLUGOUT:
		case top.E_CEC_HDMI_DEVICE_INSERTED:
			top.systemEventProc(evt);
			break;
		default:
			break;
	}
	
	//全局消息
	switch(msg)
	{
		case top.E_SS_NO_CI_MODULE:
		case top.E_SS_INVALID_SERVICE://invalid service
		case top.E_SS_SCRAMBLED_PROGRAM:// screamble
		case top.E_SS_AUDIO_ONLY://audio only
		case top.E_SS_DATA_ONLY://data only
		case top.E_DTV_SS_RUNNING_STATUS_NOT_RUNNING:
		case top.E_SS_UNSUPPORTED_FORMAT:
			top.channelLock = 0;
			top.parentalLock = 0;
			top.inputLock = 0;
			//return;这里不能加return，因为上面的消息需要刷新infobar,需要执行下面的代码
		case top.E_SIGNAL_LOCK://lock signal
			top.parentalLock = 0;
			notifyRefreshInfo();
			if(top.appOpenFlag==1)
			{
				return;
			}
			top.systemEventProc(evt);
			return;
		case top.E_DTV_EPG_PF_FINISH:
			 console.log(" E_DTV_EPG_PF_FINISH --- refreshInfobarFlag = "+refreshInfobarFlag);
			 notifyRefreshInfo();
			 if(refreshInfobarFlag == 0)
			 {
				refreshInfobarFlag = 1;
			 }
			 break;
		case top.E_SIGNAL_UNLOCK://unlock signal
		{
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && channel.inputSource == 1)//no signal暂停Ginga已移置中间件做
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_NO_SIGNAL);
//			}
			if(top.timeShiftStatusFlag != 1)
			{
				top.channelLock = 0;
				top.parentalLock = 0;
				clearTimeout(channelInfo_timer);
				//if(top.inputLock == 0)
				{
					channelInfo_timer = setTimeout("hideInfoAndShowRemind()",2);
				}
				
				if(top.appOpenFlag==1)
				{
					return;
				}
				top.systemEventProc(evt);
			}
			return;
		}
		case top.E_PVR_NO_SIGNAL:
		{
			if(top.timeShiftStatusFlag == 1)
			{
				top.channelLock = 0;
				top.parentalLock = 0;
				top.inputLock = 0;
				notifyRefreshInfo();
				if(top.appOpenFlag==1)
				{
					return;
				}
				top.systemEventProc(evt);
			}
		}
		case top.E_TV_EXCHANGE_END:
		{
			if(inputSource>1)
			{
				notifyRefreshInfo();
			}
			return;
		}
		case top.E_SS_COMMON_VIDEO:// service 
			top.channelLock = 0;
			top.parentalLock = 0;
			testLog("E_SS_COMMON_VIDEO channel.inputSource is "+ channel.inputSource);
			if (channel.inputSource != 1 && top.supportHBBTV)
            {
                top.globleHBBTVClose();
            }
			if(setting.getInputSourceLock(channel.inputSource) == 1 && channel.inputUnlockState(channel.inputSource) == 1)
			{
				top.inputLock = 1;
			}
			else
			{
				top.inputLock = 0;
//                if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True )//vedio画面播出来暂停Ginga已移置中间件做
//                {
//                    if(channel.inputSource == 1)//DTV and Ginga enable
//                    {
//                        top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_COMMON_VIDEO);
//                    }
//                }
			}
			notifyRefreshInfo();
			return;
		case top.E_SS_CH_BLOCK://channel lock
			top.channelLock = 1;
			console.log(" channelInfo_visible is "+channelInfo_visible);
			if(channelInfo_visible)
			{
				hideInfoForm();
			}
			showRemind();
			//notifyRefreshInfo();
			top.systemEventProc(evt);
			return;
		case top.E_SS_PARENTAL_BLOCK://有节目锁
			top.parentalLock = 1;
			console.log(" channelInfo_visible is "+channelInfo_visible);
			if(channelInfo_visible)
			{
				hideInfoForm();
			}
			showRemind();
			//notifyRefreshInfo();
			top.systemEventProc(evt);
			return;
		case top.E_DTV_SS_INPUT_BLOCK://input lock
			top.inputLock = 1;
			if(channelInfo_visible)
			{
				hideInfoForm();
			}
			showRemind();
			top.systemEventProc(evt);
			return;
		case top.E_OBTAIN_DIGITAL_AUDIO_INFO:
		{
			if(currentPlayChannelNumber==value)
			{
				initAudioMode();
			}
			break;
		}
		case top.E_NETWORK_UPDATE_GET_UPDATED_INFORMATION:
			/*if(top.appOpenFlag==1)
			{
				return;
			}*/
            var softwareupdaeservice = setting.getProperty("app.ui.software_update", "0");
            if (top.isEUFlag && softwareupdaeservice == 0)
            {
                console.log("---THIS IS EUFlag E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG and softwareupdaeservice disable!! ");
                return;
            }
			var isNewSoftwareFound = evt.modifiers;  // <=0:Not found 100:Unforce upgrade 200:Force upgrade
			if(isNewSoftwareFound == 100){
				top.g_isForceUpgrade = false;
				if(setting.networkDownloadButton == 2){
					/* If "Never" button was selected, the dialog would not
					show until a new software occurred. */
					var updateInfo = setting.getUpdateInfo();
					var softwareVersionInDB = setting.networkUpdateSoftwareVersionInDB;
					var softwareVersionInServer = 0;
					if(updateInfo){
                        if(updateInfo.version.length > 15)
                        {
						softwareVersionInServer = parseInt(updateInfo.version.slice(15), 10); /* -3 */
					}
                        else
                        {
                            testLog("[Error] version length is short !");
                        }
					}
                    testLog(" ~~~[UI]GetUpdateInformation VersionInServer="+softwareVersionInServer + "--VersionInDB="+softwareVersionInDB);
                    if(softwareVersionInServer != softwareVersionInDB){
                        console.log("---THIS IS E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG AND OTHER VERSION UPDATE---");
                        setting.networkDownloadButton = 0;
                        top.g_whichUpdateDialogWillBeUsed = 0;
                        top.$("operatePage").src = "";
                        top.$("otherPage").src ="";
                        top.$("main").src = "networkUpdateDialog.html";
                        top.requestFocus(top.main, 1);
                        top.setFrameFocusPage("main");
                    }
                }
                /*else if(setting.networkDownloadButton == 1){
                 setting.startDownloadUpdateFile(1);
                 }*/
                else{
                    console.log("---THIS IS E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG AND NORMAL UPDATE---");
                    top.g_whichUpdateDialogWillBeUsed = 0;
                    top.$("operatePage").src = "";
                    top.$("otherPage").src ="";
                    top.$("main").src = "networkUpdateDialog.html";
                    top.requestFocus(top.main, 1);
                    top.setFrameFocusPage("main");
                }
            }
            else if(isNewSoftwareFound == 200){
                console.log("---THIS IS E_NETWORK_UPDATE_GET_UPDATED_INFORMATION MSG AND FORCED UPDATE---");
                top.g_isForceUpgrade = true;
                setting.networkDownloadButton = 0;
				setting.startDownloadUpdateFile(1);
			}
			return;
		case top.E_SHOW_UPDATE_DIALOG:
		    if(top.appOpenFlag==1)
			{
				return;
			}
			setting.networkUpdateButton = 0;
			top.g_whichUpdateDialogWillBeUsed = 1;
			   top.$("main").src = "networkUpdateDialog.html";
			return;
		case top.E_UPDATE_BGM_TRIGGER:
			if(top.appOpenFlag==1)
			{
				return;
			}
			top.$("operatePage").src = "";
			top.$('otherPage').src = "";
			top.clearMyTimeout();
			top.$("main").src = "channelUpdate.html";
			top.requestFocus(top.main, 1);
			top.setFrameFocusPage("main");
			break;
		case top.E_CHANNEL_PLAY_END://channel change success end
			if(inputSource <= 1)//dtv中因为切台后并不一定能发送屏保消息，所以没法复位锁的标志，所以在这里做了锁的标志的复位
			{
				//top.channelLock = 0;
				//top.parentalLock = 0;
				//top.inputLock = 0;
			}
//			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True &&
//				channel.inputSource == 1 && top.GingaObj.isEnable == 1)//DTV and Ginga enable //切频道后恢复Ginga已移置中间件做
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_AFTER_CHANNEL_CHANGE);
//			}
            if (channel.inputSource == 1 && top.supportHBBTV && top.recordStatusFlag == 0 && top.timeShiftStatusFlag == 0)
            {
                console.log("--in E_CHANNEL_PLAY_END and open hbbtv! ");
                top.globleHBBTVOpen();
            }
			if(channelIndex==channel.currentIndex)
			{
				channelChangeStatus=0;
			}
			else if(channelChangeStatus == 0)
			{
				channelIndex = channel.currentIndex;
			}
			oldKey = 0xffff;
			channelIndex=channel.currentIndex;
            refreshChannelInfo();
            checkEWBS();
			return;	
		case top.E_DTV_SERVICE_PLAY://播放流数据更新
			if(channelChangeStatus==0)
			{
				channelIndex=channel.currentIndex;
			}
			if(CI_Mheg5OpenStatus>0 || channel.checkhbbtvShowInfo()==0)//CI出发MHEG没有关掉之前不自动弹出info信息
			{
				return;
			}
			refreshChannelInfo();
			hideRemind();
            checkEWBS();
			return;
		case top.E_CI_MHEG_OPEN://MMH打开，需要进入channel_play页面并
			CI_Mheg5OpenStatus = 1;
			top.g_MMHStatus = 1;
			if(!channel.currentSignalStatus)
			{
				refreshChannelInfoTimer();
				hideRemind();
			}
			else
			{
				showRemind();
				hideInfoForm();
			}
			return;
		case top.E_CI_MHEG_CLOSE://mmi 关闭
			CI_Mheg5OpenStatus = 0;
            top.g_MMHStatus = 0;
			return;
		case top.E_SIGNAL_FORMAT_CHANGED://格式更改信息，需要更新分辨率
			if(inputSource > 1)
			{
				if(channelInfo_visible == 0)
				{
					show_moreInfo_flag = 1;
				}
			}
			else
			{
				if(show_moreInfo_flag == 0) 
				{
					//show_moreInfo_flag = 1;
				}
				else if(show_moreInfo_flag == 3 || show_moreInfo_flag == 4 || show_moreInfo_flag == 5)
				{
					//show_moreInfo_flag = 6;
				}
			}
			if(CI_Mheg5OpenStatus>0 || channel.checkhbbtvShowInfo()==0)//CI出发MHEG没有关掉之前不自动弹出info信息
			{
				return;
			}
			hideRemind();
			refreshChannelInfo();
			formatChange();
			return;
		case top.E_TELETEXT_UPDATE_NEWFLASH:
		{
			if(top.appOpenFlag==1)
			{
				return;
			}
			top.g_setting.ttxShowNewflash();
			top.$("main").src = "TeletextMenu.html";
			top.requestFocus(top.main, 1);
		}
		break;
		case top.E_TELETEXT_UPDATE_ALARMPAGE:
		{
			if(top.appOpenFlag==1)
			{
				return;
			}
			top.g_setting.ttxShowAlarmpage();
			top.$("main").src = "TeletextMenu.html";
			top.requestFocus(top.main, 1);
		}
		break;
		case top.E_UPDATE_ABORTED_LAST_TIME:
		    if(top.appOpenFlag==1)
			{
				return;
			}
			top.g_whichUpdateDialogWillBeUsed = 2;
			top.$("main").src = "networkUpdateDialog.html";
			return;
		case top.E_READY_TO_CHANGE_CEC:
		{
			if(channelInfo_visible)
			{
				hideInfoForm();
			}
			else if(top.appOpenFlag==1)
			{
				//Update lastInputSource value, there are cec switch to hdmi source message to come over
				//testLog("in chan -E_READY_TO_CHANGE_CEC --top.g_channel.inputSource"+top.g_channel.inputSource+"top.lastInputSource="+top.lastInputSource+"value = "+value);
				top.tochangeCEC(value);
				return;
			}
			top.systemEventProc(evt);
		}
		break;
		case top.E_HBBTV_STATE_CHANGE:
		    var value = evt.modifiers;
		    top.hbbtvStatus = value;
			showRemind();
			break;
		case top.E_APP_CLOSE:
            console.log("channelPlay msg E_APP_CLOSE test top.scheduleApp = "+top.scheduleApp );
			if (top.scheduleApp == top.SCHEDULE_NETFLIX)
            {
                top.scheduleApp = 0;
                top.g_channel.inputSource=top.E_INPUT_STORAGE;
				top.g_setting.setProperty("app.ui.currentApp","vod.netflix");
                top.openNetflix("hotkey");
                return;
            }
			else if(top.scheduleApp == top.SCHEDULE_CEC)
			{
				top.scheduleApp = 0;
				top.appOpenFlag = 0;
				top.tochangeCEC(top.lastInputSource);
				return;
			}
            else if(top.scheduleApp == top.SCHEDULE_YOUTUBE)
            {
                top.scheduleApp = 0;
                tcl.channel.requestInputSource(10);
                top.g_setting.setProperty("app.ui.currentApp","tbrowser.youtube");
                top.g_ulits.openApplication("tbrowser.youtube","https://www.youtube.com/tv?launch=menu&additionalDataUrl=http%3a%2f%2flocalhost%3a56789%2fapps%2fYouTube%2fdial_data");
                return;
            }
            else if(top.scheduleApp == top.SCHEDULE_INTERNET)
            {
                top.scheduleApp = 0;
                tcl.channel.requestInputSource(10);
                top.g_setting.setProperty("app.ui.currentApp","tbrowser.browser");
                top.g_ulits.openApplication("tbrowser.browser","http://eu.guide.huan.tv/huan123/skin/home2015List.action?skin=D1280_2015&data=GBR_mt56#");
                return;
            }
			else if(top.scheduleApp == top.SCHEDULE_SWITCHSRC)
			{
				top.scheduleApp = 0;
				top.appOpenFlag = 0;
                if (top.lastInputSource==0 || top.lastInputSource==1)
                {
                    var currentChannel = channel.getChannelInfoByIndex(channel.currentIndex);
                    top.lastInputSource = currentChannel.serviceType==0 ? 0 : 1;
                }
				top.toswitchSource(top.lastInputSource);
				return;
			}
            else if(top.scheduleApp == top.SCHEDULE_MEDIA)
            {
                top.scheduleApp = 0;
                top.appOpenFlag = 0;
                var usbLock = top.g_factory.usbLock;
                var hotelEnable = top.g_factory.hotelEnable;
                
                if((usbLock) && (hotelEnable))
                {
                    top.$('main').src = "password.html?usbLock";
                    top.main.focus();
                }  
                else
                {
                    top.$('main').src = "deviceList.html";
                }
                top.isFromOptionIntoUsb = 1;
                return;
            }
            else if(top.scheduleApp == top.SCHEDULE_KODI)
            {
                top.scheduleApp = 0;
                top.appOpenFlag = 0;
                if(top.g_pushType<4)
                {
					top.enterMediaPlay();
					if(top.g_pushType==1)
					{
						top.$("main").src = "musicPlay.html?dmr";
					}
					else if(top.g_pushType==2)
					{
						top.$("main").src = "picturePlay.html?dmr";
					}
					else if(top.g_pushType==3)
					{
						top.$("main").src = "videoPlay.html?dmr";
					}
				}
				else
				{
					top.enterKodi(1);
				}
				return;
            }
			else if(top.scheduleApp == top.SCHEDULE_APPS)
			{
				scheduleApp = 0;
				g_setting.sendMsgToDBC(1);
				tcl.channel.requestInputSource(10);
				top.g_setting.setProperty("app.ui.currentApp", "tbrowser.common");
				var appStoreUrl;
				if(isLAFlag)
				{
					appStoreUrl = "http://5495564812.fxm6263467844.com/";
				}
				else if(isNAFlag)
				{
					appStoreUrl = "http://5495564812-na.fxm6263467844.com/";
				}else
				{
					appStoreUrl = "http://5495564812.fxm6263467844.com/";
				}
				top.g_ulits.openApplication("tbrowser.common",appStoreUrl);
				return;
			}
            else if (top.scheduleApp == top.SCHEDULE_DIAL)
            {
                top.scheduleApp = 0;
                top.sendEvent("T-DIAL",top.E_APP_PROCESS_READY);
                return;
            }
			else if(top.scheduleApp == top.SCHEDULE_GLOBOPLAY)
			{
				top.scheduleApp = 0;
                tcl.channel.requestInputSource(10);
                top.g_setting.setProperty("app.ui.currentApp","globoSDK");
                top.g_ulits.openApplication("tvos.globoplay.activity","");
				return;
			}
            else if (top.scheduleApp == top.SCHEDULE_STR)
            {
                top.scheduleApp = 0;
                top.appOpenFlag = 0;
                top.$("main").src="channelPlay.html";
                top.toPowerOff();
            }

		    if(top.scheduleApp != top.SCHEDULE_HOMEPAGE)
			{
				top.lastInputSource = top.g_channel.getLastinputSource();
				console.log("channelPlay msg E_APP_CLOSE top.lastInputSource = " + top.lastInputSource);
				top.g_channel.inputSource = top.lastInputSource;
                top.g_setting.scaleVideoWindow(0, 0, 0, 0);
			}
			if(top.initGingaByNetflixFlag == 1 && top.g_setting.getProperty("ro.sita.model.FUNCTION_ENABLE_CFG.cfg_ginga_enable", "0") == "1" &&
                    top.isLAFlag)
			{
                top.initGingaByNetflixFlag = 0;
                top.isGingaOn = true;
                top.initGinga();
			}
			top.appOpenFlag = 0;
            setting.sendMsgToDBC(4);
			top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x400|0x800,2,0);
			top.$("main").onload=function(){
                top.$("main").style.display="block";
                top.$("operatePage").style.display="block";
                top.$("otherPage").style.display="block";
                top.$("main").onload=function(){};
            }
			if(top.scheduleApp == top.SCHEDULE_LOCAL_EPG)
			{
				top.scheduleApp = 0;
				if(top.isNAFlag)
				{
					top.$("main").src = "programGuide_NA.html";
				}
				else
				{
				top.$("main").src = "programGuide.html";
				}
			}
			else if (top.scheduleApp == top.SCHEDULE_HOMEPAGE)
			{
                top.scheduleApp = 0;
				top.openHomePage()
			}
			else
			{
				top.$("main").src="channelPlay.html"
			}
			break;
		case top.E_APP_CLOSE_REPLACE:
		{
			if(top.g_channel.inputSource==top.E_INPUT_STORAGE)
			{
		   		 top.g_channel.inputSource=1;
			}
			top.appOpenFlag = 0;
			top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x400|0x800,2,0);
			top.$("main").onload=function(){
				   	top.$("main").style.display="block";
					top.$("operatePage").style.display="block";
					top.$("otherPage").style.display="block";
					top.$("main").onload=function(){};
				}
			top.$("main").src="channelPlay.html"
			break
		}
		case top.E_APP_IPEPG_OPEN_LOCAL_EPG:
		{
			top.scheduleApp = top.SCHEDULE_LOCAL_EPG; 	
		}
		break;
		case top.E_POWER_OFF_TIMER:
		{
            if(top.g_setting.location > 0)//location 为shop 或者 shop with demo 不响应倒计时待机消息
            {
                return;
            }
			top.g_lastTime = evt.modifiers;
			if(top.appOpenFlag==0)
			{
				top.systemEventProc(evt);
			}
			else
			{
				appOpenPowerOff=1;
				top.$('otherPage').src = "powerOffTimer.html";
				top.$("otherPage").style.display="block";
			}
			break;
		}
		case top.E_POWER_OFF_TIMER_EX:
		{
		    if(top.g_setting.location > 0)//location 为shop 或者 shop with demo 不响应倒计时待机消息
            {
                return;
            }
			top.g_lastTime = 60;
			if(top.appOpenFlag==0)
			{
				top.systemEventProc(evt);
			}
			else
			{
				if(top.powerOffToShop() == "toShop")
				{
					top.$('otherPage').src = "powerOffTimerShop.html";
					top.$("otherPage").style.display="block";
				}
				else
				{
					appOpenPowerOff=1;
					top.$('otherPage').src = "powerOffTimer.html";
					top.$("otherPage").style.display="block";
				}
			}
			break;
		}
		case top.E_NETWORK_CONNECT_TEST_FAIL:
		case top.E_NETWORK_CONNECT_TEST_SUCCESS:
		top.systemEventProc(evt);
			break;
		case top.E_BOOKING_PLAY_START:
		case top.E_BOOKING_RECORD_START:
		case top.E_BOOKING_AHEAD_PLAY_START:
		case top.E_BOOKING_AHEAD_RECORD_START:
		case top.E_FACTORY_SET_OSD_LANGUAGE:
        case top.E_HP_PLUGIN:
        case top.E_HP_PLUGOUT:
			top.systemEventProc(evt);
			break;
		case top.E_APP_OPEN:
		{
            if(top.g_channel.checkhbbtvStatus() > 0)
            {
                top.globleHBBTVClose();
            }
			if(programStatus == 1)
			{
				if(top.timeShiftStatusFlag == 1)
				{
					top.g_pvr.timeshiftStop();
					top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
					top.g_pvr.returnToLive();//返回实时播放页面
					top.timeShiftStatusFlag = 0;
					top.$("globleShow").contentWindow.hiddenTimeShift();
					top.$("operatePage").src = "";
					top.requestFocus(top.main, 1);
				}
				if(top.recordStatusFlag==1)
				{
					top.g_pvr.recordStop();
					top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
					top.pvrCurrentTime = 0;
					top.recordStatusFlag = 0;
					top.pvrTotalTime = 2*60*60;
					top.$("globleShow").contentWindow.hiddenRecord();
					top.$("operatePage").src = "";
					top.requestFocus(top.main, 1);
				}
			}
			top.$("main").style.display="none";
			top.$("operatePage").style.display="none";
			top.$("otherPage").style.display="none";
			break;
		}
        case top.E_APP_PROCESS_INITIALIZATION:
        {
            top.systemEventProc(evt);
            break;
        }
		case top.E_STR_SCREEN_OFF:
		{
			var status = top.g_channel.checkhbbtvStatus();
			if(status !=0)
            {
                top.globleHBBTVClose();
            }
            top.systemEventProc(evt);
			break;
		}
		case top.E_STR_SCREEN_ON:
		{
		    if (channel.inputSource == 1 && top.supportHBBTV && top.recordStatusFlag == 0 && top.timeShiftStatusFlag == 0)
            {
                console.log("--in E_STR_SCREEN_ON and open hbbtv! ");
                top.globleHBBTVOpen();
            }
            else
            {
                top.globleHBBTVClose();
            }
            top.systemEventProc(evt);
			break;
		}
		case top.E_FACTORY_P_MODE_CTRL:
		{
			top.g_factory_hotkey = top.g_factory.factoryHotkey;
			notifyRefreshInfo();
			top.systemEventProc(evt);
			break;
		}		
		
		case top.E_REQ_CHANGE_CHANNEL:
		{
			console.log("in E_REQ_CHANGE_CHANNEL ----------------- value = "+value);
			var JSONObject = JSON.parse(Util.getEvent(value));
			console.log("in E_REQ_CHANGE_CHANNEL -----------------JSONObject.data1 = "+JSONObject.data1+" JSONObject.data2 = "+JSONObject.data2);
			var changeChannelMode = (JSONObject.data1 >>24) & 0xFF;
			///var changeChannelMode = 1;
			refreshInfobarFlag = (JSONObject.data1 >>16) & 0xFF;
			var channelID = JSONObject.data2;
			console.log("in changeChannelMode  = "+changeChannelMode+" refreshInfobarFlag = "+refreshInfobarFlag+" channelID = "+channelID);
			if(changeChannelMode == 0)
			{
				channel.playByIndex(channelID);
			}
			else if(changeChannelMode == 1)
			{
				if(oldKey==top.VK_CHANNEL_DOWN)
				{
					return;
				}
				else
				{
					clearTimeout(channelOldKeyTimer);
					oldKey = top.VK_CHANNEL_DOWN;
				}
				if(top.g_channel.checkhbbtvStatus()==3)
				{
					 top.$("operatePage").src = "";
					 top.$("otherPage").src ="";
					 top.$("main").src = "hbbtvCancelRemind.html?"+top.VK_CHANNEL_DOWN;
					 top.$("main").style.display = "block";
					 top.requestFocus(top.main, 1);
					 top.setFrameFocusPage("main");
					 return;
				}
				if(top.sourceChangeCheck(1) == true)
				{
					channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff; },400);
					top.$("operatePage").src = "";
					top.$("otherPage").src = "password.html?sourceLock:channelplay:downkey";
					top.$("otherPage").style.display = "block";
					top.requestFocus(top.otherPage, 0);
					top.setFrameFocusPage("otherPage");
					return;
				}
				channelDownKey();
				channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff; },400);
				return;
			}
			else if(changeChannelMode == 2)
			{
				if(oldKey==top.VK_CHANNEL_DOWN)
				{
					return;
				}
				else
				{
					clearTimeout(channelOldKeyTimer);
					oldKey = top.VK_CHANNEL_DOWN;
				}
				if(top.g_channel.checkhbbtvStatus()==3)
				{
					 top.$("operatePage").src = "";
					 top.$("otherPage").src ="";
					 top.$("main").src = "hbbtvCancelRemind.html?"+top.VK_CHANNEL_DOWN;
					 top.$("main").style.display = "block";
					 top.requestFocus(top.main, 1);
					 top.setFrameFocusPage("main");
					 return;
				}
				if(top.sourceChangeCheck(1) == true)
				{
					channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff; },400);
					top.$("operatePage").src = "";
					top.$("otherPage").src = "password.html?sourceLock:channelplay:downkey";
					top.$("otherPage").style.display = "block";
					top.requestFocus(top.otherPage, 0);
					top.setFrameFocusPage("otherPage");
					return;
				}
				channelDownKey();
				channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff; },400);
				return;
			}
			else
			{
				console.log("in E_REQ_CHANGE_CHANNEL ----------------do not ");
			}
			break;
		}
        case top.E_HBBTV_SHOW_MEDIA_LANG:
        {
            console.log("in E_HBBTV_SHOW_MEDIA_LANG -----------------");
            top.$("operatePage").src = "";
            top.$("otherPage").src = "quickMTS.html";
            top.$("otherPage").style.display = "block";
            top.requestFocus(top.otherPage, 0);
            top.setFrameFocusPage("otherPage");
            break;
        }
        case top.E_NOTIFY_DTV_SERVICE_EWBS:
        {
            console.log("revice E_NOTIFY_DTV_SERVICE_EWBS  value= "+value);
            //var value = evt.modifiers;
            if(value == 1){
                var chIndex = channel.getEWBSChannelIndex();
                if( (isEWBSRemindFlag == 0) && (chIndex != -1) && (chIndex != channelIndex)){
                    $("dialogContent").innerHTML = EWBSRemind;
                    var picReDivs=$("dialogButton").getElementsByTagName("span");
                    picReDivs[0].innerText=top.yesNo[0];
                    picReDivs[1].innerText=top.yesNo[1];
                    top.doEleScrForNoOption(picReDivs,1, 0);
                    selectFlag=0;
                    isEWBSRemindFlag = 1;
                    $("ewbsRemind").style.display = "block";
                }
            }
            else{
                $("ewbsRemind").style.display = "none";
                if(EWBS_org_chIndex != channelIndex && EWBS_org_chIndex != -1){
                    channel.playByIndex(EWBS_org_chIndex);
                    EWBS_org_chIndex = -1;
                    channelChangeStatus = 1;
                }
                isEWBSRemindFlag = 0;
                selectFlag = 0;
                $("ewbsRemindFocus").style.left="140px"
            }
            break;
        }
        case top.E_NOTIFY_DTV_SS_VIDEO_UNSUPPORTED:
        case top.E_NOTIFY_DTV_SS_AUDIO_UNSUPPORTED:
        {
            $("remind").innerHTML = channel_remind[16];
            $("remind").style.display = "block";
        }
            break;
        case top.E_NOTIFY_VRC_SET_VOL:
            console.log("--hzm revice E_NOTIFY_VRC_SET_VOL  value= "+ value + "  top.g_volume_visible = "+ top.g_volume_visible);
            top.$("globleShow").contentWindow.setVolumeByType(top.$("globleShow").contentWindow.curVolumeType,value);
            if (1)//(top.g_volume_visible == 0)
            {
                top.g_volume_visible = 1;
                top.$("operatePage").src = "";
                top.$("otherPage").src = "";
                top.$('globleShow').contentWindow.initVolume();
                top.$("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
                top.startVolumeTimer();
            }
            break;
        case top.E_NOTIFY_VRC_SET_CHANNEL_INDEX:
            console.log("--hzm revice E_NOTIFY_VRC_SET_CHANNEL_INDEX  value= "+ value);
            if (top.appOpenFlag == 1) return;
            onInsertNum(value);
            break;
        case top.E_NOTIFY_VRC_SET_INPUT_SOURCE:
            console.log("--hzm revice E_NOTIFY_VRC_SET_INPUT_SOURCE  value= "+ value + "  top.appOpenFlag = " + top.appOpenFlag);
            if (value == 10)
            {
                //暂时不实现
                //top.globalHotkeyHandle(top.VK_MEDIA);
                //var event = new Object();
                //event.which = top.VK_MEDIA;
                //top.document.getElementById("main").contentWindow.keyproc(event);
            }
            else
            {
                if (top.appOpenFlag == 1) return;
                top.toSourceEx(0,value);
            }
            break;
        case top.E_NOTIFY_VRC_START_AUTO_CHANNEL_SCAN:
            console.log("--hzm revice E_NOTIFY_VRC_START_AUTO_CHANNEL_SCAN  value = "+ value + "  top.appOpenFlag = " + top.appOpenFlag);
            if (top.appOpenFlag == 1) return;
            if(programStatus == 1)
            {
                if(top.timeShiftStatusFlag == 1)
                {
                    top.g_pvr.timeshiftStop();
                    top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
                    top.g_pvr.returnToLive();//返回实时播放页面
                    top.timeShiftStatusFlag = 0;
                    top.$("globleShow").contentWindow.hiddenTimeShift();
                    top.$("operatePage").src = "";
                    top.requestFocus(top.main, 1);
                }
                if(top.recordStatusFlag==1)
                {
                    top.g_pvr.recordStop();
                    top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
                    top.pvrCurrentTime = 0;
                    top.recordStatusFlag = 0;
                    top.pvrTotalTime = 2*60*60;
                    top.$("globleShow").contentWindow.hiddenRecord();
                    top.$("operatePage").src = "";
                    top.requestFocus(top.main, 1);
                }
            }
            top.cmd_vrc_auto_search_type = value;
            top.g_nextHtmlPage = "autoSearch.html";
            top.jumpToOperatePage("index.html");
            break;
		case top.E_READY_TO_CHANGE_SCART:
			if(top.appOpenFlag==1){
				top.systemEventProc(evt);
			}
			break;
		case top.E_NOTIFY_BTSPEAKER_CONNECT:
		case top.E_NOTIFY_BTSPEAKER_DISCONNECT:
				top.systemEventProc(evt);
			break;
		default:
			if(top.isAUFlag && top.isFirstInChanenlPlay && msg == top.E_MEDIA_USB_INSERTED)//au block usb insert msg
			{
				break;
			}
			top.systemEventProc(evt);
			break;
	}
}

function keyproc(evt)
{
	var keycode = evt.which;
    if(channel.inputSource == top.E_INPUT_HDMI_I && setting.tlinkStatus == 1) //信源为HDMI1,T-link状态为“on”
    {
        var ret = true;
		console.log("  keycode = "+keycode);
        switch (keycode)
        {
            case top.VK_PLAY_PAUSE:
            case top.VK_STOP:
            case top.VK_REWIND:
            case top.VK_FAST_FWD:
            case top.VK_PREV:
            case top.VK_NEXT:
            case top.VK_PAUSE:
            case top.VK_PLAY:
			if((inputSource == top.E_INPUT_HDMI_I)&&(setting.isMhlReady()))
			{
				setting.sendMhlKeyValue(keycode);
				return;
			}
			if(keycode== top.VK_BACK)
			{
				setting.sendCecKeyValue(1006);
			}
			else
			{
				setting.sendCecKeyValue(keycode);
			}
			return;
        }
    }


	if(top.isFirstInChanenlPlay)
	{
		return;
	}

    if(top.recordStatusFlag != 1 && top.timeShiftStatusFlag != 1 && showPageType != "showAudio" && showPageType != "showSubtile" && top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True )
	{
		console.log("Ginga.isEnable >>>>>>>>>>>>>>> Ginga.isEnable " + Ginga.isEnable);
		if(channel.inputSource == 1 && Ginga.isEnable == 1)//DTV and Ginga enable
		{

            var result = Ginga.sendKeyEvent(evt.which,1);//1->keydown;2->keyup
            console.log("Ginga.sendKeyEvent >>>>>>>>>>>>>>> result =  " + result);
            if(result == 0)
            {
                return;
            }

		}
	}
	/*
	 添加 hbbtv相关逻辑
	 1.检查hbbtv是否打开： 1 打开；0未打开
	 2.hbbtv为打开状态将所有按键发给hbbtv模块
	 3.根据返回值判断是否ui继续处理按键： 1 UI不需要处理；0 UI需要处理
	 */
	var tmpHbbtvStatu = channel.checkhbbtvStatus();
	if(showPageType != "showAudio" && showPageType != "showSubtile" && tmpHbbtvStatu >= 1 && tmpHbbtvStatu <= 3 && keycode != top.VK_EXIT && channel.currentSignalStatus == 1)// && top.g_setting.networkStatus())
	{
		if(channel.sendKeyToHbbtv(keycode) == 1)
		{
			console.log("hevens hbbtv keycode =  " + keycode + "has been send to hbbtv !!!");
			return;
		}
	}
	/*
		添加 mheg相关逻辑
		1.检查mheg是否打开： 1 打开；0未打开
		2.mheg为打开状态将所有按键发给mheg模块
		3.根据返回值判断是否ui继续处理按键： 1 UI不需要处理；0 UI需要处理
	*/
	if(showPageType != "showAudio" && showPageType != "showSubtile" && channel.getMheg5Status() == 1)
	{
		console.log("Mheg ---- keycode =  "+keycode);
		if(channel.transportKeyToMheg5(keycode) == 1)
		{
			console.log("this key transport to Mheg <----"+keycode);
			return;
		}
	}
	if(top.g_ciUpdateStatus==1 && evt.which != top.VK_POWER)
	{
			testLog("ci updating, no key action!! ");
			return;
	}
	if(powerDownTimer)
	{
		clearTimeout(powerDownTimer);
	}
	powerDownTimer = setTimeout("powerOffForSpecialSituation()",14*60*1000);
	if(showEsticker)
	{
		clearTimeout(showEsticker);
	}
	showEsticker = setTimeout("top.showEsticker()",30*1000);
	backLightState = setting.powerBacklightState;
	console.log("backLightState is "+backLightState+" top.recordStatusFlag is "+top.recordStatusFlag+" evt.which is "+evt.which);
	//netflix认证要求，任何情况下按netflix键都需要进入此应用, evt.which != 0 无效按键不能唤醒
    if(backLightState == 0 && top.recordStatusFlag == 1 && evt.which != top.VK_NETFLIX && evt.which != 0)
	{
        if (top.isSambaFlag == "true" && top.g_setting.getProperty("app.ui.sambaTV","1") =="1")
        {
           
            top.sendPowerModeToSamba("normal");//STR关闭时，待机刻录开机时发送normal给samba
        }

		testLog("top.mute_status is "+top.mute_status);
		top.forceMute(0);
		setting.powerBacklightState = 1; //待机录制由UI关闭背光，此刻也需要UI打开背光
		backLightState = 1;
		return;
	}
	if(appOpenPowerOff==1)//power off 在app open时的处理
	{
		top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
		top.$('operatePage').src = "";
		if(top.appOpenFlag==1)
		{
			top.$("operatePage").style.display="none";
		}
		top.g_lastTime = -1;
		top.g_setting.cancelPowerOff();
        top.standByTime = setting.autoStandby;//取消倒计时时，standByTime需要同步更新
		appOpenPowerOff=0;
		return;
	}
    if(top.appOpenFlag==1)
	{
		var keycode = evt.which;
		switch(keycode)
		{
			case top.VK_VOLUME_DOWN://volume down,多媒体不能共用
			case top.VK_VOLUME_UP://volume up
				top.$('globleShow').contentWindow.initVolume();
				if(top.$('globleShow').contentWindow.volumeCount > 0)
				{
					top.g_volume_visible = 1;
					top.$("operatePage").src = "";
					top.$("globleShow").contentWindow.$("adjustProgressBox").style.display = "block";
					top.setGlobleRemindEnable(1);
					top.requestFocus(top.globleShow, 0);
					top.setFrameFocusPage("globleShow");
					//top.startVolumeTimer();
				}
				break ;
			case top.VK_MUTE://key mute
				top.endT = new Date();
				top.showMute(1);
				break ;
			case top.VK_OPTION://APP下option按键响应
				if(top.appOpenFlag){
					top.$('otherPage').src = "option.html";
					top.$("otherPage").style.display="block";
					top.requestFocus(top.otherPage, 0);
					top.setFrameFocusPage("otherPage");
					return;
				}
				break ;
            case top.VK_POWER://power
            case top.VK_NETFLIX:
            case top.VK_YOUTUBE:
            case top.VK_INTERNET:
			case top.VK_APPS:
            case top.VK_MENU:
            case top.VK_TV:
            case top.VK_SOURCE:
            case top.VK_HOME:
            case top.VK_FRONT_PANEL_LOCKED:
			case top.VK_GLOBOPLAY:
			case top.VK_PANEL3_DOWN://按面板左侧键，-,（三键面板）
			case top.VK_PANEL3_UP://按面板右侧键，+,（三键面板）
			case top.VK_PANEL3_OK://按面板菜单键,（三键面板）
			case top.VK_PANEL3_LONG_OK://长按面板菜单键（三键面板）
				top.keyDownProcess(evt);
			 break ;
		}
		return;
	}
	top.g_previousHtmlPage = "channelPlay.html";
	var keycode = evt.which;
/*
	//check pwd for changing Prject Id
	switch (keycode)
	{
		case top.VK_0:
		case top.VK_1:
		case top.VK_2:
		case top.VK_3:
		case top.VK_4:
		case top.VK_5:
		case top.VK_6:
		case top.VK_7:
		case top.VK_8:
		case top.VK_9:
			top.enterProjIdPwd(keycode);
			break;
	}*/
	if(top.isLAFlag && isSearchingFlag)
	{
		switch(keycode)
		{
			case top.VK_POWER:
				break;
			default:
				return;
		}
	}
	if((inputSource >=6 && inputSource<=8) || inputSource == 12) 
	{
		switch (keycode)
		{
			case top.VK_VIRTUAL_REMOTE:
				//显示或者不显示--lqt---HDMI会走此逻辑
				top.Log("lqt--channplay.html---HDMI---VK_VIRTUAL_REMOTE");
				if(top.virtualRemoteState == 0)
				{
					if(setting.isMhlReady())
					{
						top.document.getElementById("virtualRemote").contentWindow.showVirtualRemote("HbbTV");
					}
					else
					{
						top.document.getElementById("virtualRemote").contentWindow.showVirtualRemote("HDMI");
					}
				}
				else
				{
					//隐藏虚拟遥控器
					top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
				}
				return;
				//lqt--虚拟遥控器的上键
			case top.VK_VIRTUAL_KEYBOARD_UP:
	    	{
	    		top.document.getElementById("virtualRemote").contentWindow.keyDownForUp();
	    		
	    		return;
	    	}
	    	//lqt--虚拟遥控器的下键
	    	case top.VK_VIRTUAL_KEYBOARD_DOWN:
	    	{
	    		top.document.getElementById("virtualRemote").contentWindow.keyDownForDown();
	    		
	    		return;
	    	}
	    	//lqt--虚拟遥控器的左键
	    	case top.VK_VIRTUAL_KEYBOARD_LEFT:
	    	{
	    		top.document.getElementById("virtualRemote").contentWindow.keyDownForLeft();
	    		
	    		return;
	    	}
	    	//lqt--虚拟遥控器的右键
	    	case top.VK_VIRTUAL_KEYBOARD_RIGHT:
	    	{
	    		top.document.getElementById("virtualRemote").contentWindow.keyDownForRight(); 
	    		
	    		return;
	    	}
	    	//lqt--鼠标的左键
			case top.VK_VIRTUAL_MOUSE_OK:
			{
				var clientX = top.g_setting.getProperty("memory.app.ui.virtualRemote.clientX", "0");
				var clientY = top.g_setting.getProperty("memory.app.ui.virtualRemote.clientY", "0");
				testLog("lqt---channelPlay.html---clientX: "+clientX);
				testLog("lqt---channelPlay.html---clientY: "+clientY);
				top.document.getElementById("virtualRemote").contentWindow.keyDownMouseClick(clientX,clientY); 
				
				return;
			}
	    	//lqt--虚拟遥控器的ok键
	    	case top.VK_VIRTUAL_KEYBOARD_OK:
	    	{
	    		top.document.getElementById("virtualRemote").contentWindow.keyDownForOK(); 
	    		
	    		return;
	    	}
	    	//lqt--虚拟遥控器的返回键
	    	case top.VK_VIRTUAL_KEYBOARD_BACK:
	    	{
	    		//如果是显示的话，就隐藏
	    		if(top.virtualRemoteState == 1)
	    		{
	    			//隐藏虚拟遥控器
	    			top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
	    		}
	    		
	    		return;
	    	}
			case top.VK_PLAY_PAUSE:
			case top.VK_PAUSE:
			case top.VK_PLAY:
			case top.VK_STOP:
			case top.VK_REWIND:
			case top.VK_FAST_FWD:
			case top.VK_PREV:
			case top.VK_NEXT:
			case top.VK_UP:
			case top.VK_DOWN:
			case top.VK_RED:
			case top.VK_GREEN:
			case top.VK_YELLOW:
			case top.VK_BLUE:
			case top.VK_PAUSE:
			case top.VK_RECORD:
			case top.VK_EXIT:
				if((inputSource == 6)&& setting.isMhlReady()/*(top.mhl_inserted_status)&&(top.mhl_signal_input_status)*/)
				{
					setting.sendMhlKeyValue(keycode);
				}
				else
				{
						//setting.sendCecKeyValue(keycode);
				}
				return;
            case top.VK_LEFT:
            case top.VK_RIGHT:
                if((inputSource == 6)&& setting.isMhlReady()/*(top.mhl_inserted_status)&&(top.mhl_signal_input_status)*/)
                {
                    setting.sendMhlKeyValue(keycode);
                    return ;
                }
                else
                {
                    break;
                }
			case top.VK_BACK:
				if((inputSource == 6)&& setting.isMhlReady()/*(top.mhl_inserted_status)&&(top.mhl_signal_input_status)*/)
				{
					setting.sendMhlKeyValue(keycode);
				}
				else
				{
						//setting.sendCecKeyValue(keycode);
				}
				break;
			case top.VK_ENTER://OK
			{
				if(top.inputLock == 1)
				{
					top.$("main").src = "password.html?channelLock";
					top.requestFocus(top.main, 1);
					top.setFrameFocusPage("main");
					
				}
				else
				{
					if((inputSource == 6)&&setting.isMhlReady()/*(top.mhl_inserted_status)&&(top.mhl_signal_input_status)*/)
					{
						testLog("MHL:" + keycode);
						setting.sendMhlKeyValue(keycode);
					}
					else
					{
							//setting.sendCecKeyValue(keycode);
					}
				}
				return;
			}
			case top.VK_0:
			case top.VK_1:
			case top.VK_2:
			case top.VK_3:
			case top.VK_4:
			case top.VK_5:
			case top.VK_6:
			case top.VK_7:
			case top.VK_8:
			case top.VK_9:
				if((inputSource == 6)&& setting.isMhlReady()/*(top.mhl_inserted_status)&&(top.mhl_signal_input_status)*/)
				{
					setting.sendMhlKeyValue(keycode);
					return;
				}
				else
				{
					//哥伦比亚按小数点后不能输入数字
					if(top.isCBFlag && inputSpotFlag) break;
					onInsertNum(keycode - 48);
					return;
				}
			default://由下面去处理按键
				break;
		}
	}
	//快捷键处理
	if(keycode!=top.VK_CHANNEL_UP&&keycode!=top.VK_CHANNEL_DOWN)
	{
		oldKey=0xffff;
	}
	switch (keycode)
	{
		case top.VK_PANEL3_DOWN:
		case top.VK_PANEL3_UP:
		case top.VK_PANEL3_OK:
			//PVR、TimeShift不响应面板按键
			if(top.recordStatusFlag || top.timeShiftStatusFlag) break;
			top.$('globleShow').contentWindow.on_off = "on";
		case top.VK_PANEL3_LONG_OK:
			//PVR、TimeShift不响应面板按键
			if(top.recordStatusFlag || top.timeShiftStatusFlag) break;
			testLog("--channelPlay.html--keycode---:"+keycode);
			top.$('globleShow').contentWindow.keyProc(evt);
			return;
		case top.VK_VIRTUAL_REMOTE:
			//显示或者不显示--lqt---非HDMI会走此逻辑
			top.Log("lqt--channplay.html---else(TV、AV、CMP)---VK_VIRTUAL_REMOTE");
			top.Log("lqt----------inputSource------------------- "+top.g_channel.inputSource);
			top.Log("lqt----------checkhbbtvStatus:------------- "+top.g_channel.checkhbbtvStatus());
			top.Log("lqt----------appOpenFlag------------------- "+top.appOpenFlag);
			//如果信源是TV：0、1  ，media：10
			if(top.g_channel.inputSource == 0||top.g_channel.inputSource == 1||top.g_channel.inputSource == 10)
			{
				if($("preSetBarPlay").style.display == "block")
				{
					top.Log("lqt----------preSetBarPlay------------------- "+$("preSetBarPlay").style.display);
					return;
				}
				if(top.g_channel.checkhbbtvStatus() == 3)//3表示，开始在hbbtv播放视频了。
				{
					//当HbbTV显示的时候，设置type为HbbTV
					if(top.virtualRemoteState == 0)
					{
						top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x20|0x40|0x80|0x100|0x200|0x800,2,0);//得到部分按键的优先级
						top.document.getElementById("virtualRemote").contentWindow.showVirtualRemote("HbbTV");
					}
					else
					{
						top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
						//隐藏虚拟遥控器
						top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
					}
					
				}
				else if(top.g_channel.checkhbbtvStatus() == 1||top.g_channel.checkhbbtvStatus() == 2)//1表示，没有显示任何hbbtv的内容，2表示右上角有hbbtv的提示，或者下方有hbbtv的导航。
				{
					//当HbbTV显示的时候，设置type为HbbTV
					if(top.virtualRemoteState == 0)
					{
						top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x20|0x40|0x80|0x100|0x200|0x800,2,0);//得到部分按键的优先级
						top.document.getElementById("virtualRemote").contentWindow.showVirtualRemote("TV");
					}
					else
					{
						top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
						//隐藏虚拟遥控器
						top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
					}
				}
				else
				{
					if(top.recordStatusFlag != 1&&top.timeShiftStatusFlag != 1)//如果PVR没有录制的话。且没有timeshift录制的话
					{
						if(top.virtualRemoteState == 0)
						{
							top.document.getElementById("virtualRemote").contentWindow.showVirtualRemote("TV");
						}
						else
						{
							//隐藏虚拟遥控器
							top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
						}
					}
					else
					{
						if(top.virtualRemoteState == 0)
						{
							top.document.getElementById("virtualRemote").contentWindow.showVirtualRemote(top.RemoteConntrolType);
						}
						else
						{
							//隐藏虚拟遥控器
							top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
						}
					}
				}
				
			}
			else if(top.g_channel.inputSource == 11||top.g_channel.inputSource == 4)
			{
				if(top.virtualRemoteState == 0)
				{
					top.document.getElementById("virtualRemote").contentWindow.showVirtualRemote("HDMI");
				}
				else
				{
					//隐藏虚拟遥控器
					top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
				}
			}
			
			return;
			//lqt--虚拟遥控器的上键
		case top.VK_VIRTUAL_KEYBOARD_UP:
		{
			top.document.getElementById("virtualRemote").contentWindow.keyDownForUp();
			
			return;
		}
		//lqt--虚拟遥控器的下键
		case top.VK_VIRTUAL_KEYBOARD_DOWN:
		{
			top.document.getElementById("virtualRemote").contentWindow.keyDownForDown();
			
			return;
		}
		//lqt--虚拟遥控器的左键
		case top.VK_VIRTUAL_KEYBOARD_LEFT:
		{
			top.document.getElementById("virtualRemote").contentWindow.keyDownForLeft();
			
			return;
		}
		//lqt--虚拟遥控器的右键
		case top.VK_VIRTUAL_KEYBOARD_RIGHT:
		{
			top.document.getElementById("virtualRemote").contentWindow.keyDownForRight(); 
			
			return;
		}
		//lqt--鼠标的左键
		case top.VK_VIRTUAL_MOUSE_OK:
		{
			var clientX = top.g_setting.getProperty("memory.app.ui.virtualRemote.clientX", "0");
			var clientY = top.g_setting.getProperty("memory.app.ui.virtualRemote.clientY", "0");
			testLog("lqt---channelPlay.html---clientX: "+clientX);
			testLog("lqt---channelPlay.html---clientY: "+clientY);
			top.document.getElementById("virtualRemote").contentWindow.keyDownMouseClick(clientX,clientY); 
			
			return;
		}
		//lqt--虚拟遥控器的ok键
		case top.VK_VIRTUAL_KEYBOARD_OK:
		{
			top.document.getElementById("virtualRemote").contentWindow.keyDownForOK(); 
			
			return;
		}
		//lqt--虚拟遥控器的返回键
		case top.VK_VIRTUAL_KEYBOARD_BACK:
		{
			//如果是显示的话，就隐藏
			if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			
			return;
		}
		case top.VK_VOLUME_UP://volume up
		case top.VK_VOLUME_DOWN://volume down
			if((inputSource == 6)&&setting.isMhlReady()/*(top.mhl_inserted_status)&&(top.mhl_signal_input_status)*/)
			{
				
			}
			else
			{
				//setting.sendCecKeyValue(keycode);
			}
		     break;
		case top.VK_SOURCE://source
		{
			if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
		}
		case top.VK_MUTE://mute
		case top.VK_POWER://power
		case top.VK_FAV://fav
		case top.VK_LIST://list
		case top.VK_ECO://eco
		case top.VK_SLEEP://sleep
        case top.VK_SOURCE_CMP1:
        case top.VK_SOURCE_VGA:
        case top.VK_SOURCE_AV1:
        case top.VK_SOURCE_HDMI1:
        case top.VK_SOURCE_HDMI2:
        case top.VK_SOURCE_HDMI3:
        case top.VK_SOURCE_HDMI4:
		case top.VK_SOUND:
		case top.VK_FREEZE:
		case top.VK_TUNER:
		case top.VK_PIC:	
		case top.VK_MTS:		
			if(getSportModeType() && top.g_factory.pvrOpenStatus)
			{
				console.log("will go sportMode!!!");
				return;
			}
			top.g_previousHtmlPage = "channelPlay.html";
			top.keyDownProcess(evt);
			return;
		case top.VK_LANG://lang		
			if((getSportModeType() && top.g_factory.pvrOpenStatus)
					||((top.isLAFlag||top.isNAFlag)&&top.g_channel.inputSource==top.E_INPUT_ATV))
			{
				console.log("will go sportMode!!!");
				return;
			}
			top.g_previousHtmlPage = "channelPlay.html";
			top.keyDownProcess(evt);
			return;
		case top.VK_MEDIA:
		case top.VK_NETFLIX:
        case top.VK_YOUTUBE:
		case top.VK_GLOBOPLAY:
        case top.VK_INTERNET:
		case top.VK_APPS:
        {
        	if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
            if(top.appOpenFlag == 1 && top.g_setting.getProperty("app.ui.currentApp","tbrowser.mmh")== "vod.netflix")
                return;
        	hideRemind();
            top.keyDownProcess(evt);     
            return; 
        }	
			
		case top.VK_RECORD://record
			if(programStatus == 1 && top.g_setting.getProperty("ro.sita.model.LiveTV.PVR","FALSE") == "TRUE")
			{
				top.g_previousHtmlPage = "channelPlay.html";
				top.specialKeyDownProcess(evt);
			}
			else if((1 == inputSource) && (1 == top.isNAFlag) && ("true" == top.isSCBCFlag))
			{
				top.$("operatePage").src = "";
				top.g_remindWord = "notFunction";
				top.$("main").src = "intermediate.html";
				top.$("main").style.display = "block";
			}
			return;
		case top.VK_ZOOM_DOWN://zoom-
		case top.VK_ZOOM_UP://zoom+
			top.g_previousHtmlPage = "channelPlay.html";
			top.keyDownProcess(evt);
			return;
		/*case top.VK_LANG://lang
			if(showPageType == "showAudio")
			{
				toAudioLangback();
				return;
			}
			if(programStatus == 1)
			{
				if(inputSource == 0)
				{
					if(channelInfo_visible)
					{
						if(show_moreInfo_flag == 0 || show_moreInfo_flag == 3 || show_moreInfo_flag == 4 || show_moreInfo_flag == 5)
						{
							initSoundType();
						}
						else
						{
							doChangeSoundType();
						}
					}
					else
					{
						refreshChannelInfoTimer();
					}
					
					if(show_moreInfo_flag == 0)
					{
						show_moreInfo_flag = 1;
					}
					else if(show_moreInfo_flag == 3 || show_moreInfo_flag == 4 || show_moreInfo_flag == 5)
					{
						show_moreInfo_flag = 6;
					}
					hideRemind();
					showInfoFrom();//in showInfoFrom,channelInfo_visible == 1 
				}
				else if(inputSource == 1&& top.channelLock != 1 && top.parentalLock!=1&&top.inputLock != 1)
				{
					if(showPageType == "")
					{
						showAudioSelectList();
					}
				}
				else if(inputSource ==  1&&(top.channelLock == 1 || top.parentalLock==1 || top.inputLock == 1))
				{
					top.g_remindWord = "notAvailable";
					top.$("main").src = "intermediate.html";
					top.requestFocus(top.main, 1);
					top.setFrameFocusPage("main");
					top.$("operatePage").src = "";
				}
                else if(top.g_channel.checkhbbtvStatus()>2 && inputSource==10)
                {
                    if(showPageType == "")
					{
						showAudioSelectList();
					}
                }
			}*/
			return;
		case top.VK_HOME:
		case top.VK_MENU:
		{
			if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			top.keyDownProcess(evt);
			return;
		}
			
		case top.VK_CHANNEL_UP://channel up
			
			if(oldKey==top.VK_CHANNEL_UP)
			{
				return;
			}
			else
			{
				clearTimeout(channelOldKeyTimer);
				oldKey = top.VK_CHANNEL_UP;
			}
			if(top.g_channel.checkhbbtvStatus()==3)
			{
				 top.$("operatePage").src = "";
				 top.$("otherPage").src ="";
				 top.$("main").src = "hbbtvCancelRemind.html?"+top.VK_CHANNEL_UP;
				 top.$("main").style.display = "block";
				 top.requestFocus(top.main, 1);
				 top.setFrameFocusPage("main");
				 return;
			}
			if(top.sourceChangeCheck(0) == true)
			{
				channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff; },400);
				top.$("operatePage").src = "";
				top.$("otherPage").src = "password.html?sourceLock:channelplay:upkey";
				top.$("otherPage").style.display = "block";
				top.requestFocus(top.otherPage, 0);
				top.setFrameFocusPage("otherPage");
				return;
			}
			channelUpKey();
			channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff;},400);
			return;
		case top.VK_CHANNEL_DOWN://channel down
			if(oldKey==top.VK_CHANNEL_DOWN)
			{
				return;
			}
			else
			{
				clearTimeout(channelOldKeyTimer);
				oldKey = top.VK_CHANNEL_DOWN;
			}
			if(top.g_channel.checkhbbtvStatus()==3)
			{
				 top.$("operatePage").src = "";
				 top.$("otherPage").src ="";
				 top.$("main").src = "hbbtvCancelRemind.html?"+top.VK_CHANNEL_DOWN;
				 top.$("main").style.display = "block";
				 top.requestFocus(top.main, 1);
				 top.setFrameFocusPage("main");
				 return;
			}
			if(top.sourceChangeCheck(1) == true)
			{
				channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff; },400);
				top.$("operatePage").src = "";
				top.$("otherPage").src = "password.html?sourceLock:channelplay:downkey";
				top.$("otherPage").style.display = "block";
				top.requestFocus(top.otherPage, 0);
				top.setFrameFocusPage("otherPage");
				return;
			}
			channelDownKey();
			channelOldKeyTimer=setTimeout(function(){oldKey = 0xffff; },400);
			return;
		case top.VK_PRE_CH://pre-ch
            toPreChannel();
			return;
		case top.VK_BACK:
			{
				if(showPageType == "showAudio" || showPageType == "showSubtile" ||showPageType == "closeSubtitleForMheg5")
				{
					toAudioLangback();
					return;
				}
				if(top.g_factory.designModeHotkey==1)
				{
					top.g_factory_mode = 0;
					document.location.href="factory/designMenu.html";
					return;
				}
				if(top.g_factory.factoryHotkey==1)
				{
					top.g_factory_mode = 1;
					document.location.href="factory/factoryMenu.html";
					return;
				}
				if(isEWBSRemindFlag == 1)
				{
					selectFlag = 0;
					isEWBSRemindFlag = 0;
					$("ewbsRemindFocus").style.left="140px"
					$("ewbsRemind").style.display = "none";
					return;
				}
                if(1)
                {
                    toPreChannel();
                }
				return;
			}
        case top.VK_LEFT:
        {
            if(isEWBSRemindFlag == 1){
                changeRemindFocus();
                return ;
            }
            if(top.isLAFlag||top.isNAFlag)
            {
                top.openZoomMenu();
                return ;
            }
        }
        case top.VK_RIGHT:
        {
            if(isEWBSRemindFlag == 1){
                changeRemindFocus();
                return ;
            }
            if(top.isLAFlag||top.isNAFlag)
            {
                top.openZoomMenu();
                return ;
            }
        }
        case top.VK_ENTER:
        {
            if(isEWBSRemindFlag == 1){
                toEnterEWBS();
                return ;
            }
        }
		default:
			break;
	}
	if(CI_Mheg5OpenStatus==0 && top.g_openMheg5State==0)
	{
		switch (keycode)
		{
			case top.VK_GREEN:
			{
				doGreenKey();
			}
			break;
			case top.VK_INFO:// info
            {
				manualInfoStatus = 1;
				checkInfoKey(0);
                if (nscreenTimer)
                {
                    clearTimeout(nscreenTimer);
                    nscreenTimer = 0;
                }
                if (top.checkNetStatus()&&top.supportTVRemote)
                {
                    nscreenTimer = setTimeout(function(){
                        top.$('otherPage').src = "nScreenQRCode.html";
                        top.otherPage.focus();
                        top.setFrameFocusPage("otherPage");
                    },2000);
                }
				return;
            }
			case top.VK_SUBTITLE://subtitle
				if ((top.isLAFlag || top.isNAFlag) && (!(top.isCBFlag && inputSource == 1))) {
					if (top.preTempPage == "media" || top.appOpenFlag == 1)
						return;
					top.specialKeyDownProcess(evt);
					return;
				}
				else {
					if (top.g_channel.checkhbbtvStatus() > 2) {
						return;
					}
					if (showPageType == "showSubtile") {
						toAudioLangback();
						return;
					}
					if (programStatus == 1) {
						if (inputSource == 1 && top.channelLock != 1 && top.parentalLock != 1 && top.inputLock != 1) {
							if (showPageType == "") {
								showSubtitleList();
							}

						}
						else if ((inputSource == 0 && top.channelLock == 1) || (inputSource == 1 && (top.channelLock == 1 || top.parentalLock == 1)) || top.inputLock == 1) {
							checkInfoKey(0);
						}
						else if (inputSource == top.E_INPUT_ATV || inputSource == top.E_INPUT_AV_I || inputSource == top.E_INPUT_AV_II || inputSource == top.E_INPUT_YPBPR)//在这些信源下直接切换subtitle,而不需要显示
						{
							currentChannel.setProgramSubtitleMode();
						}
					}
					return;
				}
		    case top.VK_GUIDE://guide
            {
				top.$("globleShow").contentWindow.hiddenGlassRemind();
				if(top.hbbtvCancelKeyOperation(top.VK_GUIDE)==true)
				{
					return;
				}
				top.g_previousHtmlPage = "channelPlay.html";
				if(top.g_channel.inputSource == 1 && top.inputLock != 1)
				{
					 if(top.currentPanel==1)
					 {
						if(top.g_setting.pic3DMode!=0)
						{
							top.g_setting.pic3DMode=0;
							top.$("globleShow").contentWindow.hiddenGlassRemind();
						}
					}
					else if(top.currentPanel==2)
					{
						if(top.g_setting.pic3DMode!=0)
						{
							top.g_setting.pic3DMode=0;
						}
					}
					top.g_isUsedHotKeyToIntoPage = 1;
					if(top.recordStatusFlag == 1)
					{
						top.$("globleShow").contentWindow.hiddenRecord();
						top.clearMyTimeout();
						top.$('main').src = "pvr/Pvr.html?guide";
						return;
					}
					else if(top.timeShiftStatusFlag == 1)
					{
						top.$("globleShow").contentWindow.hiddenTimeShift();
						top.$('main').src = "pvr/timeshift.html?guide";
						return;
					}
				}
                top.openEPG();
				top.requestFocus(top.main, 1);
				top.$("operatePage").src = "";
            }
			return;			
		    case top.VK_OPTION://option
		    if(top.virtualRemoteState == 1)
			{
				//隐藏虚拟遥控器
				top.document.getElementById("virtualRemote").contentWindow.hideVirtualRemote();
			}
			top.g_previousHtmlPage = "channelPlay.html";
			top.keyDownProcess(evt);
			return;
			case top.VK_TV://tv,在mheg下边不能响应
				top.g_previousHtmlPage = "channelPlay.html";
				top.keyDownProcess(evt);
				break;
			case top.VK_EXIT:
				if(showPageType == "showAudio" || showPageType == "showSubtile" ||showPageType == "closeSubtitleForMheg5")
				{
					toAudioLangback();
					return;
				}
				if(channelInfo_visible)
				{
					hideInfoForm();
					showRemind();
				}
				else
				{
				    //HBBTV exit按键统一使用sendKeyToHbbtv接口，方便中间件同事debug
					//channel.exitHbbtv();
                    if(channel.sendKeyToHbbtv(top.VK_EXIT) == 1)
                    {
                        console.log(" hbbtv keycode = VK_EXIT has been send to hbbtv !!!");
                    }
				}
				if(programStatus == 1)
				{
					if(top.timeShiftStatusFlag == 1)
					{
						top.$("globleShow").contentWindow.hiddenTimeShift();
						top.$('main').src = "pvr/timeshift.html?stop";
						top.$("main").style.display = "block";
						top.$("operatePage").src = "";
						top.requestFocus(top.main, 1);
					}
					if(top.recordStatusFlag==1)
					{
						top.$("operatePage").src = "";
						top.$("globleShow").contentWindow.hiddenRecord();
						top.$('main').src = "pvr/Pvr.html?exit";
						top.requestFocus(top.main, 1);
					}
				}
				if(enterNumFlag==1)
				{
					if(top.isLAFlag|| top.isNAFlag)
					{
						if(playChannelNumber)
						{
							clearTimeout(playChannelNumber);
							playChannelNumber=0;
						}
						isSearchingFlag = false;
						inputMainChNum = -1;
						inputSubChNum = -1;
						enterNumFlag = 0;
						inputSpotFlag = false;
						hideInfoAndShowRemind();
					}
				}
				break;
			case top.VK_PLAY_PAUSE://pause/play timeshift
			case top.VK_PAUSE:
			case top.VK_PLAY:
			//case top.VK_TELETEXT://text
			case top.VK_STOP:
			case top.VK_REWIND://fastBackward
			case top.VK_FAST_FWD://fastForward
				if(programStatus == 1)
				{
					top.specialKeyDownProcess(evt);
				}
				break;
			case top.VK_TELETEXT://text
			{
				top.g_previousHtmlPage = "channelPlay.html";
				if(top.channelLock || top.parentalLock || top.inputLock || top.recordStatusFlag==1 || top.timeShiftStatusFlag == 1)
				{
					top.g_remindWord = "notSupport";
					top.$("main").src = "intermediate.html";
				}
				else
				{
					if(!top.g_channel.currentSignalStatus)
					{
					   top.g_remindWord = "noTeletext";
					   top.$("operatePage").src = "";
					   top.$("main").src = "intermediate.html";
					   top.$("main").style.display = "block";
						
					   return;
					}
					else
					{
                        console.log("====huangzhming HbbtvStatus="+channel.checkhbbtvStatus());
					    console.log("====huangzhming isHbbtvTTXExist="+setting.isHbbtvTTXExist()+"  isTtxAvailable="+setting.isTtxAvailable+"  networkStatus="+setting.networkStatus());
                        if ( setting.isHbbtvTTXExist() && setting.isTtxAvailable && setting.networkStatus())//有HbbTV的Teletext应用，也有DTV的Teletext
                        {
                            if (setting.isHbbtvTTXOpen())
                            {
                                setting.closeHbbtvTTX();
                                setting.openttx();
                                top.$("operatePage").src = "";
                                top.$("main").src = "TeletextMenu.html";
                                top.$("main").style.display = "block";
                            }
                            else
                            {
                                setting.openHbbtvTTX();
                            }
                        }
                        else if (setting.isHbbtvTTXExist() && setting.networkStatus() && !setting.isTtxAvailable)//有HbbTV的Teletex应用，没有DTV的teletext
                        {
                            if (setting.isHbbtvTTXOpen())
                            {
                                setting.closeHbbtvTTX();
                            }
                            else
                            {
                                setting.openHbbtvTTX();
                            }
                        }
                        else //只有DTV的Teletext
                        {
                            if(top.g_setting.openttx())
                            {
                                top.$("operatePage").src = "";
                                top.$("main").src = "TeletextMenu.html";
                                top.$("main").style.display = "block";

                            }
                            else
                            {
                                var Mheg5Status=top.g_channel.getMheg5Status();
                                if(Mheg5Status==1)
                                {
                                    if(setting.enableSubtitle==1)
                                    {
                                        showSubtitleRemind("closeSubtitleForMheg5");
                                    }
                                    else
                                    {
                                        top.g_openMheg5State=1;
                                        channel.transportKeyToMheg5(keycode);
                                    }
                                }
                                else
                                {
                                    top.$("operatePage").src = "";
                                    top.g_remindWord = "noTeletext";
                                    top.$("main").src = "intermediate.html";
                                    top.$("main").style.display = "block";
                                }
                            }
                        }
					    /*console.log("======top.hbbtvCancelKeyOperation(top.VK_TELETEXT)="+top.hbbtvCancelKeyOperation(top.VK_TELETEXT));
                        if(top.hbbtvCancelKeyOperation(top.VK_TELETEXT)==true)
						{
							return;
						}*/
					}
				}
				top.requestFocus(top.main, 1);
				top.setFrameFocusPage("main");
			}
			break;
			case top.VK_RED:
			case top.VK_BLUE:
				if(channel.getMheg5Status() == 1)
				{
					try
					{
						testLog("setting.enableSubtitle==="+setting.enableSubtitle);
						if(setting.enableSubtitle==1)
						{
							showSubtitleRemind("closeSubtitleForMheg5");
						}
						else
						{
							top.g_openMheg5State=1;
							channel.transportKeyToMheg5(keycode);
						}
					}
					catch(er)
					{
						testLog("setting.enableSubtitle==="+er);
					}
				}
				else
				{
					top.keyDownProcess(evt);
				}
				break;
			case top.VK_ENTER://OK
				if(/*channelInfo_visible == 0 && */(((inputSource == 0 || inputSource == 1 )&&top.channelLock == 1) || top.parentalLock==1 || top.inputLock == 1) && enterNumFlag != 1)
				{
					top.$("main").src = "password.html?channelLock";
					top.requestFocus(top.main, 1);
					top.setFrameFocusPage("main");
					
					break;
				}
				else if(enterNumFlag==1)
				{
					if(top.isLAFlag || top.isNAFlag)
					{
						console.log("===================  isSearchingFlag = " + isSearchingFlag);
						if(!isSearchingFlag)//如果在搜索之中，则不去检测
						{
							inputNumCheck();
						}
					}
					else
					{
						onPlayByNum();
					}
				}
				else if(showPageType == "showAudio")
				{
					toAudioLangOK();
				}
				else if(showPageType == "showSubtile")
				{
					toSubtitleOK();
				}
				else if(showPageType == "closeSubtitleForMheg5")
				{
					toOKCloseSubtitleSelect();
				}
				else if((inputSource == 0 || inputSource == 1 )&&programStatus == 0)
				{
					var install_lock = top.g_setting.installLock;//off 0    on 1
					if(top.g_factory.hotelEnable == 1 && (top.g_factory.hotelChLock == 1  || top.g_factory.menuLock == 1))
					{
						top.g_nextHtmlPage = "channelSet.html";
						top.jumpToOperatePage("index.html");

					}
					else if(install_lock == 1)
					{//开
						top.g_nextHtmlPage = "channelSet.html";
						top.jumpToOperatePage("index.html");

					}
					else 
					{
						top.g_nextHtmlPage = "channelScan.html";
						top.jumpToOperatePage("index.html");

					}
				}
                else if((inputSource == 0 || inputSource == 1 )&& programStatus == 1 && !top.channelLock && !top.parentalLock && !top.inputLock && !top.timeShiftStatusFlag && !top.recordStatusFlag)
                {
                    if(top.preTempPage=="media"||top.preTempPage=="homePage"||top.appOpenFlag)
                        return;
                    if(top.g_channel.checkhbbtvStatus()==3)
                    {
                        $("operatePage").src = "";
                        $("otherPage").src ="";
                        $("main").src = "hbbtvCancelRemind.html?"+VK_LIST;
                        $("main").style.display = "block";
                        top.requestFocus(top.main, 1);
                        setFrameFocusPage("main");
                        return;
                    }
                    if(getSportModeType() && top.g_factory.pvrOpenStatus)
                    {
                        console.log("will go sportMode!!!");
                        return;
                    }
                    top.toChannelList();
                }
				break;
			case top.VK_0:
			case top.VK_1:
			case top.VK_2:
			case top.VK_3:
			case top.VK_4:
			case top.VK_5:
			case top.VK_6:
			case top.VK_7:
			case top.VK_8:
			case top.VK_9:
				//哥伦比亚按小数点后不能输入数字
				if(top.isCBFlag && inputSpotFlag) break;
				onInsertNum(keycode - 48);
				break;
			case top.VK_PERIOD://只在LA NA项目中 且LA项目tunermode 为 5 时才有DTV搜索 哥伦比亚只有antenna下才有DTV节目
				if((top.isLAFlag && channel.tunerMode == 5) || top.isNAFlag || (top.isCBFlag && channel.tunerMode == 1))
				{
					onInsertSpot();
				}
				break;
			case top.VK_DOWN:
				toDown();
				ret = false;
				break;  
			case top.VK_UP:
				toUp();
				ret = false;
				break;
		   case top.VK_LEFT:
		   		/*  目前去掉左右键调节声音
				top.$('globleShow').contentWindow.initVolume();
				top.g_volume_visible = 1;
				top.$("operatePage").src = "";
				top.$("globleShow").contentWindow.$("volumeForm").style.display = "block";
				top.requestFocus(top.globleShow, 0);
				top.setFrameFocusPage("globleShow");
				//showMute(0);//不能解除mute
				top.startVolumeTimer();
				*/
				if(showPageType == "closeSubtitleForMheg5")
				{
					positionV--;
					if(positionV<0)
					{
						positionV=1;
						$("subtitleRemindFocus").style.left="420px";
					}
					else
					{
						$("subtitleRemindFocus").style.left="190px";
					}
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
					}
					audioShowTimer=setTimeout("toAudioLangback()",10*1000);
				}
				break;
			case top.VK_RIGHT:
				/*  目前去掉左右键调节声
				top.$('globleShow').contentWindow.initVolume();
				top.g_volume_visible = 1;
				top.$("operatePage").src = "";
				top.$("globleShow").contentWindow.$("volumeForm").style.display = "block";
				top.requestFocus(top.globleShow, 0);
				top.setFrameFocusPage("globleShow");
				//showMute(0);
				top.startVolumeTimer();
				*/
				if(showPageType == "closeSubtitleForMheg5")
				{
					positionV++;
					if(positionV>1)
					{
						positionV=0;
						$("subtitleRemindFocus").style.left="190px";
					}
					else
					{
						$("subtitleRemindFocus").style.left="420px";
					}
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
					}
					audioShowTimer=setTimeout("toAudioLangback()",10*1000);
				}
				break;
			default:
				top.keyDownProcess(evt);
				return;
		}
	}
	else if(CI_Mheg5OpenStatus >0 || top.g_openMheg5State==1)
	{
		channelMhegLevel=channel.getMheg5Level();
		switch (keycode)
		{	
			case top.VK_TV://tv,在mheg下边不能响应
				break;
			case top.VK_LEFT:
				if(channelMhegLevel!=0)
				{
					channel.transportKeyToMheg5(keycode);
				}
				else
				{/*  目前去掉左右键调节声
					top.$('globleShow').contentWindow.initVolume();
					top.g_volume_visible = 1;
					top.$("operatePage").src = "";
					top.$("globleShow").contentWindow.$("volumeForm").style.display = "block";
					top.requestFocus(top.globleShow, 0);
					top.setFrameFocusPage("globleShow");
					//showMute(0);//不能解除mute
					top.startVolumeTimer();
					*/
				}
				break;
			case top.VK_UP:
				if(channelMhegLevel!=0)
				{
					channel.transportKeyToMheg5(keycode);
				}
				else
				{
					toUp();
				}
				break;
			case top.VK_RIGHT:
				if(channelMhegLevel!=0)
				{
					channel.transportKeyToMheg5(keycode);
				}
				else
				{
					/*  目前去掉左右键调节声
					top.$('globleShow').contentWindow.initVolume();
					top.g_volume_visible = 1;
					top.$("operatePage").src = "";
					top.$("globleShow").contentWindow.$("volumeForm").style.display = "block";
					top.requestFocus(top.globleShow, 0);
					top.setFrameFocusPage("globleShow");
					//showMute(0);
					top.startVolumeTimer();
					*/
				}
				break;
			case top.VK_DOWN:
				if(channelMhegLevel!=0)
				{
					channel.transportKeyToMheg5(keycode);
				}
				else
				{
					toDown();
				}
				break;
			case top.VK_ENTER:
				if((channelNumShowStatus == 0||channelInfo_visible == 0)&&(channelMhegLevel != 0))
				{
					channel.transportKeyToMheg5(keycode);
				}
				else if(/*channelInfo_visible == 0 && */(((inputSource == 0 || inputSource == 1 )&&top.channelLock == 1) ||top.parentalLock==1 || top.inputLock == 1) && enterNumFlag != 1)
				{
					top.$("main").src = "password.html?channelLock";
					top.requestFocus(top.main, 1);
					top.setFrameFocusPage("main");
					break;
				}
				else if(enterNumFlag==1)
				{
					if(top.isLAFlag|| top.isNAFlag)
					{
						console.log("===================  isSearchingFlag = " + isSearchingFlag);
						if(!isSearchingFlag)//如果在搜索之中，则不去检测
						{
							inputNumCheck();
						}
					}
					else
					{
						onPlayByNum();
					}
				}
				else if(showPageType == "showAudio")
				{
					toAudioLangOK();
				}
				else if(showPageType == "showSubtile")
				{
					toSubtitleOK();
				}
				else if((inputSource == 0 || inputSource == 1 )&&programStatus == 0)
				{
					var install_lock = top.g_setting.installLock;//off 0    on 1
					if(top.g_factory.hotelEnable == 1 && top.g_factory.hotelChLock == 1)
					{
						top.g_nextHtmlPage = "channelSet.html";
						top.jumpToOperatePage("index.html");
					}
					else if(install_lock == 1)
					{//开
						top.g_nextHtmlPage = "channelSet.html";
						top.jumpToOperatePage("index.html");
					}
					else 
					{
						top.g_nextHtmlPage = "channelScan.html";
						top.jumpToOperatePage("index.html");
					}
				}
				break;
			case top.VK_RED:
			case top.VK_GREEN:
			case top.VK_YELLOW:
			case top.VK_BLUE:
				channel.transportKeyToMheg5(keycode);
				break;
			case top.VK_PLAY_PAUSE:
			case top.VK_PAUSE:
			case top.VK_PLAY:
			case top.VK_STOP:
			case top.VK_REWIND:
			case top.VK_FAST_FWD:
			case top.VK_PREV:
			case top.VK_NEXT:
			
				if(channelMhegLevel==3)
				{
					channel.transportKeyToMheg5(keycode);
				}
				break;
			case top.VK_EXIT:
			case top.VK_TELETEXT:
				top.g_openMheg5State=0;
				channel.transportKeyToMheg5(keycode);
				break;
			case top.VK_GUIDE://guide
				if(channelMhegLevel==3)
				{
					channel.transportKeyToMheg5(keycode);
				}
				else
				{
					try
					{
						top.$("globleShow").contentWindow.hiddenGlassRemind();
						if(top.hbbtvCancelKeyOperation(top.VK_GUIDE)==true)
						{
							return;
						}
						top.g_previousHtmlPage = "channelPlay.html";
						if(top.g_channel.inputSource == 1 && top.inputLock != 1)
						{
							 if(top.currentPanel==1)
							 {
								if(top.g_setting.pic3DMode!=0)
								{
									top.g_setting.pic3DMode=0;
									top.$("globleShow").contentWindow.hiddenGlassRemind();
								}
							}
							else if(top.currentPanel==2)
							{
								if(top.g_setting.pic3DMode!=0)
								{
									top.g_setting.pic3DMode=0;
								}
							}
							top.g_isUsedHotKeyToIntoPage = 1;
							if(top.recordStatusFlag == 1)
							{
								top.$("globleShow").contentWindow.hiddenRecord();
								top.clearMyTimeout();
								top.$('main').src = "pvr/Pvr.html?guide";
								return;
							}
							else if(top.timeShiftStatusFlag == 1)
							{
								top.$("globleShow").contentWindow.hiddenTimeShift();
								top.$('main').src = "pvr/timeshift.html?guide";
								return;
							}
							if(0/*top.checkNetStatus()&&setting.guideOnSwitch==1*/)
							{
								top.lastInputSource = top.g_channel.inputSource;
								top.appOpenFlag=1;
                                top.g_setting.setProperty("app.ui.currentApp","tbrowser.ipepg");
								top.g_ulits.setKeySet(0x1|0x2|0x4|0x8|0x10|0x20|0x40|0x80|0x100|0x200|0x800,2,0);
								top.$("main").style.display="none";
								top.$("operatePage").style.display="none";
								top.$("otherPage").style.display="none";
								top.RemoteConntrolType = "EPG";//lqt- 设置虚拟遥控器的场景类型--主要给IPEPG使用
								top.g_ulits.openApplication("tbrowser.ipepg","http://eurepg.huan.tv/"/*"-u "+applist[12].url+" "*/);
							}
							else
							{
								top.appOpenFlag=0;
								if(top.isNAFlag)
								{
									top.$("main").src = "programGuide_NA.html";
								}
								else
								{
								top.$("main").src = "programGuide.html";
								}
							}
						}
						else
						{
							top.g_remindWord = "notAvailable";
							top.$("main").src = "intermediate.html";
						}
						top.requestFocus(top.main, 1);
						top.$("operatePage").src = "";
					}
					catch(er)
					{
						testLog(er);
					}
					return;			
				}
				break
		    case top.VK_OPTION://option
				if(channelMhegLevel==3)
				{
					channel.transportKeyToMheg5(keycode);
				}
				else
				{
					top.g_previousHtmlPage = "channelPlay.html";
					top.keyDownProcess(evt);
				}
				break;
			case top.VK_INFO:// info
				if(channelMhegLevel==3)
				{
					channel.transportKeyToMheg5(keycode);
				}
				else
                {
                    checkInfoKey(1);
                    if (nscreenTimer)
                    {
                        clearTimeout(nscreenTimer);
                        nscreenTimer = 0;
                    }
                    if (top.checkNetStatus()&&top.supportTVRemote)
                    {
                        nscreenTimer = setTimeout(function(){
                            top.$('otherPage').src = "nScreenQRCode.html";
                            top.otherPage.focus();
                            top.setFrameFocusPage("otherPage");
                        },2000);
                    }
				}
				break;
			case top.VK_0:
			case top.VK_1:
			case top.VK_2:
			case top.VK_3:
			case top.VK_4:
			case top.VK_5:
			case top.VK_6:
			case top.VK_7:
			case top.VK_8:
			case top.VK_9:
				//哥伦比亚按小数点后不能输入数字
				if(top.isCBFlag && inputSpotFlag) break;
				onInsertNum(keycode - 48);
				break;
			default:
				top.keyDownProcess(evt);
				break;
		}
	}
}

function $(id)
{
    return document.getElementById(id);
}
function initPre()
{
			
	if(inputSource > 1)
	{
		programStatus = 1;
		if(top.g_isShowInfoBar == 1)//且不是节目预定引起的节目跳转
		{
			refreshChannelInfoTimer();
			show_moreInfo_flag = 1;
			hideRemind();
			showInfoFrom();
			top.g_isShowInfoBar = 0;
		}
		else
		{
			hideInfoForm();
			showRemind();
		}
	}
	else
	{
		if(!programStatus)// 显示no program info的条件
		{
			programStatus = 0;
			hideInfoForm();
			showRemind();
		}
		else
		{
			programStatus = 1;
			if(top.g_MMHStatus == 1)//MMH开启
			{
				if(!channel.currentSignalStatus)//可以显示info bar的条件，无信号且不是节目预定引起的节目跳转
				{
					initAudioMode();
					refreshChannelInfoTimer();
					show_moreInfo_flag = 1;
					hideRemind();
					showInfoFrom();
				}
				else
				{
					hideRemind();
					hideInfoForm();
				}
			}
			else
			{
				if(top.g_isShowInfoBar == 1)//且不是节目预定引起的节目跳转
				{
					initAudioMode();
					refreshChannelInfoTimer();
					show_moreInfo_flag = 1;
					hideRemind();
					showInfoFrom();
					top.g_isShowInfoBar = 0;
				}
				else
				{
					hideInfoForm();
					showRemind();
				}
			}
		}
	}
	if(top.isChangeSourceJustNow == 1)//如果刚刚切换完成信源，则需要等待格式更新的消息才能填写分辨率
	{
		top.isChangeSourceJustNow = 0;
		if(inputSource > 1)
		{
			$("input_format").innerText = "";
		}
		else
		{
			$("channel_resolution").innerText = "";
		}
	}
	else//非切换信源可以直接获取分辨率信息
	{
		formatChange();
	}
}
var isEWBSRemindFlag                 = 0;//0 无EWBS，1 有EWBS未跳台，2有EWBS已跳台
var EWBS_org_chIndex                = -1;
var selectFlag = 0;
var EWBSRemind = "The EWBS has been triggered,do you want to change the channel?";
function changeRemindFocus(){
	console.log("in changeRemindFocus isEWBSRemindFlag "+isEWBSRemindFlag+" selectFlag "+selectFlag);
	if(selectFlag==0){
		selectFlag=1;
		$("ewbsRemindFocus").style.left="440px"
	}
	else {
		selectFlag=0;
		$("ewbsRemindFocus").style.left="140px"
	}
}	
function toEnterEWBS(){
	if(selectFlag == 0){
		//取得EWBS目标台并换台
		var chIndex = channel.getEWBSChannelIndex();
		if((chIndex != -1) && (chIndex != channelIndex)){
			isEWBSRemindFlag = 2;
			EWBS_org_chIndex = channelIndex;
			channel.playByIndex(chIndex);
			channelChangeStatus = 1;
		}
		else{
			isEWBSRemindFlag = 0;
		}
	}
	else{
		isEWBSRemindFlag = 0;
	}
	selectFlag = 0;
	$("ewbsRemindFocus").style.left="140px"
	$("ewbsRemind").style.display = "none";
}

function checkEWBS()
{
	if(top.isLAFlag == 0 && channel.systemcountry != 35)
		return;
    var chIndex = channel.getEWBSChannelIndex();
    console.log("UI checkEWBS chIndex="+chIndex+"  channelIndex="+channelIndex+"  isEWBSRemindFlag="+isEWBSRemindFlag);
    if((chIndex != -1) && (chIndex != channelIndex) && chIndex != 65535){
		$("dialogContent").innerHTML = EWBSRemind;
		var picReDivs=$("dialogButton").getElementsByTagName("span");
		picReDivs[0].innerText=top.yesNo[0];
	    picReDivs[1].innerText=top.yesNo[1];
		top.doEleScrForNoOption(picReDivs,1, 0);
		selectFlag=0;
        isEWBSRemindFlag = 1;
		$("ewbsRemind").style.display = "block";
    }
	else{
        $("ewbsRemind").style.display = "none";
		isEWBSRemindFlag = 0;
    }
}

function init()
{
    top.initTextDirection(window);
	currentTunerMode = channel.tunerMode;//[0]cable [1]antenna
	if(top.isNAFlag)
	{
		if(currentTunerMode == 6)
		{	
			currentTunerMode = 1;
		}
		else if(currentTunerMode == 7)
		{
			currentTunerMode = 0;
		}
		
		$("channel_num").style.color = "#fff";
		$("tuner_name").style.color = "#fff";
		$("channel_time").style.color = "#fff";
		$("program_time_1").style.color = "#fff";
		
	}
	else if(top.isLAFlag)
	{
		currentTunerMode = currentTunerMode == 5 ? 1 : currentTunerMode;//[0]cable [1]antenna
    }
	//当有锁存在时UI不去设置CC使能接口
	console.log("top.parentalLock is "+top.parentalLock+" top.channelLock is "+top.channelLock+" top.inputLock is "+top.inputLock);
	if(top.parentalLock == 0 && top.channelLock == 0 && top.inputLock == 0 )
	{
		setting.setCCVisibility(1,1);                                     //显示CC
	}

    if (top.supportSCARTSource == 1)
    {
        inputList[inputSourceCount].name = 1;
        inputList[inputSourceCount].source = top.E_INPUT_SCART;
        inputSourceCount++;
    }
    else if(top.supportAV1Source == 1)
    {
    	inputList[inputSourceCount].name = 1;
        inputList[inputSourceCount].source = top.E_INPUT_AV_I;
        inputSourceCount++;
    }
    else if(top.supportAV2Source == 1)
    {
    	inputList[inputSourceCount].name = 1;
        inputList[inputSourceCount].source = top.E_INPUT_AV_II;
        inputSourceCount++;
    }
    if (top.supportYPBPRSource == 1)
    {
        inputList[inputSourceCount].name = 2;
        inputList[inputSourceCount].source = top.E_INPUT_YPBPR;
        inputSourceCount++;
    }
    if (top.supportHDMI1Source == 1)
    {
        inputList[inputSourceCount].name = 3;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_I;
        inputSourceCount++;
    }
    if (top.supportHDMI2Source == 1)
    {
        inputList[inputSourceCount].name = 4;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_II;
        inputSourceCount++;
    }
    if (top.supportHDMI3Source == 1)
    {
        inputList[inputSourceCount].name = 5;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_III;
        inputSourceCount++;
    }
    if (top.supportHDMI4Source == 1)
    {
        inputList[inputSourceCount].name = 6;
        inputList[inputSourceCount].source = top.E_INPUT_HDMI_IV;
        inputSourceCount++;
    }
    if (top.supportVGASource == 1)
    {
        inputList[inputSourceCount].name = 7;
        inputList[inputSourceCount].source = top.E_INPUT_PC;
        inputSourceCount++;
    }
    for (var i=0; i< inputSourceCount; i++)
    {
        if (inputList[i].source == top.g_channel.inputSource)
        {
            currentInputIndex = i;
            break;
        }
    }
	CI_Mheg5OpenStatus=channel.getCIMheg5OpenStatus();
	backLightState = setting.powerBacklightState;
	var numT = document.location.search;//获取URL携带参数
	if(numT!=null && numT!="")
	{
		numT=numT.substring(numT.indexOf("?")+1);
        if (numT.indexOf("=") == -1 && numT.indexOf("&") == -1)
        {
            num=parseInt(numT);
            if(programStatus == 1 && !isNaN(num))
            {
                onInsertNum(num);
            }
        }
	}
	powerDownTimer = setTimeout("powerOffForSpecialSituation()",14*60*1000);
	showEsticker = setTimeout("top.showEsticker()",60*1000);
	top.standByTime = setting.autoStandby;
	if(top.isFirstInitNotifyThread)//初始化消息接收线程
	{
		setting.browserIsStart();
		top.isFirstInitNotifyThread = 0;
	}
	top.g_isShowInfoBar = 0;
	//testLog("in init -- top.g_temp = "+top.g_temp);
	//Empty empty, prevent other page position caused some abnormal menu refresh
	top.g_temp = "";
	checkEWBS();
	// ATSC与DVB流程不同，ATV下搜索DTV没有搜索到节目时断电，重启会有黑屏问题，此时判断当前tuner mode有节目时则由UI去切对应的信源
	if(top.isNAFlag && channel.channelProgramStatus() && top.g_channel.inputSource <= top.E_INPUT_DTV)
	{
		var AtvCount = top.g_channel.getChListCountByServiceType(0);
		var DtvCount = top.g_channel.getChListCountByServiceType(1) + top.g_channel.getChListCountByServiceType(2) + top.g_channel.getChListCountByServiceType(3);
		console.log("current inputSource = " + inputSource + " AtvCount is " + AtvCount +" DtvCount is " + DtvCount);
		if(top.g_channel.inputSource == top.E_INPUT_DTV)
		{
			if(AtvCount > 0 && DtvCount <= 0)
			{
				channel.inputSource = top.E_INPUT_ATV;
			}
		}
		else if(top.g_channel.inputSource == top.E_INPUT_ATV)
		{
			if(DtvCount > 0 && AtvCount <= 0)
			{
				channel.inputSource = top.E_INPUT_DTV;
			}
		}
	}
}

function uninit()
{
    if (typeof(middleware) != "undefined")
    {
        middleware.setUIContext(1);
    }
	top.timeoutFuc.timeoutEnable=1;
//	if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)
//	{
//		/*
//		Ginga.sendNetworkEvent(2);//GINGA_NW_EVT_TS_UNSELECTED
//		Ginga.enableScreen(0);*/
//		//top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_PAUSE_FOR_CONTROL_LOST);
//	}
}


var shopTimer = 0;
/*
*提示显示
*完成对初始化时的提示的显示
*提示的优先级：no program info > no signal > other
*/
function showRemind()
{
	if(top.isFirstInChanenlPlay == 1)
	{
		if(top.isAUFlag)
		{//澳洲平台 重新初始化变量
			if(setting.location == 1 || setting.location == 2)//shop mode or shop with demo mode
			{
				$("remind").style.display = "none";
				$("prompt").style.display = "block";
				$("promptContent").innerText = mEPSTips[0];
				top.shopRemindFlag = 1;
				ttsRead();
				setTimeout(function(){
					$("promptContent").innerText = mEPSTips[1];
					ttsRead();
					},5*1000);
				if(!shopTimer)
				{
					shopTimer = setTimeout(function(){
						top.shopRemindFlag = 0;
						top.isFirstInChanenlPlay = 0;
						$("prompt").style.display="none";
						showRemind();
						},10*1000);
				}
				return;
			}
			else//home mode
			{
				$("prompt").style.display="none";
				top.isFirstInChanenlPlay = 0;
				top.shopRemindFlag = 0;
			}
		}
		else
		{
			top.isFirstInChanenlPlay = 0;
			if(setting.location == 1 || setting.location == 2)//shop mode
			{
				$("remind").style.display = "none";
				$("prompt").style.display="block";
				$("promptContent").innerText=promptContent;
				top.shopRemindFlag = 1;
				ttsRead();
				if(!shopTimer)
				{
					shopTimer = setTimeout(function(){
						top.shopRemindFlag = 0;
						$("prompt").style.display="none";
						showRemind();
						if(setting.location == 2 && top.appOpenFlag == 0)
						{
                            var manufacturer = setting.getProperty("ro.sita.model.MODEL_MANUFACTURER_NAME_CFG.MANUFACTURER_NAME", "TCL");
                            if (top.isEUFlag == 1)
                            {
                                if(manufacturer == "THOMSON")
                                {
                                    top.jumpHotkeyPage("eSticker/eSticker_eu_thom.html");
                                }
                                else
                                {
                                    top.jumpHotkeyPage("eSticker/eSticker_eu_tcl.html");
                                }
                            }
							else
                            {
                                if (manufacturer == "TCL")
                                {
                                    top.jumpHotkeyPage("eSticker/eSticker_tcl.html");
                                }
                                else
                                {
                                    top.jumpHotkeyPage("eSticker/eSticker.html");
                                }
                            }
						}
						},20*1000);
				}
				return;
			}
			else//home mode or shop with demo mode
			{
				$("prompt").style.display="none";
				top.shopRemindFlag = 0;
			}
		}
	}
	else
	{
		if(top.shopRemindFlag == 1 && shopTimer > 0)//这个情况是用在主动切换页面时
		{
			ttsRead();
			return;
		}
		else
		{
			top.shopRemindFlag = 0;
			$("prompt").style.display="none";
		}
	}
	
	$("sameLcnRemind").style.display = "none";
	var signalStatus = channel.currentSignalStatus;
	inputSource=channel.inputSource;
	//几个优先级比较高的判断条件
	if(top.g_MMHStatus == 1)//MMH开启
	{
		$("remind").style.display = "none";
		return;
	}
	else if(top.g_temp == "nitrefresh")
	{
		$("remind").style.display = "none";
		return;
	}
	else if(top.g_factory_hotkey == 1)
	{
		$("remind").style.display = "none";
		return;		
	}
	
	console.log("in current inputSource is "+inputSource+" top.parentalLock is "+top.parentalLock+" channel.currentScreenSaverMode is "+channel.currentScreenSaverMode);
	if(inputSource > 1)
	{
		if(top.inputLock == 1&&inputSource!=top.E_INPUT_STORAGE)//信源锁等级>频道锁>父母锁
		{
			if(top.appOpenFlag==0)
			{
				top.keySetForUI(1);
			}
			$("remind").innerHTML = channel_remind[15];
			$("remind").style.display = "block";
			ttsRead();
			return;
		}
		else if(!signalStatus&&inputSource!=top.E_INPUT_STORAGE)//没有信号
		{
			top.channelLock=0;
			top.parentalLock=0;
			top.inputLock = 0;
			if(top.appOpenFlag==0)
			{
				top.keySetForUI(1);
			}
			$("remind").innerHTML = channel_remind[1];
			$("remind").style.display = "block";
		}
        else if (signalStatus == 4 && inputSource!=top.E_INPUT_STORAGE)
        {
            $("remind").innerHTML = channel_remind[16];
            $("remind").style.display = "block";
			ttsRead();
            return;
        }
		else if((top.parentalLock == 1 && inputSource!=top.E_INPUT_STORAGE) || (top.isNAFlag == 1 && (channel.currentScreenSaverMode == 5) && (inputSource == top.E_INPUT_AV_I ||inputSource == top.E_INPUT_AV_II)))//父母锁 NA项目ATV/DTV/AV信源有父母锁
		{
			if(top.appOpenFlag==0)
			{
				top.keySetForUI(1);
			}
			top.parentalLock = 1;
			$("remind").innerHTML = channel_remind[10];
			$("remind").style.display = "block";
			ttsRead();
			return;
		}
		else
		{
			var t = currentChannel.vResolution;
			if("-1" == t&&inputSource!=top.E_INPUT_STORAGE)
			{
				$("remind").innerHTML = channel_remind[16];
				$("remind").style.display = "block";
				ttsRead();
				return;
			}
			else
			{
				$("remind").style.display = "none";
			}
		}
	}
	else
	{
		testLog("top.inputLock===="+top.inputLock);
		if(top.inputLock == 1&&inputSource!=10&&programStatus==0)//信源锁等级>频道锁>父母锁
		{
			if(top.appOpenFlag==0)
			{
				top.keySetForUI(1);
			}
			$("remind").innerHTML = channel_remind[15];
			$("remind").style.display = "block";
			ttsRead();
			return;
		}
		if(programStatus == 0)//无节目信号
		{
			if(top.appOpenFlag==0)
			{
				top.keySetForUI(1);
			}
			$("remind").innerHTML = channel_remind[0];
			$("remind").style.display = "block";
			$("remind").style.left = "660px";
	        $("remind").style.top =  "400px";
			ttsRead();
			return;
		}
		if(channelInfo_visible == 0)
		{
			var screenMode = channel.currentScreenSaverMode;

			if(top.inputLock == 1&&inputSource!=top.E_INPUT_STORAGE)//信源锁等级>频道锁>父母锁
			{
				if(top.appOpenFlag==0)
				{
					top.keySetForUI(1);
				}
				$("remind").innerHTML = channel_remind[15];
				$("remind").style.display = "block";
				ttsRead();
				return;
			}
			else if(!signalStatus)//没有信号
			{
				top.channelLock=0;
				top.parentalLock=0;
				top.inputLock = 0;
				var number = channel.getSameLcnChannelNumber();
				if(number > 0)
				{
					if(top.appOpenFlag==0)
					{
						top.keySetForUI(1);
					}
					$("sameLcnRemind").innerHTML = sameLcnRemindWord.replace(/%d/,number);
					$("sameLcnRemind").style.display = "block";
					$("remind").style.display = "none";
				}
				else
				{
					if(top.appOpenFlag==0)
					{
						top.keySetForUI(1);
					}
					$("remind").innerHTML = channel_remind[1];
					$("remind").style.display = "block";
				}
				if(showPageType == "closeSubtitleForMheg5")
				{
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
					}
					toAudioLangback();
				}
			}
			else if(top.channelLock == 1)//locked
			{
				if(top.appOpenFlag==0)
				{
					top.keySetForUI(1);
				}
				$("remind").innerHTML = channel_remind[14];
				$("remind").style.display = "block";
				if(showPageType == "closeSubtitleForMheg5")
				{
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
					}
					toAudioLangback();
				}
			}
			else//信号锁定
			{
				top.channelLock=0;
				top.parentalLock=0;
				if(inputSource == 1)
				{
					if(screenMode == 5)//parrent rating
					{
						if(inputSource == 1)
						{
							if(top.appOpenFlag==0)
							{
								top.keySetForUI(1);
							}
							top.parentalLock = 1;
							currentEventAgeLevel = currentChannel.getProgramPlayList()[0].parentRate;
							if(currentEventAgeLevel == 18 && setting.parentalRating == 18)
							{
								$("remind").innerHTML = channel_remind[12];
							}
							else
							{
								$("remind").innerHTML = channel_remind[10];
							}
							$("remind").style.display = "block";
							if(showPageType == "closeSubtitleForMheg5")
							{
								if(audioShowTimer!=0)
								{
									clearTimeout(audioShowTimer);
									audioShowTimer=0;
								}
								toAudioLangback();
							}
						}
						else
						{
							if(top.appOpenFlag==0)
							{
								top.keySetForUI(0);
							}
							$("remind").style.display = "none";
						}
					}
					else if(screenMode == 4)
					{
						if(top.appOpenFlag==0)
						{
							top.keySetForUI(1);
						}
						top.channelLock=1;
						$("remind").innerHTML = channel_remind[14];
						$("remind").style.display = "block";
						if(showPageType == "closeSubtitleForMheg5")
						{
							if(audioShowTimer!=0)
							{
								clearTimeout(audioShowTimer);
								audioShowTimer=0;
							}
							toAudioLangback();
						}
					}
					else if (screenMode == 3 || screenMode==1)//scramble
					{
						$("remind").innerHTML = channel_remind[2];
						$("remind").style.display = "block";
						if(showPageType == "closeSubtitleForMheg5")
						{
							if(audioShowTimer!=0)
							{
								clearTimeout(audioShowTimer);
								audioShowTimer=0;
							}
							toAudioLangback();
						}
					}
					else if(screenMode == 0)//invalid
					{
						$("remind").innerHTML = channel_remind[5];
						$("remind").style.display = "block";
						if(showPageType == "closeSubtitleForMheg5")
						{
							if(audioShowTimer!=0)
							{
								clearTimeout(audioShowTimer);
								audioShowTimer=0;
							}
							toAudioLangback();
						}
					}
					else if(screenMode == 7)//data only
					{
						$("remind").innerHTML = channel_remind[3];
						$("remind").style.display = "block";
						if(showPageType == "closeSubtitleForMheg5")
						{
							if(audioShowTimer!=0)
							{
								clearTimeout(audioShowTimer);
								audioShowTimer=0;
							}
							toAudioLangback();
						}
					}
					else if(screenMode == 6)//audio only
					{
						if(channel.getMheg5Status() == 1)//特殊处理，有些流当前显示静止画面，任然发送audio消息。
						{
							if(top.appOpenFlag==0)
							{
								top.keySetForUI(0);
							}
							$("remind").style.display = "none";
						}
						else
						{
							$("remind").innerHTML = channel_remind[4];
							$("remind").style.display = "block";
							if(showPageType == "closeSubtitleForMheg5")
							{
								if(audioShowTimer!=0)
								{
									clearTimeout(audioShowTimer);
									audioShowTimer=0;
								}
								toAudioLangback();
							}
						}
					}
					else if(screenMode == 12)//not runnig
					{
						$("remind").innerHTML = channel_remind[17];
						$("remind").style.display = "block";
						if(showPageType == "closeSubtitleForMheg5")
						{
							if(audioShowTimer!=0)
							{
								clearTimeout(audioShowTimer);
								audioShowTimer=0;
							}
							toAudioLangback();
						}
					}
					else
					{
						if(top.appOpenFlag==0)
						{
							testLog(" otherPage is "+top.$("otherPage").src);
							//if(top.$("otherPage").src == "")
							//{
								top.keySetForUI(0);
							//}
						}
						$("remind").style.display = "none";
					}
				}
				else if((top.parentalLock == 1 || screenMode == 5)&& inputSource == 0 && top.isNAFlag == 1)//父母锁 NA项目ATV/DTV/AV信源有父母锁
				{
					if(top.appOpenFlag==0)
					{
						top.keySetForUI(1);
					}
					top.parentalLock = 1;
					$("remind").innerHTML = channel_remind[10];
					$("remind").style.display = "block";
					ttsRead();
					return;
				}
				else
				{
					if(top.appOpenFlag==0)
						{
							top.keySetForUI(0);
						}
					$("remind").style.display = "none";
				}
			}
		}
	}
	
	list_position_h = 0;
	xPosition = positions[list_position_h][0];
	yPosition = positions[list_position_h][1];
	$("remind").style.left = xPosition;
	$("remind").style.top = yPosition;
	ttsRead();
	setTimeout("doScreenAnimation()",1000);
}

function hideRemind()
{
	$("remind").style.display = "none";
	$("sameLcnRemind").style.display = "none";
	if(screenAniTimer)
	{
		clearTimeout(screenAniTimer);
		screenAniTimer = 0;
	}
}


function powerOffForSpecialSituation()
{
	if(((top.g_channel.inputSource<=1&&!channel.channelProgramStatus()) || channel.currentSignalStatus == 0)&&channel.checkhbbtvStatus()==0&&top.appOpenFlag==0&&top.g_factory_hotkey == 0&&top.g_scanStatus == 0&&top.g_setting.location == 0)// 显示no program info的条件,十五分钟都显示无信号
	{
		top.g_lastTime = 60;
		top.powerOffAsNosignal = 1;
		top.$("otherPage").src = "powerOffTimer.html";
		top.requestFocus(top.main, 1);
		top.g_previousHtmlPage = "";
	}
	else
	{
		powerDownTimer = setTimeout("powerOffForSpecialSituation()",14*60*1000);
	}
	
}
function standByPowerOff()
{
	top.g_lastTime = 60;
	top.$("otherPage").src = "powerOffTimer.html";
	top.requestFocus(top.main, 1);
	top.g_previousHtmlPage = "";
}
var channelChangeTimer = 0;
function channelPreChKey()
{
	if(inputSource <= 1)
	{
		if(playChannelNumber)
		{
			clearTimeout(playChannelNumber);
			
		}
		playChannelNumber=0;
		
		if(channelInfo_timer)
		{
			clearTimeout(channelInfo_timer);
			
		}
		channelInfo_timer=0;
		
		//初始化，把屏幕黑掉
		$("remind").style.display = "none";
		$("sameLcnRemind").style.display = "none";
		if(screenAniTimer)
		{
			clearTimeout(screenAniTimer);
			screenAniTimer = 0;
		}
		var currentIndex = channel.currentIndex;
		var preCHIndex = top.g_channel.lastIndex;
        	channelIndex = preCHIndex;
		var previousChannel = channel.getChannelInfoByIndex(channelIndex);
		$("channel_num").innerText = (top.isLAFlag || top.isNAFlag)? top.parseChNumber(previousChannel) : previousChannel.number;
		$("channel_name").innerText =  previousChannel.name;
		currentPlayChannelNumber = previousChannel.number;
		if(previousChannel.serviceType==0)
		{
			inputSource=0;
		}
		else
		{
			inputSource=1;
		}
		$("channel_info_1").style.border="4px solid #1b1b1b";
		$("channel_info_1").style.display = "block";
		$("channel_info_2").style.display = "none";
		$("channel_content_contain").style.display = "none";
		if(currentIndex != channelIndex)
		{
			currentChannel = previousChannel;
			channelChange();
		}
		channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
	}
}
function initNumInfoShow()//初始化右侧info框
{
	show_moreInfo_flag = 5;
	$("channel_info_1").style.border="4px solid #1b1b1b";
	$("channel_info_1").style.display = "block";
	$("channel_info_2").style.display = "none";
	$("channel_content_contain").style.display = "none";
}
function initShowInput(source)
{
	$("channel_num").innerText = source_titles[source];
	$("channel_time").innerHTML="";
	$("tuner_picture").style.display="none";
	$("tuner_name").innerHTML="";
	$("channel_name").innerText ="";
	$("input_format").innerText="";
}
function initVarValue()
{
	top.g_openMheg5State=0;
	top.channelLock =0; 
	top.parentalLock=0;  
	top.inputLock = 0;
	top.g_isShowInfoBar = 1;
	channelInfo_visible = 1;
}
function channelDownKey()
{
	var systemCountry = top.g_channel.systemCountry;
	if(playChannelNumber)
	{
		clearTimeout(playChannelNumber);
	}
	playChannelNumber=0;
	if(channelInfo_timer)
	{
		clearTimeout(channelInfo_timer);
	}
	channelInfo_timer=0;
			//初始化，把屏幕黑掉
	$("remind").style.display = "none";
	$("sameLcnRemind").style.display = "none";
	if(screenAniTimer)
	{
		clearTimeout(screenAniTimer);
		screenAniTimer = 0;
	}
	if(inputSource <= 1&&programStatus == 1  && top.inputLock != 1)
	{
		
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
			var currentIndex = channel.currentIndex;
			if((top.isLAFlag || top.isNAFlag) && isSearchingFlag)
			{
				channel.stopScan();
				isSearchingFlag = false;
				currentIndex = top.currentChannelIndex;
			}
			channelIndex = top.g_channel.getPreviousIndexByIndex(channelIndex);
			if(channelIndex>=65535)
			{
				channelIndex=currentIndex;
			}
			var previousChannel = channel.getChannelInfoByIndex(channelIndex);
            console.log("--channelDownKey previousChannel isSkip = " + previousChannel.isSkip);
            //下一个节目时skip的话则返回
            if (previousChannel.isSkip == 1)
            {
                return;
            }
			channelInfo_visible = 1;
			$("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(previousChannel) : previousChannel.number;
			$("channel_name").innerText =  previousChannel.name;
			inputSource = previousChannel.serviceType==0 ? 0 : 1;
			initNumInfoShow();
			if(currentIndex != channelIndex && channelIndex<65535)
			{
				currentChannel = previousChannel;
				if(audioShowTimer!=0)
				{
					clearTimeout(audioShowTimer);
					audioShowTimer=0;
					toAudioLangback();
				}
				currentPlayChannelNumber = previousChannel.number;
				channelChange();
			}
		}
		else
		{
			var currentIndex = channel.currentIndex;
			if((top.isLAFlag || top.isNAFlag) && isSearchingFlag)
			{
				channel.stopScan();
				isSearchingFlag = false;
				currentIndex = top.currentChannelIndex;
			}
			var firstIndex = channel.firstIndex;
			var TempIndex = top.g_channel.getPreviousIndexByIndex(channelIndex);
			
			if(currentIndex<=firstIndex||channelIndex<=firstIndex || TempIndex>=65535)
			{
				var nextSource = inputList[inputSourceCount-1].source;
				if(top.recordStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenRecord();
					top.$('main').src = "pvr/Pvr.html?inputsource&"+nextSource;
					return;
				}
				else if(top.timeShiftStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenTimeShift();
					top.$('main').src = "pvr/timeshift.html?inputsource&"+nextSource;
					return;
				}
				if(top.currentPanel==1)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
						top.$("globleShow").contentWindow.hiddenGlassRemind();
					}
				}else if(top.currentPanel==2)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
					}
				}
				if(audioShowTimer!=0)
				{
					clearTimeout(audioShowTimer);
					audioShowTimer=0;
					toAudioLangback();
				}
				hideRemind();
				initNumInfoShow();				
				initVarValue();
                currentInputIndex = inputSourceCount-1;
				initShowInput(inputList[currentInputIndex].name);
                if(1 == sourceToDtvFlag)
                {
                    playChannelNumber = setTimeout("changeSource(inputList[currentInputIndex].source)",1500);
                }
                else
                {
                    playChannelNumber = setTimeout("changeSource(inputList[currentInputIndex].source)",100);
                }
				inputSource=inputList[currentInputIndex].source;
			}
			else
			{
				channelIndex = TempIndex;
				var previousChannel = channel.getChannelInfoByIndex(channelIndex);
				channelInfo_visible = 1;
				$("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(previousChannel) : previousChannel.number;
				$("channel_name").innerText =  previousChannel.name;
				inputSource = previousChannel.serviceType == 0 ? 0 : 1;
				initNumInfoShow();
				
				if(currentIndex != channelIndex && channelIndex<65535)
				{
					currentChannel = previousChannel;
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
						toAudioLangback();
					}
					currentPlayChannelNumber = previousChannel.number;
					channelChange();
				}
			}
		}
		
	}
    else if(inputSource > 1)
	{
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			hideRemind();
			initVarValue();
			if(currentInputIndex==0)
			{
                if ((top.supportATVSource == 1) || (top.supportDTVSource == 1))
                {
                    currentInputIndex = -1;
                    if( channel.channelProgramStatus() >0)
                    {
                        channelIndex=channel.endIndex;
                        if(channelIndex>=65535)
                        {
                            channelIndex=channel.currentIndex;
                        }
                        if(channelIndex<65535)
                        {
                            var previousChannel = channel.getChannelInfoByIndex(channelIndex);
                            $("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(previousChannel) : previousChannel.number;
                            $("channel_name").innerText =  previousChannel.name;
                            initNumInfoShow();
                            if(previousChannel.serviceType==0)
                            {
                                inputSource=0;
                            }
                            else
                            {
                                inputSource=1;
                            }
                            $("input_format").innerText="";
                            currentPlayChannelNumber = previousChannel.number;
                            channelChange();
                        }
                        else
                        {
                            hideInfoForm();
                            channelChangeStatus=1;
                            channel.inputSource=1;
                            showRemind();
                            inputSource=1;
                        }
                    }
                    else
                    {
                        hideInfoForm();
                        channelChangeStatus=1;
                        channel.inputSource=1;
                        showRemind();
                        inputSource=1;
                    }
                }
                else //无TV功能
                {
                    currentInputIndex = inputSourceCount-1;
                    initNumInfoShow();
                    initShowInput(inputList[currentInputIndex].name);
                    playChannelNumber =setTimeout("changeSource(inputList[currentInputIndex].source)",600);
                    inputSource=inputList[currentInputIndex].source;
                }
			}
            else if (currentInputIndex>0)
            {
                currentInputIndex -= 1;
                initNumInfoShow();
				initShowInput(inputList[currentInputIndex].name);
				playChannelNumber =setTimeout("changeSource(inputList[currentInputIndex].source)",600);
				inputSource=inputList[currentInputIndex].source;
            }
		}
	}
	else if(inputSource <= 1&&(programStatus == 0 || top.inputLock == 1))
	{
		var systemCountry = top.g_channel.systemCountry;
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{

			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			hideRemind();
			initNumInfoShow();
            currentInputIndex = inputSourceCount-1;
			initShowInput(inputList[currentInputIndex].name);
			initVarValue();
            if(1 == sourceToDtvFlag)
            {
                playChannelNumber = setTimeout("changeSource(inputList[currentInputIndex].source)",1500);
            }
            else
            {
                playChannelNumber = setTimeout("changeSource(inputList[currentInputIndex].source)",600);
            }
			inputSource=inputList[currentInputIndex].source;
		}
	}
    if(top.E_INPUT_DTV == channel.inputSource)
    {
        setSourceToDtvFlagTimeout();
    }
    if(getSportModeType() && top.g_factory.pvrOpenStatus)
	{
		tcl.channel.requestMute(0);
		turnOnSportMode();
		return;
	}
	channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
}
function channelUpKey()
{
	var systemCountry = top.g_channel.systemCountry;
	if(playChannelNumber)
	{
		clearTimeout(playChannelNumber);
	}
	playChannelNumber=0;
	if(channelInfo_timer)
	{
		clearTimeout(channelInfo_timer);
	}
	channelInfo_timer=0;
	
	//初始化，把屏幕黑掉
	$("remind").style.display = "none";
	$("sameLcnRemind").style.display = "none";
	if(screenAniTimer)
	{
		clearTimeout(screenAniTimer);
		screenAniTimer = 0;
	}
	if(inputSource <= 1&&programStatus == 1 && top.inputLock != 1)
	{

		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
			var currentIndex = channel.currentIndex;
			if((top.isLAFlag || top.isNAFlag) && isSearchingFlag)
			{
				channel.stopScan();
				isSearchingFlag = false;
				currentIndex = top.currentChannelIndex;
			}
			channelIndex = channel.getNextIndexByIndex(channelIndex);
			if(channelIndex>=65535)
			{
				channelIndex=currentIndex;
			}
			var nextChannel = channel.getChannelInfoByIndex(channelIndex);
            console.log("--hzm channelUpKey nextChannel skip = " + channelIndex.isSkip);
			//下一个节目时skip的话则返回
            if (nextChannel.isSkip == 1)
            {
                return;
            }
			channelInfo_visible = 1;
			$("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(nextChannel) : nextChannel.number;
			$("channel_name").innerText =  nextChannel.name;
			inputSource = nextChannel.serviceType==0 ? 0 : 1;
			initNumInfoShow();
			if(currentIndex != channelIndex && channelIndex<65535)
			{
				currentChannel = nextChannel;
				if(audioShowTimer!=0)
				{
					clearTimeout(audioShowTimer);
					audioShowTimer=0;
					toAudioLangback();
				}
				currentPlayChannelNumber = nextChannel.number;
				channelChange();
			}
		}
		else
		{
			var currentIndex = channel.currentIndex;
			if(isSearchingFlag && (top.isLAFlag || top.isNAFlag))//la
			{
				channel.stopScan();
				isSearchingFlag = false;
				currentIndex = top.currentChannelIndex;
			}
			var endIndex = channel.endIndex;
			var TempIndex = top.g_channel.getNextIndexByIndex(channelIndex);
			if(currentIndex>=endIndex||channelIndex>=endIndex || TempIndex>=65535)
			{
				var nextSource = inputList[0].source;
				if(top.recordStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenRecord();
					top.$('main').src = "pvr/Pvr.html?inputsource&"+nextSource;
					return;
				}
				else if(top.timeShiftStatusFlag == 1)
				{
					top.$("globleShow").contentWindow.hiddenTimeShift();
					top.$('main').src = "pvr/timeshift.html?inputsource&"+nextSource;
					return;
				}
				if(top.currentPanel==1)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
						top.$("globleShow").contentWindow.hiddenGlassRemind();
					}
				}else if(top.currentPanel==2)
				{
					if(top.g_setting.pic3DMode!=0)
					{
						top.g_setting.pic3DMode=0;
					}
				}
				if(audioShowTimer!=0)
				{
					clearTimeout(audioShowTimer);
					audioShowTimer=0;
					toAudioLangback();
				}
				hideRemind();
				initNumInfoShow();
                currentInputIndex = 0;
				initShowInput(inputList[0].name);
				initVarValue();
                if(1 == sourceToDtvFlag)
                {
                    playChannelNumber = setTimeout("changeSource(inputList[0].source)",1500);
                }
                else
                {
                    playChannelNumber = setTimeout("changeSource(inputList[0].source)",100);
                }
				inputSource=inputList[0].source;
			}
			else
			{
				channelIndex = TempIndex;
				var nextChannel = channel.getChannelInfoByIndex(channelIndex);
				channelInfo_visible = 1;
				$("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(nextChannel) : nextChannel.number;
				$("channel_name").innerText =  nextChannel.name;
				inputSource = nextChannel.serviceType == 0 ? 0 : 1;
				initNumInfoShow();
				if(currentIndex != channelIndex && channelIndex<65535)
				{
					currentChannel = nextChannel;
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
						toAudioLangback();
					}
					currentPlayChannelNumber = nextChannel.number;
					channelChange();
				}
			}
		}
	}
	else if(inputSource >1)
	{
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			hideRemind();
			initVarValue();
            if (currentInputIndex<(inputSourceCount-1))
            {
                initNumInfoShow();
                currentInputIndex += 1;
				initShowInput(inputList[currentInputIndex].name);
				playChannelNumber = setTimeout("changeSource(inputList[currentInputIndex].source)",600);
				inputSource=inputList[currentInputIndex].source;
            }
			else
			{
                if ((top.supportATVSource == 1) || (top.supportDTVSource == 1))
                {
                    if( channel.channelProgramStatus() >0)
                    {
                        channelIndex=channel.firstIndex;
                        if(channelIndex>=65535)
                        {
                            channelIndex=channel.currentIndex;
                        }
                        if(channelIndex<65535)
                        {
                            var previousChannel = channel.getChannelInfoByIndex(channelIndex);
                            $("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(previousChannel) : previousChannel.number;
                            $("channel_name").innerText =  previousChannel.name;
                            if(previousChannel.serviceType==0)
                            {
                                inputSource=0;
                            }
                            else
                            {
                                inputSource=1;
                            }
                            initNumInfoShow();
                            $("input_format").innerHTML="";
                            currentPlayChannelNumber = previousChannel.number;
                            channelChange();
                        }
                        else
                        {
                            hideInfoForm();
                            channel.inputSource=1;
                            showRemind();
                            inputSource=1;
                        }
                    }
                    else
                    {
                        hideInfoForm();
                        channel.inputSource=1;
                        programStatus = channel.channelProgramStatus();
                        showRemind();
                        inputSource=1;
                    }
                }
                else //无TV功能
                {
                    currentInputIndex = 0;
                    initNumInfoShow();
                    initShowInput(inputList[currentInputIndex].name);
                    playChannelNumber = setTimeout("changeSource(inputList[currentInputIndex].source)",600);
                    inputSource=inputList[currentInputIndex].source;
                }
			}
		}
	}
	else if(inputSource <= 1&&(programStatus == 0 || top.inputLock == 1))
	{
		var systemCountry = top.g_channel.systemCountry;
		if (((systemCountry != 15 && systemCountry != 6 && systemCountry != 7 && systemCountry != 23 && systemCountry != 119) && top.isEUFlag) ||
            "true" == top.isSCBCFlag || top.isLAFlag || top.isNAFlag || top.isAFFlag || top.isAPFlag)
		{
		}
		else
		{
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			hideRemind();
			initNumInfoShow();
			initVarValue();
			$("input_format").innerText="";
            currentInputIndex = 0;
			$("channel_num").innerText = source_titles[inputList[currentInputIndex].name];
			$("channel_name").innerText ="";
			$("channel_time").innerHTML="";
			$("tuner_picture").style.display="none";
			$("tuner_name").innerHTML="";
            if(1 == sourceToDtvFlag)
            {
                playChannelNumber =setTimeout("changeSource(inputList[currentInputIndex].source)",1500);
            }
            else
            {
                playChannelNumber =setTimeout("changeSource(inputList[currentInputIndex].source)",600);
            }
			inputSource=inputList[currentInputIndex].source;
		}
	}
    if(top.E_INPUT_DTV == channel.inputSource)
    {
        setSourceToDtvFlagTimeout();
    }
    if(getSportModeType() && top.g_factory.pvrOpenStatus)
	{
		tcl.channel.requestMute(0);
		turnOnSportMode();
		return;
	}
	channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
}
function changeSource(source)
{
    if(top.E_INPUT_DTV == source)        //如果是DTV，切信源前需要延时
    {
        setSourceToDtvFlagTimeout();
    }

	if(top.g_channel.inputSource!=source)
	{
		top.g_channel.inputSource = source;
	}
	else
	{
		refreshChannelInfoTimer();
		formatChange();
		if(inputSource > 1)
		{
			if(channelInfo_visible == 0)
			{
				show_moreInfo_flag = 1;
			}
		}
		else
		{
			if(show_moreInfo_flag == 0) 
			{
				show_moreInfo_flag = 1;
			}
			else if(show_moreInfo_flag == 3 || show_moreInfo_flag == 4 || show_moreInfo_flag == 5)
			{
				show_moreInfo_flag = 6;
			}
		}
		hideRemind();
		if(CI_Mheg5OpenStatus>0 || channel.checkhbbtvShowInfo()==0)//CI出发MHEG没有关掉之前不自动弹出info信息
		{
			return;
		}
		showInfoFrom();
	}
}
function channelChange()//上下换台时播放节目接口
{
	if(inputSource <= 1)
	{
		if(playChannelNumber)
		{
			clearTimeout(playChannelNumber);
			playChannelNumber=0;
		}
		if(top.recordStatusFlag == 1)
		{
			top.$("globleShow").contentWindow.hiddenRecord();
			top.$('main').src = "pvr/Pvr.html?channelChange&"+channelIndex;
			return;
		}
		else if(top.timeShiftStatusFlag == 1)
		{
			top.$("globleShow").contentWindow.hiddenTimeShift();
			top.$('main').src = "pvr/timeshift.html?channelChange&"+channelIndex;
			return;
		}
		top.g_openMheg5State=0;
		top.channelLock =0; 
		top.parentalLock=0;  
		top.inputLock = 0;
		clearTimeout(refreshInfoTimer);
		refreshInfoTimer = 0;
		top.currentChannelIndex = channelIndex;
		$("program_audio").innerText = "";
		$("sound_channel_text").innerText = "";
		if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)
		{
			var cur_channel = channel.getCurrentChannelInfo();
			var curr_freq = cur_channel.frequency;
			var next_channel = channel.getChannelInfoByIndex(channelIndex);
			var next_freq = next_channel.frequency;
			if(curr_freq == next_freq)
			{
				//sameFreqChangeCh = 1;
				top.GingaObj.isSameTS = true;
			}
			else
			{
				top.GingaObj.isSameTS = false;
			}
//			if(channel.inputSource == 1 && top.GingaObj.isEnable == 1)//DTV and Ginga enable //切频道前暂停Ginga已移置中间件做
//			{
//				top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_BEFORE_CHANNEL_CHANGE);
//				/*Ginga.deactive();//切台前deactive Ginga
//				if(sameFreqChangeCh == 0)
//				{
//					Ginga.sendNetworkEvent(2);//GINGA_NW_EVT_TS_UNSELECTED
//				}
//				else
//				{
//					Ginga.sendNetworkEvent(6);//GINGA_NW_EVT_SERVICE_UNSELECTED
//				}
//				flag_changeChanel = 1;*/
//			}
		}
		if(isSearchingFlag && (top.isLAFlag || top.isNAFlag))//la
		{
			channel.stopScan();
			isSearchingFlag = false;
		}
		channel.playByIndex(channelIndex);
		channelChangeStatus = 1;
		if(top.appOpenFlag==0)
		{
			top.keySetForUI(0);
		}
	}
}

var noSignalStillFlag = 0;



function formatChange()
{
	if(inputSource != channel.inputSource)
	{
		return;
	}
	var t = currentChannel.vResolution;
	if("-1" == t)//not support
	{
		formatSupportFlag = 0;
		if(inputSource > 1)
		{
			$("input_format").innerText = "";
		}
		else
		{
			$("channel_resolution").innerText = "";
		}
		return;
	}
	
	var resolutionDatas = t.split("&");	
	//判断是高清还是标清
	var isHD = 0;
	if(resolutionDatas[1] > 720)
	{
		isHD = 1;
	}
	else if(resolutionDatas[1] == 720)
	{
		if(resolutionDatas[3] == 0)//判断高清 p 高清 i 标清
		{
			isHD = 1;
		}
	}
	
	if(inputSource > 1)
	{
		if(channel.currentSignalStatus)
		{
			if(inputSource == top.E_INPUT_HDMI_I || inputSource == top.E_INPUT_HDMI_II || inputSource == top.E_INPUT_HDMI_III || inputSource == top.E_INPUT_HDMI_IV)
			{
				if(setting.hdmiMode == 1 || (setting.hdmiMode == 0 && setting.getHdmiRealType() == 1))
				{
					if(parseInt(resolutionDatas[0],10)>0&&parseInt(resolutionDatas[1],10)>0&&parseInt(resolutionDatas[2],10)>0)
					{
						if ((resolutionDatas[1] >= 2160) && (top.isEUFlag))
						{
							$("input_format").innerText = "1920x1080@60Hz";//xxxxi@xxHZ HD
						}
						else
						{
							$("input_format").innerText = resolutionDatas[0] + "x" + resolutionDatas[1] + "@" + resolutionDatas[2] + "Hz";//xxxxi@xxHZ HD
						}
					}
					else
					{
						$("input_format").innerText = "";
					}
				}
				else
				{
					if(parseInt(resolutionDatas[0],10)>0&&parseInt(resolutionDatas[1],10)>0&&parseInt(resolutionDatas[2],10)>0&&parseInt(resolutionDatas[3])>=0&&parseInt(resolutionDatas[3],10)<=1)
					{
						//$("input_format").innerText = resolutionDatas[0] + "x" + resolutionDatas[1] + pOrI[resolutionDatas[3]] + " " + resolutionDatas[2] + "Hz ";
						if ((resolutionDatas[1] >= 2160) && (top.isEUFlag) )
						{
							$("input_format").innerText = "1080p@60Hz";//xxxxi@xxHZ HD
						}
						else
						{
							$("input_format").innerText = resolutionDatas[1] + pOrI[resolutionDatas[3]] + " " + resolutionDatas[2] + "Hz ";
						}
					}
					else{
						$("input_format").innerText="";
					}
				}
			}
			else
			{
				if(parseInt(resolutionDatas[0],10)>0&&parseInt(resolutionDatas[1],10)>0&&parseInt(resolutionDatas[2],10)>0)
				{
					if(parseInt(resolutionDatas[3],10)>=0&&parseInt(resolutionDatas[3],10)<=1)
					{
                        //$("input_format").innerText = resolutionDatas[0] + "x" +resolutionDatas[1] + pOrI[parseInt(resolutionDatas[3],10)]+" "/*"@"*/ + resolutionDatas[2] + "Hz ";//xxxxi@xxHZ HD
                        $("input_format").innerText = resolutionDatas[1] + pOrI[parseInt(resolutionDatas[3],10)]+" "/*"@"*/ + resolutionDatas[2] + "Hz ";//xxxxi@xxHZ HD
					}
					else
					{
						//$("input_format").innerText = resolutionDatas[0] + "x" +resolutionDatas[1] + " "/*"@"*/ + resolutionDatas[2] + "Hz ";//xxxxi@xxHZ HD
                        $("input_format").innerText = resolutionDatas[1] + " "/*"@"*/ + resolutionDatas[2] + "Hz ";//xxxxi@xxHZ HD
					}
				}
				else
				{
					$("input_format").innerText = "";
				}
			}
		}
		else
		{
			$("input_format").innerText = "";
		}
		var ttsStr = $("input_format").innerText;
		top.ttsLog("ttsStr=" + ttsStr);
		top.setTTSSay(top.SPEECH_TYPE_SAY, ttsStr);
	}
	else
	{
		$("input_format").innerText = "";
		if(top.channelLock == 1 || top.parentalLock == 1 || (currentChannel.isLock == 1 && currentChannel.unlockFlag == 0)|| resolutionDatas[0] <=0)
		{
			$("channel_resolution").innerText = "";	
		}
		else if(resolutionDatas[0] > 0)
		{
			var screenMode = channel.currentScreenSaverMode;
			if(screenMode==3 || screenMode==1)
			{
				$("channel_resolution").innerText = channel_remind[2];
			}
			else if(screenMode == 6)
			{
				$("channel_resolution").innerText = "";
			}
			else
			{
				if(parseInt(resolutionDatas[1],10)>0&&parseInt(resolutionDatas[3],10)>=0&&parseInt(resolutionDatas[3],10)<=1)
				{
					$("channel_resolution").innerText = resolutionDatas[1] + pOrI[resolutionDatas[3]] + " " + sdOrHd[isHD];//xxxxp HD;
				}
				else
				{
					$("channel_resolution").innerText = "";
				}
			}
		}
	}
}
/*
	根据不同项目显示CC
*/
function showCC()
{
	var isCcExist = setting.isCCAvailable();
	console.log("showCC isCcExist is "+isCcExist);
	//格伦比亚项目 在ATV信源下显示为CC。DTV信源下显示为STTL
	if((top.isLAFlag && !top.isCBFlag) ||(top.isCBFlag && channel.inputSource == 0))
	{
		if(isCcExist)
		{
			$("show_cc").innerText = "CC";
			$('show_cc').style.display = "block";
		}
		else 
		{
			$("show_cc").innerText = "";
			$('show_cc').style.display = "none";
		}
	}
	else if(top.isNAFlag)
	{
		$("show_cc").style.color = "#fff";
		if(isCcExist)
		{
			$("show_cc").innerText = "CC";
			$('show_cc').style.display = "block";
		}
		else 
		{
			//$("show_cc").innerText = "No CC";
			$("show_cc").innerText = "";
			$('show_cc').style.display = "none";
		}
	}
	else
	{
		$('show_cc').style.display = "none";
	}
}

function showGinga()
{
    var gingaList = Ginga.getAppList();
    if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && Ginga.isEnable && gingaList.length > 0)//show ginga characters on infobar
    {
        $("ginga_Service").innerText = "Ginga";
    }
    else
    {
        $("ginga_Service").innerText = "";
    }
}

var currentEventAgeLevel = 0;
var ageRatingWords				= top.ageRatingOptions;			//LA项目中对应的Rating age
var contentRatingWords          = top.contentRatingOptions; 	//LA项目中对应的Rating content
/*
*换台
*操作：填写channel info信息
*/
function refreshChannelInfoTimer()
{
	if(enterNumFlag)
	{
		return;
	}
	if(top.isLAFlag)
	{
		$("program_parentRate_1").style.display = "none";
		$("program_parentRate_2").style.display = "none";
		$("rating_info").style.display = "block";
		$('show_cc').style.display = "block";
		$("show_cc").innerText = "CC";
	}
	else if(top.isNAFlag)
	{
		$("program_parentRate_1").style.display = "block";
		$("program_parentRate_2").style.display = "block";
		$("rating_info").style.display = "none";
		$('show_cc').style.display = "block";
	}
	else
	{
		$('show_cc').style.display = "none";
		$("rating_info").style.display = "none";
		$("program_parentRate_1").style.display = "block";
		$("program_parentRate_2").style.display = "block";
	}
	
	refreshInfoTimer=0;
	console.log("curren hbbtvStatus "+channel.checkhbbtvStatus());
	if (channelInfo_timer && channel.checkhbbtvStatus() == 0)//当hbbtv状态打开时不清除此值，防止showInfoFrom()入口处直接返回
   	{
      	clearTimeout(channelInfo_timer);
      	channelInfo_timer = 0;
   	}
	if(inputSource!=top.g_channel.inputSource)
	{
		return;
	}
	if(inputSource<=1&&channelIndex!=channel.currentIndex)
	{
		return;
	}
	$("input_format").innerText = "";
	var inputName;
	if(top.inputLock == 1)
	{
		switch(inputSource)
		{
			case 0:
			case 1:
				$("channel_num").innerText = source_titles[0];
				break;
			case 2:
			case 3:
			case 11:
                var sourceindex;
                if(top.supportAV1Source == 1)
                {
                    sourceindex=top.E_INPUT_AV_I;
                }
                else if(top.supportAV2Source == 1)
                {
                    sourceindex=top.E_INPUT_AV_II;
                }
                else
                {
                    sourceindex=top.E_INPUT_SCART;
                }
				inputName = channel.inputSourceDeviceName(sourceindex);
				$("channel_num").innerText = source_titles[1];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 4:
				inputName = channel.inputSourceDeviceName(4);
					$("channel_num").innerText = source_titles[2];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 5:
				inputName = channel.inputSourceDeviceName(5);
					$("channel_num").innerText = source_titles[7];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 6:
				inputName = channel.inputSourceDeviceName(6);
					$("channel_num").innerText = source_titles[3];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 7:
				inputName = channel.inputSourceDeviceName(7);
					$("channel_num").innerText = source_titles[4];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 8:
				inputName = channel.inputSourceDeviceName(8);
					$("channel_num").innerText = source_titles[5];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 12:
				inputName = channel.inputSourceDeviceName(12);
				$("channel_num").innerText = source_titles[6];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
		}
		$("input_format").innerText =  channel_remind[18];
		$("channel_time").innerHTML="";
		$("tuner_picture").style.display="none";
		$("tuner_name").innerHTML="";
		top.ttsLog("channel_num=" + $("channel_num").innerText);
		top.ttsLog("channel_name=" + $("channel_name").innerText);
		//top.ttsLog("channel_remind=" +channel_remind[18]);
		var ttsStr = $("channel_num").innerText + "," + $("channel_name").innerText + "," + channel_remind[18];
		top.ttsLog("ttsStr=" + ttsStr);
		top.setTTSSay(top.SPEECH_TYPE_FLUSH, ttsStr);
		//整块的显示控制在调用的地方处理
			
		return;
	}
	
	if(inputSource > 1)//非tv信源
	{
		switch(inputSource)
		{
			case 0:
			case 1:
				$("channel_num").innerText = source_titles[0];
				break;
			case 2:
			case 3:
			case 11:
                var sourceindex;
                if(top.supportAV1Source == 1)
                {
                    sourceindex=top.E_INPUT_AV_I;
                }
                else if(top.supportAV2Source == 1)
                {
                    sourceindex=top.E_INPUT_AV_II;
                }
                else
                {
                    sourceindex=top.E_INPUT_SCART;
                }
				inputName = channel.inputSourceDeviceName(sourceindex);
                $("channel_num").innerText = source_titles[1];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 4:
				inputName = channel.inputSourceDeviceName(4);
				$("channel_num").innerText = source_titles[2];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 5:
				inputName = channel.inputSourceDeviceName(5);
				$("channel_num").innerText = source_titles[7];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 6:
				inputName = channel.inputSourceDeviceName(6);
				$("channel_num").innerText = source_titles[3];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 7:
				inputName = channel.inputSourceDeviceName(7);
				$("channel_num").innerText = source_titles[4];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 8:
				inputName = channel.inputSourceDeviceName(8);
				$("channel_num").innerText = source_titles[5];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
			case 12:
				inputName = channel.inputSourceDeviceName(12);
				$("channel_num").innerText = source_titles[6];
				if(inputName==0)
				{
					$("channel_name").innerText ="";
				}
				else
				{
					$("channel_name").innerText ="("+ top.sysInputSet[inputName]+")";
				}
				break;
		}
		top.ttsLog("channel_name=" + $("channel_name").innerText);
		top.ttsLog("channel_num=" + $("channel_num").innerText);
		var ttsStr = $("channel_num").innerText + $("channel_name").innerText;
		if(lastChannelInfo != ttsStr)
		{
			top.ttsLog("ttsStr=" + ttsStr);
			top.setTTSSay(top.SPEECH_TYPE_FLUSH, ttsStr);
		}
		lastChannelInfo = ttsStr;
		$("channel_time").innerHTML="";
		$("tuner_picture").style.display="none";
		$("tuner_name").innerHTML="";
		return;
	}
	else if(channelIndex!=channel.currentIndex)
	{
		return;
	}
	setTimeout(function(){
		try
		{
			if(top.g_channel.inputSource == 1 && channel.currentSignalStatus==1)
			{
				var triplet = channel.getCurrentChannelTriplet();
				var tripletTemp = triplet.split("&");
				channel.setHistoryChannelInfo(tripletTemp[0],tripletTemp[2],tripletTemp[3],tripletTemp[1]);
			}
		}
		catch(er)
		{
			testLog(er);
		}
	},400);
 	currentChannel = channel.getCurrentChannelInfo();
	//channel_info_1
	var num = currentChannel.number;
	if(num >= 0)
	{
		$("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(currentChannel) : currentChannel.number;
	}
	else
	{
		$("channel_num").innerText = "";
	}
	$("channel_name").innerText =  currentChannel.name;
	var date = setting.currentDate;
	var newDate = new Date(date.substring(6),parseInt(date.substring(3,5),10) - 1,date.substring(0,2));
	$("channel_time").innerText =  setting.currentTime.substring(0,5);
	//var tuner = top.isLAFlag ? (channel.tunerMode == 5 ? 1 : channel.tunerMode) : channel.tunerMode;
	var tuner = channel.tunerMode;
	if(top.isNAFlag == 1)
	{
		if(tuner == 6)
		{	
			tuner = 1;
		}
		else if(tuner == 7)
		{
			tuner = 0;
		}
	}
	else if(top.isLAFlag == 1)
	{
		tuner = tuner == 5 ? 1 : tuner;
	}
	$("tuner_picture").style.display="block";
	if(tuner==0)
	{
		$("tuner_picture").src=tuner_picture[0];
		$("tuner_name").innerHTML=tuner_name[0];
	}
	else if(tuner==1)
	{
		$("tuner_picture").src=tuner_picture[1];
		$("tuner_name").innerHTML=tuner_name[1];
	}
	else
	{
		$("tuner_picture").src=tuner_picture[2];
		$("tuner_name").innerHTML=tuner_name[2];
	}
	
   
	
	$("channel_resolution").innerText = "";
	if(top.channelLock == 1 || top.parentalLock == 1 || (currentChannel.isLock == 1 && currentChannel.unlockFlag == 0))//locked
	{
		var programList  = currentChannel.getProgramPlayList();
		if( programList[0].id == -1)//没有当前事件
		{
			currentEventAgeLevel = 0;
		}
		else
		{
			currentEventAgeLevel = programList[0].parentRate;
		}
		
		if(top.channelLock == 1)
		{
			$("channelRemind").innerHTML = channel_remind[13];
			$("channel_content").innerText = channel_remind[13];
			top.ttsLog("ttsStr=" +channel_remind[13]);
			top.setTTSSay(top.SPEECH_TYPE_FLUSH,channel_remind[13]);
		}
		else if(top.parentalLock == 1)
		{
			$("channelRemind").innerHTML = channel_remind[9];
			$("channel_content").innerText = channel_remind[9];
			top.ttsLog("ttsStr=" +channel_remind[9]);
			top.setTTSSay(top.SPEECH_TYPE_FLUSH,channel_remind[9]);
		}
		else
		{
			$("channelRemind").innerHTML = "";
			$("channel_content").innerText = "";
		}
		$("channelRemind").style.display = "block";
		$("nowChannelInfo").style.display = "block";
		$("expandChannelInfo").style.display = "none";	
		$("rating_info").style.display = "none";
		//var isCcExist = setting.isCCAvailable();
		//$('show_cc').style.display = (top.isLAFlag && isCcExist) ? "block" : "none";
		showCC();
		$("audio_mode").style.display = "none";
		$("sound_channel").style.display = "none";
		$("program_content_genre").style.display="none";
		return;
	}
	else if(!channel.currentSignalStatus)//no signal
	{
		if(currentChannel.isFavorite)//是否为喜爱节目
		{
			$("fav_picture").style.display = "block";
		}
		else
		{
			$("fav_picture").style.display = "none";
		}
		$("nowChannelInfo").style.display = "block";
		$("expandChannelInfo").style.display = "none";
		$("sttl_ttx").style.display = "none";
		$("rating_info").style.display = "none";
		//var isCcExist = setting.isCCAvailable();
		//$('show_cc').style.display = (top.isLAFlag && isCcExist) ? "block" : "none";
		showCC();
		$("sound_channel").style.display = "none";
		$("program_content_genre").style.display="none";
		if(inputSource == 0)
		{
			initSoundType();//初始化丽音
			$("audio_mode").style.display = "block";
			$('channel_content').innerText = channel_remind[11];
			$("channelRemind").style.display = "none";
		}
		else
		{
			$("channelRemind").innerHTML = channel_remind[1];
			$("channelRemind").style.display = "block";
			$("audio_mode").style.display = "none";
			$("channel_content").innerText = channel_remind[1];
		}
		top.ttsLog("channel_name=" + $("channel_name").innerText);
		top.ttsLog("channel_num=" + $("channel_num").innerText);
		var ttsStr = $("channel_num").innerText + $("channel_name").innerText;
		top.ttsLog("ttsStr=" + ttsStr);
		top.setTTSSay(top.SPEECH_TYPE_FLUSH, ttsStr);
		return;
	}

	else 
	{
		formatChange();
		if(currentChannel.isFavorite)//是否为喜爱节目
		{
			$("fav_picture").style.display = "block";
		}
		else
		{
			$("fav_picture").style.display = "none";
		}
		$("channelRemind").style.display = "none";
		var programList  = currentChannel.getProgramPlayList();
		var programListLength = programList.length;

        showGinga();

		if(currentChannel.serviceType == 0)
		{
			initSoundType();//初始化丽音
			$("sttl_ttx").style.display = "block";
			//$("ttx_picture").style.display = setting.isTtxAvailable ? "block" : "none";
            if(setting.isTtxAvailable)
            {
                if (top.isLAFlag || top.isNAFlag)
                    $("ttx_picture").style.display = "none";
                else
                    $("ttx_picture").style.display = "block";
            }
            else
            {
                $("ttx_picture").style.display = "none";
            }
			$("era_picture").style.display = "none";
			$("sttl_picture").style.display = "none";
			
			$("audio_mode").style.display = "block";
			$("sound_channel").style.display = "none";
			//channel_remind[11]
			$("program_time_1").innerText =  "";
			$("program_name_1").innerText = "";
			$("program_parentRate_1").innerText = "";
			$("program_time_2").innerText = "";
			$("program_name_2").innerText = "";
			$("program_parentRate_2").innerText = "";
			$('channel_content').innerText = channel_remind[11];
			$("program_name_1").innerText = channel_remind[19];
			$("nowChannelInfo").style.display = "block";
			$("expandChannelInfo").style.display = "block";
			$("program_content_genre").style.display="none";
			//var isCcExist = setting.isCCAvailable();
            //$('show_cc').style.display = (top.isLAFlag && isCcExist) ? "block" : "none";
			showCC();
			$("rating_age").innerText = "";
			$("rating_content").innerText = "";
			$('subtitle_language').innerText = "";
			$("data_Service").innerText = "";
		}
		else
		{
			$("sttl_ttx").style.display = "block";
			$("audio_mode").style.display = "block";
			$("sound_channel").style.display = "block";
			var screenMode = channel.currentScreenSaverMode;
			if(screenMode == 3 || screenMode ==1)
			{
				$("sound_channel_text").innerText = "";
				$("program_audio").innerText = channel_remind[2];
			}
			initSubtitleMode();
			
			//var isCcExist = setting.isCCAvailable();
            //$('show_cc').style.display = (top.isLAFlag && isCcExist) ? "block" : "none";
			showCC();
			
			var isNoProgramData = 1;
			console.log("programList[0].id is "+programList[0].id+" programList[1].id is "+programList[1].id);
			console.log("startTime"+programList[0].startTime+"endTime"+programList[0].endTime+" name "+programList[0].name);
			console.log("startTime"+programList[1].startTime+"endTime"+programList[1].endTime+" name "+programList[1].name);
			//var tts_programList0 = programList[0].name + programList[0].startTime + programList[0].endTime;
			//var tts_programList1 = programList[1].name + programList[1].startTime + programList[1].endTime;
			if(programList[0].id == -1)//没有当前事件
			{
				//testLog("Current program no signal !!!!");
				if(top.isLAFlag)
				{
					$("rating_age").innerText = "";
					$("rating_content").innerText = "";
					$("data_Service").innerText = "";
				}

				$("program_time_1").innerText = "";
				$("program_name_1").innerText = "";
				$("program_parentRate_1").innerText = "";
				isNoProgramData = 1;
				showGenre(0xffff);
			}
			else
			{
				$("program_time_1").innerText =  programList[0].startTime + "-" +  programList[0].endTime;
				$("program_name_1").innerText = programList[0].name;
				var rate = programList[0].parentRate;
				//testLog("showGenre ~~~~~~~ "+programList[0].genre);
				showGenre(programList[0].genre);
				if(top.isLAFlag && !top.isCBFlag)
				{
					//rate = setting.parentalRating;
					//var lockLevel = setting.getContentLockLevel();
					//testLog("liukl LA rate is "+rate);
					var lockLevel = (rate >> 4) & 0x0f;
					rate = rate & 0x0f;
					//testLog("liukl LA rate is "+rate+" lockLevel is "+lockLevel);
					if(rate == 0)
					{
						$("rating_age").innerText = "";
					}	
					else
					{
						$("rating_age").innerText = ageRatingWords[rate - 1];
					}
					if(lockLevel == 0)
					{
						$("rating_content").innerText = "";
					}
					else
					{
						$("rating_content").innerText = contentRatingWords[lockLevel];
					}
					$("data_Service").innerText = "Data";
				}
				else if(top.isCBFlag)
				{
					console.log(" CB rate is "+rate);
					if(rate >= 4 && rate < 19)
					{
						$("rating_age").innerText = rate;
					}
					else
					{
						$("rating_age").innerText = "";
					}
				}
				else
				{
					if(top.isAUFlag && 0 == channel.systemCountry)
					{
						setAUParentRating(rate, $("program_parentRate_1"));
					}
					else if(top.isAUFlag && 26 == channel.systemCountry)
					{
						setNZParentRating(rate, $("program_parentRate_1"));
					}
					else if(top.isAPFlag && 36 == channel.systemCountry)
					{
						setAPParentRating(rate, $("program_parentRate_1"));
					}
					else if(top.isNAFlag)
					{
						$("program_parentRate_1").style.display = "block";
						var rating = setting.getEpgEventRating(currentChannel.index,programList[0].id);
						console.log(" getEpgEventRating rating is "+rating+" index is "+currentChannel.index+" id is "+programList[0].id);
						if(rating.length > 0)
						{
							$("program_parentRate_1").innerText = rating;
						}
						else
						{
							$("program_parentRate_1").innerText = "No Rating";
						}
					}
					else 
					{
						if(rate >= 4 && rate < 19)
						{
							$("program_parentRate_1").innerText = rate + "+";
						}
						else if(top.g_channel.systemCountry==22&&rate == 19)
						{
							$("program_parentRate_1").innerText = "X";
						}
						else
						{
							$("program_parentRate_1").innerText = "";
						}
					}
				}
				isNoProgramData = 0;
			}
			if(programList[1].id == -1)//没有next事件
			{
				$("program_time_2").innerText = "";
				$("program_name_2").innerText = "";
				$("program_parentRate_2").innerText = "";
			}
			else
			{
				$("program_time_2").innerHTML =  programList[1].startTime + "-" +  programList[1].endTime;
				$("program_name_2").innerHTML = programList[1].name;
				var rate = programList[1].parentRate ;
				if(top.isAUFlag && 0 == channel.systemCountry)
				{
					setAUParentRating(rate, $("program_parentRate_2"));
				}
				else if(top.isAUFlag && 26 == channel.systemCountry)
				{
					setNZParentRating(rate, $("program_parentRate_2"));
				}
				else if(top.isAPFlag && 36 == channel.systemCountry)
				{
					setAPParentRating(rate, $("program_parentRate_2"));
				}
				else if(top.isNAFlag)
				{
					$("program_parentRate_2").style.display = "block";
					var rating = setting.getEpgEventRating(currentChannel.index,programList[1].id);
					console.log(" getEpgEventRating rating is "+rating+" index is "+currentChannel.index+" id is "+programList[1].id);
					if(rating.length > 0)
					{
						$("program_parentRate_2").innerText = rating;
					}
					else
					{
						$("program_parentRate_2").innerText = "No Rating";
					}				
				}
				else 
				{
					if(rate >= 4 && rate < 19)
					{
						$("program_parentRate_2").innerText = rate + "+";
					}
					else if(top.g_channel.systemCountry==22&&rate == 19)
					{
						$("program_parentRate_1").innerText = "X";
					}
					else
					{
						$("program_parentRate_2").innerText = "";
					}
				}
				isNoProgramData = 0;
			}
			
			if(isNoProgramData == 1)//no program data
			{
				$("nowChannelInfo").style.display = "block";
				$("expandChannelInfo").style.display = "block";
				$("channel_content").innerText = channel_remind[11];
				$("program_name_1").innerText = channel_remind[19];
			}
			else//其他情况
			{
				var detail="";
				if(programList[0].id >= 0)
				{
				  detail =channel.eventDetail(currentChannel.index,programList[0].id);
				}
				if(detail.length > 0)
				{
					$('channel_content').innerText = detail;
				}
				else
				{
					$('channel_content').innerText = channel_remind[11];
				}
				
				$("nowChannelInfo").style.display = "block";
				$("expandChannelInfo").style.display = "block";
			}
		}
	}
	top.ttsLog("channel_num=" + $("channel_num").innerText);
	var currentChannelInfo = $("channel_num").innerText + "," + $("channel_name").innerText + "," + $("program_name_1").innerText + "," + $("channel_content").innerText;
	if(lastChannelInfo != currentChannelInfo)
	{
		top.ttsLog("ttsStr=" + currentChannelInfo);
		top.setTTSSay(top.SPEECH_TYPE_FLUSH, currentChannelInfo);
	}
	lastChannelInfo = currentChannelInfo;
}
function setNZParentRating(rate, obj)
{
	switch(rate)
	{
		case 0x0 + 3:
			obj.innerText = "";
			break;
		case 0x1 + 3:
		case 0x2 + 3:
		case 0x3 + 3:
		case 0x4 + 3:
		case 0x5 + 3:
		case 0x6 + 3:
			obj.innerText = "G";
			break;
		case 0x7 + 3:		
		case 0x8 + 3:
			obj.innerText = "PGR";
			break;
		case 0x9 + 3:
		case 0xA + 3:
		case 0xB + 3:
		case 0xC + 3:
			obj.innerText = "AO";
			break;
		default:
			obj.innerText = "";
			break;
	}
}

function setAUParentRating(rate, obj)
{
	switch(rate)
	{
		case 0x0 + 3:
		case 0x1 + 3:
			obj.innerText = "";
			break;
		case 0x2 + 3:
		case 0x3 + 3:
			obj.innerText = "P";
			break;
		case 0x4 + 3:
		case 0x5 + 3:
			obj.innerText = "C";
			break;
		case 0x6 + 3:
		case 0x7 + 3:
			obj.innerText = "G";
			break;
		case 0x8 + 3:
		case 0x9 + 3:
			obj.innerText = "PG";
			break;
		case 0xA + 3:
		case 0xB + 3:
			obj.innerText = "M";
			break;
		case 0xC + 3:
		case 0xD + 3:
		case 0xE + 3:
			obj.innerText = "MA 15+";
			break;
		case 0xF + 3:
			obj.innerText = "R";
			break;
		default:
			obj.innerText = "";
			break;
	}
}
function setAPParentRating(rate, obj)
{
       console.log("Log from channelPlay.html:"+"=================rate=================:"+rate);

	switch(rate)
	{
        case 0:
            obj.innerText = "-";
            break;
        case 4:
            obj.innerText = "ป";
            break;
        case 5:
        case 6:
            obj.innerText = "ด";
            break;
        case 7:
        case 8:
        case 9:
        case 10:
            obj.innerText = "ท";
            break;
        case 11:
        case 12:
        case 13:
            obj.innerText = "น13";
            break;
        case 14:
        case 15:
        case 16:
        case 17:
        case 18:
            obj.innerText = "น18";
            break;
        case 19:
            obj.innerText = "ฉ";
            break;
        default:
            obj.innerText = "";
            break;

	}
}

function refreshChannelInfo()
{
	console.log("in refreshChannelInfo refreshInfobarFlag = "+refreshInfobarFlag);
	if(refreshInfobarFlag == 0)
	{
		return;
	}
	if(refreshInfoTimer==0&&(inputSource<=1&&channelIndex==channel.currentIndex))
	{
		refreshInfoTimer=setTimeout(function(){
			refreshChannelInfoTimer();
			refreshInfoTimer = 0;
			hideRemind();
			showInfoFrom();},300);
	}
	else if(inputSource<=1&&channelIndex!=channel.currentIndex)
	{
		clearTimeout(refreshInfoTimer);
		refreshInfoTimer=0;
	}
	else if(inputSource>1)
	{
		clearTimeout(refreshInfoTimer);
		refreshInfoTimer=0;
		refreshChannelInfoTimer();
		formatChange();
		showInfoFrom();
	}
}

//atv 下 按LANG键切换的是丽音
function initSoundType()
{
	soundTypeInfo = setting.getSoundType();
	soundTypeItems = soundTypeInfo.items.split("/");
	soundTypeLength = soundTypeInfo.length;
	soundTypeIndex = soundTypeInfo.index;
	if(soundTypeLength > 0)
	{
		$("program_audio").innerText = sound_type[parseInt(soundTypeItems[soundTypeIndex],10)];
	}
	else
	{
		$("program_audio").innerText = "";
	}
	$("lang_eye_picture").style.display = "none";
    $("lang_ear_picture").style.display = "none";
	
}

function doChangeSoundType()
{
	soundTypeInfo = setting.getSoundType();
	soundTypeItems = soundTypeInfo.items.split("/");
	soundTypeLength = soundTypeInfo.length;
	soundTypeIndex = soundTypeInfo.index;
	if(soundTypeLength > 1)
	{
		soundTypeIndex++;
		if(soundTypeIndex >= soundTypeLength)
		{
			soundTypeIndex = 0;
		}
		setting.setSoundType(soundTypeInfo.mode,soundTypeIndex);
		$("program_audio").innerText = sound_type[parseInt(soundTypeItems[soundTypeIndex],10)];
	}
}


var audioModeDatas 				  = new Array(30);//保存audio mode列表, 每一个数据保存类型为“视听觉障碍类型（1位）:index/count 语言 音频模型”
var soundChannel                  = 0;
var audioModeCountPage            = 0;
var audioCurrentPage              = 0;
var positionH                     = 0;
var audioShowTimer                = 0;
/*
*function:快捷键LANG
*input:
*/
function countAudioPage()
{
	if(audioModeCount==0)
	{
		audioModeCountPage=0;
	}
	else 
	{
		if(audioModeCount%14==0)
		{
			audioModeCountPage=parseInt(audioModeCount/14);
		}
		else
		{
			audioModeCountPage=parseInt(audioModeCount/14)+1;
		}
	}
}

var audioModeCount = 0;
var audioModeIndex	= 0;
var visuals;					//视觉障碍标志数组
var audios;						//audio type枚举数组
var soundChannels ;
var langShows = new Array(30); //国家显示文字数组
function getAudioInfo()
{
	var audioInfo = currentChannel.programAudioMode();
	audioModeCount = audioInfo.audioSelCount;
	audioModeIndex	= audioInfo.curAudioIdx;
	var langs = audioInfo.langCodeList.split("/");
	visuals = audioInfo.visualTypeList.split("/");
	audios	= audioInfo.audioTypeList.split("/");
	soundChannels = audioInfo.soundChannelList.split("/");
	/**********处理audio mode中的语言问题start************/
	var count = 1;
	var nowIndex = 0;
	var afterIndex = 0;
	var beforeIndex = 0;
	var isExist = 0;
	for(nowIndex = 0; nowIndex < audioModeCount; nowIndex++)
	{
		for(beforeIndex = 0; beforeIndex < nowIndex; beforeIndex++)//判断先前是否已经对这个数据做过判断
		{
			if(langs[nowIndex] == langs[beforeIndex])
			{
				isExist = 1;
			}
		}
	
		if(isExist)//先前已经做过判断，直接处理下一个数据
		{
			isExist = 0;
			continue;
		}
		else
		{
			var systemCountry = top.g_channel.systemCountry;
			for(afterIndex = ( nowIndex + 1); afterIndex < audioModeCount; afterIndex++)//判断后面是否有相同的语言，如果有需要做特殊处理
			{
				if(langs[nowIndex] == langs[afterIndex])
				{
					count++;
					if(count == 2)//对第一次的语言做处理
					{
						if((systemCountry == 15 || systemCountry == 6 || systemCountry == 7 || systemCountry == 23 || systemCountry == 25)&&langs[nowIndex]==46)
						{
							langShows[nowIndex] = top.all_language[parseInt(langs[nowIndex],10)+1] + 1;
						}
						else
						{
							langShows[nowIndex] = top.all_language[langs[nowIndex]] + 1;
						}
					}
					if((systemCountry == 15 || systemCountry == 6 || systemCountry == 7 || systemCountry == 23 || systemCountry == 25)&&langs[nowIndex]==46)
					{
						langShows[afterIndex] = top.all_language[parseInt(langs[afterIndex],10)+1] + count;
					}
					else
					{
						langShows[afterIndex] = top.all_language[langs[afterIndex]] + count;
					}
				}
			}
			if(count == 1)
			{
				if((systemCountry == 15 || systemCountry == 6 || systemCountry == 7 || systemCountry == 23 || systemCountry == 25)&&langs[nowIndex]==46)
				{
					langShows[nowIndex] = top.all_language[parseInt(langs[nowIndex],10)+1];
				}
				else
				{
					langShows[nowIndex] = top.all_language[langs[nowIndex]];
				}
			}
			count = 1;
		}
	}
	/**********处理audio mode中的语言问题 end************/
	var srceenMode =channel.currentScreenSaverMode;
	if(srceenMode == 3 || srceenMode ==1)
	{
		for(var i = 0; i < audioModeCount; i++)
		{
			audioModeDatas[i] = "" + (i + 1) + "/" + audioModeCount + " " +channel_remind[2];
		}
	}
	else
	{
		for(var i = 0; i < audioModeCount; i++)
		{
			audioModeDatas[i] = "" + (i + 1) + "/" + audioModeCount + " " + langShows[i] + " " + audioType[audios[i]] 
		}
	}
}
function showAudioSelectList() //显示audio lang 选择列表
{

	getAudioInfo();
	
	countAudioPage();
	if(audioModeCount>0)
	{
	    top.keySetForUI(1);
		showPageType = "showAudio";
		$("preSetOptionPlay").innerHTML=mode_option[0];
		audioCurrentPage=parseInt(audioModeIndex/14);
		positionH=parseInt(audioModeIndex%14);
		showAudioCurrentPage();
		$("preSetSelectFocusPlay").style.top=105+positionH*70+"px";
		doElementScroll(presetSpanList,positionH);
		$("preSetBarPlay").style.display="block";
		clearTimeout(audioShowTimer);
		audioShowTimer=setTimeout("toAudioLangback()",10*1000);
	}
	else
	{
	    top.keySetForUI(0);
		if(showPageType == "")
		{
			$("preSetBarPlay").style.display="none";
		}
	}

}
function showAudioCurrentPage()//显示audio 当前页选项
{
	try
	{
	presetSpanList=$("preSetBarPlay").getElementsByTagName("span");//picPreset[pictureMode];
	for(var i =0 ; i<14;i++)
	{
		presetSpanList[i+1].innerHTML="";
	}
	for(var i =0 ; i<14;i++)
	{
		if(audioCurrentPage*14+i>=audioModeCount)
		{
			break;
		}
		var audioData = audioModeDatas[audioCurrentPage*14+i].split(" ");
		presetSpanList[i+1].innerHTML=audioData[0]+" "+audioData[1];// +" "+dtvSoundChannels[soundChannels[audioCurrentPage*14+i]];
	}
	}catch(er)
	{
		testLog("showAudioCurrentPage:"+er);
	}
}
function initAudioMode() //初始化info 信息中的audio
{

	getAudioInfo();
			
	if(audioModeCount > 0)
	{
		if(visuals[audioModeIndex] == 3 && top.isNAFlag != 1)
		{
			$("lang_eye_picture").style.display = "block";
		}
		else if(visuals[audioModeIndex] == 2 && top.isNAFlag != 1)
        {
            $("lang_ear_picture").style.display = "block";
        }
		else
		{
			$("lang_eye_picture").style.display = "none";
            $("lang_ear_picture").style.display = "none";
		}
		$("program_audio").innerText = channel_play_main[1] + audioModeDatas[audioModeIndex];
		
		//更新声道
		soundChannel = currentChannel.soundChannel;
		var screenMode = channel.currentScreenSaverMode;
		if(screenMode == 3 || screenMode ==1)
		{
			$("sound_channel_text").innerText = "";
		}
		else
		{
			$("sound_channel_text").innerText = dtvSoundChannels[soundChannel];
		}
	}
	else
	{
		$("program_audio").innerText=top.others[27];
		$("sound_channel").style.display = "none";
	}
}
function doChangeAudioMode()
{
	if(audioModeCount > 1)
	{
		audioModeIndex++;
		if(audioModeIndex >= audioModeCount)
		{
			audioModeIndex = 0;
		}
		currentChannel.setProgramAudioMode(audioModeIndex);
		initAudioMode();
	}
}

var isTTX;
var subtitleModeDatas;
var subtitleModeCount;//subtitle mode 总数量
var subtitleModeIndex = 0;
var subtitleLanguage = new Array(64);
var subtitleType = new Array(64);
var subtitleLanShow = new Array(64);
function initSubtitleMode()
{
    //isTTX#subtitleModeIndex#subtitleModeCount#subtitleType:subtitleLanguage&subtitleType:subtitleLanguage&
	var str = currentChannel.programSubtitleMode;
	isTTX = parseInt(str.substring(0,str.indexOf("#")),10);
	str = str.substring(str.indexOf("#") + 1);
	subtitleModeIndex = parseInt(str.substring(0,str.indexOf("#")),10);
	str = str.substring(str.indexOf("#") + 1);
	subtitleModeCount = parseInt(str.substring(0,str.indexOf("#")),10);
	str = str.substring(str.indexOf("#") + 1);
	subtitleModeDatas = str.split("&");
	for(var i=0;i<subtitleModeCount;i++)
	{
		subtitleType[i]=parseInt(subtitleModeDatas[i].substring(0,subtitleModeDatas[i].indexOf(":")),10);
		subtitleLanguage[i]=parseInt(subtitleModeDatas[i].substring(subtitleModeDatas[i].indexOf(":") + 1),10);
	}
	/**********处理subtitle mode中的语言问题start************/
	var count = 1;
	var nowIndex = 0;
	var afterIndex = 0;
	var beforeIndex = 0;
	var isExist = 0;
	for(nowIndex = 0; nowIndex < subtitleModeCount; nowIndex++)
	{
		for(beforeIndex = 0; beforeIndex < nowIndex; beforeIndex++)//判断先前是否已经对这个数据做过判断
		{
			if(subtitleLanguage[nowIndex] == subtitleLanguage[beforeIndex])
			{
				isExist = 1;
			}
		}
	
		if(isExist)//先前已经做过判断，直接处理下一个数据
		{
			isExist = 0;
			continue;
		}
		else
		{
			for(afterIndex = ( nowIndex + 1); afterIndex < subtitleModeCount; afterIndex++)//判断后面是否有相同的语言，如果有需要做特殊处理
			{
				if(subtitleLanguage[nowIndex] == subtitleLanguage[afterIndex])
				{
					count++;
					if(count == 2)//对第一次的语言做处理
					{
						subtitleLanShow[nowIndex] = top.all_language[subtitleLanguage[nowIndex]] + 1;
					}
					subtitleLanShow[afterIndex] = top.all_language[subtitleLanguage[afterIndex]] + count;
				}
			}
			if(count == 1)
			{
				subtitleLanShow[nowIndex] = top.all_language[subtitleLanguage[nowIndex]];
			}
			count = 1;
		}
	}

	/**********处理subtitle mode中的语言问题 end************/
	if(setting.isTtxAvailable)
	{
        if (top.isLAFlag || top.isNAFlag)
            $("ttx_picture").style.display = "none";
        else
		    $("ttx_picture").style.display = "block";
	}
	else
	{
		$("ttx_picture").style.display = "none";
	}
	var screenMode =channel.currentScreenSaverMode;
	if(subtitleModeCount > 0 && screenMode != 3 && screenMode!=1)
	{
		if((top.isLAFlag && !top.isCBFlag) || top.isNAFlag)
		{
			$("sttl_picture").style.display = "none";
		}
		else
		{
			$("sttl_picture").style.display = "block";
		}
		if(subtitleModeIndex >= subtitleModeCount)
		{
			$("era_picture").style.display = "none";
			$('subtitle_language').innerText = "";
		}
		else
		{
			var earType = subtitleType[subtitleModeIndex];
			if(earType == 1)
			{
				$("era_picture").style.display = "block";
			}
			else
			{
				$("era_picture").style.display = "none";
			}
			$('subtitle_language').innerText =subtitleLanShow[subtitleModeIndex];
		}
	}
	else
	{
		$("sttl_picture").style.display = "none";
		$("era_picture").style.display = "none";
		$('subtitle_language').innerText = "";
	}
}
var subtitleCountPage =0;
var subtitleCurrentPage = 0;
function countSubtitlePage()
{
	if(subtitleModeCount==0)
	{
	    top.g_remindWord = "noSubTitle";
        top.$("main").src = "intermediate.html";
        top.requestFocus(top.main, 1);
        top.setFrameFocusPage("main");
        top.$("operatePage").src = "";

		subtitleCountPage=0;
	}
	else 
	{
		if((subtitleModeCount+1)%14==0)
		{
			subtitleCountPage=parseInt((subtitleModeCount+1)/14);
		}
		else
		{
			subtitleCountPage=parseInt((subtitleModeCount+1)/14)+1;
		}
	}
}
function showSubtitleList()
{
	initSubtitleMode();
	countSubtitlePage();
	if(subtitleModeCount>0&&subtitleModeCount<64)
	{
		top.keySetForUI(1);
		showPageType = "showSubtile";
		if(subtitleModeIndex==255)
		{
			subtitleModeIndex=0;
		}
		else
		{
			subtitleModeIndex++;
		}
		$("preSetOptionPlay").innerHTML=top.chOptions[6];
		subtitleCurrentPage=parseInt(subtitleModeIndex/14);
		positionH=parseInt(subtitleModeIndex%14);
		showSubtitleCurrentPage();
		$("preSetSelectFocusPlay").style.top=105+positionH*70+"px";
		doElementScroll(presetSpanList,positionH);
		$("preSetBarPlay").style.display="block";
		clearTimeout(audioShowTimer);
		audioShowTimer=setTimeout("toAudioLangback()",10*1000);
	}
	else
	{
		top.keySetForUI(0);
		if(showPageType == "")
		{
			$("preSetBarPlay").style.display="none";
		}
	}
}
var presetSpanList;
function showSubtitleCurrentPage()
{
	presetSpanList=$("preSetBarPlay").getElementsByTagName("span");//picPreset[pictureMode];
	for(var i =0 ; i<14;i++)
	{
		presetSpanList[i+1].innerHTML="";
	}
	if(subtitleCurrentPage==0)
	{
		presetSpanList[1].innerHTML=top.offOn[0];
		for(var i =1 ; i<14;i++)
		{
			if(i>=subtitleModeCount+1)
			{
				break;
			}
			presetSpanList[i+1].innerHTML=subtitleLanShow[i-1];

			if( top.isEUFlag)
			{
				var earType = subtitleType[i-1];
				if (earType == 1) {
					$("era_picture_list").style.top = 128 + i * 70 + "px";
					$("era_picture_list").style.display = "block";
				}
				else {
					$("era_picture_list").style.display = "none";
				}
			}
		}
	}
	else
	{
		for(var i =0 ; i<14;i++)
		{
			if(subtitleCurrentPage*14+i>=subtitleModeCount+1)
			{
				break;
			}
			presetSpanList[i+1].innerHTML=subtitleLanShow[subtitleCurrentPage*14+i-1];

			if( top.isEUFlag)
			{
				var earType = subtitleType[i-1];
				if (earType == 1) {
					$("era_picture_list").style.top = 128 + i * 70 + "px";
					$("era_picture_list").style.display = "block";
				}
				else {
					$("era_picture_list").style.display = "none";
				}
			}
		}
	}
}
function doChangeSubtitleMode()
{
	if(subtitleModeCount > 0)
	{
		var value = currentChannel.setProgramSubtitleMode();
		if(value > 0)
		{
			initSubtitleMode();
		}
	}
}


function hideInfoAndShowRemind()
{
	channelNumShowStatus=0;
	hideInfoForm();
	showRemind();
}

function hideInfoForm()
{
	lastChannelInfo = null;
	$("channel_info_1").style.display = "none";
	$("channel_info_2").style.display = "none";
	$("channel_content_contain").style.display = "none";
	channelInfo_visible = 0;
	if(channelInfo_timer)
	{
		clearTimeout(channelInfo_timer);
	}
	channelInfo_timer = 0;
}
/*
*显示channel info
*具体功能：1.清空现有显示 
*2.设置show_moreInfo_flag,使其适应显示，
*3.修改channelInfo_visible，使其为1 
*4.停止channelInfo_timer的计时功能，设置其为0 
*5.显示channel info
*/
function showInfoFrom()
{
	if((channel.checkhbbtvStatus() > 1 && manualInfoStatus != 1) || channel.inputSource == top.E_INPUT_STORAGE)
	{
		manualInfoStatus = 0;
		return;
	}
	manualInfoStatus = 0;
	detailAnimationTimer = 0;
	if(enterNumFlag)
	{
		return;
	}
	if(inputSource != channel.inputSource)
	{
		return;
	}
	if(inputSource<=1&&channelIndex!=channel.currentIndex)
	{
		return;
	}
	var date = setting.currentDate;
	var newDate = new Date(date.substring(6),parseInt(date.substring(3,5),10) - 1,date.substring(0,2));
	$("channel_time").innerText =  setting.currentTime.substring(0,5);
	if(channelInfo_timer)
	{
		clearTimeout(channelInfo_timer);
		channelInfo_timer = 0;
	}
	if(inputSource > 1 || top.inputLock == 1)
	{
		//when P mode is on ,the info menu should be hided quickly for factory
		if(top.g_factory_hotkey == 1)
		{
			channelInfo_visible = 1;
			$("channel_info_1").style.border="4px solid #1b1b1b";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",1000);
		}
		else if(show_moreInfo_flag == 1)
		{
			channelInfo_visible = 1;
			$("channel_info_1").style.border="4px solid #1b1b1b";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		else
		{
			channelInfo_visible = 0;
			$("channel_info_1").style.display = "none";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",1);
		}
		$("channel_time").innerText="";
		$("tuner_picture").style.display="none";
		$("tuner_name").innerHTML="";
	}
	else
	{
		
		$("tuner_picture").style.display="block";
		//var tuner = top.isLAFlag ? (channel.tunerMode == 5 ? 1 : channel.tunerMode) : channel.tunerMode;
		var tuner = channel.tunerMode;
		if(top.isNAFlag == 1)
		{
			if(tuner == 6)
			{	
				tuner = 1;
			}
			else if(tuner == 7)
			{
				tuner = 0;
			}
		}
		else if(top.isLAFlag == 1)
		{
			tuner = tuner == 5 ? 1 : tuner;
		}
		if(tuner==0)
		{
			$("tuner_picture").src=tuner_picture[0];
			$("tuner_name").innerHTML=tuner_name[0];
		}
		else if(tuner==1)
		{
			$("tuner_picture").src=tuner_picture[1];
			$("tuner_name").innerHTML=tuner_name[1];
		}
		else
		{
			$("tuner_picture").src=tuner_picture[2];
			$("tuner_name").innerHTML=tuner_name[2];
		}
		channelInfo_visible = 1;
		channelNumShowStatus=1;
		if(show_moreInfo_flag == 1)
		{
			$("channel_info_1").style.display = "block";
			$("channel_info_1").style.borderLeft="none";
			$("channel_info_2").style.display = "block";
			$("channel_content_contain").style.display = "block";
			doAnimation();
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		else if(show_moreInfo_flag == 2)
		{
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "block";
			$("channel_info_1").style.borderLeft="none";
			$("channel_content_contain").style.display = "none";
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		else if(show_moreInfo_flag == 3)
		{
			$("channel_info_1").style.border="4px solid #1b1b1b";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		else if(show_moreInfo_flag == 4)
		{
			//没有显示
			$("channel_info_1").style.display = "none";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			channelInfo_visible = 0;
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",1);
		}
		else if(show_moreInfo_flag == 5)
		{
			$("channel_info_1").style.border="4px solid #1b1b1b";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		else if(show_moreInfo_flag == 6)
		{
			$("channel_info_1").style.borderLeft="none";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "block";
			$("channel_content_contain").style.display = "none";
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		else if(show_moreInfo_flag == 7)
		{
			$("channel_info_1").style.borderLeft="none";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "block";
			$("channel_content_contain").style.display = "block";
			doAnimation();
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		else if(show_moreInfo_flag == 0)
		{
			$("channel_info_1").style.display = "none";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			channelInfo_visible = 0;
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",1);
		}
	}
}
function doGreenKey()
{
	if(channelInfo_visible==1&&detailAnimationTimer==1)
	{
		clearTimeout(channelInfo_timer);
		channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		if(currentDetailPage<detailPage)
		{
			$("channel_content").style.top = -210*currentDetailPage + "px";
			currentDetailPage++ ;
		}
		else
		{
			currentDetailPage = 1;
			$("channel_content").style.top = "0px";
		}
	}
}
var detailAnimationTimer = 0;
var detailHeight = 0;
var detailPage = 0;
var currentDetailPage = 0;
function countDetailPage()
{
	if(parseInt(detailHeight%200)==0)
	{
		detailPage = parseInt(detailHeight/200)
	}
	else
	{
		detailPage = parseInt(detailHeight/200)+1;
	}
}
function doAnimation()
{	
	detailHeight = $('channel_content').scrollHeight;
	$("channel_content").style.top = "0px";	
	countDetailPage();
	if(detailHeight <= 200)
	{
		$("detailImg").style.display = "none";
		$("detailSpan").style.display = "none";
	}
	else
	{
		detailAnimationTimer = 1;
		currentDetailPage = 1;
		$("detailImg").style.display = "block";
		$("detailSpan").style.display = "block";
		$("detailSpan").innerHTML = viewDetail;//"View detail"
	}
}
function refreshAnimation()
{
	$("channel_content").style.webkitTransition = "none";
	$("channel_content").style.top = "0px";
	animationInfo();
	detailAnimationTimer = setTimeout("refreshAnimation()",10000);
}

function animationInfo()
{
	 $("channel_content").style.webkitTransition = "linear 8s";//6s---->15s
	 $("channel_content").style.top = -(detailHeight - 200) + "px";
}
function doInfoKey()
{
	if(programStatus == 0)//无频道列表，请先搜台
	{  
	    if(inputSource<=1)
		{
			return;
		}
	}
	if(top.inputLock == 1)
	{
		if(channelInfo_visible == 1)
		{
			channelInfo_visible = 0;
			showRemind();
			$("channel_info_1").style.display = "none";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
		}
		else
		{
			channelInfo_visible = 1;
			hideRemind();
			refreshChannelInfoTimer();
			$("channel_info_1").style.border="4px solid #1b1b1b";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
		}
	}
	else
	{
		initAudioMode();
		initSubtitleMode();
		refreshChannelInfoTimer();
		formatChange();
		if(inputSource > 1)
		{
			if(channelInfo_visible == 0)
			{
				show_moreInfo_flag = 1;
			}
			else
			{
				show_moreInfo_flag = 0;
			}
		}
		else
		{
			//如果当前没有info显示，那么下次显示时显示同上次相同的地方
			if(channelInfo_visible == 0)
			{
				if(show_moreInfo_flag == 0 ) 
				{
					show_moreInfo_flag = 1;
				}
				else if(show_moreInfo_flag == 4)
				{
					show_moreInfo_flag = 5;
				}
			}
			else
			{
				show_moreInfo_flag++;
				if(show_moreInfo_flag > 7)
				{
					show_moreInfo_flag = 0;
				}
			}
		}
		hideRemind();
		showInfoFrom();
	}
}

//la
function refreshSearchResult(id)//[0]atv [1]dtv [-1]update
{
	testLog("refreshSearchResult search end : " + id + ", isSearchingFlag = " + isSearchingFlag);
	//
	if(id == -1)
	{
		//scanningInfo = channel.getScanningInfo();
		//testLog("get scanningInfo = " + scanningInfo);
		cutScanningInfo(channel.getScanningInfo());//将scanningInfo切分并保存到响应的变量中
		if(progress == 100 && isSearchingFlag && needSearchFlag != 0)
		{
			clearTimeout(channelInfo_timer);
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
			channel.stopScan();
			if(needSearchFlag == 0)//search atv
			{
				id = 0;
			}
			else if(needSearchFlag == 1)
			{
				id = 1;
			}
		}
		return;
	}
	//ATV搜台的情况下不能调stop接口
	if(isSearchingFlag && needSearchFlag != 0)
	{
		channel.stopScan();
	}
	//
	var scanningInfo = channel.getScanningInfo();
	testLog("search result get scanningInfo = " + scanningInfo);
	cutScanningInfo(scanningInfo);//将scanningInfo切分并保存到响应的变量中
	if(id == 0)//atv
	{
		channel.setPlayStatusForScan(1);//数字搜台过程中防止切信源等消息，去播放节目,ATV搜索完成之后放开节目播放的限制
		if(atvScanCount > 0)
		{
			programStatus = channel.channelProgramStatus();
			testLog("ATV search successed!");
			channel.setServiceType(0);//atv
			//channel.inputSource = 0;//atv
		}
		else
		{
			testLog("ATV search failed! top.currentChannelIndex = " + top.currentChannelIndex);
			isSearchingFlag = false;
			channelIndex = top.currentChannelIndex;
			onPlayByNum();
			return;
		}
	}
	else if(id == 1)//dtv
	{
		channel.setPlayStatusForScan(1);//数字搜台过程中防止切信源等消息，去播放节目,ATV搜索完成之后放开节目播放的限制
		if(dtvScanCount > 0)
		{
			programStatus = channel.channelProgramStatus();
			testLog("DTV search successed!");
			channel.setServiceType(1);//dtv
			//此刻不需要切换信源，只需要调播放接口
			//channel.inputSource = 1;//dtv
		}
		else
		{
			testLog("DTV search failed!");
			if(!top.isCBFlag)
			{
				//channel.inputSource = 0;//[0]atv [1]dtv
				needSearchFlag = 0;//search atv
				onSearchByNum();
			}
			else
			{
				isSearchingFlag = false;
				channelIndex = top.currentChannelIndex;
				onPlayByNum();
			}
			//channelIndex = top.currentChannelIndex;
			//onPlayByNum();
			return;
		}
	}
	if(channelInfo_timer)
	{
		clearTimeout(channelInfo_timer);
		channelInfo_timer=0;
	}
	
	if(refreshInfoTimer)
	{
		clearTimeout(refreshInfoTimer);
		refreshInfoTimer = 0;
	}
	enterNumFlag = 0;
	isSearchingFlag = false;
	inputMainChNum = -1;
	inputSubChNum = -1;
	inputSpotFlag = false;
	refreshChannelInfo();
	channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
}

//la
function onSearchByNum()
{
	isSearchingFlag = true;
	testLog("the current channel list type = " + channel.channelListType 
		+ ", the current channel index = " + top.currentChannelIndex);
	var channelFrequency = -1;
	testLog("the needSearchFlag = " + needSearchFlag + ", inputMainChNum = " + inputMainChNum);
	if(needSearchFlag == 0)//search atv
	{
        testLog("before search atv, current tuner mode is = " + currentTunerMode);
        testLog("search ate channel["+inputMainChNum+"]");
		if(top.isCBFlag)
		{
			channelFrequency = currentTunerMode ? top.atv_antenna_freq : top.atv_cable_freq_Columbia;//[1]antenna [0]cable
		}
		else
		{
			channelFrequency = currentTunerMode ? top.atv_antenna_freq : top.atv_cable_freq;//[1]antenna [0]cable
		}
		if((currentTunerMode == 0 || currentTunerMode == 1) && (inputMainChNum >= channelFrequency[0].num 
			&& inputMainChNum <= channelFrequency[channelFrequency.length - 1].num))//block antenna invalid input
		{
			//channel.inputSource = 0;
			for(var i = 0; i < channelFrequency.length; i++)
			{
				if(inputMainChNum == channelFrequency[i].num)
				{
					testLog("find atv channel num: " + inputMainChNum);
					if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)//UI显示需要暂停Ginga,发送暂停信号到中间件
					{
						//top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_START_SCAN);
                        top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
					}
					channel.stopChannel();
					channel.setPlayStatusForScan(0);//数字搜台过程中防止切信源等消息，去播放节目
					//LA requirement low~high  3000
					channel.startScanAtvManual(channelFrequency[i].freq - 3000, channelFrequency[i].freq + 3000);
					return;
				}
			}
		}
		testLog("did not find atv channel num" + inputMainChNum);
	}
	else if(needSearchFlag == 1)//search dtv
	{
		testLog("before search dtv, current tuner mode is = " + currentTunerMode);
		testLog("search dtv channel["+inputMainChNum+"]");
		if(top.isLAFlag && !top.isCBFlag)
		{
			channelFrequency = top.dtv_antenna_freq;
		}
		else if(top.isNAFlag)
		{
			channelFrequency = currentTunerMode == 1 ? top.dtv_antenna_freq_NA : top.dtv_cable_freq_NA;
		}
		else if(top.isCBFlag)
		{
			channelFrequency = top.dtv_antenna_freq_Columbia;
		}
		else
		{
			channelFrequency = top.dtv_antenna_freq;
		}
		if(currentTunerMode == 1 && (inputMainChNum >= channelFrequency[0].num
			&& inputMainChNum <= channelFrequency[channelFrequency.length - 1].num))//block antenna invalid input
		{
			//channel.inputSource = 1;
			for(var i = 0; i < channelFrequency.length; i++)
			{
				if(inputMainChNum == channelFrequency[i].num)
				{
					if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True) //菜单显示需要暂停Ginga,发送暂停信号到中间件
					{
						//top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_START_SCAN);
                        top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
					}
					channel.stopChannel();
					testLog("the dtv equal index = channelFrequency["+i+"].freq = " + channelFrequency[i].freq+" channelFrequency[i].num is "+channelFrequency[i].num);
					channel.setPlayStatusForScan(0);//数字搜台过程中防止切信源等消息，去播放节目
					if(top.isNAFlag)//NA项目搜台使用频道号
					{
						channel.startScanDtvManual(channelFrequency[i].num, 0, 0);//[0]frequency [1]modulation [2]symbol
					}
					else
					{
						channel.startScanDtvManual(channelFrequency[i].freq, 0, 0);//[0]frequency [1]modulation [2]symbol
					}
					return;
				}
			}
			//频点表的数字不一定是连续的
			needSearchFlag = 0;//search atv
			onSearchByNum();
			return;
		}
		else if(currentTunerMode == 0 && (inputMainChNum >= channelFrequency[0].num
				&& inputMainChNum <= channelFrequency[channelFrequency.length - 1].num))//block cable invalid input
		{
			//channel.inputSource = 1;
			for(var i = 0; i < channelFrequency.length; i++)
			{
				if(inputMainChNum == channelFrequency[i].num)
				{
					channel.stopChannel();
					console.log("the dtv equal index = channelFrequency["+i+"].freq = " + channelFrequency[i].freq+" channelFrequency[i].num is "+channelFrequency[i].num);
					channel.setPlayStatusForScan(0);//数字搜台过程中防止切信源等消息，去播放节目
					if(top.isNAFlag)//NA项目搜台使用频道号
					{
						channel.startScanDtvManual(channelFrequency[i].num, 0, 0);//[0]frequency [1]modulation [2]symbol
					}
					else
					{
						channel.startScanDtvManual(channelFrequency[i].freq, 0, 0);//[0]frequency [1]modulation [2]symbol
					}
					return;
				}
			}
			//频点表的数字不一定是连续的
			needSearchFlag = 0;//search atv
			onSearchByNum();
			return;
		}
		else
		{
			//输入的num在dtv中没有，需要去检索一遍atv频点表
			testLog("input dtv channel num too large " + inputMainChNum);
			needSearchFlag = 0;//search atv
			onSearchByNum();
			return;
		}
	}
	if(backInputSource != channel.inputSource)
	{
		channel.inputSource = backInputSource;
	}
	isSearchingFlag = false;
	inputMainChNum = -1;
	inputSubChNum = -1;
	inputSpotFlag = false;
	hideInfoAndShowRemind();
	
	channelIndex = top.currentChannelIndex;
	onPlayByNum();
}

//la
function isInputChExist()
{
	var tmpChNum = -1;
	testLog("antenna testing exist");

	if(top.isCBFlag)
	{
		if(inputMainChNum > 0 && !inputSpotFlag)//xx 只跳转到模拟台。没有就只ATV搜索
		{
			tmpChNum = channel.getIndexByNumber(inputMainChNum,top.E_INPUT_ATV);//check atv channel
			testLog("search atv xx style, inputMainChNum = " + inputMainChNum + ", tmpChNum = " + tmpChNum);
			if(tmpChNum < 0 || tmpChNum >= 65535)
			{
				testLog("the input xx num ATV does not exit, start searching");
				needSearchFlag = 0;//[1]dtv 1st & atv 2nd
				return 0;//need search
			}
			else
			{
				testLog("the input xx num ATV does exit");
				channelIndex = tmpChNum;
				return 1;//need change channel
			}
		}
		if(inputMainChNum > 0 && inputSpotFlag)//xx. 只跳转到数字台，没有就只DTV节目搜索
		{
			tmpChNum = channel.getIndexByNumber(inputMainChNum,top.E_INPUT_DTV);//check dtv channel
			testLog("search dtv xx. style, inputMainChNum = " + inputMainChNum + ", tmpChNum = " + tmpChNum);
			if(tmpChNum < 0 || tmpChNum >= 65535)//dtv check failed
			{
				needSearchFlag = 1;//[1]dtv 1st & atv 2nd
				return 0;//need search
			}
			else
			{
				channelIndex = tmpChNum;
				return 1;//need change channel
			}
		}
		else
		{
		}
	}
	else
	{
		if((inputMainChNum > 0 && !inputSpotFlag)//xx
		|| (inputMainChNum > 0 && inputSpotFlag && inputSubChNum == -1)//xx.
		)//search dtv
		{
			tmpChNum = channel.getIndexByMulNumber(inputMainChNum, -1);//check dtv channel
			testLog("search dtv xx/xx. style, inputMainChNum = " + inputMainChNum + ", tmpChNum = " + tmpChNum);
			if(tmpChNum < 0 || tmpChNum >= 65535)//dtv check failed
			{
				testLog("the input xx/xx. num DTV does not exit, check atv");
				tmpChNum = channel.getIndexByNumber(inputMainChNum,top.E_INPUT_ATV);
				if(tmpChNum < 0 || tmpChNum >= 65535)
				{
					testLog("the input xx/xx. num ATV does not exit, start searching");
					if(!top.isCAFlag && channel.tunerMode == 0)//LA cable下不能搜索DTV节目，只能搜索ATV
					{
						needSearchFlag = 0;//[1]dtv 1st & atv 2nd
					}
					else
					{
						needSearchFlag = 1;//[1]dtv 1st & atv 2nd
					}
					return 0;//need search
				}
				else
				{
					testLog("the input xx/xx. num ATV does exit");
					channelIndex = tmpChNum;
					return 1;//need change channel
				}
			}
			else
			{
				channelIndex = tmpChNum;
				return 1;//need change channel
			}
		}
		else if(inputMainChNum > 0 && inputSpotFlag && inputSubChNum == 0)//xx.0 only check atv
		{
			tmpChNum = channel.getIndexByNumber(inputMainChNum,top.E_INPUT_ATV);
			testLog("search xx.0 style, " + inputMainChNum + " result = " + tmpChNum);
			if(tmpChNum < 0 || tmpChNum >= 65535)
			{
				needSearchFlag = 0;//[0]atv
				return 0;//need search
			}
			else
			{
				channelIndex = tmpChNum;
				return 1;//need change channel
			}
		}
		else if(inputMainChNum > 0 && inputSpotFlag && inputSubChNum > 0)//xx.123 only check dtv
		{
			tmpChNum = channel.getIndexByMulNumber(inputMainChNum, inputSubChNum);
			testLog("search dtv xx.yyy style, tmpChNum = " + tmpChNum);
			if(tmpChNum < 0 || tmpChNum >= 65535)
			{
				needSearchFlag = -1;//[-1]do not search
				return -1;//do not search
			}
			else
			{
				channelIndex = tmpChNum;
				return 1;//need change channel
			}
		}
		else// . or .XX
		{
			needSearchFlag = -1;//[-1]do not search
			return -1;//do not search
		}
	}
}

//la
function isFreqEqual(f1, f2)
{
	var result = Math.abs(f1 - f2) < 512 ? 1 : 0;
	return result;
}

function inputNumCheck()
{
	testLog("in input num check function");
	if(playChannelNumber)
	{
		clearTimeout(playChannelNumber);
	}
	isSearchingFlag = true;
	var inputStatus = isInputChExist();
	switch(inputStatus)
	{
		case -1://input error channel num, do nothing
			testLog("after case -1, do nothing");
			isSearchingFlag = false;
			inputMainChNum = -1;
			inputSubChNum = -1;
			enterNumFlag = 0;
			inputSpotFlag = false;
			hideInfoAndShowRemind();
			break;
		case 0://inputed channel num dos not exit, need searching & saving
			testLog("after case 0, need search channel");
			backInputSource = channel.inputSource;
			top.currentChannelIndex = channel.currentIndex;
			onSearchByNum();
			testLog("after case 0, after on search by num");
			//inputMainChNum = -1;
			//inputSubChNum = -1;
			//inputSpotFlag = false;
			break;
		case 1://inputed channel num exits, directly change channel
			testLog("after case 1, switch channel");
			isSearchingFlag = false;
			onPlayByNum();
			break;
		default:
			isSearchingFlag = false;
			onPlayByNum();
			break;
	}
}

/**
 * 检查节目是否为无效节目
 * 返回值：true 有效节目，false 无效节目
 * **/
function checkChannelType()
{
	var channelIndex = 0;
	if(!top.isLAFlag && !top.isNAFlag && !top.isCBFlag)
	{
		channelIndex = channel.getIndexByNumber(channelNumber, -1);//其他项目节目是混排，故应该查找所有类型
	}
	var targetChannel = channel.getChannelInfoByIndex(channelIndex);
	console.log("checkChannelType channelIndex  = " + channelIndex + "   serviceType = "  + targetChannel.serviceType);
	if(targetChannel.serviceType == 5)//如果是DATA节目，则不去播放
		return false;
	else
		return true;
}

function onPlayByNum()
{
	if(playChannelNumber)
	{
		clearTimeout(playChannelNumber);
		playChannelNumber=0;
	}
	if(channelInfo_timer)
	{
		clearTimeout(channelInfo_timer);
		channelInfo_timer=0;
	}
	if(!checkChannelType())
	{//数字按键切台，如果是无效节目，则不去执行切台
		channelNumber = 0;
		enterNumFlag = 0;
		if(top.isLAFlag || top.isNAFlag || top.isCBFlag)
		{
			inputMainChNum = -1;
			inputSubChNum = -1;
			inputSpotFlag = false;
		}
		channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		return;
	}

	var currentIndex = channel.currentIndex;
	if(!top.isLAFlag && !top.isNAFlag && !top.isCBFlag)
	{
		channelIndex=channel.getIndexByNumber(channelNumber,-1);//其他项目节目是混排，故应该查找所有类型
	}
	testLog("play channelIndex   ===================  "+channelIndex);
	if(inputSource>1)
	{
		if(channelIndex<65535)
		{
			top.g_openMheg5State=0;
			if(audioShowTimer!=0)
			{
				clearTimeout(audioShowTimer);
				audioShowTimer=0;
				toAudioLangback();
			}
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			top.channelLock =0; 
			top.parentalLock=0;  
			top.inputLock = 0;
			currentChannel=channel.getChannelInfoByIndex(channelIndex);
			inputSource = currentChannel.serviceType==0 ? 0 : 1;
			clearTimeout(refreshInfoTimer);
			refreshInfoTimer = 0;
			top.currentChannelIndex = channelIndex;
			currentPlayChannelNumber = channelNumber;
			$("program_audio").innerText = "";
			$("sound_channel_text").innerText = "";
			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)
			{
				var cur_channel = channel.getCurrentChannelInfo();
				var curr_freq = cur_channel.frequency;
				var next_channel = channel.getChannelInfoByIndex(channelIndex);
				var next_freq = next_channel.frequency;
				if(curr_freq == next_freq)
				{
					top.GingaObj.isSameTS = true;
				}
				else
				{
					top.GingaObj.isSameTS = false;
				}
//				if(channel.inputSource == 1 && top.GingaObj.isEnable == 1)//DTV and Ginga enable //切频道前暂停Ginga已移置中间件做
//				{
//					top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_BEFORE_CHANNEL_CHANGE);
//					/*Ginga.deactive();//切台前deactive Ginga
//					if(sameFreqChangeCh == 0)
//					{
//						Ginga.sendNetworkEvent(2);//GINGA_NW_EVT_TS_UNSELECTED
//					}
//					else
//					{
//						Ginga.sendNetworkEvent(6);//GINGA_NW_EVT_SERVICE_UNSELECTED
//					}
//					flag_changeChanel = 1;*/
//				}
			}
			channel.playByIndex(channelIndex);
			channelChangeStatus = 1;
		}
	}
	else
	{
		if(channelIndex!=currentIndex && channelIndex<65535)
		{
			if(top.recordStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenRecord();
				top.$('main').src = "pvr/Pvr.html?channelChange&"+channelIndex;
				return;
			}
			else if(top.timeShiftStatusFlag == 1)
			{
				top.$("globleShow").contentWindow.hiddenTimeShift();
				top.$('main').src = "pvr/timeshift.html?channelChange&"+channelIndex;
				return;
			}
			top.g_openMheg5State=0;
			if(audioShowTimer!=0)
			{
				clearTimeout(audioShowTimer);
				audioShowTimer=0;
				toAudioLangback();
			}
			if(top.currentPanel==1)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
					top.$("globleShow").contentWindow.hiddenGlassRemind();
				}
			}else if(top.currentPanel==2)
			{
				if(top.g_setting.pic3DMode!=0)
				{
					top.g_setting.pic3DMode=0;
				}
			}
			top.channelLock =0; 
			top.parentalLock=0;  
			top.inputLock = 0;
			currentChannel=channel.getChannelInfoByIndex(channelIndex);
			inputSource = currentChannel.serviceType==0 ? 0 : 1;
			clearTimeout(refreshInfoTimer);
			refreshInfoTimer = 0;
			top.currentChannelIndex = channelIndex;
			currentPlayChannelNumber = channelNumber;
			$("program_audio").innerText = "";
			$("sound_channel_text").innerText = "";
			if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)
			{
				var cur_channel = channel.getCurrentChannelInfo();
				var curr_freq = cur_channel.frequency;
				var next_channel = channel.getChannelInfoByIndex(channelIndex);
				var next_freq = next_channel.frequency;
				if(curr_freq == next_freq)
				{
					top.GingaObj.isSameTS = true;
				}
				else
				{
					top.GingaObj.isSameTS = false;
				}
//				if(channel.inputSource == 1 && top.GingaObj.isEnable == 1)//DTV and Ginga enable //切频道前暂停Ginga已移置中间件做
//				{
//					top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_BEFORE_CHANNEL_CHANGE);
//					/*Ginga.deactive();//切台前deactive Ginga
//					if(sameFreqChangeCh == 0)
//					{
//						Ginga.sendNetworkEvent(2);//GINGA_NW_EVT_TS_UNSELECTED
//					}
//					else
//					{
//						Ginga.sendNetworkEvent(6);//GINGA_NW_EVT_SERVICE_UNSELECTED
//					}
//					flag_changeChanel = 1;*/
//				}
			}
			channel.playByIndex(channelIndex);
			channelChangeStatus = 1;
		}
		else
		{
			channelIndex=currentIndex;
			channel.playByIndex(channelIndex);
		}
	}
	channelNumber=0;
	enterNumFlag = 0;
	if(top.isLAFlag || top.isNAFlag || top.isCBFlag)
	{
		inputMainChNum = -1;
		inputSubChNum = -1;
		inputSpotFlag = false;
	}
	channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
}
function showOtherPlayNum(num)
{
	if(top.inputLock != 1)
	{
		channelInfo_visible = 1;
		$("channel_info_2").style.display = "none";
		$("channel_content_contain").style.display = "none";
		$("channel_info_1").style.border="4px solid #1b1b1b";
		$("channel_info_1").style.display="block";
		$("remind").style.display = "none";
		$("sameLcnRemind").style.display = "none";
		
		if(screenAniTimer)
		{
			clearTimeout(screenAniTimer);
			screenAniTimer = 0;
		}
		
		
		if(playChannelNumber)
		{
			clearTimeout(playChannelNumber);
			playChannelNumber=0;
		}
		if(channelInfo_timer)
		{
			clearTimeout(channelInfo_timer);
			channelInfo_timer=0;
		}
		enterNumFlag=1;
		if(channelNumber == 0 || channelNumber > 999)
		{
			channelNumber = num;
		}
		else
		{
			channelNumber = channelNumber*10+num;
		}
		
		$("channel_num").innerText = channelNumber;
		$("channel_name").innerText = "";
		var date = setting.currentDate;
		var newDate = new Date(date.substring(6),parseInt(date.substring(3,5),10) - 1,date.substring(0,2));
		$("channel_time").innerText =  setting.currentTime.substring(0,5);
		//var tuner = top.isLAFlag ? (channel.tunerMode == 5 ? 1 : channel.tunerMode) : channel.tunerMode;
		var tuner = channel.tunerMode;
		if(top.isNAFlag == 1)
		{
			if(tuner == 6)
			{	
				tuner = 1;
			}
			else if(tuner == 7)
			{
				tuner = 0;
			}
		}
		else if(top.isLAFlag == 1)
		{
			tuner = tuner == 5 ? 1 : tuner;
		}
		$("tuner_picture").style.display="block";
		if(tuner==0)
		{
			$("tuner_picture").src=tuner_picture[0];
			$("tuner_name").innerHTML=tuner_name[0];
		}
		else if(tuner==1)
		{
			$("tuner_picture").src=tuner_picture[1];
			$("tuner_name").innerHTML=tuner_name[1];
		}
		else
		{
			$("tuner_picture").src=tuner_picture[2];
			$("tuner_name").innerHTML=tuner_name[2];
		}
	}
}
function showChannelNumber(currentChannel)
{
	channelInfo_visible = 1;
	$("channel_info_2").style.display = "none";
	$("channel_content_contain").style.display = "none";
	$("channel_info_1").style.border="4px solid #1b1b1b";
	$("channel_info_1").style.display="block";
	$("remind").style.display = "none";
	$("sameLcnRemind").style.display = "none";
	$("input_format").innerText =  "";
	if(screenAniTimer)
	{
		clearTimeout(screenAniTimer);
		screenAniTimer = 0;
	}

	if(playChannelNumber)
	{
		clearTimeout(playChannelNumber);
		playChannelNumber=0;
	}
	if(channelInfo_timer)
	{
		clearTimeout(channelInfo_timer);
		channelInfo_timer=0;
	}
	currentPlayChannelNumber = currentChannel.number;
	$("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(currentChannel) : currentChannel.number;
	$("channel_name").innerText = currentChannel.name;
	var date = setting.currentDate;
	var newDate = new Date(date.substring(6),parseInt(date.substring(3,5),10) - 1,date.substring(0,2));
	$("channel_time").innerText =  setting.currentTime.substring(0,5);
	//var tuner = top.isLAFlag ? (channel.tunerMode == 5 ? 1 : channel.tunerMode) : channel.tunerMode;
	var tuner = channel.tunerMode;
	if(top.isNAFlag == 1)
	{
		if(tuner == 6)
		{	
			tuner = 1;
		}
		else if(tuner == 7)
		{
			tuner = 0;
		}
	}
	else if (top.isLAFlag == 1)
	{
		tuner = tuner == 5 ? 1 : tuner;
	}
	$("tuner_picture").style.display="block";
	if(tuner==0)
	{
		$("tuner_picture").src=tuner_picture[0];
		$("tuner_name").innerHTML=tuner_name[0];
	}
	else if(tuner==1)
	{
		$("tuner_picture").src=tuner_picture[1];
		$("tuner_name").innerHTML=tuner_name[1];
	}
	else
	{
		$("tuner_picture").src=tuner_picture[2];
		$("tuner_name").innerHTML=tuner_name[2];
	}
}

//for la
function onInsertSpot()
{
	if(!inputSpotFlag && inputMainChNum > 0)//false: has not input spot yet
	{
		inputSpotFlag = true;
		$("channel_num").innerText += ".";
	}
	if(playChannelNumber)
	{
		clearTimeout(playChannelNumber);
		playChannelNumber = 0;
	}
	playChannelNumber = setTimeout(function(){inputNumCheck();}, 3000);
}

function onInsertNum(num)
{
	console.log(" in onInsertNum num is "+num);
	if((channelNumShowStatus==0||channelInfo_visible==0)&&(channelMhegLevel>1)&&(top.g_openMheg5State==1||CI_Mheg5OpenStatus >0))
	{
		channel.transportKeyToMheg5(num+48);
	}
	else if(top.inputLock != 1)
	{
		channelInfo_visible = 1;
		$("channel_info_2").style.display = "none";
		$("channel_content_contain").style.display = "none";
		$("channel_info_1").style.border="4px solid #1b1b1b";
		$("channel_info_1").style.display="block";
		$("remind").style.display = "none";
		$("sameLcnRemind").style.display = "none";
		
		if(screenAniTimer)
		{
			clearTimeout(screenAniTimer);
			screenAniTimer = 0;
		}
	    clearTimeout(refreshInfoTimer);
		refreshInfoTimer = 0;
		if(playChannelNumber)
		{
			clearTimeout(playChannelNumber);
			playChannelNumber=0;
		}
		if(channelInfo_timer)
		{
			clearTimeout(channelInfo_timer);
			channelInfo_timer=0;
		}
		enterNumFlag=1;
		console.log("top.recordStatusFlag is "+top.recordStatusFlag+" top.timeShiftStatusFlag is "+top.timeShiftStatusFlag+"channelIndex is "+channelIndex);
		if(top.recordStatusFlag == 1)
		{
			top.$("globleShow").contentWindow.hiddenRecord();
			top.$('main').src = "pvr/Pvr.html?exit";
			return;
		}
		else if(top.timeShiftStatusFlag == 1)
		{
			top.$("globleShow").contentWindow.hiddenTimeShift();
			top.$('main').src = "pvr/timeshift.html?stop";
			return;
		}
		
		if(top.isLAFlag || top.isNAFlag || top.isCBFlag)
		{
				testLog("antenna num input test");
				if(!inputSpotFlag)//should input main num
				{
					inputMainChNum = (inputMainChNum <= 0) ? num : inputMainChNum * 10 + num;
					if(inputMainChNum > CH_MAIN_NUM_MAX_ANTENNA)
					{
						inputMainChNum = num;
					}
				}
				else//should input sub num
				{
					
					inputSubChNum = (inputSubChNum <= 0) ? num : inputSubChNum * 10 + num;
					if(inputSubChNum > CH_SUB_NUM_MAX_ANTENNA)
					{
						inputSpotFlag = false;
						inputSubChNum = -1;
						inputMainChNum = -1;
						inputMainChNum = (inputMainChNum <= 0) ? num : inputMainChNum * 10 + num;
					}
				}
				$("channel_num").innerText = inputSpotFlag 
					? inputMainChNum + "." + inputSubChNum
					: inputMainChNum;
		}
		else
		{
			channelNumber = (channelNumber == 0 || channelNumber > 9999) ? num : channelNumber*10+num;
			$("channel_num").innerText = channelNumber;
		}
		$("channel_name").innerText = "";
		/*
		var date = setting.currentDate;
		var newDate = new Date(date.substring(6),parseInt(date.substring(3,5),10) - 1,date.substring(0,2));
		$("channel_time").innerText =  setting.currentTime.substring(0,5);
		var tuner=channel.tunerMode;
		if(tuner==0)
		{
			$("tuner_picture").src=tuner_picture[0];
			$("tuner_name").innerHTML=tuner_name[0];
		}
		else if(tuner==1)
		{
			$("tuner_picture").src=tuner_picture[1];
			$("tuner_name").innerHTML=tuner_name[1];
		}
		else
		{
			$("tuner_picture").src=tuner_picture[2];
			$("tuner_name").innerHTML=tuner_name[2];
		}*/
		playChannelNumber=setTimeout(function(){
			if(top.isLAFlag|| top.isNAFlag || top.isCBFlag)
			{
				inputNumCheck();
			}
			else
			{
                if(top.g_channel.checkhbbtvStatus()==3)
                    top.globleHBBTVClose();
					onPlayByNum();
			}},3000);
	}
}

function toUp()//audio lang 显示时左右移动焦点
{
	if(showPageType == "showAudio")
	{
		positionH--;
		if(audioCurrentPage*14+positionH<0)
		{
			audioCurrentPage=audioModeCountPage-1;
			showAudioCurrentPage();
			positionH=audioModeCount-audioCurrentPage*14-1;
		}
		else if(positionH<0)
		{
			audioCurrentPage--;
			showAudioCurrentPage();
			positionH=13;
		}
		$("preSetSelectFocusPlay").style.top=105+positionH*70+"px";
		if(audioShowTimer!=0)
		{
			clearTimeout(audioShowTimer);
			audioShowTimer=0;
		}
		audioShowTimer=setTimeout("toAudioLangback()",10*1000);
		doElementScroll(presetSpanList,positionH);
	}
	else if(showPageType == "showSubtile")
	{
		positionH--;
		if(subtitleCurrentPage*14+positionH<0)
		{
			subtitleCurrentPage=subtitleCountPage-1;
			showSubtitleCurrentPage();
			positionH=subtitleModeCount-subtitleCurrentPage*14;
		}
		else if(positionH<0)
		{
			subtitleCurrentPage--;
			showSubtitleCurrentPage();
			positionH=13;
		}
		$("preSetSelectFocusPlay").style.top=105+positionH*70+"px";
		if(audioShowTimer!=0)
		{
			clearTimeout(audioShowTimer);
			audioShowTimer=0;
		}
		audioShowTimer=setTimeout("toAudioLangback()",10*1000);
		doElementScroll(presetSpanList,positionH);
	}
	else if(channelInfo_visible==1 && (show_moreInfo_flag == 1 || show_moreInfo_flag == 7))
	{
		clearTimeout(channelInfo_timer);
		channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		currentDetailPage = 1;
		$("channel_content").style.top = "0px";
		var programList  = currentChannel.getProgramPlayList();
		var detail="";
		if(programList[0].id >= 0)
		{
			detail =channel.eventDetail(currentChannel.index,programList[0].id);
		}
		if(detail.length > 0)
		{
			$('channel_content').innerText = detail;
		}
		else
		{
			$('channel_content').innerText = channel_remind[11];
		}
		doAnimation();
	}
	else
	{
		/*  目前去掉上下键换台
		if(channelIndex==channel.currentIndex)
		{
			channelChangeStatus=0;
		}
		if(channelChangeStatus)
		{
			return;
		}
		channelChangeStatus=1;
		if(inputSource <= 1 && programStatus!=0)
		{
			if(playChannelNumber)
			{
				clearTimeout(playChannelNumber);
			}
			playChannelNumber=0;
			if(channelInfo_timer)
			{
				clearTimeout(channelInfo_timer);
			}
			channelInfo_timer=0;
			
			//初始化，把屏幕黑掉
			$("remind").style.display = "none";
			$("sameLcnRemind").style.display = "none";
			if(screenAniTimer)
			{
				clearTimeout(screenAniTimer);
				screenAniTimer = 0;
			}
			var currentIndex = channel.currentIndex;
			channelIndex = channel.getNextIndexByIndex(channelIndex);
			if(channelIndex>=65535)
			{
				channelIndex=currentIndex;
			}
			var nextChannel = channel.getChannelInfoByIndex(channelIndex);
			channelInfo_visible = 1;
			$("channel_num").innerText = nextChannel.number;
			$("channel_name").innerText =  nextChannel.name;
			if(nextChannel.serviceType==0)
			{
				inputSource=0;
			}
			else
			{
				inputSource=1;
			}
			$("channel_info_1").style.border="4px solid #1b1b1b";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			if(currentIndex != channelIndex && channelIndex<65535)
			{
				currentChannel = nextChannel;
				if(audioShowTimer!=0)
				{
					clearTimeout(audioShowTimer);
					audioShowTimer=0;
					toAudioLangback();
				}
				playChannelNumber = setTimeout("channelChange()",600);
			}
			clearChannelChangeStatusTimer=setTimeout("channelChangeStatus=0",200);
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		*/
	}
}
function toDown()//audio lang 显示时左右移动焦点
{
	if(showPageType == "showAudio")
	{
		positionH++;
		if(audioCurrentPage*14+positionH>=audioModeCount)
		{
			audioCurrentPage=0;
			showAudioCurrentPage();
			positionH=0;
		}
		else if(positionH>=14)
		{
			audioCurrentPage++;
			if(audioCurrentPage>=audioModeCountPage)
			{
				audioCurrentPage=0;
			}
			showAudioCurrentPage();
			positionH=0;
		}
		$("preSetSelectFocusPlay").style.top=105+positionH*70+"px";
		if(audioShowTimer!=0)
		{
			clearTimeout(audioShowTimer);
			audioShowTimer=0;
		}
		audioShowTimer=setTimeout("toAudioLangback()",10*1000);
		doElementScroll(presetSpanList,positionH);
	}
	else if(showPageType == "showSubtile")
	{
		positionH++;
		if(subtitleCurrentPage*14+positionH>=subtitleModeCount+1)
		{
			subtitleCurrentPage=0;
			showSubtitleCurrentPage();
			positionH=0;
		}
		else if(positionH>=14)
		{
			subtitleCurrentPage++;
			if(subtitleCurrentPage>=subtitleCountPage)
			{
				subtitleCurrentPage=0;
			}
			showSubtitleCurrentPage();
			positionH=0;
		}
		$("preSetSelectFocusPlay").style.top=105+positionH*70+"px";
		if(audioShowTimer!=0)
		{
			clearTimeout(audioShowTimer);
			audioShowTimer=0;
		}
		audioShowTimer=setTimeout("toAudioLangback()",10*1000);
		doElementScroll(presetSpanList,positionH);
	}
	else if(channelInfo_visible==1 && (show_moreInfo_flag == 1 || show_moreInfo_flag == 7))
	{
		clearTimeout(channelInfo_timer);
		channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		currentDetailPage = 1;
		$("channel_content").style.top = "0px";
		var programList  = currentChannel.getProgramPlayList();
		var detail="";
		if(programList[1].id >= 0)
		{
			detail =channel.eventDetail(currentChannel.index,programList[1].id);
		}
		if(detail.length > 0)
		{
			$('channel_content').innerText = detail;
		}
		else
		{
			$('channel_content').innerText = channel_remind[11];
		}
		doAnimation();
	}
	else
	{/*  目前去掉上下键换台
		if(channelIndex==channel.currentIndex)
		{
			channelChangeStatus=0;
		}
		if(channelChangeStatus==1)
		{
			return;
		}
		channelChangeStatus=1;
		if(inputSource <= 1 && programStatus!=0)
		{
			if(playChannelNumber)
			{
				clearTimeout(playChannelNumber);
			}
			playChannelNumber=0;
			
			if(channelInfo_timer)
			{
				clearTimeout(channelInfo_timer);
				
			}
			channelInfo_timer=0;
			
			//初始化，把屏幕黑掉
			$("remind").style.display = "none";
			$("sameLcnRemind").style.display = "none";
			if(screenAniTimer)
			{
				clearTimeout(screenAniTimer);
				screenAniTimer = 0;
			}
			var currentIndex = channel.currentIndex;
			channelIndex = top.g_channel.getPreviousIndexByIndex(channelIndex);
			if(channelIndex>=65535)
			{
				channelIndex=currentIndex;
			}
			var previousChannel = channel.getChannelInfoByIndex(channelIndex);
			channelInfo_visible = 1;
			$("channel_num").innerText = previousChannel.number;
			$("channel_name").innerText =  previousChannel.name;
			if(previousChannel.serviceType==0)
			{
				inputSource=0;
			}
			else
			{
				inputSource=1;
			}
			$("channel_info_1").style.border="4px solid #1b1b1b";
			$("channel_info_1").style.display = "block";
			$("channel_info_2").style.display = "none";
			$("channel_content_contain").style.display = "none";
			if(currentIndex != channelIndex && channelIndex<65535)
			{
				currentChannel = previousChannel;
				if(audioShowTimer!=0)
				{
					clearTimeout(audioShowTimer);
					audioShowTimer=0;
					toAudioLangback();
				}
				playChannelNumber = setTimeout("channelChange()",600);
			}
			clearChannelChangeStatusTimer=setTimeout("channelChangeStatus=0",200);
			channelInfo_timer = setTimeout("hideInfoAndShowRemind()",channelInfoDuaration);
		}
		*/
	}
}
function toSubtitleOK()
{
	if(showPageType == "showSubtile")
	{
		if(subtitleCurrentPage==0&&positionH==0)
		{
			setting.enableSubtitle = positionH;
		}
		else
		{
			subtitleModeIndex=subtitleCurrentPage*14+positionH-1;
			channel.setSubtitleByIndex(subtitleModeIndex);
		}
		initAudioMode();
		initSubtitleMode();
		if(audioShowTimer!=0)
		{
			clearTimeout(audioShowTimer);
			audioShowTimer=0;
		}
		toAudioLangback();
	}
}
function toAudioLangOK()//audio lang 设置audio lang
{
	if(showPageType == "showAudio")
	{
		audioModeIndex=audioCurrentPage*14+positionH;
		currentChannel.setProgramAudioMode(audioModeIndex);
		initAudioMode();
		initSubtitleMode();
		if(audioShowTimer!=0)
		{
			clearTimeout(audioShowTimer);
			audioShowTimer=0;
		}
		toAudioLangback();
	}
}
function toAudioLangback()//audio 显示时按返回键 隐藏显示
{
	if(showPageType == "showAudio" || showPageType == "showSubtile")
	{
		
		$("preSetBarPlay").style.display="none";
	}
	else if(showPageType == "closeSubtitleForMheg5")
	{
		$("subtitleRemind").style.display="none";
	}
	
	clearTimeout(audioShowTimer);
	showPageType = "";
    top.keySetForUI(0);
}
function showSubtitleRemind(type)
{
	try
	{
	$("preSetBarPlay").style.display="none";
	var remindSpan = $("subtitleRemind").getElementsByTagName("span");
	remindSpan[0].innerHTML = top.closeSubtitleRemind;
	var buttonDiv  = $("subtitleRemind").getElementsByTagName("div");
	buttonDiv[0].innerHTML = top.yesNo[1];
	buttonDiv[1].innerHTML = top.yesNo[0];
	$("subtitleRemindFocus").style.left = "420px";
	positionV = 1;
	showPageType = type;
	$("subtitleRemind").style.display="block";
	audioShowTimer=setTimeout("toAudioLangback()",10*1000);
	}catch(er)
	{
		testLog("showSubtitleRemind:"+er);	
	}
}

function toOKCloseSubtitleSelect()
{
	if(positionV==1)
	{
		setting.enableSubtitle = 0;
		initSubtitleMode();
		top.g_openMheg5State=1;
		channel.transportKeyToMheg5(top.VK_RED);
		clearTimeout(audioShowTimer);
	}
	toAudioLangback();
}
var positions = [[0,310],[0,540],[360,842],[960,842],[1312,540],[1312,310],[360,0],[960,0]];
var list_position_h = 0;
var flag = 0;
var screenAniTimer = 0;
var xPosition = 0;
var yPosition = 0;

function doScreenAnimation()
{
	if(screenAniTimer)
	{
		clearTimeout(screenAniTimer);
	}
	if($("remind").style.display == "none")//没有remind显示
	{
		return;
	}
	
	list_position_h += 2;
	if(list_position_h > 7)//返回滚动
	{
		if(flag == 0)
		{
			flag = 1;
			list_position_h = 1;
		}
		else
		{
			flag = 0;
			list_position_h = 0;
		}
	}
	
	distanceX = positions[list_position_h][0] - xPosition;
	distanceY = positions[list_position_h][1] - yPosition;
	
	moveStepFlag = 0;
	animationNow();
	
}

var distanceX = 0;
var distanceY = 0;
var moveStepFlag = 0;
function animationNow()
{
	moveStepFlag++;
	
	$("remind").style.left = xPosition + parseInt(moveStepFlag*distanceX/14) + "px";
	$("remind").style.top = yPosition + parseInt(moveStepFlag*distanceY/14) + "px";
	
	if(moveStepFlag >= 14)
	{
		moveStepFlag = 0;
		xPosition = positions[list_position_h][0];
		yPosition = positions[list_position_h][1];
		screenAniTimer = setTimeout("doScreenAnimation()",1000);
	}
	else
	{
		if(moveStepFlag%2 == 0)
		{
			screenAniTimer = setTimeout("animationNow()",1000);
		}
		else
		{
			screenAniTimer = setTimeout("animationNow()",800);
		}
	}
}

//var genre_first_level_LA = [top.chEpgFirstGenre[1],top.chEpgFirstGenre[3],chEpgFirstGenre[8],"Soap opera","Mini-series","Series","Variety","Reality show",top.netOptions[4],"Comical","Children","Erotic",top.chEpgFirstGenre[0],"Raffle,television sales,prizing","Debate/interview","Ohter"];		
var genre_first_level_LA 	= top.chEpgFirstGenreLA;						//记录六个频道在当前时间片上分别有多少个event
var genre_first_level_UK		= top.chEpgFirstGenreUK;
function showGenre(genre)
{
	$("program_content_genre").style.display="block";
	var firstLevel = genre>>4;
	console.log("firstLevel is "+firstLevel+ " genre is "+genre);
	if(top.isLAFlag)
	{
		if(firstLevel < 0 || genre == 0xffff)//无分类过滤
		{
			$('program_content_genre').innerText = parentRateWord;
		}
		else
		{
			$('program_content_genre').innerText = genre_first_level_LA[firstLevel];
		}
	}
	else
	{
		if(channel.systemCountry == 25)//Uk
		{
			if(firstLevel <= 0 || firstLevel >=16)//无分类过滤
			{
				$('program_content_genre').innerText = parentRateWord;
			}
			else
			{
				switch(firstLevel)
				{
					case 1://movie
						$('program_content_genre').innerText = genre_first_level_UK[0];
						break;
					case 2://News and Factual
					case 7:
					case 8:
						$('program_content_genre').innerText = genre_first_level_UK[1];
						break;
					case 3://Entertainment
					case 6:
						$('program_content_genre').innerText = genre_first_level_UK[2];
						break;
					case 4://sport
						$('program_content_genre').innerText = genre_first_level_UK[3];
						break;
					case 5://Children's
						$('program_content_genre').innerText = genre_first_level_UK[4];
						break;
					case 9://Education
						$('program_content_genre').innerText = genre_first_level_UK[5];
						break;
					case 10://Lifestyle
						$('program_content_genre').innerText = genre_first_level_UK[6];
						break;
					case 15://Drama
						$('program_content_genre').innerText = genre_first_level_UK[7];
						break;
					default:
						break;
				}
			}
		}
		else
		{
			if(firstLevel <= 0 || firstLevel >=12)//无分类过滤
			{
				$('program_content_genre').innerText = parentRateWord;
			}
			else
			{
				$('program_content_genre').innerText = genre_first_level[firstLevel - 1];
				/*此处用来显示大分类和子分类，参考51只显示大的分类。我们也就这样做了
				var secondLevel = genre&15;//取低四位
				$('program_content_genre').innerText = genre_first_level[firstLevel - 1] + "/" + genre_second_level[firstLevel - 1][secondLevel];
				*/
			}
		}
	}
}


/*
 检查info键是否被长按4s.如果是的话需要调出QR code图片供用户扫描使用
 flag:0  top.g_openMheg5State==0&&CI_Mheg5OpenStatus==0,
      1  CI_Mheg5OpenStatus==1 || top.g_openMheg5State==1
*/
var infoBarTimer = 0;

function checkInfoKey(flag)
{
	if(infoBarTimer)
	{
		clearTimeout(infoBarTimer);
	}
	if(flag == 0)
	{
		infoBarTimer = setTimeout(function(){doInfoKey();},500);
	}
	else
	{
		infoBarTimer = setTimeout(function(){
			stillFlag = 0;
			if(channelMhegLevel==3)
            {
                channel.transportKeyToMheg5(keycode);
            }
			else 
            {
                doInfoKey();
            }
        },500);
	}
}

function keyupproc(evt)
{
    if(top.recordStatusFlag != 1 && top.timeShiftStatusFlag != 1 && showPageType != "showAudio" && showPageType != "showSubtile" && top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)
	{
		console.log("Ginga.isEnable >>>>>>>>>>>>>>> Ginga.isEnable =  " + Ginga.isEnable);
		if(channel.inputSource == 1 && Ginga.isEnable == 1)//DTV and Ginga enable
		{

            var result = Ginga.sendKeyEvent(evt.which, 2);//1->keydown;2->keyup
            console.log("Ginga.sendKeyEvent >>>>>>>>>>>>>>> result =  " + result);
            if (result == 0) {
                return;
            }

		}
	}
    if (evt.which == top.VK_INFO && nscreenTimer)
    {
        clearTimeout(nscreenTimer);
        nscreenTimer = 0;
    }
}

function doElementScroll(spanList,position)
{
	setScrollAttribute(spanList,position);
	setTimeout(function(){resetScrollHtmlInner(spanList);},1);
}

function isOverflowed(element)
{
	testLog("isOverflowed:element.scrollWidth="+element.scrollWidth +"element.clientWidth="+element.clientWidth);
    return element.scrollWidth > element.clientWidth;
}

/*
把整个列表属性更改，如果当前焦点选项真实句子长度长于预留的长度则需要做滚动显示
htmlTagList:内容标签列表；ListLength：当前有内容的列表标签的个数；focusPosition：当前焦点选项在内容标签上的位置
*/
function setScrollAttribute(htmlTagList,focusPosition)
{
	testLog("setScrollAttribute: htmlTagList.length="+htmlTagList.length+"focusPosition="+focusPosition);
	for(var i = 1; i < htmlTagList.length; i++)
	{
		/*var tempText = htmlTagList[i].innerHTML;*/
		htmlTagList[i].setAttribute("contentText",htmlTagList[i].innerHTML);
		if(focusPosition+1 == i && isOverflowed(htmlTagList[i]))//如果当前焦点选项真实句子长度长于预留的长度则需要做滚动显示
		{
			htmlTagList[i].style.overflowX = "-webkit-marquee";
			htmlTagList[i].style.textOverflow = "clip";
			/*htmlTagList[i].innerHTML = tempText;*/
		}
		else
		{
			htmlTagList[i].style.overflowX = "hidden";
			htmlTagList[i].style.textOverflow = "ellipsis";
			/*htmlTagList[i].innerHTML = tempText;*/
		}
		htmlTagList[i].innerHTML = "";
	}
}
/*
重新为整个列表属性更改完成的列表赋值
htmlTagList:内容标签列表；ListLength：当前有内容的列表标签的个数
*/
function resetScrollHtmlInner(htmlTagList)
{
	for(var i = 1; i < htmlTagList.length; i++)
	{
		htmlTagList[i].innerHTML = htmlTagList[i].getAttribute("contentText");
	}
}
/*
function createControlBox(remindWord,selectWords,boxHeight,boxWidth,focusImg)
{
	var div = document.createElement("div");
	div.className = "dialogForm";
	div.id = "controlBox";
	div.style.height = boxHeight+"px";
	div.style.width = boxWidth+"px";
	div.style.left = (1920-boxWidth)/2 + "px";
	top.document.body.appendChild(div);
	var remindSpan = document.createElement("span");
	remindSpan.innerHTML = remindWord;
	remindSpan.style.left = boxWidth/10 + "px";
	remindSpan.style.top = parseInt(boxHeight/3) - parseInt(remindSpan.offsetHeight/2);
	div.appendChild(remindSpan);
	
}
function distoryCotorlBox()
{
	
}*/
function displayFocusBox(flag){}

/*
功能描述：将scanningInfo切分并保存到响应的变量中
参数：id:0（atv或dtv进度更新的消息），1代表atv搜台结束，2代表dtv搜台结束
全局变量：anologScanCount;digitalScanCount;progress;
*/
function cutScanningInfo(info)
{
	var str = info;
	var data = str.split("/");
	atvScanCount = parseInt(data[0],10);
	var digital = parseInt(data[1],10);
	var radio = parseInt(data[2],10);
	dtvScanCount = digital + radio;
	//上传的freq是以kHz结尾的
	frequency = parseInt(data[3],10);
	progress = parseInt(data[4],10);
	testLog("in cutScanningInfo progress = " + progress);
}

function addMouseListener()
{
	$("preSetBarPlay").onmousedown = function(evt){
			if(evt.button == 2){//left key
				toAudioLangback();
			}
		}
	var spans=$("preSetBarPlay").getElementsByTagName("span");
	for(var i = 0; i < 14; i++)
	{
		spans[i+1].setAttribute("newAttr",i);
		spans[i+1].onmousedown = function(evt){
			if(evt.button == 0){//left key
				if(showPageType == "showSubtile")
				{
					if(subtitleCurrentPage==0&&parseInt(this.getAttribute("newAttr"))==0)
					{
						setting.enableSubtitle = parseInt(this.getAttribute("newAttr"));
					}
					else
					{
						subtitleModeIndex=subtitleCurrentPage*14+parseInt(this.getAttribute("newAttr"))-1;
						channel.setSubtitleByIndex(subtitleModeIndex);
					}
					initAudioMode();
					initSubtitleMode();
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
					}
					toAudioLangback();
				}
				else if(showPageType == "showAudio")
				{
					audioModeIndex=audioCurrentPage*14+parseInt(this.getAttribute("newAttr"));
					currentChannel.setProgramAudioMode(audioModeIndex);
					initAudioMode();
					initSubtitleMode();
					if(audioShowTimer!=0)
					{
						clearTimeout(audioShowTimer);
						audioShowTimer=0;
					}
					toAudioLangback();
				}
			}
		}
	}
}
function setSourceToDtvFlagTimeout()
{
    clearTimeout(sourceToDtvIndex);
    sourceToDtvFlag  = 1;
    sourceToDtvIndex = setTimeout("sourceToDtvFlag = 0",5000);
}

function playChannelByNum(num)
{
	if((channelNumShowStatus==0||channelInfo_visible==0)&&(channelMhegLevel>1)&&(top.g_openMheg5State==1||CI_Mheg5OpenStatus >0))
	{
		return;
	}
	else if(top.inputLock != 1)
	{
		channelInfo_visible = 1;
		$("channel_info_2").style.display = "none";
		$("channel_content_contain").style.display = "none";
		$("channel_info_1").style.border="4px solid #1b1b1b";
		$("channel_info_1").style.display="block";
		$("remind").style.display = "none";
		$("sameLcnRemind").style.display = "none";
		
		if(screenAniTimer)
		{
			clearTimeout(screenAniTimer);
			screenAniTimer = 0;
		}
	    clearTimeout(refreshInfoTimer);
		refreshInfoTimer = 0;
		if(playChannelNumber)
		{
			clearTimeout(playChannelNumber);
			playChannelNumber=0;
		}
		if(channelInfo_timer)
		{
			clearTimeout(channelInfo_timer);
			channelInfo_timer=0;
		}
		enterNumFlag=1;

		if(top.isLAFlag || top.isNAFlag || top.isCBFlag)
		{
			testLog("antenna num input test");
			if(!inputSpotFlag)//should input main num
			{
				inputMainChNum = (inputMainChNum <= 0) ? num : inputMainChNum * 10 + num;
				if(inputMainChNum > CH_MAIN_NUM_MAX_ANTENNA)
				{
					inputMainChNum = num;
				}
			}
			else//should input sub num
			{
				inputSubChNum = (inputSubChNum <= 0) ? num : inputSubChNum * 10 + num;
				if(inputSubChNum > CH_SUB_NUM_MAX_ANTENNA)
				{
					inputSpotFlag = false;
					inputSubChNum = -1;
					inputMainChNum = -1;
					inputMainChNum = (inputMainChNum <= 0) ? num : inputMainChNum * 10 + num;
				}
			}
			channelNumber = inputSpotFlag ? inputMainChNum + "." + inputSubChNum: inputMainChNum;
			$("channel_num").innerText = channelNumber;
		}
		else
		{
			channelNumber = num;
			$("channel_num").innerText = channelNumber;
		}
		$("channel_name").innerText = "";

        if(top.isLAFlag|| top.isNAFlag || top.isCBFlag)
        {
            inputNumCheck();
        }
        else
        {
            onPlayByNum();
        }
	}
}

function toPreChannel()
{
    if(top.g_channel.checkhbbtvStatus()==3)
    {
        top.$("operatePage").src = "";
        top.$("otherPage").src ="";
        top.$("main").src = "hbbtvCancelRemind.html?"+top.VK_PRE_CH;
        top.$("main").style.display = "block";
        top.requestFocus(top.main, 1);
        top.setFrameFocusPage("main");
        return;
    }
    if(programStatus == 1  && top.inputLock != 1)
    {
        channelPreChKey();
    }
}


function ttsRead()
{
	if(0 == top.g_setting.ttsSwitch)
	{
		top.ttsLog("ttsSwitch is off");
		return;
	}
	var ttsStr = "";
	var currentStatus = "";
	var ttsName = "";
	if("block" == $("remind").style.display)
	{
		ttsName = $("remind").innerHTML;
		currentStatus = "";
	}
	else if("block" == $("prompt").style.display)
	{
		ttsName = $("promptContent").innerText;
		currentStatus = "";
	}
	else
	{
		ttsName = "";
		currentStatus = "";
	}
	ttsStr = ttsName + currentStatus;
	if("" != ttsStr)
	{
		top.ttsLog("ttsStr=" + ttsStr);
		top.setTTSSay(top.SPEECH_TYPE_FLUSH, ttsStr);
	}
}
</script>

</head>

<body id="frame" onunload="uninit()" >


<div id="channel_info_1">
    <span id="channel_num"></span>
    <span id="channel_name"></span>
    <span id="input_format"></span>
    <img  id="tuner_picture" src="" style="position:absolute; top:150px; left:50px;"/>
    <span id="tuner_name" class="channel_info_font" style=" top:150px; left:150px; color:#F00;"></span>
    <span id="channel_time" class="channel_info_font" style=" top:150px; left:300px; color:#F00;"></span>
</div>

<div id="channel_info_2">
	<div id="nowChannelInfo">
        <span id="channel_resolution" class="channel_info_font" style="top:150px;width:160px; left:1200px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis; text-align:center;"></span>
    </div>
    
    
  <img id="fav_picture"  src="images/icon_fav_focus.png" style="position:absolute; top:143px; left:450px; display:none;" />
    
    <div id="expandChannelInfo">
        <span id="program_time_1" class="channel_info_font" style=" top:54px; left:15px; color:red;"></span>
        <span id="program_name_1" class="channel_info_font" style=" font-size:30px; top:8px; left:15px; width:500px; overflow:hidden;white-space:nowrap;text-overflow:ellipsis;"></span>
        <span id="program_parentRate_1" class="channel_info_font" style="top:50px; left:650px;"></span>
        <span id="program_time_2" class="channel_info_font" style=" top:100px; left:15px;"></span>
        <span id="program_name_2" class="channel_info_font" style=" top:100px; left:230px;width:500px; overflow:hidden;white-space:nowrap;text-overflow:ellipsis;"></span>
        <span id="program_parentRate_2" class="channel_info_font" style="top:100px; left:750px;"></span>
    </div>
    <div id="program_content_genre">
    </div>
    <div id="audio_mode">     	
    	<img id="lang_eye_picture" src="images/icon_eye.png" />
        <img id="lang_ear_picture" src="images/icon_ear.png" />
        <span id="program_audio" class="channel_info_font" style="width:500px;"></span>
    </div>
    <div id="rating_info" class="Rating" >
		<span id="rating_age" class="channel_info_font" style=" top:2px; left:2px;"></span>
		<span id="rating_content" class="channel_info_font" style=" top:2px; left:60px; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;"></span> 
	</div>
    <div id="sttl_ttx" class="subtitle" >
        <img id="ttx_picture" src="images/icon_TTX.png" />
     	<img id="era_picture" src="images/icon_ear.png" />
        <img id="sttl_picture" src="images/icon_STTL.png" />
        <span id="subtitle_language" ></span>
		<span id="show_cc" class="cc"></span>
		<span id="data_Service" ></span>
        <span id="ginga_Service" ></span>
    </div>
    
     <div id="sound_channel">
            <span id="sound_channel_text"></span>
        </div>
        
    <div id="channelRemind"></div>
    
</div>
   
<div id="channel_content_contain">
	<div id="channel_content_">
    <span id="channel_content"></span>
    </div>
    <img src="images/icon-Color_key_G.png" id="detailImg"><span id="detailSpan"></span>
</div>

<div id="remind"></div>
<span id="sameLcnRemind"></span>



<div id="print" style=" width:400px; height:300px;color:#0F0; word-wrap:break-word;"></div>

<div id="prompt">
	<div id="promptContent"></div>
</div>
<!----------------------重置选择列表--------------------------->
   <div style="position:absolute; width:1920px; height:200px; top:900px; text-align:center;">
       <div id="preSetBar" style="display:none; width:1450px; left:250px;">
            <span id="preSetOption" ></span>
            <img  id="preSetLeft" src="images/arrow/focus_L-Focus.png" style="position:absolute; top:34px; left:310px; display:none;"/>
            <span class="preSetValueMarquee" style="width:260px;left:337px; font-size:18px;"></span>
            <span class="preSetValueMarquee" style="width:260px;left:611px; font-size:18px;"></span>
            <span class="preSetValueMarquee" style="width:260px;left:885px; font-size:18px;"></span>
            <span class="preSetValueMarquee" style="width:260px;left:1159px; font-size:18px; "></span>
            <img id="preSetRight" src="images/arrow/focus_R-Focus.png" style="position:absolute; top:34px; left:1420px; display:none;"/>
            <img id="preSetSelectFocus" src="images/Focus_Frame/Focus2.png" style="width:274px"/>
       </div>
   </div>
   
  <div id="preSetBarPlay">
            <span id="preSetOptionPlay" >Zoom</span>
            <span class="preSetValueMarquee" style="width:310px;left:25px; top:100px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:170px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:240px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:310px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:380px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:450px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:520px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:590px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:660px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:730px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:800px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:870px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:940px; height:70px; line-height:70px;"></span>
            <span class="preSetValueMarquee" style="width:310px;left:25px;top:1010px; height:70px; line-height:70px;"></span>
	        <img id="era_picture_list" src="images/info-icon4-ear.png" />
            <img id="preSetSelectFocusPlay" src="images/focus-Tuner_mode.png" style=" position:absolute;display:block; top:120px; left:5px; width:350px; height:64px; pointer-events:none;"/>
  </div>
    <!----------------------subtitle 关闭提示框-------------------------->
   <div id="subtitleRemind" class="dialogForm" style="height:300px;top:390px; left:680px; display:none;">
        <span class="dialogContent" style="top:100px;"></span>
        <div class="dialogButton" style="left:200px;"></div>
        <div class="dialogButton" style="left:430px;"></div>
        <img id="subtitleRemindFocus" style=" position:absolute ;left:420px; bottom:20px; height:60px; width:170px;" src="images/Focus_Frame/Focus2.png">
   </div>
   <!----------------------EWBS操作提示框-------------------------->
   <div id="ewbsRemind">
   		<span id="dialogName">Tips</span>
        <span id="dialogContent" style=""></span>
		<div id="dialogButton">
			<div class="dialogButton" style="position:absolute;left:155px; font-size:20px; width:200px;">
				<span style="display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;"></span>
			</div>
			<div class="dialogButton" style="left:455px; font-size:20px; width:200px;">
				<span style="display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;"></span>
			</div>
		</div>
        <img id="ewbsRemindFocus" style=" position:absolute ;left:140px; bottom:20px; height:60px; width:230px;display:block;" src="./images/Focus_Frame/Focus2.png">
   </div>

    <!----------------------unSupport提示框-------------------------->
    <!--<div id="unSupportDialog">-->
        <!--<span id="unSupportContent"></span>-->
    <!--</div>-->

<script type="text/javascript">

	{
		function getSportModeType()//return: [0]simply [1]full
		{
			if("TRUE" != setting.getProperty("ro.sita.model.LiveTV.FullySportsMode", "FALSE"))
			{
				return 0;
			}
			//"top.g_pvr.getUsbStatus() != 1"		-> 	no usb
			//"!top.g_setting.footballMode"		-> 	sportMode is off
			//"top.g_channel.inputSource != 1"	-> 	current source is not dtv
			if(top.g_pvr.getUsbStatus() != 1 || !top.g_setting.footballMode 
				|| top.g_channel.inputSource != 1 || top.channelLock == 1 || top.inputLock == 1)
			{
				return 0;
			}
			else
			{
				return 1;
			}
		}

		function turnOnSportMode()
		{
			top.g_previousHtmlPage = "channelPlay.html";
			if(top.timeShiftStatusFlag == 1)
			{
				testLog("the timeshift status is on");
				top.g_pvr.timeshiftStop();
				top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				top.timeShiftStatusFlag = 0;
				top.$("globleShow").contentWindow.hiddenTimeShift();
				//如果当前播放的频道不是booking需要跳转到的频道后面会做切台，不需要做下面的操作，如果做了会导致后面的切台不成功
				{
					top.g_pvr.returnToLive();//返回实时播放页面,相当于切台。
				}
			}
			if(top.recordStatusFlag==1)
			{
				testLog("the record status is on");
				top.recordStatusFlag = 0;
				top.g_pvr.recordStop();
				top.g_pvr.pvrMhegSuspend(0);/*将mheg状态和显示恢复*/
				top.$("globleShow").contentWindow.hiddenRecord();
				top.pvrCurrentTime = 0;
				top.pvrTotalTime = 2 * 60 * 60;
			}
			testLog("jumppage to sportMode.html");
			setTimeout(function(){
			top.$('main').src = "pvr/timeshiftInit.html";
			top.$("main").style.display = "block";
			top.$("operatePage").src = "";
			top.requestFocus(top.main, 1);
			top.setFrameFocusPage("main");},1000);
		}
	}
	if(top.$('main').style.display == "none")
	{
		top.$('main').style.display = "block";
	}
	if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True)
	{
		channel.testLog("[ginga app]channePlay top.timeShiftStatusFlag "+top.timeShiftStatusFlag+ " and "+ top.recordStatusFlag);
		if(top.recordStatusFlag == 1 || top.timeShiftStatusFlag == 1) //菜单显示需要暂停Ginga,发送暂停信号到中间件
		{
			//top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_IN_PVR_STATUS);
            top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
		}
		else 
		{
		//	top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_NOT_PVR_STATUS);
            top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
		}
		if(top.appOpenFlag == 1)
		{
			//top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_PAUSE_FOR_OTHER_APP);
            top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_UNSELECTED);
		}
		else 
		{
		//	top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_RESUME_FROM_OTHER_APP);
		//	top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_RESUME_FROM_CONTROL_LOST);
            top.g_ginga.setNetworkEvent(top.GingaStates.NetworkEvents.GINGA_NW_EVT_TS_SELECTED);
		}
	}
//	var cur_screenMode = channel.currentScreenSaverMode;    //频道内容限制锁暂停Ginga已移置到中间件处理
//	 if(cur_screenMode == 4 || cur_screenMode == 5)
//	 {
//	   if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && channel.inputSource == 1)
//	   {
//			top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_LOCKED_PROG);
//	   }
//	 }
	top.showBackground(0);
    top.keySetForUI(0);
	top.resetFramePacking3DMode();
    var str=document.location.search;
    str=str.substring(str.indexOf("?")+1);
    var args=str.split("&");
    for (var i=0; i<args.length; i++)
    {
        if (args[i].indexOf("changesource")==0)
        {
            if (args[i].substring(args[i].indexOf("=")+1)=="1")
            {
                if (tcl.channel.inputSource != top.lastInputSource)
                {
                    tcl.channel.inputSource = top.lastInputSource;
                }
            }
            break;
        }
    }
	inputSource = channel.inputSource;
	var unlock = channel.inputUnlockState(inputSource);
	var str = window.location.search;
	if(getSportModeType() && top.g_factory.pvrOpenStatus && str != "?usb")
	{
		tcl.channel.requestMute(0);
		turnOnSportMode();
	}
	else
	{
		if(top.appOpenFlag == 0 && channel.inputSource == 1)
		{
            if (top.supportHBBTV && top.recordStatusFlag == 0 && top.timeShiftStatusFlag == 0)
            {
                console.log("--in init and open hbbtv! ");
                top.globleHBBTVOpen();
            }
            else
            {
                top.globleHBBTVClose();
            }
		}
        top.timeoutFuc.timeoutEnable=0;
		top.clearMyTimeout();
	    if (typeof(middleware) != "undefined")
	    {
	        middleware.setUIContext(0);
	    }
		programStatus = channel.channelProgramStatus();
		currentChannel = channel.getCurrentChannelInfo();
		channelIndex=channel.currentIndex;
		currentPlayChannelNumber = currentChannel.number;
		top.currentChannelIndex = channelIndex;
		if(unlock==1)
		{
			top.inputLock = 1;
//            if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && channel.inputSource == 1)//信源锁暂停Ginga已移置到中间件处理
//            {
//                top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_LOCKED_INP);
//            }
		}
		else
		{
			top.inputLock =0;
		}
		if(currentChannel.isLock == 1 && currentChannel.unlockFlag == 0)
		{
			top.channelLock = 1;
//            if(top.isGingaOn && top.GingaObj.isInit == top.GingaStates.True && channel.inputSource == 1)//频道用户设置锁暂停Ginga已移置到中间件处理
//            {
//                top.gingaEvtProc(top.GingaStates.Events.GINGA_EVT_LOCKED_CH);
//            }
		}
		if(channel.checkhbbtvStatus()>=1)
		{
			top.hbbtvStatus = 1;
		}
		if(inputSource <= 1)
		{	
			if(top.g_menu5In1Visiable==0)
				setting.contextOf5in1 = top.CONTEXT_ATV_DTV_FULL_SCREEN;
		}
		else
		{
			if(top.g_menu5In1Visiable==0)
				setting.contextOf5in1 = top.CONTEXT_OTHER_FULL_SCREEN;
		}
		if(top.isFirstInitNotifyThread)//初始化消息接收线程
		{
			setting.createNotifyThread();
	        top.isFirstInitNotifyThread = 0;
	        top.sendEvent("vod.netflix", 0xf301);
			if(setting.location == 1 || setting.location == 2 || programStatus == 0)
			{
				hideInfoForm();
				showRemind();
			}
			else
			{
			if(inputSource <= 1 && top.inputLock == 0)
			{
				channelInfo_visible = 1;	
				$("channel_num").innerText = (top.isLAFlag || top.isNAFlag) ? top.parseChNumber(currentChannel) : currentChannel.number;
				$("channel_name").innerText =  currentChannel.name;
				show_moreInfo_flag = 3;
				showInfoFrom();
			}
			else
			{
				initShowInput(top.inputList[top.currentInputIndex].name);
				show_moreInfo_flag = 1;
				var curinputName = channel.inputSourceDeviceName(inputSource);
				if(curinputName != 0)
					$("channel_name").innerText ="("+ top.sysInputSet[curinputName]+")";
				//	top.ttsLog("channel_name=" +$("channel_name").innerText);
				if(top.inputLock == 1)
				{
					$("input_format").innerText =  channel_remind[18];
				//	top.ttsLog("channel_remind=" +channel_remind[18]);
					var tts_remind =  $("channel_name").innerText + ","+channel_remind[18] ;
					top.ttsLog("tts_remind=" +tts_remind);
					top.setTTSSay(top.SPEECH_TYPE_FLUSH,tts_remind);
				}
				else
				{
					formatChange();
				}
				showInfoFrom();
			}
				top.isFirstInChanenlPlay = 0;
				top.shopRemindFlag = 0;
			}
		}
		else
		{
			initPre();
		}	
		init();
		addMouseListener();
	}

</script>
</body>
</html>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<script type="text/javascript">
document.onsystemevent 			= notifyProcess;
document.onkeydown 			= keyproc;

var comIfaceWords			= [top.sysOptions[9],top.sysCiDes[0]];
var passwordWords 			= [top.others[2],top.passError];


var setting 				= top.g_setting;
var channel					= top.g_channel;
var mimiType 				= 0;				//2 éœ€è¦è¾“å…¥å¯†ç ï¼Œå…¶ä»– æ­£å¸¸æ˜¾ç¤º
var itemLength 				= 0;				//CI é¡¹çš„æ¡æ•°
var list_position_h 		= 0;				//ç„¦ç‚¹åºå·
var nowItemNum 				= 0;				//å½“å‰itemåºå·
var distance 				= 0;				//å½“å‰itemåºå·å’Œå½“å‰itemä½ç½®çš„å·®å€¼ï¼šnowItemNum - list_position_h

var SUB_MENU_START 			= 220;				//ä¸‰å››çº§èœå•ç„¦ç‚¹ç§»åŠ¨èµ·å§‹ä½ç½?
var SUB_MENU_STEP 			= 70;				//ä¸‰å››çº§ä¸»èœå•ç„¦ç‚¹ç§»åŠ¨çš„step
var spanList;
var LIST_SHOW_SUM 			= 7;
/////////å¯†ç æ¡†ä½¿ç”?
var passStringLength 		= 0;
var passString				= "";				//å½?mimiType == 2æ—¶ä½¿ç”?
var passStringDefinedLen	= 0;
var blindOption				= 0;
function notifyProcess(evt)
{
	channel.testLog("in common interface notifyProcess");
	var msg = evt.which;
    console.log("in common interface notifyProcess msg = " + msg);
	switch(msg)
	{
		case top.E_SIGNAL_UNLOCK://unlock signal
		case top.E_PVR_NO_SIGNAL:
			top.jumpPage();
			break;
		case top.E_CI_CARD_REMOVE://CI remove
			top.jumpPage();
			break;
		case top.E_CI_DATA_READY:// CI data ready
			doCI();
			setting.setCIMsgResendFlag(top.E_CI_DATA_READY, 0);
			break;
		case top.E_CI_EXIT_CI:
			top.jumpPage();
			break;
		case top.E_CIPLUS_PROGRAM_CHANGE:
			break;
		default:
			top.systemEventProc(evt);
			break;
	}
}

function keyproc(e)
{
	var ret = true;
	var keycode = e.which;
	top.g_channel.testLog("in common keyproc g_ciUpdateStatus = " + top.g_ciUpdateStatus);
	console.log("in common keyproc g_ciUpdateStatus = " + top.g_ciUpdateStatus + "  keycode = " + keycode);
	//å¿«æ·é”®å¤„ç?
	if(top.g_ciUpdateStatus==0)
	{
		switch(keycode)
		{
			case top.VK_LEFT:// left
				toLeft();
				ret = false;
				break;
			case top.VK_UP:// up
				toUp();
				ret = false;
				break;
			case top.VK_DOWN://down
				toDown();
				ret = false;
				break;
			case top.VK_ENTER:
				doEnter();
				ret = false;
				break;
			case top.VK_BACK:
				toBack();
				ret = false;
				break;
			case top.VK_EXIT://exit
				doExit();
				break;
			case top.VK_0:
			case top.VK_1:
			case top.VK_2:
			case top.VK_3:
			case top.VK_4:
			case top.VK_5:
			case top.VK_6:
			case top.VK_7:
			case top.VK_8:
			case top.VK_9:
				if(mimiType == 2)
				{
					doPassNum(e.which - 48);
				}
				break;
			case top.VK_POWER://power
			case top.VK_MUTE://power
				top.keyDownProcess(e);
				break;
			case top.VK_VOLUME_UP://volume up
        		case top.VK_VOLUME_DOWN://volume down
            	top.document.getElementById('main').src = "channelPlay.html";
            	top.requestFocus(top.main, 1);
				top.keyDownProcess(e);
            	return;
			default:
				top.keyDownProcess(e);
				ret = true;
				break;
		}
		return ret;
	}
	else
	{
		switch (keycode)
		{
			case top.VK_POWER://power
				top.keyDownProcess(e);
				break;
			default:
				break;
		}
	}
}

function $(id)
{
	return document.getElementById(id);
}

function toLeft()
{
	if(mimiType == 2)
	{
		if(passStringLength > 0)
		{
			passStringLength--;
			passString = passString.substring(0,passStringLength);
			$('passInputContent').innerHTML = $('passInputContent').innerHTML.substring(1);
		}
		else
		{
			return;
		}
	}
	else
	{
		toBack();
	}
}

function toUp()
{
	if(mimiType != 2)
	{
		if(nowItemNum > 0 && list_position_h == 0)
		{
			distance -= LIST_SHOW_SUM;
			for(var i = 0; i < LIST_SHOW_SUM; i++)
			{
				spanList[i].innerHTML = setting.getListItem(i + distance);
				fourthMenuRightLiList[i + 4].style.display = "block";
			}
			nowItemNum--;
			list_position_h = LIST_SHOW_SUM - 1;
		}
		else if(nowItemNum > 0 && list_position_h > 0)
		{
			nowItemNum--;
			list_position_h--;
		}
		$("fourthListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
	}
}

function toDown()
{
	if(mimiType != 2)
	{
		if(list_position_h < (LIST_SHOW_SUM - 1) && nowItemNum < (itemLength - 1))
		{
			nowItemNum++;
			list_position_h++;
		}
		else if(list_position_h == (LIST_SHOW_SUM - 1) && nowItemNum < (itemLength - 1))
		{
			distance += LIST_SHOW_SUM;
			for(var i = 0; i < LIST_SHOW_SUM; i++)
			{
                if (i < (itemLength-distance))
                {
                    spanList[i].innerHTML = setting.getListItem(i + distance);
                    fourthMenuRightLiList[i + 4].style.display = "block";
                }
                else
                {
                    spanList[i].innerHTML = "";
                    fourthMenuRightLiList[i + 4].style.display = "none";
                }
			}
			nowItemNum++;
			list_position_h = 0;
		}
		$("fourthListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
	}
}

function doEnter()
{
	if(mimiType == 2)
	{
		return;
	}
	else
	{
		setting.selectListItem(list_position_h + distance);//å‚æ•°ä»?å¼€å§?
		//æ¸…é™¤ç—•è¿¹
        /*
		$('ciTitle').innerHTML = "";
		$('subtitle').innerHTML = "";
		$('keyRemind').innerHTML = "";
		for(var i = 0; i < LIST_SHOW_SUM; i++)
		{
			spanList[i].innerHTML = "";
			fourthMenuRightLiList[i + 4].style.display = "none";
		}
		$("fourthListFocus").style.display = "none";
        */
	}
}

function doExit()
{
	setting.exitCI();
}

function toBack()
{
	if(mimiType == 2)
	{
		//æ¸…é™¤ç—•è¿¹
		//$('passForm').style.display = "none";
		//$('passInputContent').innerHTML = "_";
		//passString = "";
		//passStringLength = 0;
		setting.sendPassword("");
	}
	else if(mimiType == 1)
	{
		setting.selectListItem(-1);
	}
	//setting.backMenu();
}
/*
åŠŸèƒ½æè¿°ï¼šå¯†ç è¾“å…¥æ¡†ä¸­è¾“å…¥æ•°å­—æ—¶çš„å¤„ç?
å‚æ•°ï¼?
å…¨å±€å˜é‡ï¼špassString;passStringLength
*/
function doPassNum(num)
{
	passString += num;
	passStringLength++;
	if(passStringLength == passStringDefinedLen)
	{
		setting.sendPassword(passString);
		//æ¸…é™¤ç—•è¿¹
		$('passForm').style.display = "none";
		$('passInputContent').innerHTML = "_";
		passString = "";
		passStringLength = 0;
	}
	else
	{
		if(blindOption == 1)
		{
		$('passInputContent').innerHTML = "*" + $('passInputContent').innerHTML;
		}
		else
		{
			$('passInputContent').innerHTML = passString + "_";
		}
	}
}

/*
åŠŸèƒ½æè¿°ï¼?åˆ·æ–°CIç•Œé¢,éœ€è¦å¯¹ä¸€äº›å…¨å±€å˜é‡åˆå§‹åŒ?
å‚æ•°ï¼?
å…¨å±€å˜é‡ï¼šmimiType;list_position_hï¼›distanceï¼›nowItemNum
*/
function doCI()
{
	$('passForm').style.display = "none";
	$('passInputContent').innerHTML = "_";
	passString = "";
	passStringLength = 0;
	mimiType = setting.getMimiType();
	console.log("in doCI mimiType = " + mimiType);
	if(mimiType == 2)//æ˜¾ç¤ºå¯†ç æ¡?
	{
		$('ciTitle').innerHTML = "";
		$('subtitle').innerHTML = "";
		$('keyRemind').innerHTML = "";
		for(var i = 0; i < LIST_SHOW_SUM; i++)
		{
			spanList[i].innerHTML = "";
			fourthMenuRightLiList[i + 4].style.display = "none";
		}
		$("fourthListFocus").style.display = "none";
		var enqdata = setting.getCIEnqData(0).split("/@/");
		passStringDefinedLen = enqdata[0];
		blindOption = enqdata[1];
		initPass();
	}
	else
	{
		//$('ciTitle').innerHTML = "";
		//$('subtitle').innerHTML = "";
		//$('keyRemind').innerHTML = "";
		/*for(var i = 0; i < LIST_SHOW_SUM; i++)
		{
			spanList[i].innerHTML = "";
			fourthMenuRightLiList[i + 4].style.display = "none";
		}
		$("fourthListFocus").style.display = "none";
        
		$("fourthListFocus").style.display = "block";
		*/
		list_position_h = 0;
		nowItemNum = 0;
		distance = 0;
		showNormalCI();
	}
}

/*
åŠŸèƒ½æè¿°ï¼šæ˜¾ç¤ºæ­£å¸¸çŠ¶æ€ï¼ˆå³ééœ€è¦è¾“å…¥å¯†ç ï¼‰çš„ciç•Œé¢
å‚æ•°ï¼?
å…¨å±€å˜é‡ï¼šitemLength;passStringLength
*/
function showNormalCI()
{
	$('ciTitle').innerHTML = setting.getTitleString();
	$('subtitle').innerHTML = setting.getSubtitleString();
	var bottomString=setting.getBottomString();
	bottomString = replaceT(bottomString);
	$('keyRemind').innerHTML = bottomString;
	itemLength = setting.getListItemCount();
	for(var i = 0; i < LIST_SHOW_SUM; i++)
	{
		if( i < itemLength)//æ³¨æ„ï¼šitemæ˜¯ä»1å¼€å§‹çš„
		{
			var listItem=setting.getListItem(i);
			listItem=Trim(listItem,"g");
			spanList[i].innerHTML = listItem;
			fourthMenuRightLiList[i + 4].style.display = "block";
		}
		else
		{
			spanList[i].innerHTML = "";
			fourthMenuRightLiList[i + 4].style.display = "none";
		}
	}
	if(itemLength > 0)
	{
		$("fourthListFocus").style.display = "block";
		$("fourthListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
	}
	else
	{
		$("fourthListFocus").style.display = "none";
	}
}


/*
åŠŸèƒ½æè¿°ï¼šåˆå§‹åŒ–å¯†ç æ¡?
å‚æ•°ï¼?
å…¨å±€å˜é‡ï¼špassStringï¼›passStringLengthï¼?
*/
function initPass()
{	
	$("passForm").style.display = "block";
	$('passTitle').innerHTML = setting.getPasswordTitle();
	$("passInputTitle").innerHTML = "";//passwordWords[0];
	passString="";
	passStringLength = 0;
	$('passInputContent').innerHTML="_";
}

/*
åŠŸèƒ½æè¿°ï¼šå°†å­—ä¸²ä¸­æ‰€æœ‰â€?â€å’Œâ€?â€ç¬¦å·æ›¿æ¢æˆhtmlèƒ½è¯†åˆ«çš„æ ‡å¿—
å‚æ•°ï¼šsï¼šè¦è¿›è¡Œæ›¿æ¢çš„å­—ä¸?
å…¨å±€å˜é‡ï¼?
*/
function replaceT(s)
{
	s=s.replace(/</g,"&lt;");
	s=s.replace(/>/g,"&gt;");
	return s;
}

/*
åŠŸèƒ½æè¿°ï¼šå°†å­—ä¸²ä¸­æ‰€æœ‰è¿‡é•¿çš„ç©ºæ ¼ã€tabã€å›è½¦ã€æ¢è¡Œç¬¦å·æ›¿æ¢æˆç©ºæ ¼
å‚æ•°ï¼šstrï¼šè¦è¿›è¡Œæ›¿æ¢çš„å­—ä¸²ï¼›is_globalï¼šâ€œgâ€è¡¨ç¤ºè¦å…¨éƒ¨æ›¿æ¢,ä¿è¯æœ€ç»ˆæ›¿æ¢æˆçš„å­—ä¸²ä¸ä¼šæœ‰ä¸¤ä¸ªç©ºæ ¼æŒ¨ç€çš„æƒ…å†?
å…¨å±€å˜é‡ï¼?
*/
function Trim(str,is_global)
{
	 var result; 
	 result = str.replace(/(^\s+)|(\s+$)/g,"&nbsp;");
	 if(is_global.toLowerCase()=="g")
		result = result.replace(/\s/g,"&nbsp;");
	 return result;
}
function timeoutInit()
{
}

var isDirectToPage = 0;//æ˜¯å¦æ˜¯ciå¡æ¶ˆæ¯ç›´æ¥è¿›å…¥æ­¤é¡µé¢ï¼? å¦ï¼Œ1æ˜?
var fourthMenuRightLiList;
function init()
{
    top.initTextDirection(window);
	fourthMenuRightLiList = $("fourthMenuRight").getElementsByTagName("li");
	//é¢æ¿æŒ‰é”®å¤„ç†åœºæ™¯è®¾ç½®
	setting.contextOf5in1 = top.CONTEXT_MENU_SELECT;
	
	if(top.g_nextHtmlPage == "common_interface.html")
	{
		$("sndMenuLeft").style.display = "block";
		$("thdMenuLeft").style.display = "block";
		$("fourthMenuLeft").style.left = "80px";
		$("fourthMenuRight").style.left = "124px";
		isDirectToPage = 1;
		/*å¿…é¡»åœ¨æ­¤å¤„æ¶ˆé™¤æ‰ï¼Œä¸èƒ½å†uninitä¸­æ¶ˆé™¤ã€‚ä¸ç„¶çš„è¯å†è¯¥é¡µé¢æ¥data ready æ¶ˆæ¯å°†g_nextHtmlPageç½®ä¸ºcommon_interface.htmlï¼?
		ä½†æ˜¯å½“è·³è½¬é¡µé¢çš„æ—¶å€™g_nextHtmlPageåœ¨uninitä¸­åˆç½®ä¸ºç©ºäº†ï¼Œè¿™æ ·ä¼šå‡ºé”™*/
		top.g_nextHtmlPage = "";
	}
	else
	{
		$("sndMenuLeft").style.display = "none";
		$("thdMenuLeft").style.display = "none";
		isDirectToPage = 0;
	}
	
	$("fourthMenuRight").style.display = "block";
	top.stopTimeout();
	$('titleNameSpan').innerHTML = comIfaceWords[0];
	$("ciCardName").innerHTML = top.g_ciCurrentCardName;
	spanList = document.getElementsByClassName("showMenu")[0].getElementsByTagName("span");
	doCI();
	setting.setCIMsgResendFlag(top.E_CI_DATA_READY, 0);
	addMouseListener();
}

function uninit()
{
	top.clearMyTimeout();
}

function addMouseListener()
{
	document.body.onmousedown = function(evt){evt.preventDefault();
		if(evt.button == 2) toBack();//right key
	}
	
	//menu
	for(var i = 4; i < 11; i++)
	{
		fourthMenuRightLiList[i].setAttribute("newAttr",i);
		fourthMenuRightLiList[i].onmousedown = function(evt){
			if(evt.button == 0){//left key
				if(mimiType != 2)
				{
					list_position_h = parseInt(this.getAttribute("newAttr")) - 4;
					$("fourthListFocus").style.top = SUB_MENU_START + SUB_MENU_STEP*list_position_h + "px";
					doEnter();
				}
			}
		}
	}
}

</script>

<link rel="stylesheet" type="text/css" href="../all.css" />
<style type="text/css">
#title
{
	position:absolute;
	top:60px;
}
#keyRemind
{
	position:absolute;
	left:380px;
	bottom:30px;
	width:550px;
	color:#FFF;
	font-size:22px;
	font-weight:bold;
}
.list/* è®¾ç½® å…³äºåˆ—è¡¨æ¯é¡¹çš„å±æ€?/
{
	position:relative;
	width:900px;
	height:70px;
	color:#FFFFFF;
	top:10px;
}
#fourthListFocus/*è®¾å››çº§èœå•ä¸­ç„¦ç‚¹å±æ€?/
{
	position:absolute;
	width:896px;
	height:70px;
	top:130px;
	z-index:100;
}
#spanProperty1
{
	font-size:25px;
}

</style>
</head>

<body onLoad="init()" onUnload="uninit()" >
	<div id="sndMenuLeft" style="left:0px; display:none;"></div>
  	<div id="thdMenuLeft" style="left:40px; display:none;"></div>
	<div id="fourthMenuLeft"></div>
    <div id="fourthMenuRight" style="width:900px; display:none;">
        <div class="titleName">
            <span id="titleNameSpan" style="top:60px; position:absolute"></span>
        </div>
        <div class="showMenu" style="width:900px;">
    	<ul>
            <img id="fourthListFocus" src="../images/Focus_Frame/Focus.png" style="top:340px;">
            <!--<li	class="titleName">-->
            	<!--<label  id="title"></label>-->
            <!--</li>-->
            <li></li>
            <li class="list">
                <div id="ciCardName" class="listFirstProperty"></div>
            </li>
            <li class="list" >
                <div id="ciTitle" class="listFirstProperty" style="left:30px;"></div>
            </li>
             <li class="list" >
                <div id="subtitle" class="listFirstProperty" style="left:30px;"></div>
            </li>
             <li class="list" >
                <span id="spanProperty1" class="listFirstProperty1" style="left:50px;"></span>
            </li>
            <li class="list" >
                <span id="spanProperty1" class="listFirstProperty1" style="left:50px;"></span>
            </li>
            <li class="list" >
                <span id="spanProperty1" class="listFirstProperty1" style="left:50px;"></span>
            </li>
            <li class="list" >
                 <span id="spanProperty1" class="listFirstProperty1" style="left:50px;"></span>
            </li>
            <li class="list" >
                <span id="spanProperty1" class="listFirstProperty1" style="left:50px;"></span>
            </li>
            <li class="list" >
                <span id="spanProperty1" class="listFirstProperty1" style="left:50px;"></span>
            </li>
            <li class="list" >
                <span id="spanProperty1" class="listFirstProperty1" style="left:50px;"></span>
            </li>
   		</ul>
        </div>
   </div>
   
   <!----------------------country passStringä½¿ç”¨---------------------->
   <div id="passForm" class="dialogForm" style=" height:350px;top:300px;  left:65px;display:none;">
        <span id="passTitle" class="dialogTitle" ></span>
        <div class="dialogInput" style="top:130px;border:thin solid #FFF;background:#999;">
        	<span id="passInputTitle" class="dialogInputName"></span>
            <div id="passInputContent" class="dialogInputContent" style="width:600px;"></div>
        </div>
   </div>
   
   <div id="keyRemind"></div>
</body>
</html>
